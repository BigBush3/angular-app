{"code":"!function(){var t,n,e,r,a,i,o,s={version:\"0.7.35\",container:null,data:[]},l=10,u=1,c={},h={};if(s.display=function(f){var p,d=s.container,k=[],z=0,A=!1;G((t=P.set(f).applyDefaults(f)).zoomextend)&&(l=t.zoomextend),G(t.zoomlevel)&&(u=t.zoomlevel);var N=document.getElementById(t.container);if(N){e=\"#\"+t.container;var j=window.getComputedStyle(N,null);parseInt(j.width)||t.width||(N.style.width=H(N.parentNode.clientWidth))}else e=\"body\",N=null;var W=[16,16],$=Qt(),Z=G(t.background.width)?$+t.background.width:$,X=window.devicePixelRatio||1,J=Vt(t.projection,t.projectionRatio);if(J){t.lines.graticule.lat&&\"outline\"===t.lines.graticule.lat.pos[0]&&(J.scale-=2);var K=J.ratio,tt=Math.round($/K),rt=Math.round(Z/K),ht=J.scale*$/1024,ft=t.stars.size,pt=t.dsos.size||ft,dt=t.stars.exponent,gt=t.dsos.exponent||dt,vt=1,mt=b(t.center),bt=t.datapath;\"body\"!==e&&(N.style.height=H(rt)),n=s.projection(t.projection).rotate(mt).translate([Z/2,rt/2]).scale(ht*u),r=d3.geo.zoom().projection(n).center([Z/2,rt/2]).scaleExtent([ht,ht*l]).on(\"zoom.redraw\",jt),ht*=u;var wt=d3.select(e).selectAll(\"canvas\"),xt=\"\"!==t.culture&&\"iau\"!==t.culture?t.culture:\"\";0===wt[0].length&&(wt=d3.select(e).append(\"canvas\")),wt.style(\"width\",H(Z)).style(\"height\",H(rt)).attr(\"width\",Z*X).attr(\"height\",rt*X);var St=wt.node().getContext(\"2d\");St.setTransform(X,0,0,X,0,0);var _t=d3.geo.graticule().minorStep([15,10]);a=d3.geo.path().projection(n).context(St),d?d.selectAll(e+\" *\").remove():d=d3.select(e).append(\"container\"),t.interactive?(wt.call(r),d3.select(e).on(\"dblclick\",function(){return Tt(1.5625),!1})):wt.attr(\"style\",\"cursor: default!important\"),Rt(J.clip),d3.select(window).on(\"resize\",At),!0===t.interactive&&!0===t.controls&&null===U(\"celestial-zoomin\")&&(d3.select(e).append(\"input\").attr(\"type\",\"button\").attr(\"id\",\"celestial-zoomin\").attr(\"value\",\"+\").on(\"click\",function(){return Tt(1.25),!1}),d3.select(e).append(\"input\").attr(\"type\",\"button\").attr(\"id\",\"celestial-zoomout\").attr(\"value\",\"\\u2212\").on(\"click\",function(){return Tt(.8),!1})),i=d3.geo.circle().angle([90]),o=d3.geo.circle().angle([179.9]),function(t){var n=P.set(t),r=s.projections(),a=s.eulerAngles(),i=d3.select(e+\" ~ #celestial-form\");i.size()<1&&(i=d3.select(e).select(function(){return this.parentNode}).append(\"div\").attr(\"id\",\"celestial-form\"));var o=i.append(\"div\").attr(\"class\",\"ctrl\").append(\"form\").attr(\"id\",\"params\").attr(\"name\",\"params\").attr(\"method\",\"get\").attr(\"action\",\"#\"),l=o.append(\"div\").attr(\"class\",\"col\").attr(\"id\",\"general\");l.append(\"label\").attr(\"title\",\"Map width in pixel, 0 indicates full width\").attr(\"for\",\"width\").html(\"Width \"),l.append(\"input\").attr(\"type\",\"number\").attr(\"maxlength\",\"4\").attr(\"max\",\"20000\").attr(\"min\",\"0\").attr(\"title\",\"Map width\").attr(\"id\",\"width\").attr(\"value\",n.width).on(\"change\",function(){var t=this.value;!1!==at(this)&&(n.width=t,s.resize({width:t}))}),l.append(\"span\").html(\"px\"),l.append(\"label\").attr(\"title\",\"Map projection, (hemi) indicates hemispherical projection\").attr(\"for\",\"projection\").html(\"Projection\");var u=l.append(\"select\").attr(\"id\",\"projection\").on(\"change\",function(){this&&(n.projection=this.value,P.set(n),s.reproject(n))}),c=0,h=Object.keys(r).map(function(t,e){return t===n.projection&&(c=e),{o:t,n:r[t].clip&&!0===r[t].clip?r[t].n+\" (hemi)\":r[t].n}});u.selectAll(\"option\").data(h).enter().append(\"option\").attr(\"value\",function(t){return t.o}).text(function(t){return t.n}),u.property(\"selectedIndex\",c),c=0,l.append(\"label\").attr(\"title\",\"Coordinate space in which the map is displayed\").attr(\"for\",\"transform\").html(\"Coordinates\"),u=l.append(\"select\").attr(\"id\",\"transform\").on(\"change\",function(){var t=this.value,e=ot(t,n.transform);null!==e&&(n.center[0]=e),n.transform=t,P.set(n),s.reload(n)}),h=Object.keys(a).map(function(t,e){return t===n.transform&&(c=e),{o:t,n:t.replace(/^([a-z])/,function(t,n){return n.toUpperCase()})}}),u.selectAll(\"option\").data(h).enter().append(\"option\").attr(\"value\",function(t){return t.o}).text(function(t){return t.n}),u.property(\"selectedIndex\",c),l.append(\"br\"),l.append(\"label\").attr(\"title\",\"Center coordinates long/lat in selected coordinate space\").attr(\"for\",\"centerx\").html(\"Center\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"centerx\").attr(\"title\",\"Center right ascension/longitude\").attr(\"max\",\"24\").attr(\"min\",\"0\").attr(\"step\",\"0.1\").on(\"change\",m),l.append(\"span\").attr(\"id\",\"cxunit\").html(\"h\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"centery\").attr(\"title\",\"Center declination/latitude\").attr(\"max\",\"90\").attr(\"min\",\"-90\").attr(\"step\",\"0.1\").on(\"change\",m),l.append(\"span\").html(\"\\xb0\"),l.append(\"label\").attr(\"title\",\"Orientation\").attr(\"for\",\"centerz\").html(\"Orientation\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"centerz\").attr(\"title\",\"Center orientation\").attr(\"max\",\"180\").attr(\"min\",\"-180\").attr(\"step\",\"0.1\").on(\"change\",m),l.append(\"span\").html(\"\\xb0\"),l.append(\"label\").attr(\"for\",\"orientationfixed\").attr(\"class\",\"advanced\").html(\"Fixed\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"orientationfixed\").attr(\"class\",\"advanced\").property(\"checked\",n.orientationfixed).on(\"change\",S),l.append(\"label\").attr(\"title\",\"Center and zoom in on this constellation\").attr(\"for\",\"constellation\").html(\"Show\"),l.append(\"select\").attr(\"id\",\"constellation\").on(\"change\",function(){var t=this.value;t&&k(t)}),st(n.center,n.transform),(l=o.append(\"div\").attr(\"class\",\"col\").attr(\"id\",\"stars\")).append(\"label\").attr(\"class\",\"header\").attr(\"for\",\"stars-show\").html(\"Stars\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"stars-show\").property(\"checked\",n.stars.show).on(\"change\",S),l.append(\"label\").attr(\"for\",\"stars-limit\").html(\"down to magnitude\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"stars-limit\").attr(\"title\",\"Star display limit (magnitude)\").attr(\"value\",n.stars.limit).attr(\"max\",\"6\").attr(\"min\",\"-1\").attr(\"step\",\"0.1\").on(\"change\",S),l.append(\"label\").attr(\"for\",\"stars-colors\").html(\"with spectral colors\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"stars-colors\").property(\"checked\",n.stars.colors).on(\"change\",S),l.append(\"label\").attr(\"for\",\"stars-color\").html(\"or default color \"),l.append(\"input\").attr(\"type\",\"color\").attr(\"autocomplete\",\"off\").attr(\"id\",\"stars-style-fill\").attr(\"title\",\"Star color\").property(\"value\",n.stars.style.fill).on(\"change\",S),l.append(\"br\");var f=R.starnames[n.culture]||R.starnames.iau;for(var p in f)if(V(f,p)){var d=Object.keys(f[p]);d.length>1?(l.append(\"label\").attr(\"for\",\"stars-\"+p).html(\"Show\"),c=0,l.append(\"label\").attr(\"title\",\"Type of star name\").attr(\"id\",\"label-propername\").attr(\"for\",\"stars-\"+p+\"Type\").html(function(){return\"propername\"===p?\"proper names\":\"\"}),u=l.append(\"select\").attr(\"id\",\"stars-\"+p+\"Type\").attr(\"class\",function(){return\"propername\"===p?\"advanced\":\"\"}).on(\"change\",S),h=d.map(function(t,e){return t===n.stars[p+\"Type\"]&&(c=e),{o:t,n:f[p][t]}}),u.selectAll(\"option\").data(h).enter().append(\"option\").attr(\"value\",function(t){return t.o}).text(function(t){return t.n}),u.property(\"selectedIndex\",c),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"stars-\"+p).property(\"checked\",n.stars[p]).on(\"change\",S)):1===d.length&&(l.append(\"label\").attr(\"for\",\"stars-\"+p).html(\" \"+f[p][d[0]]),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"stars-\"+p).property(\"checked\",n.stars[p]).on(\"change\",S)),l.append(\"label\").attr(\"for\",\"stars-\"+p+\"Limit\").html(\"down to mag\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"stars-\"+p+\"Limit\").attr(\"title\",\"Star name display limit (magnitude)\").attr(\"value\",n.stars[p+\"Limit\"]).attr(\"max\",\"6\").attr(\"min\",\"-1\").attr(\"step\",\"0.1\").on(\"change\",S)}for(p in l.append(\"br\"),l.append(\"label\").attr(\"for\",\"stars-size\").attr(\"class\",\"advanced\").html(\"Stellar disk size: base\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"stars-size\").attr(\"class\",\"advanced\").attr(\"title\",\"Size of the displayed star disk; base\").attr(\"value\",n.stars.size).attr(\"max\",\"100\").attr(\"min\",\"0\").attr(\"step\",\"0.1\").on(\"change\",S),l.append(\"label\").attr(\"for\",\"stars-exponent\").attr(\"class\",\"advanced\").html(\" * e ^ (exponent\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"stars-exponent\").attr(\"class\",\"advanced\").attr(\"title\",\"Size of the displayed star disk; exponent\").attr(\"value\",n.stars.exponent).attr(\"max\",\"3\").attr(\"min\",\"-1\").attr(\"step\",\"0.01\").on(\"change\",S),l.append(\"span\").attr(\"class\",\"advanced\").text(\" * (magnitude + 2))  [* adaptation]\"),nt(ct(\"stars-show\")),(l=o.append(\"div\").attr(\"class\",\"col\").attr(\"id\",\"dsos\")).append(\"label\").attr(\"class\",\"header\").attr(\"title\",\"Deep Space Objects\").attr(\"for\",\"dsos-show\").html(\"DSOs\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"dsos-show\").property(\"checked\",n.dsos.show).on(\"change\",S),l.append(\"label\").attr(\"for\",\"dsos-limit\").html(\"down to mag\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"dsos-limit\").attr(\"title\",\"DSO display limit (magnitude)\").attr(\"value\",n.dsos.limit).attr(\"max\",\"6\").attr(\"min\",\"0\").attr(\"step\",\"0.1\").on(\"change\",S),l.append(\"label\").attr(\"for\",\"dsos-colors\").html(\"with symbol colors\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"dsos-colors\").property(\"checked\",n.dsos.colors).on(\"change\",S),l.append(\"label\").attr(\"for\",\"dsos-color\").html(\"or default color \"),l.append(\"input\").attr(\"type\",\"color\").attr(\"autocomplete\",\"off\").attr(\"id\",\"dsos-style-fill\").attr(\"title\",\"DSO color\").property(\"value\",n.dsos.style.fill).on(\"change\",S),l.append(\"br\"),f=R.dsonames[n.culture]||R.dsonames.iau)if(V(f,p)){var g=Object.keys(f[p]);l.append(\"label\").attr(\"for\",\"dsos-\"+p).html(\"Show\"),c=0,l.append(\"label\").attr(\"title\",\"Type of DSO name\").attr(\"for\",\"dsos-\"+p+\"Type\").attr(\"class\",\"advanced\").html(\"\"),u=l.append(\"select\").attr(\"id\",\"dsos-\"+p+\"Type\").attr(\"class\",\"advanced\").on(\"change\",S),h=g.map(function(t,e){return t===n.stars[p+\"Type\"]&&(c=e),{o:t,n:f[p][t]}}),u.selectAll(\"option\").data(h).enter().append(\"option\").attr(\"value\",function(t){return t.o}).text(function(t){return t.n}),u.property(\"selectedIndex\",c),l.append(\"label\").attr(\"for\",\"dsos-\"+p).html(\"names\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"dsos-\"+p).property(\"checked\",n.dsos[p]).on(\"change\",S)}for(p in l.append(\"label\").attr(\"for\",\"dsos-nameLimit\").html(\"down to mag\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"dsos-nameLimit\").attr(\"title\",\"DSO name display limit (magnitude)\").attr(\"value\",n.dsos.nameLimit).attr(\"max\",\"6\").attr(\"min\",\"0\").attr(\"step\",\"0.1\").on(\"change\",S),l.append(\"br\"),l.append(\"label\").attr(\"for\",\"dsos-size\").attr(\"class\",\"advanced\").html(\"DSO symbol size: (base\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"dsos-size\").attr(\"class\",\"advanced\").attr(\"title\",\"Size of the displayed symbol: base\").attr(\"value\",n.dsos.size).attr(\"max\",\"100\").attr(\"min\",\"0\").attr(\"step\",\"0.1\").on(\"change\",S),l.append(\"label\").attr(\"for\",\"dsos-exponent\").attr(\"class\",\"advanced\").html(\" * 2 [* adaptation] - magnitude) ^ exponent\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"dsos-exponent\").attr(\"class\",\"advanced\").attr(\"title\",\"Size of the displayed symbol; exponent\").attr(\"value\",n.dsos.exponent).attr(\"max\",\"3\").attr(\"min\",\"-1\").attr(\"step\",\"0.01\").on(\"change\",S),nt(ct(\"dsos-show\")),(l=o.append(\"div\").attr(\"class\",\"col\").attr(\"id\",\"constellations\")).append(\"label\").attr(\"class\",\"header\").html(\"Constellations\"),f=R.constellations[n.culture]||R.constellations.iau)if(V(f,p)){var v=Object.keys(f[p]);v.length>1?(l.append(\"label\").attr(\"for\",\"constellations-\"+p).html(\"Show\"),c=0,l.append(\"label\").attr(\"title\",\"Language of constellation names\").attr(\"for\",\"constellations-\"+p+\"Type\").attr(\"class\",\"advanced\").html(\"\"),u=l.append(\"select\").attr(\"id\",\"constellations-\"+p+\"Type\").attr(\"class\",\"advanced\").on(\"change\",S),h=v.map(function(t,e){return t===n.constellations[p+\"Type\"]&&(c=e),{o:t,n:f[p][t]}}),u.selectAll(\"option\").data(h).enter().append(\"option\").attr(\"value\",function(t){return t.o}).text(function(t){return t.n}),u.property(\"selectedIndex\",c),l.append(\"label\").attr(\"for\",\"constellations-\"+p).html(\"names\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"constellations-\"+p).property(\"checked\",n.constellations[p]).on(\"change\",S)):1===v.length&&(l.append(\"label\").attr(\"for\",\"constellations-\"+p).attr(\"class\",\"advanced\").html(\" \"+f[p][v[0]]),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"constellations-\"+p).attr(\"class\",\"advanced\").property(\"checked\",n.constellations[p]).on(\"change\",S))}l.append(\"label\").attr(\"for\",\"constellations-lines\").html(\" lines\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"constellations-lines\").property(\"checked\",n.constellations.lines).on(\"change\",S),l.append(\"label\").attr(\"for\",\"constellations-bounds\").html(\" boundaries\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"constellations-bounds\").property(\"checked\",n.constellations.bounds).on(\"change\",S),nt(ct(\"constellations-names\")),(l=o.append(\"div\").attr(\"class\",\"col\").attr(\"id\",\"lines\")).append(\"label\").attr(\"class\",\"header\").html(\"Lines\"),l.append(\"label\").attr(\"title\",\"Latitude/longitude grid lines\").attr(\"for\",\"lines-graticule\").html(\"Graticule\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"lines-graticule-show\").property(\"checked\",n.lines.graticule.show).on(\"change\",S),l.append(\"label\").attr(\"for\",\"lines-equatorial\").html(\"Equator\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"lines-equatorial-show\").property(\"checked\",n.lines.equatorial.show).on(\"change\",S),l.append(\"label\").attr(\"for\",\"lines-ecliptic\").html(\"Ecliptic\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"lines-ecliptic-show\").property(\"checked\",n.lines.ecliptic.show).on(\"change\",S),l.append(\"label\").attr(\"for\",\"lines-galactic\").html(\"Galactic plane\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"lines-galactic-show\").property(\"checked\",n.lines.galactic.show).on(\"change\",S),l.append(\"label\").attr(\"for\",\"lines-supergalactic\").html(\"Supergalactic plane\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"lines-supergalactic-show\").property(\"checked\",n.lines.supergalactic.show).on(\"change\",S),(l=o.append(\"div\").attr(\"class\",\"col\").attr(\"id\",\"other\")).append(\"label\").attr(\"class\",\"header\").html(\"Other\"),l.append(\"label\").attr(\"for\",\"mw-show\").html(\"Milky Way\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"mw-show\").property(\"checked\",n.mw.show).on(\"change\",S),l.append(\"label\").attr(\"for\",\"mw-style-fill\").attr(\"class\",\"advanced\").html(\" color\"),l.append(\"input\").attr(\"type\",\"color\").attr(\"id\",\"mw-style-fill\").attr(\"class\",\"advanced\").attr(\"title\",\"Milky Way color\").attr(\"value\",n.mw.style.fill).on(\"change\",S),l.append(\"label\").attr(\"for\",\"mw-style-opacity\").attr(\"class\",\"advanced\").html(\" opacity\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"mw-style-opacity\").attr(\"class\",\"advanced\").attr(\"title\",\"Transparency of each Milky Way layer\").attr(\"value\",n.mw.style.opacity).attr(\"max\",\"1\").attr(\"min\",\"0\").attr(\"step\",\"0.01\").on(\"change\",S),l.append(\"label\").attr(\"for\",\"advanced\").html(\"Advanced options\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"advanced\").property(\"checked\",n.advanced).on(\"change\",S),l.append(\"br\"),l.append(\"label\").attr(\"for\",\"background-fill\").html(\"Background color\"),l.append(\"input\").attr(\"type\",\"color\").attr(\"id\",\"background-fill\").attr(\"title\",\"Background color\").attr(\"value\",n.background.fill).on(\"change\",S),l.append(\"label\").attr(\"for\",\"background-opacity\").attr(\"class\",\"advanced\").html(\"opacity\"),l.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"background-opacity\").attr(\"class\",\"advanced\").attr(\"title\",\"Background opacity\").attr(\"value\",n.background.opacity).attr(\"max\",\"1\").attr(\"min\",\"0\").attr(\"step\",\"0.01\").on(\"change\",S),l.append(\"label\").attr(\"title\",\"Star/DSO sizes are increased with higher zoom-levels\").attr(\"for\",\"adaptable\").attr(\"class\",\"advanced\").html(\"Adaptable object sizes\"),l.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"adaptable\").attr(\"class\",\"advanced\").property(\"checked\",n.adaptable).on(\"change\",S);var M=F[n.culture];function m(){!1!==at(this)&&!1!==b()&&s.rotate(n)}function b(){var t=ct(\"centerx\"),e=ct(\"centery\"),r=ct(\"centerz\");if(t&&e){if(\"equatorial\"!==n.transform)n.center[0]=parseFloat(t.value);else{var a=parseFloat(t.value);n.center[0]=a>12?15*a-360:15*a}n.center[1]=parseFloat(e.value);var i=parseFloat(r.value);return n.center[2]=isNaN(i)?0:i,\"\"!==t.value&&\"\"!==e.value}}function x(t){var n=d3.time.format(\"%Y%m%dT%H%M%S%Z\"),e=\"d3-celestial\",r=s.date();return r&&(e+=n(r)),e+t}function k(t){var n,e=[],r=L;if(\"---\"===t)return s.constellation=null,1!==(n=s.zoomBy())&&e.push({param:\"zoom\",value:1/n,duration:0}),void s.animate(e,!1);if((\"function\"==(i=typeof(a=s.constellations))||\"object\"===i&&a)&&V(s.constellations,t)){var a,i,o=s.constellations[t],l=y(o.center,w[r.transform]);r.center=l,st(r.center,r.transform),1!==(n=s.zoomBy())&&e.push({param:\"zoom\",value:1/n,duration:0}),e.push({param:\"center\",value:l,duration:0}),e.push({param:\"zoom\",value:1+360/o.scale,duration:0}),s.constellation=t,s.animate(e,!1)}}function S(){var t,e=this;switch(Object.assign(n,P.set()),e.type){case\"checkbox\":t=e.checked,nt(e);break;case\"number\":if(!1===at(e))return;t=parseFloat(e.value);break;case\"color\":if(!1===it(e))return;t=e.value;break;case\"text\":if(-1===e.id.search(/fill$/))return;if(!1===it(e))return;t=e.value;break;case\"select-one\":t=e.value}null!==t&&(_(e.id,t),\"dsos-style-fill\"===e.id?(_(\"dsos-style-stroke\",t),_(\"dsos-nameStyle-fill\",t)):\"constellations-namesType\"===e.id?ut():\"lang\"===e.id?q(t):\"advanced\"===e.id&&lt(t),b(),Object.assign(L,n),s.apply(n))}function _(t,e){var r=t.split(\"-\");switch(r.length){case 1:n[r[0]]=e;break;case 2:n[r[0]][r[1]]=e;break;case 3:n[r[0]][r[1]][r[2]]=e;break;default:return}}function q(t){Object.assign(n,L),n.lang=t;for(var e=[\"constellations\",\"planets\"],r=0;r<e.length;r++)n[e[r]].namesType=V(R[e[r]][n.culture].names,t)?t:V(R[e[r]][n.culture].names,\"desig\")?\"desig\":\"name\";return n.dsos.namesType=V(R.dsonames[n.culture].names,t)?t:\"desig\",n.stars.propernameType=V(R.starnames[n.culture].propername,t)?t:\"desig\",Object.assign(L,n),T(),ut(),n}function T(){d3.selectAll(e+\" ~ #celestial-form input, \"+e+\" ~  #celestial-form select\").each(function(t,e){if(void 0!==this){var r=this.id;if(\"lat\"===r||\"lon\"===r)Y(n.geopos)&&(this.value=\"lat\"===r?n.geopos[0]:n.geopos[1]);else if(-1!==r.search(/center/)){if(Y(n.center))switch(r){case\"centerx\":this.value=n.center[0];break;case\"centery\":this.value=n.center[1];break;case\"centerz\":this.value=n.center[2]||0}}else{if(\"datetime\"===r||\"hr\"===r||\"min\"===r||\"sec\"===r||\"tz\"===r)return;if(\"button\"!==this.type){var a=z(r);switch(this.type){case\"checkbox\":this.checked=a,nt(r);break;case\"number\":if(!1===at(this))break;this.value=parseFloat(z(r));break;case\"color\":if(!1===it(this))break;this.value=a;break;case\"text\":if(-1===r.search(/fill$/))break;if(!1===it(this))break;this.value=a;break;case\"select-one\":this.value=a}}}}})}function z(t){var e=t.split(\"-\");switch(e.length){case 1:return n[e[0]];case 2:return n[e[0]][e[1]];case 3:return n[e[0]][e[1]][e[2]];default:return}}c=0,l.append(\"label\").attr(\"title\",\"General language setting\").attr(\"for\",\"lang\").html(\"Object names \"),u=l.append(\"select\").attr(\"id\",\"lang\").on(\"change\",S),h=M.map(function(t,e){return t===n.lang&&(c=e),{o:t,n:R.constellations[n.culture].names[t]}}),h=[{o:\"---\",n:\"(Select language)\"}].concat(h),u.selectAll(\"option\").data(h).enter().append(\"option\").attr(\"value\",function(t){return t.o}).text(function(t){return t.n}),u.property(\"selectedIndex\",c),(l=o.append(\"div\").attr(\"class\",\"col\").attr(\"id\",\"download\")).append(\"label\").attr(\"class\",\"header\").html(\"Download\"),l.append(\"input\").attr(\"type\",\"button\").attr(\"id\",\"download-png\").attr(\"value\",\"PNG Image\").on(\"click\",function(){var t=d3.select(\"body\").append(\"a\").node(),n=document.querySelector(e+\" canvas\");t.download=x(\".png\"),t.rel=\"noopener\",t.href=n.toDataURL(\"image/png\").replace(\"image/png\",\"image/octet-stream\"),t.click(),d3.select(t).remove()}),l.append(\"input\").attr(\"type\",\"button\").attr(\"id\",\"download-svg\").attr(\"value\",\"SVG File\").on(\"click\",function(){return yt(x(\".svg\")),!1}),function(){var t,n=/\\d+(\\.\\d+)?/g,e={s:6,d:6},r=s.settings();null!==(t=r.dsos.data.match(n))&&(e.d=parseFloat(t[t.length-1])),6!==e.d&&(ct(\"dsos-limit\").max=e.d,ct(\"dsos-nameLimit\").max=e.d),null!==(t=r.stars.data.match(n))&&(e.s=parseFloat(t[t.length-1])),6!=e.s&&(ct(\"stars-limit\").max=e.s,ct(\"stars-designationLimit\").max=e.s,ct(\"stars-propernameLimit\").max=e.s)}(),ot(n.transform),function(t,n){var r,a;if(V(t,\"formFields\"))if(!1!==t.form||!0!==t.location)for(a in!1===t.form&&d3.select(e+\" ~ #celestial-form\").style(\"display\",\"none\"),t.formFields)V(t.formFields,a)&&\"location\"!==a&&(r=!1===t.formFields[a]?\"none\":\"block\",d3.select(e+\" ~ #celestial-form\").select(\"#\"+a).style({display:r}));else for(a in d3.select(e+\" ~ #celestial-form\").style(\"display\",\"inline-block\"),t.formFields)V(t.formFields,a)&&\"location\"!==a&&d3.select(e+\" ~ #celestial-form\").select(\"#\"+a).style({display:\"none\"})}(t),lt(n.advanced),s.updateForm=T,s.showConstellation=k,s.setLanguage=function(t){var e=P.set();return-1!==F[n.culture].indexOf(t)&&(e=q(t)),e}}(t),null===U(\"error\")&&d3.select(\"body\").append(\"div\").attr(\"id\",\"error\"),null===U(\"loc\")?function(t){var n=d3.time.format(\"%Y-%m-%d %H:%M:%S\"),r=[0,0],a=[0,0],i=new Date,o=-i.getTimezoneOffset(),l=o,u=P.set(t),c=d3.select(e+\" ~ #celestial-form form\").insert(\"div\",\"div#general\").attr(\"id\",\"loc\"),h=new kt(u,function(t,n){ct(\"datetime\").value=w(t,n),l=n,q()});V(u,\"geopos\")&&null!==u.geopos&&2===u.geopos.length&&(a=u.geopos);var f=c.append(\"div\").attr(\"class\",\"col\").attr(\"id\",\"location\").style(\"display\",\"none\");f.append(\"label\").attr(\"title\",\"Location coordinates long/lat\").attr(\"for\",\"lat\").html(\"Location\"),f.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"lat\").attr(\"title\",\"Latitude\").attr(\"placeholder\",\"Latitude\").attr(\"max\",\"90\").attr(\"min\",\"-90\").attr(\"step\",\"0.0001\").attr(\"value\",a[0]).on(\"change\",function(){!0===at(this)&&q()}),f.append(\"span\").html(\"\\xb0\"),f.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"lon\").attr(\"title\",\"Longitude\").attr(\"placeholder\",\"Longitude\").attr(\"max\",\"180\").attr(\"min\",\"-180\").attr(\"step\",\"0.0001\").attr(\"value\",a[1]).on(\"change\",function(){!0===at(this)&&q()}),f.append(\"span\").html(\"\\xb0\"),\"geolocation\"in navigator&&f.append(\"input\").attr(\"type\",\"button\").attr(\"value\",\"Here\").attr(\"id\",\"here\").on(\"click\",function(){navigator.geolocation.getCurrentPosition(function(t){a=[B(t.coords.latitude,4),B(t.coords.longitude,4)],ct(\"lat\").value=a[0],ct(\"lon\").value=a[1],q()})}),f.append(\"label\").attr(\"title\",\"Local date/time\").attr(\"for\",\"datetime\").html(\" Date/time\"),f.append(\"input\").attr(\"type\",\"button\").attr(\"id\",\"day-left\").attr(\"title\",\"One day back\").on(\"click\",function(){i.setDate(i.getDate()-1),ct(\"datetime\").value=w(i,l),q()}),f.append(\"input\").attr(\"type\",\"text\").attr(\"id\",\"datetime\").attr(\"title\",\"Date and time\").attr(\"value\",w(i,l)).on(\"click\",b,!0).on(\"input\",function(){this.value=w(i,l),h.isVisible()||b()}),f.append(\"div\").attr(\"id\",\"datepick\").on(\"click\",b),f.append(\"input\").attr(\"type\",\"button\").attr(\"id\",\"day-right\").attr(\"title\",\"One day forward\").on(\"click\",function(){i.setDate(i.getDate()+1),ct(\"datetime\").value=w(i,l),q()}),f.append(\"input\").attr(\"type\",\"button\").attr(\"value\",\"Now\").attr(\"id\",\"now\").on(\"click\",function(){i.setTime(Date.now()),ct(\"datetime\").value=w(i,l),q()}),f.append(\"br\"),f.append(\"label\").attr(\"title\",\"Show horizon marker\").attr(\"for\",\"horizon-show\").html(\" Horizon marker\"),f.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"horizon-show\").property(\"checked\",u.horizon.show).on(\"change\",_),f.append(\"label\").attr(\"title\",\"Show daylight\").attr(\"for\",\"daylight-show\").html(\"Daylight sky\"),f.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"daylight-show\").property(\"checked\",u.daylight.show).on(\"change\",_),f.append(\"br\"),f.append(\"label\").attr(\"title\",\"Show solar system objects\").attr(\"for\",\"planets-show\").html(\" Planets, Sun & Moon\"),f.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"planets-show\").property(\"checked\",u.planets.show).on(\"change\",_);var p=R.planets[u.culture]||R.planets.iau;for(var d in p)if(V(p,d)){var g=Object.keys(p[d]);if(g.length>1){var v=\"symbol\"===d?\"as\":\"with\";f.append(\"label\").attr(\"for\",\"planets-\"+d+\"Type\").html(v);var M=0;f.append(\"label\").attr(\"title\",\"Type of planet name\").attr(\"for\",\"planets-\"+d+\"Type\").attr(\"class\",\"advanced\").html(\"\");var m=f.append(\"select\").attr(\"id\",\"planets-\"+d+\"Type\").on(\"change\",_),y=g.map(function(t,n){return t===u.planets[d+\"Type\"]&&(M=n),{o:t,n:p[d][t]}});m.selectAll(\"option\").data(y).enter().append(\"option\").attr(\"value\",function(t){return t.o}).text(function(t){return t.n}),m.property(\"selectedIndex\",M),\"names\"===d&&(m.attr(\"class\",\"advanced\"),f.append(\"label\").attr(\"for\",\"planets-\"+d).html(\"names\"),f.append(\"input\").attr(\"type\",\"checkbox\").attr(\"id\",\"planets-\"+d).property(\"checked\",u.planets[d]).on(\"change\",_))}}function b(){h.show(i,l)}function w(t,e){var r;if(e&&\"0\"!==e){var a=Math.floor(Math.abs(e)/60),i=Math.abs(e)-60*a;r=(e>0?\" +\":\" \\u2212\")+Q(a)+Q(i)}else r=\" \\xb10000\";return n(t)+r}function k(t){return!(!t||!Y(t)||t.length<2||!G(t[0])||t[0]<-90||t[0]>90||!G(t[1])||t[1]<-180||t[1]>180)}function S(t){return null!=t&&!(!G(t)&&Math.abs(t)>840)}function _(){Object.assign(u,P.set()),u.horizon.show=!!ct(\"horizon-show\").checked,u.daylight.show=!!ct(\"daylight-show\").checked,u.planets.show=!!ct(\"planets-show\").checked,u.planets.names=!!ct(\"planets-names\").checked,u.planets.namesType=ct(\"planets-namesType\").value,u.planets.symbolType=ct(\"planets-symbolType\").value,nt(ct(\"planets-show\")),s.apply(u)}function q(){var t=parseFloat(ct(\"lon\").value),e=parseFloat(ct(\"lat\").value);if(Object.assign(u,P.set()),i=n.parse(ct(\"datetime\").value.slice(0,-6)),!isNaN(t)&&!isNaN(e)){if(e!==a[0]||t!==a[1])return a=[e,t],void T([e,t]);ct(\"datetime\").value=w(i,l);var c=new Date(i.valueOf()-6e4*(l-o));(r=s.getPoint(x.inverse(c,[90,0],a),u.transform))[2]=0,\"zenith\"===u.follow?s.rotate({center:r}):s.redraw()}}function T(t,n){if(t&&V(u,\"settimezone\")&&!1!==u.settimezone){var e=Math.floor(i.getTime()/1e3),r=window&&\"https:\"===window.location.protocol?\"https\":\"http\";d3.json(r+\"://api.timezonedb.com/v2.1/get-time-zone?key=\"+u.timezoneid+\"&format=json&by=position&lat=\"+t[0]+\"&lng=\"+t[1]+\"&time=\"+e,function(n,e){if(n)return console.warn(n);l=\"FAILED\"===e.status?60*Math.round(t[1]/15):e.gmtOffset/60,ct(\"datetime\").value=w(i,l),q()})}}nt(ct(\"planets-show\")),lt(u.advanced),d3.select(document).on(\"mousedown\",function(){!function(t,n){for(;t.parentNode;){if(\"celestial-date\"===t.id)return!0;t=t.parentNode}return!1}(d3.event.target)&&h.isVisible()&&h.hide()}),s.dateFormat=w,s.date=function(t,n){if(!t)return i;S(n)&&(l=n),Object.assign(u,P.set()),h.isVisible()&&h.hide(),i.setTime(t.valueOf()),ct(\"datetime\").value=w(t,l),q()},s.timezone=function(t){if(!t)return l;S(t)&&(l=t),Object.assign(u,P.set()),h.isVisible()&&h.hide(),ct(\"datetime\").value=w(i,l),q()},s.position=function(){return a},s.location=function(t,n){if(!t||t.length<2)return a;k(t)&&(a=t.slice(),ct(\"lat\").value=a[0],ct(\"lon\").value=a[1],S(n)?l=n:T(a))},s.skyview=function(t){if(!t)return{date:i,location:a,timezone:l};var n,e=!1;if(h.isVisible()&&h.hide(),V(t,\"timezone\")&&S(t.timezone)&&(l=t.timezone,e=!0),V(t,\"date\")&&(n=t.date)&&n instanceof Date&&!isNaN(n)&&(i.setTime(t.date.valueOf()),ct(\"datetime\").value=w(t.date,l),e=!0),!V(t,\"location\")||!k(t.location)||(a=t.location.slice(),ct(\"lat\").value=a[0],ct(\"lon\").value=a[1],V(t,\"timezone\")))return!1===e?{date:i,location:a,timezone:l}:void(\"zenith\"===u.follow?q():s.redraw());T(a,V(t,\"date\"))},s.dtLoc=s.skyview,s.zenith=function(){return r},s.nadir=function(){var t=r[0]+180;return t>180&&(t-=360),[t,-r[1]-.001]},!V(u,\"formFields\")||!0!==u.location&&!0!==u.formFields.location||d3.select(e+\" ~ #celestial-form\").select(\"#location\").style({display:\"inline-block\"}),!k(a)||!0!==u.location&&!0!==u.formFields.location||\"zenith\"!==u.follow||setTimeout(q,1e3)}(t):!0===t.location&&\"zenith\"===t.follow&&Et({center:s.zenith()}),!0!==t.location&&!0!==t.formFields.location||(d3.select(e+\" #location\").style(\"display\",\"inline-block\"),et(\"horizon-show\",J.clip),et(\"daylight-show\",!J.clip)),this.container=d,this.clip=Pt,this.map=a,this.mapProjection=n,this.context=St,this.metrics=function(){return{width:$,height:tt,margin:W,scale:n.scale()}},this.setStyle=Ct,this.setTextStyle=Dt,this.setStyleA=It,this.setConstStyle=function(t,n){var e=C(n);St.font=e[t]},this.symbol=O.symbol,this.dsoSymbol=Ut,this.redraw=jt,this.resize=function(n){return void 0!==n&&(V(n,\"width\")?t.width=n.width:G(n)&&(t.width=n)),At(!0),t.width},this.reload=function(r){var a;r&&Object.assign(t,P.set(r)),\"center\"===t.follow&&V(t,\"center\")?a=b(t.center):\"zenith\"===t.follow&&(a=b(s.zenith())),a&&n.rotate(a),d.selectAll(e+\" *\").remove(),qt()},this.apply=function(t){zt(t)},this.reproject=function(t){return Nt(t)},this.rotate=function(n){return n?Et(n):t.center},this.zoomBy=function(t){return t?Tt(t):n.scale()/ht},this.color=function(n){return n&&V(t.dsos.symbols,n)?t.dsos.symbols[n].fill:\"#000\"},this.starColor=Ht,this.animate=function(t,n){t&&(k=t,z=0,A=!!n,Gt())},this.stop=function(t){clearTimeout(p),!0===t&&(k=[])},this.go=function(t){k.length<1||(t&&t<k.length&&(z=t),Gt())},qt()}function qt(){for(var n in Rt(J.clip),d.append(\"path\").datum(_t.outline).attr(\"class\",\"outline\"),d.append(\"path\").datum(i).attr(\"class\",\"horizon\"),d.append(\"path\").datum(o).attr(\"class\",\"daylight\"),_t.minorStep(\"equatorial\"===t.transform?[15,10]:[10,10]),t.lines)V(t.lines,n)&&(\"graticule\"===n?(d.append(\"path\").datum(_t).attr(\"class\",\"graticule\"),V(t.lines.graticule,\"lon\")&&t.lines.graticule.lon.pos.length>0&&d.selectAll(e+\" .gridvalues_lon\").data(E(\"lon\",t.lines.graticule.lon.pos)).enter().append(\"path\").attr(\"class\",\"graticule_lon\"),V(t.lines.graticule,\"lat\")&&t.lines.graticule.lat.pos.length>0&&d.selectAll(e+\" .gridvalues_lat\").data(E(\"lat\",t.lines.graticule.lat.pos)).enter().append(\"path\").attr(\"class\",\"graticule_lat\")):d.append(\"path\").datum(d3.geo.circle().angle([90]).origin(y(g[n],w[t.transform]))).attr(\"class\",n));d3.json(bt+\"mw.json\",function(n,r){if(n)return window.alert(\"Data file could not be loaded or doesn't exist. See readme.md\"),console.warn(n);var a=_(r,t.transform),i=T(a);d.selectAll(e+\" .mway\").data(a.features).enter().append(\"path\").attr(\"class\",\"mw\"),d.selectAll(e+\" .mwaybg\").data(i.features).enter().append(\"path\").attr(\"class\",\"mwbg\"),jt()}),d3.json(bt+Ft(\"constellations\"),function(n,r){if(n)return console.warn(n);var a=_(r,t.transform);d.selectAll(e+\" .constnames\").data(a.features).enter().append(\"text\").attr(\"class\",\"constname\"),s.constellations=function(t){for(var n={},e=t.features,r=0;r<e.length;r++)n[e[r].id]={center:e[r].properties.display.slice(0,2),scale:e[r].properties.display[2]};return n}(a),jt()}),d3.json(bt+Ft(\"constellations\",\"borders\"),function(n,r){if(n)return console.warn(n);var a=_(r,t.transform);d.selectAll(e+\" .bounds\").data(a.features).enter().append(\"path\").attr(\"class\",\"boundaryline\"),jt()}),d3.json(bt+Ft(\"constellations\",\"lines\"),function(n,r){if(n)return console.warn(n);var a=_(r,t.transform);d.selectAll(e+\" .lines\").data(a.features).enter().append(\"path\").attr(\"class\",\"constline\"),ut(),jt()}),d3.json(bt+t.stars.data,function(n,r){if(n)return console.warn(n);var a=_(r,t.transform);d.selectAll(e+\" .stars\").data(a.features).enter().append(\"path\").attr(\"class\",\"star\"),jt()}),d3.json(bt+Ft(\"starnames\"),function(t,n){if(t)return console.warn(t);Object.assign(c,n),jt()}),d3.json(bt+t.dsos.data,function(n,r){if(n)return console.warn(n);var a=_(r,t.transform);d.selectAll(e+\" .dsos\").data(a.features).enter().append(\"path\").attr(\"class\",\"dso\"),jt()}),d3.json(bt+Ft(\"dsonames\"),function(t,n){if(t)return console.warn(t);Object.assign(h,n),jt()}),d3.json(bt+Ft(\"planets\"),function(n,r){if(n)return console.warn(n);var a=function(n){var e=[];for(var r in n)if(V(n,r)&&-1!==t.planets.which.indexOf(r)){var a=Mt().id(r);V(n[r],\"parent\")&&a.parentBody(n[r].parent),a.elements(n[r].elements[0]).params(n[r]),\"ter\"===r?s.origin=a:e.push(a)}return e}(r);d.selectAll(e+\" .planets\").data(a).enter().append(\"path\").attr(\"class\",\"planet\"),jt()}),s.data.length>0&&s.data.forEach(function(t){V(t,\"file\")?d3.json(t.file,t.callback):setTimeout(t.callback,0)},this),t.lang&&\"\"!=t.lang&&zt(s.setLanguage(t.lang))}function Tt(e){if(e&&1!==e){var a=n.scale(),i=a*e,o=r.scaleExtent(),s=1500*Math.sqrt(Math.abs(1-e));if(i<o[0]&&(i=o[0]),i>o[1]&&(i=o[1]),!0===t.disableAnimations)return n.scale(i),r.scale(i),jt(),0;var l=d3.interpolateNumber(a,i);return d3.select({}).transition().duration(s).tween(\"scale\",function(){return function(t){var e=l(t);n.scale(e),jt()}}).transition().duration(0).tween(\"scale\",function(){r.scale(i),jt()}),s}}function zt(n){t=P.set(n),jt()}function Et(e){var r,a,i,o=t.center,s=n.rotate(),l=n.scale(),u=2e3,c=!1,h=t.orientationfixed;B(s[1],1)===-B(e.center[1],1)&&(c=!0),t=t.set(e);var f,p,d=B(d3.geo.distance(o,t.center),2),g=d3.geo.distance([o[2],0],[t.center[2],0]);return d<.035&&g<.035||!0===t.disableAnimations?(mt=b(t.center),n.rotate(mt),jt(),0):(a=l>1.4*ht?d3.interpolateNumber(l,ht):function(){return l},i=0===g?function(){return s[2]}:(f=((f=o[2])*m+v)%v,p=((p=t.center[2])*m+v)%v,Math.abs(f-p)>Math.PI&&(f>p?f-=v:p>f&&(p-=v)),d3.interpolateNumber(f/m,p/m)),d>3.14&&(t.center[0]-=.01),t.orientationfixed=!1,r=0===d?function(){return t.center}:d3.geo.interpolate(o,t.center),u=0!==d?u*d:u*g,d3.select({}).transition().duration(u).tween(\"center\",function(){return function(t){var e=b(r(t));e[2]=i(t);var o=a(t<.5?t:1-t);c&&(e[1]=s[1]),n.scale(o),n.rotate(e),jt()}}).transition().duration(0).tween(\"center\",function(){t.orientationfixed=h,mt=b(t.center),n.rotate(mt),jt()}),u)}function At(e){$=Qt(),(t.width!==$||e)&&(tt=$/K,Z=G(t.background.width)?$+t.background.width:$,rt=Math.round(Z/K),ht=J.scale*$/1024,wt.style(\"width\",H(Z)).style(\"height\",H(rt)).attr(\"width\",Z*X).attr(\"height\",rt*X),r.scaleExtent([ht,ht*l]).scale(ht*u),n.translate([Z/2,rt/2]).scale(ht*u),N&&(N.style.height=H(tt)),ht*=u,jt())}function Nt(e){var i=Vt(e.projection,e.projectionRatio);if(i){var o=n.rotate(),c=n.center(),h=n.scale(),f=r.scaleExtent(),p=s.projection(t.projection).center(c).translate([Z/2,rt/2]).scale([f[0]]),d=2500,g=0,v=d3.interpolateNumber(K,i.ratio);J.clip==i.clip&&!0!==t.disableAnimations||(d=0),Rt(i.clip);var M=s.projection(e.projection).center(c).translate([Z/2,Z/i.ratio/2]).scale([i.scale*$/1024]),m=t.adaptable;return h>f[0]?(g=Tt(.1),setTimeout(Nt,g,e),g+d):((t.location||t.formFields.location)&&(et(\"horizon-show\",i.clip),et(\"daylight-show\",!i.clip)),n=function(t,n){var e,r=d3.geo.projection(function(r,a){var i=t([r*=180/Math.PI,a*=180/Math.PI]),o=n([r,a]);return[(1-e)*i[0]+e*o[0],(e-1)*i[1]-e*o[1]]}).scale(1),a=r.center,i=r.translate;return r.alpha=function(o){if(!arguments.length)return e;e=+o;var s=t.center(),l=n.center(),u=t.translate(),c=n.translate();return a([(1-e)*s[0]+e*l[0],(1-e)*s[1]+e*l[1]]),i([(1-e)*u[0]+e*c[0],(1-e)*u[1]+e*c[1]]),r},delete r.translate,delete r.center,r.alpha(0)}(p,M),t.adaptable=!1,d3.select({}).transition().duration(d).tween(\"projection\",function(){return function(t){n.alpha(t).rotate(o),a.projection(n),Rt(i.clip),K=v(t),tt=$/K,wt.style(\"width\",H(Z)).style(\"height\",H(rt)).attr(\"width\",Z*X).attr(\"height\",rt*X),N&&(N.style.height=H(rt)),jt()}}).transition().duration(0).tween(\"projection\",function(){K=(J=i).ratio,tt=$/J.ratio,rt=G(t.background.width)?tt+t.background.width:tt,ht=J.scale*$/1024,wt.style(\"width\",H(Z)).style(\"height\",H(rt)).attr(\"width\",Z*X).attr(\"height\",rt*X),N&&(N.style.height=H(rt)),t.projection=e.projection,n=s.projection(e.projection).rotate(o).translate([Z/2,rt/2]).scale(ht*u),a.projection(n),Rt(J.clip),r.projection(n).scaleExtent([ht,ht*l]).scale(ht*u),t.adaptable=m,ht*=u,jt()}),d)}}function jt(){var r,u,f,p,g=n.rotate();for(var v in St.setTransform(X,0,0,X,0,0),t.adaptable&&(vt=Math.sqrt(n.scale()/ht)),vt||(vt=1),ft=t.stars.size,dt=t.stars.exponent,pt=t.dsos.size||ft,gt=t.dsos.exponent,t.orientationfixed&&t.center.length>2&&(g[2]=t.center[2],n.rotate(g)),t.center=[-g[0],-g[1],g[2]],st(t.center,t.transform),St.clearRect(0,0,Z+W[0],rt+W[1]),Lt(),t.mw.show&&(d.selectAll(e+\" .mw\").each(function(n){Ct(t.mw.style),a(n),St.fill()}),\"supergalactic\"!==t.transform&&t.background.opacity>.95&&d.selectAll(e+\" .mwbg\").each(function(n){Ct(t.background),a(n),St.fill()})),t.lines)V(t.lines,v)&&!0===t.lines[v].show&&(Ct(t.lines[v]),d.selectAll(e+\" .\"+v).attr(\"d\",a),St.stroke());if(V(t.lines.graticule,\"lon\")&&(Dt(t.lines.graticule.lon),d.selectAll(e+\" .graticule_lon\").each(function(t,e){if(Pt(t.geometry.coordinates)){var r=n(t.geometry.coordinates);Bt(r,t.properties.orientation),St.fillText(t.properties.value,r[0],r[1])}})),V(t.lines.graticule,\"lat\")&&(Dt(t.lines.graticule.lat),d.selectAll(e+\" .graticule_lat\").each(function(t,e){if(Pt(t.geometry.coordinates)){var r=n(t.geometry.coordinates);Bt(r,t.properties.orientation),St.fillText(t.properties.value,r[0],r[1])}})),t.constellations.bounds&&(d.selectAll(e+\" .boundaryline\").each(function(n){if(Ct(t.constellations.boundStyle),s.constellation){var e=new RegExp(\"\\\\b\"+s.constellation+\"\\\\b\");-1!==n.ids.search(e)&&(St.lineWidth*=1.5,St.globalAlpha=1,St.setLineDash([]))}a(n),St.stroke()}),St.setLineDash([])),t.constellations.lines&&d.selectAll(e+\" .constline\").each(function(n){It(n.properties.rank,t.constellations.lineStyle),a(n),St.stroke()}),Lt(!0),t.constellations.names&&d.selectAll(e+\" .constname\").each(function(e){if(Pt(e.geometry.coordinates)){It(e.properties.rank,t.constellations.nameStyle);var r=n(e.geometry.coordinates);St.fillText(function(n){return n.properties[t.constellations.namesType]}(e),r[0],r[1])}}),t.stars.show&&(Ct(t.stars.style),d.selectAll(e+\" .star\").each(function(e){if(Pt(e.geometry.coordinates)&&e.properties.mag<=t.stars.limit){var r=n(e.geometry.coordinates),a=function(t){var n=t.properties.mag;if(null===n)return.1;var e=ft*vt*Math.exp(dt*(n+2));return Math.max(e,.1)}(e);St.fillStyle=Ht(e),St.beginPath(),St.arc(r[0],r[1],a,0,2*Math.PI),St.closePath(),St.fill(),t.stars.designation&&e.properties.mag<=t.stars.designationLimit*vt&&(Dt(t.stars.designationStyle),St.fillText(V(c,i=e.id)?c[i][t.stars.designationType]:\"\",r[0]+a,r[1])),t.stars.propername&&e.properties.mag<=t.stars.propernameLimit*vt&&(Dt(t.stars.propernameStyle),St.fillText(function(n){var e=t.stars.propernameType;return V(c,n)?V(c[n],e)?c[n][e]:c[n].name:\"\"}(e.id),r[0]-a,r[1]))}var i})),t.dsos.show&&d.selectAll(e+\" .dso\").each(function(e){if(Pt(e.geometry.coordinates)&&Ot(e.properties,t.dsos.limit)){var r=n(e.geometry.coordinates),a=e.properties.type;Ct(!0===t.dsos.colors?t.dsos.symbols[a]:t.dsos.style);var i=Ut(e,r);V(t.dsos.symbols[a],\"stroke\")?St.stroke():St.fill(),t.dsos.names&&Ot(e.properties,t.dsos.nameLimit*vt)&&(Dt(t.dsos.nameStyle),!0===t.dsos.colors&&(St.fillStyle=t.dsos.symbols[a].fill),St.fillText(function(n){var e=t.dsos.namesType,r=n.id;return\"desig\"!==e&&V(h,r)&&V(h[r],e)?h[r][e]:n.properties.desig}(e),r[0]+i,r[1]-i))}}),(t.location||t.formFields.location)&&t.planets.show&&s.origin){var M=s.date(),m=s.origin(M).spherical();d.selectAll(e+\" .planet\").each(function(e){var r,a,i=e.id(),o=12*vt,s=e(M).equatorial(m),l=y(s.ephemeris.pos,w[t.transform]);if(Pt(l)){var u=n(l),c=t.planets.symbols[i];if(\"letter\"===t.planets.symbolType?(Dt(t.planets.symbolStyle),St.fillStyle=c.fill,St.fillText(c.letter,u[0],u[1])):\"lun\"===i?(V(c,\"size\")&&G(c.size)&&(o=c.size*vt),St.fillStyle=c.fill,O.symbol().type(\"crescent\").size(o*o).age(s.ephemeris.age).position(u)(St)):\"disk\"===t.planets.symbolType?(o=V(c,\"size\")&&G(c.size)?c.size*vt:function(t){var n=t.mag;if(null===n)return 2;var e=4*vt*Math.exp(-.05*(n+2));return Math.max(e,2)}(s.ephemeris),St.fillStyle=c.fill,O.symbol().type(\"circle\").size(o*o).position(u)(St),St.fill()):\"symbol\"===t.planets.symbolType&&(Dt(t.planets.symbolStyle),St.font=(a=(r=t.planets.symbolStyle.font).replace(/(^\\D*)(\\d+)(\\D.+$)/i,\"$2\"),a=Math.round(vt*a),r.replace(/(^\\D*)(\\d+)(\\D.+$)/i,\"$1\"+a+\"$3\")),St.fillStyle=c.fill,St.fillText(c[t.planets.symbolType],u[0],u[1])),t.planets.names){var h=s[t.planets.namesType];Dt(t.planets.nameStyle),St.fillStyle=c.fill,St.fillText(h,u[0]-o/2,u[1]+o/2)}}})}if(s.data.length>0&&s.data.forEach(function(t){t.redraw()}),(t.location||t.formFields.location)&&t.daylight.show&&J.clip){var b=q(\"sol\");if(b){var x=s.zenith(),k=b.ephemeris.pos,_=d3.geo.distance(x,k),T=n(k);o.origin(k),function(t,n){var e,r,a,i,o=1.36;if(t>1.885)return St.fillStyle=\"transparent\",void(St.globalAlpha=0);t<=o?(r=\"#daf1fa\",a=\"#93d7f0\",i=\"#57c0e8\",e=-(o-t)/10):(e=(t-o)/(1.885-o),r=d3.interpolateLab(\"#daf1fa\",\"#e8c866\")(e),a=d3.interpolateLab(\"#93c7d0\",\"#ff854a\")(e),i=d3.interpolateLab(\"#57b0c8\",\"#6caae2\")(e));var s=St.createRadialGradient(n[0],n[1],0,n[0],n[1],300);s.addColorStop(0,r),s.addColorStop(.2+.4*e,a),s.addColorStop(1,i),St.fillStyle=s,St.globalAlpha=.9*(1-(Math.pow(Math.E,1.4*e)-1)/(Math.pow(Math.E,1.4)-1))}(_,T),d.selectAll(e+\" .daylight\").datum(o).attr(\"d\",a),St.fill(),St.fillStyle=\"#fff\",Pt(k)&&(St.beginPath(),St.arc(T[0],T[1],6,0,2*Math.PI),St.closePath(),St.fill())}}(t.location||t.formFields.location)&&t.horizon.show&&!J.clip&&(i.origin(s.nadir()),Ct(t.horizon),d.selectAll(e+\" .horizon\").datum(i).attr(\"d\",a),St.fill(),t.horizon.stroke&&St.stroke()),t.controls&&(r=n.scale(),u=U(\"celestial-zoomin\"),f=U(\"celestial-zoomout\"),p=J.scale*$/1024,u&&f&&(u.disabled=r>=p*l*.99,f.disabled=r<=p)),S&&s.runCallback()}function Lt(r){var i=n.rotate();Vt(t.projection,f.projectionRatio),n.rotate([0,0]),Ct(t.background),d.selectAll(e+\" .outline\").attr(\"d\",a),!0===r?(St.globalAlpha=1,St.stroke()):St.fill(),n.rotate(i)}function Pt(n){return J.clip&&d3.geo.distance(t.center,n)>M?0:1}function Ct(t){St.fillStyle=t.fill||null,St.strokeStyle=t.stroke||null,St.lineWidth=t.width||null,St.globalAlpha=null!==t.opacity?t.opacity:1,St.font=t.font||null,V(t,\"dash\")?St.setLineDash(t.dash):St.setLineDash([]),St.beginPath()}function Dt(t){St.fillStyle=t.fill,St.textAlign=t.align||\"left\",St.textBaseline=t.baseline||\"bottom\",St.globalAlpha=null!==t.opacity?t.opacity:1,St.font=t.font}function It(t,n){t=t||1,St.fillStyle=Y(n.fill)?n.fill[t-1]:null,St.strokeStyle=Y(n.stroke)?n.stroke[t-1]:null,St.lineWidth=Y(n.width)?n.width[t-1]:null,St.globalAlpha=Y(n.opacity)?n.opacity[t-1]:1,St.font=Y(n.font)?n.font[t-1]:null,V(n,\"dash\")?St.setLineDash(n.dash):St.setLineDash([]),St.textAlign=n.align||\"left\",St.textBaseline=n.baseline||\"bottom\",St.beginPath()}function Rt(t){n.clipAngle(t?90:null)}function Ft(t,n,e){return t+(n=n?\".\"+n:\"\")+(V(R[t],xt)?\".\"+xt:\"\")+(e?\".\"+e:\".json\")}function Ot(t,n){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>n||999!==t.mag&&t.mag<=n}function Ut(n,e){var r=n.properties,a=function(t){return t.mag&&999!==t.mag?Math.pow(2*pt*vt-t.mag,gt):Math.pow(parseInt(t.dim)*pt*vt/7,.5)}(r)||9,i=function(n){return n&&V(t.dsos.symbols,n)?t.dsos.symbols[n].shape:\"circle\"}(r.type);return O.symbol().type(i).size(a).position(e)(St),Math.sqrt(a)/2}function Ht(n){var e=n.properties.bv;return!t.stars.colors||isNaN(e)?t.stars.style.fill:D(e)}function Bt(t,n){for(var e=n.split(\"\"),r=\"center\",a=\"middle\",i=e.length-1;i>=0;i--)switch(e[i]){case\"N\":a=\"bottom\";break;case\"S\":a=\"top\";break;case\"E\":r=\"left\",t[0]+=2;break;case\"W\":r=\"right\",t[0]-=2}return St.textAlign=r,St.textBaseline=a,t}function Qt(){return G(t.width)&&t.width>0?t.width:N?N.getBoundingClientRect().width-2*W[0]:window.getBoundingClientRect().width-2*W[0]}function Vt(t,n){if(V(I,t)){var e=I[t];return V(e,\"ratio\")||(e.ratio=2),e.ratio=n||e.ratio,e}}function Gt(){if(k&&!(k.length<1)){var t,n=k[z];switch(n.param){case\"projection\":t=Nt({projection:n.value});break;case\"center\":t=Et({center:n.value});break;case\"zoom\":t=Tt(n.value)}n.callback&&setTimeout(n.callback,t),z++,!0===A&&z===k.length&&(z=0),t=0===n.duration||n.duration<t?t:n.duration,z<k.length&&(p=setTimeout(Gt,t))}}},\"object\"==typeof module&&module.exports){var f=require(\"./lib/d3.js\"),p=require(\"./lib/d3.geo.projection.js\");module.exports={Celestial:function(){return s},d3:function(){return f},\"d3.geo.projection\":function(){return p}}}s.projection=function(t){var n,e,r;if(!V(I,t))throw new Error(\"Projection not supported: \"+t);return e=null!==(n=I[t]).arg?d3.geo[t].raw(n.arg):d3.geo[t].raw,(r=function(t,n){return e(-t,n)}).invert=function(t,n){try{var r=e.invert(t,n);return r[0]=r&&-r[0],r}catch(a){console.log(a)}},d3.geo.projection(r)};var d={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},g={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};s.eulerAngles=function(){return d},s.poles=function(){return g};var v=2*Math.PI,M=Math.PI/2,m=Math.PI/180;function y(t,n){return function(t,n){var e,r,a,i,o,s,l,u,c;return n?((s=t[0])<0&&(s+=v),l=t[1],s-=n[0],i=n[1],o=n[2],e=Math.sin(l)*Math.sin(i)-Math.cos(l)*Math.cos(i)*Math.cos(s),Math.abs(e)<1e-5&&(e=-Math.cos(l+i)+Math.cos(l)*Math.cos(i)*(1-Math.cos(s))),r=-Math.cos(l)*Math.sin(s),(u=o+(0!==e||0!==r?Math.atan2(r,e):s-Math.PI))>Math.PI&&(u-=v),s%Math.PI==0?((c=l+Math.cos(s)*i)>M&&(c=Math.PI-c),c<-M&&(c=-Math.PI-c)):(a=Math.sin(l)*Math.cos(i)+Math.cos(l)*Math.sin(i)*Math.cos(s),Math.abs(a)>.99?(c=Math.abs(Math.acos(Math.sqrt(e*e+r*r))),a<0&&(c*=-1)):c=Math.asin(a)),[u,c]):t}(t.map(function(t){return t*m}),n).map(function(t){return t/m})}function b(t){if(null===t||t.length<=0)return[0,0,0];var n=d.equatorial;return t[2]||(t[2]=0),[n[0]-t[0],n[1]-t[1],n[2]+t[2]]}var w={ecliptic:[-90,23.4393,90],\"inverse ecliptic\":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],\"inverse galactic\":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],\"inverse supergalactic\":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*m}))},add:function(t,n){if(n&&t&&3===n.length&&!this.hasOwnProperty(t))return this[t]=n.map(function(t){return t*m}),this[t]}};w.init(),s.euler=function(){return w};var x=function(t,n,e){var r=k(t,e[1])-n[0];r<0&&(r+=360),r*=m;var a=n[1]*m,i=e[0]*m,o=Math.asin(Math.sin(a)*Math.sin(i)+Math.cos(a)*Math.cos(i)*Math.cos(r)),s=Math.acos((Math.sin(a)-Math.sin(o)*Math.sin(i))/(Math.cos(o)*Math.cos(i)));return Math.sin(r)>0&&(s=2*Math.PI-s),[o/m,s/m,0]};function k(t,n){var e=t.getUTCFullYear(),r=t.getUTCMonth()+1,a=t.getUTCDate(),i=t.getUTCHours(),o=t.getUTCMinutes(),s=t.getUTCSeconds();1!=r&&2!=r||(e-=1,r+=12);var l=Math.floor(e/100),u=2-l+Math.floor(l/4)+Math.floor(365.25*e)+Math.floor(30.6001*(r+1))-730550.5+a+(i+o/60+s/3600)/24,c=u/36525,h=280.46061837+360.98564736629*u+387933e-9*c*c-c*c*c/3871e4+n;if(h>0)for(;h>360;)h-=360;else for(;h<0;)h+=360;return h}x.inverse=function(t,n,e){var r=n[0]*m,a=n[1]*m,i=e[0]*m,o=Math.asin(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(a)),s=((Math.sin(r)-Math.sin(o)*Math.sin(i))/(Math.cos(o)*Math.cos(i))).toFixed(6);return s=Math.acos(s),s/=m,[k(t,e[1])-s,o/m,0]},s.horizontal=x,s.ha=function(t,n,e){var r=k(t,n)-e;return r<180&&(r+=360),r};var S=!1;function _(t,n){if(\"equatorial\"===n)return t;for(var e=w[n],r=t.features,a=0;a<r.length;a++)r[a].geometry.coordinates=z(r[a],e);return t}function q(t,n){if(n=n||s.date(),s.origin){var e,r=s.origin(n).spherical();return s.container.selectAll(\".planet\").each(function(a){t===a.id()&&(e=a(n).equatorial(r))}),e}}function T(t){var n={type:\"FeatureCollection\",features:[{type:\"Feature\",geometry:{type:\"MultiPolygon\",coordinates:[]}}]},e=t.features[0].geometry.coordinates[0];n.features[0].geometry.coordinates[0]=[];for(var r=0;r<e.length;r++)n.features[0].geometry.coordinates[0][r]=e[r].slice().reverse();return n}function z(t,n){var e=[];switch(t.geometry.type){case\"Point\":e=y(t.geometry.coordinates,n);break;case\"LineString\":e.push(N(t.geometry.coordinates,n));break;case\"MultiLineString\":e=j(t.geometry.coordinates,n);break;case\"Polygon\":e.push(N(t.geometry.coordinates[0],n));break;case\"MultiPolygon\":e.push(j(t.geometry.coordinates[0],n))}return e}function E(n,e){var r=[];if(!e)return[];Y(e)||(e=[e]);for(var a=0;a<e.length;a++)switch(e[a]){case\"center\":r=r.concat(\"lat\"===n?A(n,t.center[0],\"N\"):A(n,t.center[1],\"S\"));break;case\"outline\":r=\"lon\"===n?(r=r.concat(A(n,t.center[1]-89.99,\"S\"))).concat(A(n,t.center[1]+89.99,\"N\")):(r=r.concat(A(n,t.center[0]-179.99,\"E\"))).concat(A(n,t.center[0]+179.99,\"W\"));break;default:if(G(e[a])){r=r.concat(A(n,e[a],\"lat\"===n?\"N\":\"S\"));break}}return function(t){for(var n=[],e=0;e<t.length;e++){var r={type:\"Feature\",id:e,properties:{},geometry:{type:\"Point\"}};r.properties.value=t[e].value,r.properties.orientation=t[e].orientation,r.geometry.coordinates=t[e].coordinates,n.push(r)}return n}(r)}function A(n,e,r){var a,i,o,s,l,u=n,c=[],h=e;\"equatorial\"===t.transform&&\"lon\"===u&&(u=\"ra\"),\"ra\"===u?(a=0,i=23,o=1):\"lon\"===u?(a=0,i=350,o=10):(a=-80,i=80,o=10);for(var f=a;f<=i;f+=o){var p=r;\"lat\"===u?(l=[h,f],s=f.toString()+\"\\xb0\",p+=f<0?\"S\":\"N\"):\"ra\"===u?(l=[15*f,h],s=f.toString()+\"\\u02b0\"):(l=[f,h],s=f.toString()+\"\\xb0\"),c.push({coordinates:l,value:s,orientation:p})}return c}function N(t,n){for(var e=[],r=0;r<t.length;r++)e.push(y(t[r],n));return e}function j(t,n){for(var e=[],r=0;r<t.length;r++)e.push(N(t[r],n));return e}s.add=function(t){var n={};return V(t,\"type\")?\"dso\"!==t.type&&\"json\"!==t.type||V(t,\"file\")&&V(t,\"callback\")?\"line\"!==t.type&&\"raw\"!==t.type||V(t,\"callback\")?(V(t,\"file\")&&(n.file=t.file),n.type=t.type,V(t,\"callback\")&&(n.callback=t.callback),V(t,\"redraw\")&&(n.redraw=t.redraw),V(t,\"save\")&&(n.save=t.save),void s.data.push(n)):console.log(\"Can't add data\"):console.log(\"Can't add data file\"):console.log(\"Missing type\")},s.remove=function(t){if(null!==t&&t<s.data.length)return s.data.splice(t,1)},s.clear=function(){s.data=[]},s.addCallback=function(t){s.callback=t,S=null!==t},s.runCallback=function(t){S=!1,s.callback(),S=!0},s.getData=_,s.getPoint=function(t,n){return y(t,w[n])},s.getPlanet=q;var L={},P={width:0,projection:\"aitoff\",projectionRatio:null,transform:\"equatorial\",center:null,geopos:null,follow:\"zenith\",orientationfixed:!0,zoomlevel:null,zoomextend:10,adaptable:!0,interactive:!0,disableAnimations:!1,form:!1,location:!1,formFields:{location:!0,general:!0,stars:!0,dsos:!0,constellations:!0,lines:!0,other:!0,download:!1},advanced:!0,daterange:[],settimezone:!0,timezoneid:\"AEFXZPQ3FDPF\",controls:!0,lang:\"\",culture:\"\",container:\"celestial-map\",datapath:\"data/\",stars:{show:!0,limit:6,colors:!0,style:{fill:\"#ffffff\",opacity:1},designation:!0,designationType:\"desig\",designationStyle:{fill:\"#ddddbb\",font:\"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif\",align:\"left\",baseline:\"top\"},designationLimit:2.5,propername:!1,propernameType:\"name\",propernameStyle:{fill:\"#ddddbb\",font:\"13px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif\",align:\"right\",baseline:\"bottom\"},propernameLimit:1.5,size:7,exponent:-.28,data:\"stars.6.json\"},dsos:{show:!0,limit:6,colors:!0,style:{fill:\"#cccccc\",stroke:\"#cccccc\",width:2,opacity:1},names:!0,namesType:\"desig\",nameStyle:{fill:\"#cccccc\",font:\"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, serif\",align:\"left\",baseline:\"bottom\"},nameLimit:4,size:null,exponent:1.4,data:\"dsos.bright.json\",symbols:{gg:{shape:\"circle\",fill:\"#ff0000\"},g:{shape:\"ellipse\",fill:\"#ff0000\"},s:{shape:\"ellipse\",fill:\"#ff0000\"},s0:{shape:\"ellipse\",fill:\"#ff0000\"},sd:{shape:\"ellipse\",fill:\"#ff0000\"},e:{shape:\"ellipse\",fill:\"#ff0000\"},i:{shape:\"ellipse\",fill:\"#ff0000\"},oc:{shape:\"circle\",fill:\"#ff9900\",stroke:\"#ff9900\",width:2},gc:{shape:\"circle\",fill:\"#ff9900\"},en:{shape:\"square\",fill:\"#ff00cc\"},bn:{shape:\"square\",fill:\"#ff00cc\"},sfr:{shape:\"square\",fill:\"#cc00ff\"},rn:{shape:\"square\",fill:\"#0000ff\"},pn:{shape:\"diamond\",fill:\"#00cccc\"},snr:{shape:\"diamond\",fill:\"#ff00cc\"},dn:{shape:\"square\",fill:\"#999999\",stroke:\"#999999\",width:2},pos:{shape:\"marker\",fill:\"#cccccc\",stroke:\"#cccccc\",width:1.5}}},constellations:{show:!0,names:!0,namesType:\"desig\",nameStyle:{fill:\"#cccc99\",align:\"center\",baseline:\"middle\",opacity:.8,font:[\"14px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\",\"12px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\",\"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\"]},lines:!0,lineStyle:{stroke:\"#cccccc\",width:1.5,opacity:.6},bounds:!1,boundStyle:{stroke:\"#ccff00\",width:1,opacity:.8,dash:[4,4]}},mw:{show:!0,style:{fill:\"#ffffff\",opacity:\"0.15\"}},lines:{graticule:{show:!0,stroke:\"#cccccc\",width:.6,opacity:.8,lon:{pos:[],fill:\"#eee\",font:\"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif\"},lat:{pos:[],fill:\"#eee\",font:\"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif\"}},equatorial:{show:!0,stroke:\"#aaaaaa\",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:\"#66cc66\",width:1.3,opacity:.7},galactic:{show:!1,stroke:\"#cc6666\",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:\"#cc66cc\",width:1.3,opacity:.7}},background:{fill:\"#000000\",opacity:1,stroke:\"#000000\",width:1.5},horizon:{show:!1,stroke:\"#cccccc\",width:1,fill:\"#000000\",opacity:.4},daylight:{show:!1},planets:{show:!1,which:[\"sol\",\"mer\",\"ven\",\"ter\",\"lun\",\"mar\",\"jup\",\"sat\",\"ura\",\"nep\",\"cer\",\"plu\"],symbols:{sol:{symbol:\"\\u2609\",letter:\"Su\",fill:\"#ffff00\",size:12},mer:{symbol:\"\\u263f\",letter:\"Me\",fill:\"#cccccc\"},ven:{symbol:\"\\u2640\",letter:\"V\",fill:\"#eeeecc\"},ter:{symbol:\"\\u2295\",letter:\"T\",fill:\"#00ccff\"},lun:{symbol:\"\\u25cf\",letter:\"L\",fill:\"#ffffff\",size:12},mar:{symbol:\"\\u2642\",letter:\"Ma\",fill:\"#ff6600\"},cer:{symbol:\"\\u26b3\",letter:\"C\",fill:\"#cccccc\"},ves:{symbol:\"\\u26b6\",letter:\"Ma\",fill:\"#cccccc\"},jup:{symbol:\"\\u2643\",letter:\"J\",fill:\"#ffaa33\"},sat:{symbol:\"\\u2644\",letter:\"Sa\",fill:\"#ffdd66\"},ura:{symbol:\"\\u2645\",letter:\"U\",fill:\"#66ccff\"},nep:{symbol:\"\\u2646\",letter:\"N\",fill:\"#6666ff\"},plu:{symbol:\"\\u2647\",letter:\"P\",fill:\"#aaaaaa\"},eri:{symbol:\"\\u26aa\",letter:\"E\",fill:\"#eeeeee\"}},symbolStyle:{fill:\"#cccccc\",opacity:1,font:\"bold 20px 'DejaVu Sans Mono', 'Arial Unicode MS', sans-serif\",align:\"center\",baseline:\"middle\"},symbolType:\"symbol\",names:!1,nameStyle:{fill:\"#cccccc\",font:\"14px 'Lucida Sans Unicode', 'DejaVu Sans', sans-serif\",align:\"right\",baseline:\"top\"},namesType:\"en\"},set:function(t){var n,e,r={},a={};if(0===Object.entries(L).length?Object.assign(r,this):Object.assign(r,L),!t)return r;for(n in r)if(V(r,n))if(V(t,n)&&null!==t[n])if(null===r[n]||r[n].constructor!=Object)a[n]=t[n];else for(e in a[n]={},r[n])a[n][e]=V(t[n],e)?t[n][e]:r[n][e];else a[n]=r[n];return a.constellations.nameStyle.font=C(a.constellations.nameStyle.font),a.constellations.nameStyle.opacity=C(a.constellations.nameStyle.opacity),a.constellations.nameStyle.fill=C(a.constellations.nameStyle.fill),a.constellations.lineStyle.width=C(a.constellations.lineStyle.width),a.constellations.lineStyle.opacity=C(a.constellations.lineStyle.opacity),a.constellations.lineStyle.stroke=C(a.constellations.lineStyle.stroke),Object.assign(L,a),a},applyDefaults:function(t){var n={};return Object.assign(n,L),n.stars.size=n.stars.size||7,n.stars.exponent=n.stars.exponent||-.28,(!n.center||n.center.length<=0)&&(n.center=[0,0,0]),n.datapath=n.datapath||\"\",n.datapath=n.datapath.replace(/([^\\/]$)/,\"$1/\"),n.transform&&\"\"!==n.transform||(n.transform=\"equatorial\"),n.culture&&-1!==n.culture.search(/^cn$/)||(n.culture=\"iau\"),t&&(V(t,\"stars\")&&(V(t.stars,\"names\")&&(n.stars.designation=t.stars.names),V(t.stars,\"namelimit\")&&(n.stars.designationLimit=t.stars.namelimit),V(t.stars,\"namestyle\")&&Object.assign(n.stars.designationStyle,t.stars.namestyle),V(t.stars,\"proper\")&&(n.stars.propername=t.stars.proper),V(t.stars,\"propernamelimit\")&&(n.stars.propernameLimit=t.stars.propernamelimit),V(t.stars,\"propernamestyle\")&&Object.assign(n.stars.propernameStyle,t.stars.propernamestyle)),V(t,\"dsos\")&&(V(t.dsos,\"desig\")&&!0===t.dsos.desig&&(n.dsos.namesType=\"desig\"),V(t.dsos,\"namelimit\")&&(n.dsos.nameLimit=t.dsos.namelimit),V(t.dsos,\"namestyle\")&&Object.assign(n.dsos.nameStyle,t.dsos.namestyle)),V(t,\"constellations\")&&(V(t.constellations,\"show\")&&!0===t.constellations.show&&(n.constellations.names=!0),V(t.constellations,\"desig\")&&!0===t.constellations.desig&&(n.constellations.namesType=\"desig\"),\"latin\"===n.constellations.namesType&&(n.constellations.namesType=\"la\"),\"iau\"===n.constellations.namesType&&(n.constellations.namesType=\"name\"),V(t.constellations,\"namestyle\")&&Object.assign(n.constellations.nameStyle,t.constellations.namestyle),V(t.constellations,\"linestyle\")&&Object.assign(n.constellations.lineStyle,t.constellations.linestyle),V(t.constellations,\"boundstyle\")&&Object.assign(n.constellations.boundStyle,t.constellations.boundstyle)),V(t,\"planets\")&&V(t.planets,\"style\")&&Object.assign(n.planets.style,t.planets.symbolStyle)),n.stars.designationType&&\"\"!==n.stars.designationType||(n.stars.designationType=\"desig\"),V(R.starnames[n.culture].designation,n.stars.designationType)||(n.designationType=\"desig\"),n.stars.propernameType&&\"\"!==n.stars.propernameType||(n.stars.propernameType=\"name\"),V(R.starnames[n.culture].propername,n.stars.propernameType)||(n.propernameType=\"name\"),n.dsos.namesType&&\"\"!==n.dsos.namesType||(n.dsos.namesType=\"desig\"),n.constellations.namesType&&\"\"!==n.constellations.namesType||(n.constellations.namesType=\"desig\"),V(R.constellations[n.culture].names,n.constellations.namesType)||(n.constellations.namesType=\"name\"),n.planets.symbolType&&\"\"!==n.planets.symbolType||(n.planets.symbolType=\"symbol\"),n.planets.namesType&&\"\"!==n.planets.namesType||(n.planets.namesType=\"desig\"),V(R.planets[n.culture].names,n.planets.namesType)||(n.planets.namesType=\"desig\"),n.constellations.nameStyle.font=C(n.constellations.nameStyle.font),n.constellations.nameStyle.opacity=C(n.constellations.nameStyle.opacity),n.constellations.nameStyle.fill=C(n.constellations.nameStyle.fill),n.constellations.lineStyle.width=C(n.constellations.lineStyle.width),n.constellations.lineStyle.opacity=C(n.constellations.lineStyle.opacity),n.constellations.lineStyle.stroke=C(n.constellations.lineStyle.stroke),Object.assign(L,n),n}};function C(t){return Y(t)?t.length>=3?t:1===t.length?[t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[1]]:void 0:[t,t,t]}s.settings=function(){return P};var D=d3.scale.quantize().domain([3.347,-.335]).range([\"#ff4700\",\"#ff4b00\",\"#ff4f00\",\"#ff5300\",\"#ff5600\",\"#ff5900\",\"#ff5b00\",\"#ff5d00\",\"#ff6000\",\"#ff6300\",\"#ff6500\",\"#ff6700\",\"#ff6900\",\"#ff6b00\",\"#ff6d00\",\"#ff7000\",\"#ff7300\",\"#ff7500\",\"#ff7800\",\"#ff7a00\",\"#ff7c00\",\"#ff7e00\",\"#ff8100\",\"#ff8300\",\"#ff8506\",\"#ff870a\",\"#ff8912\",\"#ff8b1a\",\"#ff8e21\",\"#ff9127\",\"#ff932c\",\"#ff9631\",\"#ff9836\",\"#ff9a3c\",\"#ff9d3f\",\"#ffa148\",\"#ffa34b\",\"#ffa54f\",\"#ffa753\",\"#ffa957\",\"#ffab5a\",\"#ffad5e\",\"#ffb165\",\"#ffb269\",\"#ffb46b\",\"#ffb872\",\"#ffb975\",\"#ffbb78\",\"#ffbe7e\",\"#ffc184\",\"#ffc489\",\"#ffc78f\",\"#ffc892\",\"#ffc994\",\"#ffcc99\",\"#ffce9f\",\"#ffd1a3\",\"#ffd3a8\",\"#ffd5ad\",\"#ffd7b1\",\"#ffd9b6\",\"#ffdbba\",\"#ffddbe\",\"#ffdfc2\",\"#ffe1c6\",\"#ffe3ca\",\"#ffe4ce\",\"#ffe8d5\",\"#ffe9d9\",\"#ffebdc\",\"#ffece0\",\"#ffefe6\",\"#fff0e9\",\"#fff2ec\",\"#fff4f2\",\"#fff5f5\",\"#fff6f8\",\"#fff9fd\",\"#fef9ff\",\"#f9f6ff\",\"#f6f4ff\",\"#f3f2ff\",\"#eff0ff\",\"#ebeeff\",\"#e9edff\",\"#e6ebff\",\"#e3e9ff\",\"#e0e7ff\",\"#dee6ff\",\"#dce5ff\",\"#d9e3ff\",\"#d7e2ff\",\"#d3e0ff\",\"#c9d9ff\",\"#bfd3ff\",\"#b7ceff\",\"#afc9ff\",\"#a9c5ff\",\"#a4c2ff\",\"#9fbfff\",\"#9bbcff\"]),I={airy:{n:\"Airy\\u2019s Minimum Error\",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:\"Aitoff\",arg:null,scale:162},armadillo:{n:\"Armadillo\",arg:0,scale:250},august:{n:\"August\",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:\"Azimuthal Equal Area\",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:\"Azimuthal Equidistant\",arg:null,scale:320,ratio:1,clip:!0},baker:{n:\"Baker Dinomic\",arg:null,scale:160,ratio:1.4},berghaus:{n:\"Berghaus Star\",arg:0,scale:320,ratio:1,clip:!0},boggs:{n:\"Boggs Eumorphic\",arg:null,scale:170},bonne:{n:\"Bonne\",arg:Math.PI/2.5,scale:225,ratio:.88},bromley:{n:\"Bromley\",arg:null,scale:162},cassini:{n:\"Cassini\",arg:null,scale:325,ratio:1,clip:!0},collignon:{n:\"Collignon\",arg:null,scale:100,ratio:2.6},craig:{n:\"Craig Retroazimuthal\",arg:0,scale:310,ratio:1.5,clip:!0},craster:{n:\"Craster Parabolic\",arg:null,scale:160},cylindricalEqualArea:{n:\"Cylindrical Equal Area\",arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{n:\"Cylindrical Stereographic\",arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{n:\"Eckert I\",arg:null,scale:175},eckert2:{n:\"Eckert II\",arg:null,scale:175},eckert3:{n:\"Eckert III\",arg:null,scale:190},eckert4:{n:\"Eckert IV\",arg:null,scale:190},eckert5:{n:\"Eckert V\",arg:null,scale:182},eckert6:{n:\"Eckert VI\",arg:null,scale:182},eisenlohr:{n:\"Eisenlohr\",arg:null,scale:102},equirectangular:{n:\"Equirectangular\",arg:null,scale:165},fahey:{n:\"Fahey\",arg:null,scale:196,ratio:1.4},mtFlatPolarParabolic:{n:\"Flat Polar Parabolic\",arg:null,scale:175},mtFlatPolarQuartic:{n:\"Flat Polar Quartic\",arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{n:\"Flat Polar Sinusoidal\",arg:null,scale:175,ratio:1.9},foucaut:{n:\"Foucaut\",arg:null,scale:142},ginzburg4:{n:\"Ginzburg IV\",arg:null,scale:180,ratio:1.7},ginzburg5:{n:\"Ginzburg V\",arg:null,scale:196,ratio:1.55},ginzburg6:{n:\"Ginzburg VI\",arg:null,scale:190,ratio:1.4},ginzburg8:{n:\"Ginzburg VIII\",arg:null,scale:205,ratio:1.3},ginzburg9:{n:\"Ginzburg IX\",arg:null,scale:190,ratio:1.4},homolosine:{n:\"Goode Homolosine\",arg:null,scale:160,ratio:2.2},hammer:{n:\"Hammer\",arg:2,scale:180},hatano:{n:\"Hatano\",arg:null,scale:186},healpix:{n:\"HEALPix\",arg:1,scale:320,ratio:1.2},hill:{n:\"Hill Eucyclic\",arg:2,scale:190,ratio:1.1},kavrayskiy7:{n:\"Kavrayskiy VII\",arg:null,scale:185,ratio:1.75},lagrange:{n:\"Lagrange\",arg:Math.PI/4,scale:88,ratio:1.6,clip:!1},larrivee:{n:\"l'Arriv\\xe9e\",arg:null,scale:160,ratio:1.25},laskowski:{n:\"Laskowski Tri-Optimal\",arg:null,scale:165,ratio:1.7},loximuthal:{n:\"Loximuthal\",arg:Math.PI/4,scale:175,ratio:1.8},mercator:{n:\"Mercator\",arg:null,scale:160,ratio:1.3},miller:{n:\"Miller\",arg:null,scale:160,ratio:1.5},mollweide:{n:\"Mollweide\",arg:null,scale:180},naturalEarth:{n:\"Natural Earth\",arg:null,scale:185,ratio:1.85},nellHammer:{n:\"Nell Hammer\",arg:null,scale:160,ratio:2.6},orthographic:{n:\"Orthographic\",arg:null,scale:480,ratio:1,clip:!0},patterson:{n:\"Patterson Cylindrical\",arg:null,scale:160,ratio:1.75},polyconic:{n:\"Polyconic\",arg:null,scale:160,ratio:1.3},quincuncial:{n:\"Quincuncial\",arg:null,scale:160,ratio:1.3},rectangularPolyconic:{n:\"Rectangular Polyconic\",arg:0,scale:160,ratio:1.65},robinson:{n:\"Robinson\",arg:null,scale:160},sinusoidal:{n:\"Sinusoidal\",arg:null,scale:160,ratio:2},stereographic:{n:\"Stereographic\",arg:null,scale:500,ratio:1,clip:!0},times:{n:\"Times\",arg:null,scale:210,ratio:1.4},twoPointEquidistant:{n:\"Two-Point Equidistant\",arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{n:\"van Der Grinten\",arg:null,scale:160,ratio:1},vanDerGrinten2:{n:\"van Der Grinten II\",arg:null,scale:160,ratio:1},vanDerGrinten3:{n:\"van Der Grinten III\",arg:null,scale:160,ratio:1},vanDerGrinten4:{n:\"van Der Grinten IV\",arg:null,scale:160,ratio:1.6},wagner4:{n:\"Wagner IV\",arg:null,scale:185},wagner6:{n:\"Wagner VI\",arg:null,scale:160},wagner7:{n:\"Wagner VII\",arg:null,scale:190,ratio:1.8},wiechel:{n:\"Wiechel\",arg:null,scale:360,ratio:1,clip:!0},winkel3:{n:\"Winkel Tripel\",arg:null,scale:196,ratio:1.7}};s.projections=function(){return I};var R={starnames:{iau:{designation:{desig:\"Designation\",bayer:\"Bayer\",flam:\"Flamsteed\",var:\"Variable\",gl:\"Gliese\",hd:\"Draper\",hip:\"Hipparcos\"},propername:{name:\"IAU Name\",ar:\"Arabic\",zh:\"Chinese\",en:\"English\",fi:\"Finnish\",fr:\"French\",de:\"German\",el:\"Greek\",he:\"Hebrew\",hi:\"Hindi\",it:\"Italian\",ja:\"Japanese\",ko:\"Korean\",la:\"Latin\",fa:\"Persian\",ru:\"Russian\",es:\"Spanish\",tr:\"Turkish\"}},cn:{propername:{name:\"Proper name\",en:\"English\",pinyin:\"Pinyin\"},designation:{desig:\"IAU Designation\"}}},constellations:{iau:{names:{desig:\"Designation\",name:\"IAU Name\",ar:\"Arabic\",zh:\"Chinese\",cz:\"Czech\",en:\"English\",ee:\"Estonian\",fi:\"Finnish\",fr:\"French\",de:\"German\",el:\"Greek\",he:\"Hebrew\",hi:\"Hindi\",it:\"Italian\",ja:\"Japanese\",sw:\"Kiswahili\",ko:\"Korean\",la:\"Latin\",fa:\"Persian\",ru:\"Russian\",es:\"Spanish\",tr:\"Turkish\"}},cn:{names:{name:\"Proper name\",en:\"English\",pinyin:\"Pinyin\"}}},planets:{iau:{symbol:{symbol:\"\\u263e Symbol\",letter:\"\\u216c Letter\",disk:\"\\u25cf Disk\"},names:{desig:\"Designation\",ar:\"Arabic\",zh:\"Chinese\",en:\"English\",fr:\"French\",de:\"German\",el:\"Greek\",he:\"Hebrew\",hi:\"Hindi\",it:\"Italian\",ja:\"Japanese\",ko:\"Korean\",la:\"Latin\",fa:\"Persian\",ru:\"Russian\",es:\"Spanish\"}},cn:{symbol:{symbol:\"\\u263e Symbol\",letter:\"\\u216c Letter\",disk:\"\\u25cf Disk\"},names:{desig:\"Designation\",name:\"Chinese\",pinyin:\"Pinyin\",en:\"English\"}}},dsonames:{iau:{names:{desig:\"Designation\",name:\"English\",ar:\"Arabic\",zh:\"Chinese\",fi:\"Finnish\",fr:\"French\",de:\"German\",el:\"Greek\",hi:\"Hindi\",it:\"Italian\",ja:\"Japanese\",ko:\"Korean\",la:\"Latin\",fa:\"Persian\",ru:\"Russian\",es:\"Spanish\",tr:\"Turkish\"}},cn:{names:{desig:\"Designation\",name:\"Chinese\",pinyin:\"Pinyin\",en:\"English\"}}}},F={iau:Object.keys(R.constellations.iau.names).concat(Object.keys(R.planets.iau.names)).filter(function(t,n,e){return e.indexOf(t)===n}),cn:Object.keys(R.constellations.cn.names).concat(Object.keys(R.starnames.cn.propername)).filter(function(t,n,e){return e.indexOf(t)===n})},O={};function U(t){return document.querySelector(e+\" #\"+t)}function H(t){return t+\"px\"}function B(t,n){return Math.round(Math.pow(10,n)*t)/Math.pow(10,n)}function Q(t){return t<10?\"0\"+t:t}function V(t,n){return null!==t&&hasOwnProperty.call(t,n)}function G(t){return null!==t&&!isNaN(parseFloat(t))&&isFinite(t)}function Y(t){return null!==t&&\"[object Array]\"===Object.prototype.toString.call(t)}function W(t,n,e){var r=n.valueOf()-t.valueOf();switch(e||\"d\"){case\"y\":case\"yr\":r/=31556926080;break;case\"m\":case\"mo\":r/=26298e5;break;case\"d\":case\"dy\":r/=864e5;break;case\"h\":case\"hr\":r/=36e5;break;case\"n\":case\"mn\":r/=6e4;break;case\"s\":case\"sec\":r/=1e3}return Math.floor(r)}function $(t){if(t){var n=t.split(\".\");if(!(n.length<1)&&((n=n[0].split(\"-\"))[0]=n[0].replace(/\\D/g,\"\"),n[0]))return n[1]=n[1]?n[1].replace(/\\D/g,\"\"):\"1\",n[2]=n[2]?n[2].replace(/\\D/g,\"\"):\"1\",new Date(Date.UTC(n[0],n[1]-1,n[2]))}}O.symbol=function(){var t,n=d3.functor(\"circle\"),e=d3.functor(64),r=d3.functor(Math.PI),a=(d3.functor(\"#fff\"),d3.functor(\"\"));function i(t){o[n()](t)}d3.functor([2,2]);var o={circle:function(n){var r=Math.sqrt(e())/2;return n.arc(t[0],t[1],r,0,2*Math.PI),n.closePath(),r},square:function(n){var r=Math.sqrt(e())/1.7;return n.moveTo(t[0]-r,t[1]-r),n.lineTo(t[0]+r,t[1]-r),n.lineTo(t[0]+r,t[1]+r),n.lineTo(t[0]-r,t[1]+r),n.closePath(),r},diamond:function(n){var r=Math.sqrt(e())/1.5;return n.moveTo(t[0],t[1]-r),n.lineTo(t[0]+r,t[1]),n.lineTo(t[0],t[1]+r),n.lineTo(t[0]-r,t[1]),n.closePath(),r},triangle:function(n){var r=Math.sqrt(e())/Math.sqrt(3);return n.moveTo(t[0],t[1]-r),n.lineTo(t[0]+r,t[1]+r),n.lineTo(t[0]-r,t[1]+r),n.closePath(),r},ellipse:function(n){var r=Math.sqrt(e())/2;return n.save(),n.translate(t[0],t[1]),n.scale(1.6,.8),n.beginPath(),n.arc(0,0,r,0,2*Math.PI),n.closePath(),n.restore(),r},marker:function(n){var r=Math.sqrt(e())/2;return n.moveTo(t[0],t[1]-r),n.lineTo(t[0],t[1]+r),n.moveTo(t[0]-r,t[1]),n.lineTo(t[0]+r,t[1]),n.closePath(),r},\"cross-circle\":function(n){var r=Math.sqrt(e()),a=r/2;return n.moveTo(t[0],t[1]-r),n.lineTo(t[0],t[1]+r),n.moveTo(t[0]-r,t[1]),n.lineTo(t[0]+r,t[1]),n.stroke(),n.beginPath(),n.moveTo(t[0],t[1]),n.arc(t[0],t[1],a,0,2*Math.PI),n.closePath(),a},\"stroke-circle\":function(n){var r=Math.sqrt(e()),a=r/2;return n.moveTo(t[0],t[1]-r),n.lineTo(t[0],t[1]+r),n.stroke(),n.beginPath(),n.moveTo(t[0],t[1]),n.arc(t[0],t[1],a,0,2*Math.PI),n.closePath(),a},crescent:function(n){var a=Math.sqrt(e())/2,i=r(),o=.5*(1-Math.cos(i)),s=1.6*Math.abs(o-.5)+.01,l=i>Math.PI,u=Math.abs(o)>.5?l:!l,c=n.fillStyle,h=o<.157?\"#669\":\"#557\";return n.save(),n.fillStyle=h,n.beginPath(),n.moveTo(t[0],t[1]),n.arc(t[0],t[1],a,0,2*Math.PI),n.closePath(),n.fill(),n.fillStyle=c,n.beginPath(),n.moveTo(t[0],t[1]),n.arc(t[0],t[1],a,-Math.PI/2,Math.PI/2,l),n.scale(s,1),n.arc(t[0]/s,t[1],a,Math.PI/2,-Math.PI/2,u),n.closePath(),n.fill(),n.restore(),a}};return i.type=function(t){return arguments.length?(n=d3.functor(t),i):n},i.size=function(t){return arguments.length?(e=d3.functor(t),i):e},i.age=function(t){return arguments.length?(r=d3.functor(t),i):r},i.text=function(t){return arguments.length?(a=d3.functor(t),i):a},i.position=function(n){if(arguments.length)return t=n,i},i},s.Canvas=O;var Z=function(t){return(Math.pow(Math.E,t)-Math.pow(Math.E,-t))/2},X=function(t){return(Math.pow(Math.E,t)+Math.pow(Math.E,-t))/2},J=function(t){return(t+3*Math.PI)%(2*Math.PI)-Math.PI},K=function(t){return(t+2*Math.PI)%(2*Math.PI)};Math,Math,Math;var tt={\"stars-show\":[\"stars-limit\",\"stars-colors\",\"stars-style-fill\",\"stars-designation\",\"stars-propername\",\"stars-size\",\"stars-exponent\"],\"stars-designation\":[\"stars-designationType\",\"stars-designationLimit\"],\"stars-propername\":[\"stars-propernameLimit\",\"stars-propernameType\"],\"dsos-show\":[\"dsos-limit\",\"dsos-colors\",\"dsos-style-fill\",\"dsos-names\",\"dsos-size\",\"dsos-exponent\"],\"dsos-names\":[\"dsos-namesType\",\"dsos-nameLimit\"],\"mw-show\":[\"mw-style-opacity\",\"mw-style-fill\"],\"constellations-names\":[\"constellations-namesType\"],\"planets-show\":[\"planets-symbolType\",\"planets-names\"],\"planets-names\":[\"planets-namesType\"]};function nt(t){var n,e=t.id;switch(e){case\"stars-show\":n=!ct(e).checked;for(var r=0;r<tt[e].length;r++)et(tt[e][r],n);case\"stars-designation\":for(n=!ct(\"stars-designation\").checked||!ct(\"stars-show\").checked,r=0;r<tt[\"stars-designation\"].length;r++)et(tt[\"stars-designation\"][r],n);case\"stars-propername\":for(n=!ct(\"stars-propername\").checked||!ct(\"stars-show\").checked,r=0;r<tt[\"stars-propername\"].length;r++)et(tt[\"stars-propername\"][r],n);break;case\"dsos-show\":for(n=!ct(e).checked,r=0;r<tt[e].length;r++)et(tt[e][r],n);case\"dsos-names\":for(n=!ct(\"dsos-names\").checked||!ct(\"dsos-show\").checked,r=0;r<tt[\"dsos-names\"].length;r++)et(tt[\"dsos-names\"][r],n);break;case\"planets-show\":for(n=!ct(e).checked,r=0;r<tt[e].length;r++)et(tt[e][r],n);case\"planets-names\":for(n=!ct(\"planets-names\").checked||!ct(\"planets-show\").checked,r=0;r<tt[\"planets-names\"].length;r++)et(tt[\"planets-names\"][r],n);break;case\"constellations-names\":case\"mw-show\":for(n=!ct(e).checked,r=0;r<tt[e].length;r++)et(tt[e][r],n)}}function et(t,n){var e=ct(t);e&&(e.disabled=n,e.style.color=n?\"#999\":\"#000\",e.previousSibling.style.color=n?\"#999\":\"#000\")}function rt(t,n){var e=function(t){var n=0,e=0;if(t.offsetParent)do{n+=t.offsetLeft,e+=t.offsetTop}while(null!==(t=t.offsetParent));return[n,e]}(t);d3.select(\"#error\").html(n).style({top:H(e[1]+t.offsetHeight+1),left:H(e[0]),opacity:1}),t.focus()}function at(t){var n,e=\"hr\"===t.id||\"min\"===t.id||\"sec\"===t.id?1:0;if(t.validity){if((n=t.validity).typeMismatch||n.badInput)return rt(t,t.title+\": check field value\"),!1;if(n.rangeOverflow||n.rangeUnderflow)return rt(t,t.title+\" must be between \"+(parseInt(t.min)+e)+\" and \"+(parseInt(t.max)-e)),!1}else{if(!G(n=t.value))return rt(t,t.title+\": check field value\"),!1;if((n=parseFloat(n))<t.min||n>t.max)return rt(t,t.title+\" must be between \"+(t.min+e)+\" and \"+(+t.max-e)),!1}return d3.select(\"#error\").style({top:\"-9999px\",left:\"-9999px\",opacity:0}),!0}function it(t){var n;if(t.validity){if((n=t.validity).typeMismatch||n.badInput)return rt(t,t.title+\": check field value\"),!1;if(-1===t.value.search(/^#[0-9A-F]{6}$/i))return rt(t,t.title+\": not a color value\"),!1}else{if(\"\"===(n=t.value))return!0;if(-1===n.search(/^#[0-9A-F]{6}$/i))return rt(t,t.title+\": not a color value\"),!1}return d3.select(\"#error\").style({top:\"-9999px\",left:\"-9999px\",opacity:0}),!0}function ot(t,n){var e=ct(\"centerx\");return e?(n&&(\"equatorial\"===t&&\"equatorial\"!==n?(e.value=(e.value/15).toFixed(1),e.value<0&&(e.value+=24)):\"equatorial\"!==t&&\"equatorial\"===n&&(e.value=(15*e.value).toFixed(1),e.value>180&&(e.value-=360))),\"equatorial\"===t?(e.min=\"0\",e.max=\"24\",ct(\"cxunit\").innerHTML=\"h\"):(e.min=\"-180\",e.max=\"180\",ct(\"cxunit\").innerHTML=\"\\xb0\"),e.value):null}function st(t,n){var e=ct(\"centerx\"),r=ct(\"centery\"),a=ct(\"centerz\");e&&r&&((null===t||t.length<1)&&(t=[0,0,0]),(t.length<=2||void 0===t[2])&&(t[2]=0),e.value=\"equatorial\"!==n?t[0].toFixed(1):t[0]<0?(t[0]/15+24).toFixed(1):(t[0]/15).toFixed(1),r.value=t[1].toFixed(1),a.value=null!==t[2]?t[2].toFixed(1):0,P.set({center:t}))}function lt(t){var n=t?\"inline-block\":\"none\";d3.select(e+\" ~ #celestial-form\").selectAll(\".advanced\").style(\"display\",n),d3.select(e+\" ~ #celestial-form\").selectAll(\"#label-propername\").style(\"display\",t?\"none\":\"inline-block\")}function ut(){var t,n,r=d3.select(e+\" ~ #celestial-form\").select(\"#constellation\"),a=[],i=0,o=L;s.container.selectAll(\".constname\").each(function(e,r){(t=e.id)===o.constellation&&(i=r),(n=e.properties[o.constellations.namesType])!==t&&(n+=\" (\"+t+\")\"),a.push({o:t,n:n})}),a.length<1||r.length<1?setTimeout(ut,1e3):(a=[{o:\"---\",n:\"(Select constellation)\"}].concat(a),r.selectAll(\"option\").remove(),r.selectAll(\"option\").data(a).enter().append(\"option\").attr(\"value\",function(t){return t.o}).text(function(t){return t.n}),r.property(\"selectedIndex\",i))}function ct(t){return document.querySelector(e+\" ~ #celestial-form #\"+t)}var ht={sol:.0002959122082855911,mer:0x95955473dbc3,ven:0x89d9374048629,ter:0xa923c08a47948,lun:36599199229256,mar:319711652803400,cer:467549107200,ves:129071530155,jup:0xd20883d548bcd80,sat:0x3ee3798098fbac0,ura:0x99ad2c4e2f7f70,nep:0xb54f848fd74430,plu:7327611364884,eri:827117568e4},ft={sol:\"\\u2609\",mer:\"\\u263f\",ven:\"\\u2640\",ter:\"\\u2295\",lun:\"\\u25cf\",mar:\"\\u2642\",cer:\"\\u26b3\",ves:\"\\u26b6\",jup:\"\\u2643\",sat:\"\\u2644\",ura:\"\\u2645\",nep:\"\\u2646\",plu:\"\\u2647\",eri:\"\\u26aa\"},pt=23.43928*m,dt=Math.sin(pt),gt=Math.cos(pt),vt=[\"a\",\"e\",\"i\",\"w\",\"M\",\"L\",\"W\",\"N\",\"n\",\"ep\",\"ref\",\"lecl\",\"becl\",\"Tilt\"],Mt=function(){var t,n,e,r=ht.sol,a=\"sol\",i={},o={};function s(n){return l(n),\"sol\"===t?(o.ephemeris.x=0,o.ephemeris.y=0,o.ephemeris.z=0,o.ephemeris.mag=-6,s):(u(),s)}var l=function(t){var n,e=o.ephemeris={};t&&(n=t instanceof Date?new Date(t.valueOf()):$(t)),n||(n=new Date),e.jd=f(n),(n=$(i.ep))||(n=$(\"2000-01-01\")),e.jd0=f(n),e.d=e.jd-e.jd0,e.cy=e.d/36525},u=function(){var n,e=o.ephemeris;if(\"lun\"===t){if(!(e=function(t){if(void 0!==mt)return mt.elements(t)}(e)))return}else{for(var a=0;a<vt.length;a++)V(i,n=vt[a])&&(V(i,\"d\"+n)?e[n]=i[n]+i[\"d\"+n]*e.cy:V(i,n)&&(e[n]=i[n]));V(e,\"M\")&&!V(e,\"dM\")&&V(e,\"n\")&&(e.M+=e.n*e.d)}!function(){var t=o.ephemeris;t.hasOwnProperty(\"w\")||(t.w=t.W-t.N),t.hasOwnProperty(\"M\")||(t.M=t.L-t.W),t.e<1&&(t.M=J(t.M)),t.P=v*Math.sqrt(Math.pow(t.a,3)/r)/365.25,t.T=t.jd0-t.M/M/t.P,1!==t.e?(t.q=t.a*(1-t.e),t.t0=t.a*Math.sqrt(Math.abs(t.a)/r)):(t.w0=3/Math.sqrt(2)/(t.q*Math.sqrt(t.q/r)),t.a=0,t.t0=0),t.am=Math.sqrt(r*t.q*(1+t.e))}(),function(){var t,n,e,r=o.ephemeris;1===r.e?(e=r.w0*(r.jd0-r.T)*.5,n=Math.pow(e+Math.sqrt(e*e+1),1/3),r.v=2*Math.atan(n-1/n)):(r.E=function(){var t,n,e,r,a,i=o.ephemeris,s=i.e,l=i.M,u=1e-8,h=0,f=1.9,p=!1,d=0;if(!l)return 0;if(s<1&&((l<-Math.PI||l>Math.PI)&&(h=l-(r=J(l)),l=r),s<.9)){t=Math.atan2(Math.sin(l),Math.cos(l)-s);do{t-=n=(t-s*Math.sin(t)-l)/(1-s*Math.cos(t))}while(Math.abs(n)>u);return t}if(l<0&&(l=-l,p=!0),t=l,(u*=Math.abs(1-s))<1e-15&&(u=1e-15),(s>.8&&l<Math.PI/3||s>1)&&((e=l/Math.abs(1-s))*e>6*Math.abs(1-s)&&(e=l<Math.PI?Math.pow(6*l,1/3):(a=l/s,Math.log(a+Math.sqrt(a*a+1)))),t=e),s>1&&l>4&&(t=Math.log(l)),s<1)for(;Math.abs(f)>u;)t+=f=-(n=d++>8?c(t,s)-l:t-s*Math.sin(t)-l)/(1-s*Math.cos(t));else for(;Math.abs(f)>u;)t+=f=-(n=d++>7?-c(t,s)-l:s*Z(t)-t-l)/(s*X(t)-1);return p?h-t:h+t}(),r.e>1?(t=r.e-X(r.E),n=Z(r.E)):(t=Math.cos(r.E)-r.e,n=Math.sin(r.E)),n*=Math.sqrt(Math.abs(1-r.e*r.e)),r.v=Math.atan2(n,t)),r.r=r.q*(1+r.e)/(1+r.e*Math.cos(r.v))}(),function(){var t=o.ephemeris,n=t.v+t.w;t.x=t.r*(Math.cos(t.N)*Math.cos(n)-Math.sin(t.N)*Math.sin(n)*Math.cos(t.i)),t.y=t.r*(Math.sin(t.N)*Math.cos(n)+Math.cos(t.N)*Math.sin(n)*Math.cos(t.i)),t.z=t.r*(Math.sin(n)*Math.sin(t.i))}()};function c(t,n){for(var e=n>1?t*t:-t*t,r=n*e*t/6,a=(1-n)*t-r,i=4;Math.abs(r)>1e-15;)a-=r*=e/(i*(i+1)),i+=2;return a}function h(){var t=o.ephemeris,n=Math.atan2(t.y,t.x),e=Math.atan2(t.z,Math.sqrt(t.x*t.x+t.y*t.y));return t.l=K(n),t.b=e,o}function f(t){var n=t.getUTCFullYear(),e=t.getUTCMonth()+1,r=t.getUTCDate(),a=(t.getUTCHours()-12+t.getUTCMinutes()/60+t.getUTCSeconds()/3600)/24;if(n<-4799)return-1;var i=Math.floor((14-e)/12),o=n+4800-i;return r+Math.floor((153*(e+12*i-3)+2)/5)+365*o+Math.floor(o/4)-Math.floor(o/100)+Math.floor(o/400)-32045+a}return s.cartesian=function(){return o},s.spherical=function(){return h(),o},s.equatorial=function(n){return function(n){var e=o.ephemeris,r=n.ephemeris;pt=(23.439292-.0130042*e.cy-1.667e-7*e.cy*e.cy+5.028e-7*e.cy*e.cy*e.cy)*m,dt=Math.sin(pt),gt=Math.cos(pt);var a=\"lun\"===t?{x:0,y:0,z:0}:{x:r.x,y:r.y,z:r.z};e.xeq=e.x-a.x,e.yeq=(e.y-a.y)*gt-(e.z-a.z)*dt,e.zeq=(e.y-a.y)*dt+(e.z-a.z)*gt,e.ra=K(Math.atan2(e.yeq,e.xeq)),e.dec=Math.atan2(e.zeq,Math.sqrt(e.xeq*e.xeq+e.yeq*e.yeq)),\"lun\"===t&&(e=function(t,n){if(h(),void 0!==mt)return mt.corr(t,n)}(e,r)),e.pos=[e.ra/m,e.dec/m],e.rt=Math.sqrt(e.xeq*e.xeq+e.yeq*e.yeq+e.zeq*e.zeq),\"sol\"!==t&&(e.mag=function(){var t=o.ephemeris,n=t.r,e=t.rt,r=Math.acos((n*n+e*e-1)/(2*n*e)),a=.666*((1-r/Math.PI)*Math.cos(r)+1/Math.PI*Math.sin(r));return 1*o.H+5*Math.log(n*e)*Math.LOG10E-2.5*Math.log(a)*Math.LOG10E}())}(n),o},s.transpose=function(){return function(){var t=o.ephemeris;if(!t.ref||\"ecl\"===t.ref)return t.tx=t.x,t.ty=t.y,void(t.tz=t.z);Math;var n,e,r,a,i=(e=(n=[t.tl,t.tb,t.r])[0],r=M-n[1],{x:(a=n[2])*Math.sin(r)*Math.cos(e),y:a*Math.sin(r)*Math.sin(e),z:a*Math.cos(r)});t.tx=i.x,t.ty=i.y,t.tz=i.z}(),o},s.elements=function(t){var n;if(!arguments.length||void 0===arguments[0])return s;for(var e=0;e<vt.length;e++)V(t,n=vt[e])&&(i[n]=t[n],\"a\"===n||\"e\"===n?i[n]*=1:\"ref\"!==n&&\"ep\"!==n&&(i[n]*=m),V(t,\"d\"+n)&&(i[n=\"d\"+n]=t[n],i[n]*=\"da\"===n||\"de\"===n?1:m));return s},s.params=function(t){if(!arguments.length)return s;for(var n in t)V(t,n)&&\"elements\"!==t[n]&&(o[n]=t[n]);return s},s.parentBody=function(t){return arguments.length?(r=ht[a=t],s):a},s.id=function(n){return arguments.length?(t=n,e=ft[n],s):t},s.Name=function(t){return arguments.length?(n=t,s):n},s.symbol=function(t){return arguments.length?(e=ft[t],s):e},s},mt={elements:function(t){var n=(t.jd-2451545)/36525,e=n*n,r=n*e,a=1e-4*e,i=1e-6*r,o=n*r*1e-8,s=3400.4*Math.cos(m*(235.7004+890534.223*n-32.601*a+3.664*i-1.769*o))-635.6*Math.cos(m*(100.737+413335.3554*n-122.571*a-10.684*i+5.028*o))-235.6*Math.cos(m*(134.9634+477198.8676*n+89.97*a+14.348*i-6.797*o))+218.1*Math.cos(m*(238.1713+854535.1727*n-31.065*a+3.623*i-1.769*o))+181*Math.cos(m*(10.6638+1367733.0907*n+57.37*a+18.011*i-8.566*o))-39.9*Math.cos(m*(103.2079+377336.3051*n-121.035*a-10.724*i+5.028*o))-38.4*Math.cos(m*(233.2295+926533.2733*n-34.136*a+3.705*i-1.769*o))+33.8*Math.cos(m*(336.4374+1303869.5784*n-155.171*a-7.02*i+3.259*o))+28.8*Math.cos(m*(111.4008+1781068.4461*n-65.201*a+7.328*i-3.538*o))+12.6*Math.cos(m*(13.1347+1331734.0404*n+58.906*a+17.971*i-8.566*o))+11.4*Math.cos(m*(186.5442+966404.0351*n-68.058*a-.567*i+.232*o))-11.1*Math.cos(m*(222.5657-441199.8173*n-91.506*a-14.307*i+6.797*o))-10.2*Math.cos(m*(269.9268+954397.7353*n+179.941*a+28.695*i-13.594*o))+9.7*Math.cos(m*(145.6272+1844931.9583*n+147.34*a+32.359*i-15.363*o))+9.6*Math.cos(m*(240.6422+818536.1225*n-29.529*a+3.582*i-1.769*o))+8*Math.cos(m*(297.8502+445267.1115*n-16.3*a+1.832*i-.884*o))-6.2*Math.cos(m*(132.4925+513197.9179*n+88.434*a+14.388*i-6.797*o))+6*Math.cos(m*(173.5506+1335801.3346*n-48.901*a+5.496*i-2.653*o))+3.7*Math.cos(m*(113.8717+1745069.3958*n-63.665*a+7.287*i-3.538*o))+3.6*Math.cos(m*(338.9083+1267870.5281*n-153.636*a-7.061*i+3.259*o))+3.2*Math.cos(m*(246.3642+2258267.3137*n+24.769*a+21.675*i-10.335*o))-3*Math.cos(m*(8.1929+1403732.141*n+55.834*a+18.052*i-8.566*o))+2.3*Math.cos(m*(98.2661+449334.4057*n-124.107*a-10.643*i+5.028*o))-2.2*Math.cos(m*(357.5291+35999.0503*n-1.536*a+.041*i+0*o))-2*Math.cos(m*(38.5872+858602.4669*n-138.871*a-8.852*i+4.144*o))-1.8*Math.cos(m*(105.6788+341337.2548*n-119.499*a-10.765*i+5.028*o))-1.7*Math.cos(m*(201.474+826670.7108*n-245.142*a-21.367*i+10.057*o))+1.6*Math.cos(m*(184.1196+401329.0556*n+125.428*a+18.579*i-8.798*o))-1.4*Math.cos(m*(308.4192-489205.1674*n+158.029*a+14.915*i-7.029*o))+1.3*Math.cos(m*(325.7736-63863.5122*n-212.541*a-25.031*i+11.826*o))+383397.6+(-.55*Math.cos(m*(238.2+854535.2*n))+.1*Math.cos(m*(103.2+377336.3*n))+.1*Math.cos(m*(233.2+926533.3*n)))*n,l=.014217*Math.cos(m*(100.737+413335.3554*n-122.571*a-10.684*i+5.028*o))+.008551*Math.cos(m*(325.7736-63863.5122*n-212.541*a-25.031*i+11.826*o))-.001383*Math.cos(m*(134.9634+477198.8676*n+89.97*a+14.348*i-6.797*o))+.001353*Math.cos(m*(10.6638+1367733.0907*n+57.37*a+18.011*i-8.566*o))-.001146*Math.cos(m*(66.5106+349471.8432*n-335.112*a-35.715*i+16.854*o))-915e-6*Math.cos(m*(201.474+826670.7108*n-245.142*a-21.367*i+10.057*o))+869e-6*Math.cos(m*(103.2079+377336.3051*n-121.035*a-10.724*i+5.028*o))-628e-6*Math.cos(m*(235.7004+890534.223*n-32.601*a+3.664*i-1.769*o))-393e-6*Math.cos(m*(291.5472-127727.0245*n-425.082*a-50.062*i+23.651*o))+284e-6*Math.cos(m*(328.2445-99862.5625*n-211.005*a-25.072*i+11.826*o))-278e-6*Math.cos(m*(162.8868-31931.7561*n-106.271*a-12.516*i+5.913*o))-24e-5*Math.cos(m*(269.9268+954397.7353*n+179.941*a+28.695*i-13.594*o))+23e-5*Math.cos(m*(111.4008+1781068.4461*n-65.201*a+7.328*i-3.538*o))+229e-6*Math.cos(m*(167.2476+762807.1986*n-457.683*a-46.398*i+21.882*o))-202e-6*Math.cos(m*(83.3826-12006.2998*n+247.999*a+29.262*i-13.826*o))+19e-5*Math.cos(m*(190.8102-541062.3799*n-302.511*a-39.379*i+18.623*o))+177e-6*Math.cos(m*(357.5291+35999.0503*n-1.536*a+.041*i+0*o))+153e-6*Math.cos(m*(32.2842+285608.3309*n-547.653*a-60.746*i+28.679*o))-137e-6*Math.cos(m*(44.8902+1431596.6029*n+269.911*a+43.043*i-20.392*o))+122e-6*Math.cos(m*(145.6272+1844931.9583*n+147.34*a+32.359*i-15.363*o))+116e-6*Math.cos(m*(302.211+1240006.0662*n-367.713*a-32.051*i+15.085*o))-111e-6*Math.cos(m*(203.9449+790671.6605*n-243.606*a-21.408*i+10.057*o))-108e-6*Math.cos(m*(68.9815+313472.7929*n-333.576*a-35.756*i+16.854*o))+96e-6*Math.cos(m*(336.4374+1303869.5784*n-155.171*a-7.02*i+3.259*o))-9e-5*Math.cos(m*(98.2661+449334.4057*n-124.107*a-10.643*i+5.028*o))+9e-5*Math.cos(m*(13.1347+1331734.0404*n+58.906*a+17.971*i-8.566*o))+56e-6*Math.cos(m*(55.8468-1018261.2475*n-392.482*a-53.726*i+25.42*o))-56e-6*Math.cos(m*(238.1713+854535.1727*n-31.065*a+3.623*i-1.769*o))+52e-6*Math.cos(m*(308.4192-489205.1674*n+158.029*a+14.915*i-7.029*o))-5e-5*Math.cos(m*(133.0212+698943.6863*n-670.224*a-71.429*i+33.708*o))-49e-6*Math.cos(m*(267.9846+1176142.554*n-580.254*a-57.082*i+26.911*o))-49e-6*Math.cos(m*(184.1196+401329.0556*n+125.428*a+18.579*i-8.798*o))-45e-6*Math.cos(m*(49.1562-75869.812*n+35.458*a+4.231*i-2.001*o))+44e-6*Math.cos(m*(257.3208-191590.5367*n-637.623*a-75.093*i+35.477*o))+42e-6*Math.cos(m*(105.6788+341337.2548*n-119.499*a-10.765*i+5.028*o))+42e-6*Math.cos(m*(160.4159+4067.2942*n-107.806*a-12.475*i+5.913*o))+4e-5*Math.cos(m*(246.3642+2258267.3137*n+24.769*a+21.675*i-10.335*o))-4e-5*Math.cos(m*(156.5838-604925.8921*n-515.053*a-64.41*i+30.448*o))+36e-6*Math.cos(m*(169.7185+726808.1483*n-456.147*a-46.439*i+21.882*o))+29e-6*Math.cos(m*(113.8717+1745069.3958*n-63.665*a+7.287*i-3.538*o))-29e-6*Math.cos(m*(297.8502+445267.1115*n-16.3*a+1.832*i-.884*o))-28e-6*Math.cos(m*(294.0181-163726.0747*n-423.546*a-50.103*i+23.651*o))+27e-6*Math.cos(m*(263.6238+381403.5993*n-228.841*a-23.199*i+10.941*o))-26e-6*Math.cos(m*(358.0578+221744.8187*n-760.194*a-85.777*i+40.505*o))-26e-6*Math.cos(m*(8.1929+1403732.141*n+55.834*a+18.052*i-8.566*o))+.055544+.001*n*(-.0022*Math.cos(m*(103.2+377336.3*n))),u=.0011776*Math.cos(m*(49.1562-75869.812*n+35.458*a+4.231*i-2.001*o))-971e-7*Math.cos(m*(235.7004+890534.223*n-32.601*a+3.664*i-1.769*o))+908e-7*Math.cos(m*(186.5442+966404.0351*n-68.058*a-.567*i+.232*o))+623e-7*Math.cos(m*(83.3826-12006.2998*n+247.999*a+29.262*i-13.826*o))+483e-7*Math.cos(m*(51.6271-111868.8623*n+36.994*a+4.19*i-2.001*o))+348e-7*Math.cos(m*(100.737+413335.3554*n-122.571*a-10.684*i+5.028*o))-316e-7*Math.cos(m*(308.4192-489205.1674*n+158.029*a+14.915*i-7.029*o))-253e-7*Math.cos(m*(46.6853-39870.7617*n+33.922*a+4.272*i-2.001*o))-141e-7*Math.cos(m*(274.1928-553068.6797*n-54.513*a-10.116*i+4.797*o))+127e-7*Math.cos(m*(325.7736-63863.5122*n-212.541*a-25.031*i+11.826*o))+117e-7*Math.cos(m*(184.1196+401329.0556*n+125.428*a+18.579*i-8.798*o))-78e-7*Math.cos(m*(98.3124-151739.624*n+70.916*a+8.462*i-4.001*o))-63e-7*Math.cos(m*(238.1713+854535.1727*n-31.065*a+3.623*i-1.769*o))+63e-7*Math.cos(m*(134.9634+477198.8676*n+89.97*a+14.348*i-6.797*o))+36e-7*Math.cos(m*(321.5076+1443602.9027*n+21.912*a+13.78*i-6.566*o))-35e-7*Math.cos(m*(10.6638+1367733.0907*n+57.37*a+18.011*i-8.566*o))+24e-7*Math.cos(m*(149.8932+337465.5434*n-87.113*a-6.453*i+3.028*o))+24e-7*Math.cos(m*(170.9849-930404.9848*n+66.523*a+.608*i-.232*o))+.0449858+.001*(-.0203*Math.cos(m*(125-1934.1*n))+.0034*Math.cos(m*(220.2-1935.5*n))),c=83.353+4069.0137*n-103.238*a-12.492*i+5.263*o+(-15.448*Math.sin(m*(100.737+413335.3554*n-122.571*a-10.684*i+5.028*o))-9.642*Math.sin(m*(325.7736-63863.5122*n-212.541*a-25.031*i+11.826*o))-2.721*Math.sin(m*(134.9634+477198.8676*n+89.97*a+14.348*i-6.797*o))+2.607*Math.sin(m*(66.5106+349471.8432*n-335.112*a-35.715*i+16.854*o))+2.085*Math.sin(m*(201.474+826670.7108*n-245.142*a-21.367*i+10.057*o))+1.477*Math.sin(m*(10.6638+1367733.0907*n+57.37*a+18.011*i-8.566*o))+.968*Math.sin(m*(291.5472-127727.0245*n-425.082*a-50.062*i+23.651*o))-.949*Math.sin(m*(103.2079+377336.3051*n-121.035*a-10.724*i+5.028*o))-.703*Math.sin(m*(167.2476+762807.1986*n-457.683*a-46.398*i+21.882*o))-.66*Math.sin(m*(235.7004+890534.223*n-32.601*a+3.664*i-1.769*o))-.577*Math.sin(m*(190.8102-541062.3799*n-302.511*a-39.379*i+18.623*o))-.524*Math.sin(m*(269.9268+954397.7353*n+179.941*a+28.695*i-13.594*o))-.482*Math.sin(m*(32.2842+285608.3309*n-547.653*a-60.746*i+28.679*o))+.452*Math.sin(m*(357.5291+35999.0503*n-1.536*a+.041*i+0*o))-.381*Math.sin(m*(302.211+1240006.0662*n-367.713*a-32.051*i+15.085*o))-.342*Math.sin(m*(328.2445-99862.5625*n-211.005*a-25.072*i+11.826*o))-.312*Math.sin(m*(44.8902+1431596.6029*n+269.911*a+43.043*i-20.392*o))+.282*Math.sin(m*(162.8868-31931.7561*n-106.271*a-12.516*i+5.913*o))+.255*Math.sin(m*(203.9449+790671.6605*n-243.606*a-21.408*i+10.057*o))+.252*Math.sin(m*(68.9815+313472.7929*n-333.576*a-35.756*i+16.854*o))-.211*Math.sin(m*(83.3826-12006.2998*n+247.999*a+29.262*i-13.826*o))+.193*Math.sin(m*(267.9846+1176142.554*n-580.254*a-57.082*i+26.911*o))+.191*Math.sin(m*(133.0212+698943.6863*n-670.224*a-71.429*i+33.708*o))-.184*Math.sin(m*(55.8468-1018261.2475*n-392.482*a-53.726*i+25.42*o))+.182*Math.sin(m*(145.6272+1844931.9583*n+147.34*a+32.359*i-15.363*o))-.158*Math.sin(m*(257.3208-191590.5367*n-637.623*a-75.093*i+35.477*o))+.148*Math.sin(m*(156.5838-604925.8921*n-515.053*a-64.41*i+30.448*o))-.111*Math.sin(m*(169.7185+726808.1483*n-456.147*a-46.439*i+21.882*o))+.101*Math.sin(m*(13.1347+1331734.0404*n+58.906*a+17.971*i-8.566*o))+.1*Math.sin(m*(358.0578+221744.8187*n-760.194*a-85.777*i+40.505*o))+.087*Math.sin(m*(98.2661+449334.4057*n-124.107*a-10.643*i+5.028*o))+.08*Math.sin(m*(42.948+1653341.4216*n-490.283*a-42.734*i+20.113*o))+.08*Math.sin(m*(222.5657-441199.8173*n-91.506*a-14.307*i+6.797*o))+.077*Math.sin(m*(294.0181-163726.0747*n-423.546*a-50.103*i+23.651*o))-.073*Math.sin(m*(280.8834-1495460.1151*n-482.452*a-68.074*i+32.217*o))-.071*Math.sin(m*(304.6819+1204007.0159*n-366.177*a-32.092*i+15.085*o))-.069*Math.sin(m*(233.7582+1112279.0417*n-792.795*a-82.113*i+38.736*o))-.067*Math.sin(m*(34.7551+249609.2807*n-546.117*a-60.787*i+28.679*o))-.067*Math.sin(m*(263.6238+381403.5993*n-228.841*a-23.199*i+10.941*o))+.055*Math.sin(m*(21.6203-1082124.7597*n-605.023*a-78.757*i+37.246*o))+.055*Math.sin(m*(308.4192-489205.1674*n+158.029*a+14.915*i-7.029*o))-.054*Math.sin(m*(8.7216+1589477.9094*n-702.824*a-67.766*i+31.939*o))-.052*Math.sin(m*(179.8536+1908795.4705*n+359.881*a+57.39*i-27.189*o))-.05*Math.sin(m*(98.7948+635080.1741*n-882.765*a-96.461*i+45.533*o))-.049*Math.sin(m*(128.6604-95795.2683*n-318.812*a-37.547*i+17.738*o))-.047*Math.sin(m*(17.3544+425341.6552*n-370.57*a-39.946*i+18.854*o))-.044*Math.sin(m*(160.4159+4067.2942*n-107.806*a-12.475*i+5.913*o))-.043*Math.sin(m*(238.1713+854535.1727*n-31.065*a+3.623*i-1.769*o))+.042*Math.sin(m*(270.4555+1140143.5037*n-578.718*a-57.123*i+26.911*o))-.042*Math.sin(m*(132.4925+513197.9179*n+88.434*a+14.388*i-6.797*o))-.041*Math.sin(m*(122.3573-668789.4043*n-727.594*a-89.441*i+42.274*o))-.04*Math.sin(m*(105.6788+341337.2548*n-119.499*a-10.765*i+5.028*o))+.038*Math.sin(m*(135.4921+662944.6361*n-668.688*a-71.47*i+33.708*o))-.037*Math.sin(m*(242.391-51857.2124*n-460.54*a-54.293*i+25.652*o))+.036*Math.sin(m*(336.4374+1303869.5784*n-155.171*a-7.02*i+3.259*o))+.035*Math.sin(m*(223.0943-255454.0489*n-850.164*a-100.124*i+47.302*o))-.034*Math.sin(m*(193.2811-577061.4302*n-300.976*a-39.419*i+18.623*o))+.031*Math.sin(m*(87.6023-918398.685*n-181.476*a-28.654*i+13.594*o)))+.001*n*(2.4*Math.sin(m*(103.2+377336.3*n))),h=125.0446-1934.13618*n+20.762*a+2.139*i-1.65*o+(-1.4979*Math.sin(m*(49.1562-75869.812*n+35.458*a+4.231*i-2.001*o))-.15*Math.sin(m*(357.5291+35999.0503*n-1.536*a+.041*i+0*o))-.1226*Math.sin(m*(235.7004+890534.223*n-32.601*a+3.664*i-1.769*o))+.1176*Math.sin(m*(186.5442+966404.0351*n-68.058*a-.567*i+.232*o))-.0801*Math.sin(m*(83.3826-12006.2998*n+247.999*a+29.262*i-13.826*o))-.0616*Math.sin(m*(51.6271-111868.8623*n+36.994*a+4.19*i-2.001*o))+.049*Math.sin(m*(100.737+413335.3554*n-122.571*a-10.684*i+5.028*o))+.0409*Math.sin(m*(308.4192-489205.1674*n+158.029*a+14.915*i-7.029*o))+.0327*Math.sin(m*(134.9634+477198.8676*n+89.97*a+14.348*i-6.797*o))+.0324*Math.sin(m*(46.6853-39870.7617*n+33.922*a+4.272*i-2.001*o))+.0196*Math.sin(m*(98.3124-151739.624*n+70.916*a+8.462*i-4.001*o))+.018*Math.sin(m*(274.1928-553068.6797*n-54.513*a-10.116*i+4.797*o))+.015*Math.sin(m*(325.7736-63863.5122*n-212.541*a-25.031*i+11.826*o))-.015*Math.sin(m*(184.1196+401329.0556*n+125.428*a+18.579*i-8.798*o))-.0078*Math.sin(m*(238.1713+854535.1727*n-31.065*a+3.623*i-1.769*o))-.0045*Math.sin(m*(10.6638+1367733.0907*n+57.37*a+18.011*i-8.566*o))+.0044*Math.sin(m*(321.5076+1443602.9027*n+21.912*a+13.78*i-6.566*o))-.0042*Math.sin(m*(162.8868-31931.7561*n-106.271*a-12.516*i+5.913*o))-.0031*Math.sin(m*(170.9849-930404.9848*n+66.523*a+.608*i-.232*o))+.0031*Math.sin(m*(103.2079+377336.3051*n-121.035*a-10.724*i+5.028*o))+.0029*Math.sin(m*(222.612-1042273.8471*n+103.516*a+4.798*i-2.232*o))+.0028*Math.sin(m*(184.0733+1002403.0853*n-69.594*a-.526*i+.232*o)))+.001*(25.9*Math.sin(m*(125-1934.1*n))-4.3*Math.sin(m*(220.2-1935.5*n))+.38*Math.sin(m*(357.5+35999.1*n))*n),f=218.31665+481267.88134*n-13.268*a+1.856*i-1.534*o+(-.92581*Math.sin(m*(235.7004+890534.223*n-32.601*a+3.664*i-1.769*o))+.33262*Math.sin(m*(100.737+413335.3554*n-122.571*a-10.684*i+5.028*o))-.18402*Math.sin(m*(357.5291+35999.0503*n-1.536*a+.041*i+0*o))+.11007*Math.sin(m*(134.9634+477198.8676*n+89.97*a+14.348*i-6.797*o))-.06055*Math.sin(m*(238.1713+854535.1727*n-31.065*a+3.623*i-1.769*o))+.04741*Math.sin(m*(325.7736-63863.5122*n-212.541*a-25.031*i+11.826*o))-.03086*Math.sin(m*(10.6638+1367733.0907*n+57.37*a+18.011*i-8.566*o))+.02184*Math.sin(m*(103.2079+377336.3051*n-121.035*a-10.724*i+5.028*o))+.01645*Math.sin(m*(49.1562-75869.812*n+35.458*a+4.231*i-2.001*o))+.01022*Math.sin(m*(233.2295+926533.2733*n-34.136*a+3.705*i-1.769*o))-.00756*Math.sin(m*(336.4374+1303869.5784*n-155.171*a-7.02*i+3.259*o))-.0053*Math.sin(m*(222.5657-441199.8173*n-91.506*a-14.307*i+6.797*o))-.00496*Math.sin(m*(162.8868-31931.7561*n-106.271*a-12.516*i+5.913*o))-.00472*Math.sin(m*(297.8502+445267.1115*n-16.3*a+1.832*i-.884*o))-.00271*Math.sin(m*(240.6422+818536.1225*n-29.529*a+3.582*i-1.769*o))+.00264*Math.sin(m*(132.4925+513197.9179*n+88.434*a+14.388*i-6.797*o))-.00254*Math.sin(m*(186.5442+966404.0351*n-68.058*a-.567*i+.232*o))+.00234*Math.sin(m*(269.9268+954397.7353*n+179.941*a+28.695*i-13.594*o))-.0022*Math.sin(m*(13.1347+1331734.0404*n+58.906*a+17.971*i-8.566*o))-.00202*Math.sin(m*(355.0582+71998.1006*n-3.072*a+.082*i+0*o))+.00167*Math.sin(m*(328.2445-99862.5625*n-211.005*a-25.072*i+11.826*o))-.00143*Math.sin(m*(173.5506+1335801.3346*n-48.901*a+5.496*i-2.653*o))-.00121*Math.sin(m*(98.2661+449334.4057*n-124.107*a-10.643*i+5.028*o))-.00116*Math.sin(m*(145.6272+1844931.9583*n+147.34*a+32.359*i-15.363*o))+.00102*Math.sin(m*(105.6788+341337.2548*n-119.499*a-10.765*i+5.028*o))-9e-4*Math.sin(m*(184.1196+401329.0556*n+125.428*a+18.579*i-8.798*o))-86e-5*Math.sin(m*(338.9083+1267870.5281*n-153.636*a-7.061*i+3.259*o))-78e-5*Math.sin(m*(111.4008+1781068.4461*n-65.201*a+7.328*i-3.538*o))+69e-5*Math.sin(m*(323.3027-27864.4619*n-214.077*a-24.99*i+11.826*o))+66e-5*Math.sin(m*(51.6271-111868.8623*n+36.994*a+4.19*i-2.001*o))+65e-5*Math.sin(m*(38.5872+858602.4669*n-138.871*a-8.852*i+4.144*o))-6e-4*Math.sin(m*(83.3826-12006.2998*n+247.999*a+29.262*i-13.826*o))+54e-5*Math.sin(m*(201.474+826670.7108*n-245.142*a-21.367*i+10.057*o))-52e-5*Math.sin(m*(308.4192-489205.1674*n+158.029*a+14.915*i-7.029*o))+48e-5*Math.sin(m*(8.1929+1403732.141*n+55.834*a+18.052*i-8.566*o))-41e-5*Math.sin(m*(46.6853-39870.7617*n+33.922*a+4.272*i-2.001*o))-33e-5*Math.sin(m*(274.1928-553068.6797*n-54.513*a-10.116*i+4.797*o))+3e-4*Math.sin(m*(160.4159+4067.2942*n-107.806*a-12.475*i+5.913*o)))+.001*(3.96*Math.sin(m*(119.7+131.8*n))+1.96*Math.sin(m*(125-1934.1*n))+(.463*Math.sin(m*(357.5+35999.1*n))+.152*Math.sin(m*(238.2+854535.2*n))-.071*Math.sin(m*(27.8+131.8*n))-.055*Math.sin(m*(103.2+377336.3*n))-.026*Math.sin(m*(233.2+926533.3*n)))*n+(14*Math.sin(m*(357.5+35999.1*n))+5*Math.sin(m*(238.2+854535.2*n)))*a);return t.a=s,t.e=l,t.i=2*Math.asin(u),t.w=K(m*(c-h)),t.N=K(m*h),t.M=K(m*(f-c)),t},corr:function(t,n){var e=K(n.M+Math.PI),r=K(n.w+Math.PI),a=t.M+t.w,i=a+t.N-e-r,o=-.022234*Math.sin(t.M-2*i)+.011494*Math.sin(2*i)+-.003246*Math.sin(e)+-.001029*Math.sin(2*t.M-2*i)+-994838e-9*Math.sin(t.M-2*i+e)+925025e-9*Math.sin(t.M+2*i)+802851e-9*Math.sin(2*i-e)+715585e-9*Math.sin(t.M-e)+-610865e-9*Math.sin(i)+-541052e-9*Math.sin(t.M+e)+-261799e-9*Math.sin(2*a-2*i)+191986e-9*Math.sin(t.M-4*i);t.ra+=o;var s=-.003019*Math.sin(a-2*i)+-959931e-9*Math.sin(t.M-a-2*i)+-802851e-9*Math.sin(t.M+a-2*i)+575958e-9*Math.sin(a+2*i)+296706e-9*Math.sin(2*t.M+a);return t.dec+=s,t.age=K(t.l-n.l+Math.PI),t.phase=.5*(1-Math.cos(t.age)),t}};function yt(t){d3.select(\"body\").append(\"div\").attr(\"id\",\"d3-celestial-svg\").attr(\"style\",\"display: none\");var n,e,r=d3.select(\"#d3-celestial-svg\").append(\"svg\"),a=s.metrics(),i=P.set(),o=i.datapath,l=I[i.projection],u=b(i.center),f=[-u[0],-u[1]],p=l.scale*a.width/1024,d=s.projection(i.projection).rotate(u).translate([a.width/2,a.height/2]).scale([a.scale]),v=i.adaptable?Math.sqrt(a.scale/p):1,m=\"\"!==i.culture&&\"iau\"!==i.culture?i.culture:\"\";r.selectAll(\"*\").remove();var x=r.append(\"defs\");l.clip&&d.clipAngle(90),n=d3.geo.circle().angle([179.95]).origin(f),r.attr(\"width\",a.width).attr(\"height\",a.height);for(var k=[\"background\",\"milkyWay\",\"milkyWayBg\",\"gridLines\",\"constBoundaries\",\"planesequatorial\",\"planesecliptic\",\"planesgalactic\",\"planessupergalactic\",\"constLines\",\"mapBorder\",\"stars\",\"dsos\",\"planets\",\"gridvaluesLon\",\"gridvaluesLat\",\"constNames\",\"starDesignations\",\"starNames\",\"dsoNames\",\"planetNames\",\"horizon\",\"daylight\"],S={},z={},A=0;A<k.length;A++)S[k[A]]=r.append(\"g\").attr({id:k[A],\":inkscape:groupmode\":\"layer\",\":inkscape:label\":k[A]}),z[k[A]]={};var N=d3.geo.graticule().minorStep([15,10]),j=d3.geo.path().projection(d),L=d3.queue(2);if(S.background.append(\"path\").datum(n).attr(\"class\",\"background\").attr(\"d\",j),z.background.fill=i.background.fill,i.lines.graticule.show){if(\"equatorial\"===i.transform?(S.gridLines.append(\"path\").datum(N).attr(\"class\",\"gridLines\").attr(\"d\",j),z.gridLines=G(i.lines.graticule)):(s.graticule(S.gridLines,j,i.transform),z.gridLines=G(i.lines.graticule)),V(i.lines.graticule,\"lon\")&&i.lines.graticule.lon.pos.length>0){var C={type:\"FeatureCollection\",features:E(\"lon\",i.lines.graticule.lon.pos)};S.gridvaluesLon.selectAll(\".gridvalues_lon\").data(C.features).enter().append(\"text\").attr(\"transform\",function(t,n){return H(t.geometry.coordinates)}).text(function(t){return t.properties.value}).attr({dy:\".5em\",dx:\"-.75em\",class:\"gridvaluesLon\"}),z.gridvaluesLon=Y(i.lines.graticule.lon)}if(V(i.lines.graticule,\"lat\")&&i.lines.graticule.lat.pos.length>0){var F={type:\"FeatureCollection\",features:E(\"lat\",i.lines.graticule.lat.pos)};S.gridvaluesLat.selectAll(\".gridvalues_lat\").data(F.features).enter().append(\"text\").attr(\"transform\",function(t,n){return H(t.geometry.coordinates)}).text(function(t){return t.properties.value}).attr({dy:\"-.5em\",dx:\"-.75em\",class:\"gridvaluesLat\"}),z.gridvaluesLat=Y(i.lines.graticule.lat)}}for(var O in i.lines)V(i.lines,O)&&\"graticule\"!=O&&!1!==i.lines[O].show&&(S[e=\"planes\"+O].append(\"path\").datum(d3.geo.circle().angle([90]).origin(g[O])).attr(\"class\",e).attr(\"d\",j),z[e]=G(i.lines[O]));function U(t){return l.clip&&d3.geo.distance(f,t)>M?0:1}function H(t){return\"translate(\"+d(t)+\")\"}function Q(t,n,e){return t+(n=n?\".\"+n:\"\")+(V(R[t],m)?\".\"+m:\"\")+(e?\".\"+e:\".json\")}function G(t){var n={};return n.fill=t.fill||\"none\",n[\"fill-opacity\"]=null!==t.opacity?t.opacity:1,n.stroke=t.stroke||\"none\",n[\"stroke-width\"]=null!==t.width?t.width:0,n[\"stroke-opacity\"]=null!==t.opacity?t.opacity:1,n[\"stroke-dasharray\"]=V(t,\"dash\")?t.dash.join(\" \"):\"none\",n.font=t.font||null,n}function Y(t){var n={stroke:\"none\"};return n.fill=t.fill||\"none\",n[\"fill-opacity\"]=null!==t.opacity?t.opacity:1,n[\"text-anchor\"]=W(t.align),n.font=t.font||null,n}function W(t){return t?\"center\"===t?\"middle\":\"right\"===t?\"end\":\"start\":\"start\"}function $(t){var n={type:\"Feature\",id:t.id,properties:{},geometry:{}};return n.properties.name=t[i.planets.namesType],\"symbol\"!==i.planets.symbolType&&\"letter\"!==i.planets.symbolType||(n.properties.symbol=i.planets.symbols[n.id][i.planets.symbolType]),n.properties.mag=t.ephemeris.mag||10,\"lun\"===n.id&&(n.properties.age=t.ephemeris.age,n.properties.phase=t.ephemeris.phase),n.geometry.type=\"Point\",n.geometry.coordinates=t.ephemeris.pos,n}function Z(t){var n=\" {\";for(var e in t)V(t,e)&&(n+=e+\":\"+t[e]+\"; \");return n+\"} \"}i.mw.show&&L.defer(function(t){d3.json(o+\"mw.json\",function(n,e){n&&t(n);var r=_(e,i.transform),a=T(r);S.milkyWay.selectAll(\".mway\").data(r.features).enter().append(\"path\").attr(\"class\",\"milkyWay\").attr(\"d\",j),z.milkyWay=G(i.mw.style),(!V(i.background,\"opacity\")||i.background.opacity>.95)&&(S.milkyWayBg.selectAll(\".mwaybg\").data(a.features).enter().append(\"path\").attr(\"class\",\"milkyWayBg\").attr(\"d\",j),z.milkyWayBg={fill:i.background.fill,\"fill-opacity\":i.background.opacity}),t(null)})}),i.constellations.bounds&&L.defer(function(t){d3.json(o+Q(\"constellations\",\"borders\"),function(n,e){n&&t(n);var r=_(e,i.transform);if(s.constellation)var a=new RegExp(\"\\\\b\"+s.constellation+\"\\\\b\");S.constBoundaries.selectAll(\".bounds\").data(r.features).enter().append(\"path\").attr(\"class\",function(t){return s.constellation&&-1!==t.ids.search(a)?\"constBoundariesSel\":\"constBoundaries\"}).attr(\"d\",j),z.constBoundaries=G(i.constellations.boundStyle),z.constBoundariesSel={fill:\"none\",stroke:i.constellations.boundStyle.stroke,\"stroke-width\":1.5*i.constellations.boundStyle.width,\"stroke-opacity\":1,\"stroke-dasharray\":\"none\"},t(null)})}),i.constellations.lines&&L.defer(function(t){d3.json(o+Q(\"constellations\",\"lines\"),function(n,e){n&&t(n);var r=_(e,i.transform);S.constLines.selectAll(\".lines\").data(r.features).enter().append(\"path\").attr(\"class\",function(t){return\"constLines\"+t.properties.rank}).attr(\"d\",j);var a=V(i.constellations.lineStyle,\"dash\")?i.constellations.lineStyle.dash.join(\" \"):\"none\";z.constLines1={fill:\"none\",stroke:i.constellations.lineStyle.stroke[0],\"stroke-width\":i.constellations.lineStyle.width[0],\"stroke-opacity\":i.constellations.lineStyle.opacity[0],\"stroke-dasharray\":a},z.constLines2={fill:\"none\",stroke:i.constellations.lineStyle.stroke[1],\"stroke-width\":i.constellations.lineStyle.width[1],\"stroke-opacity\":i.constellations.lineStyle.opacity[1],\"stroke-dasharray\":a},z.constLines3={fill:\"none\",stroke:i.constellations.lineStyle.stroke[2],\"stroke-width\":i.constellations.lineStyle.width[2],\"stroke-opacity\":i.constellations.lineStyle.opacity[2],\"stroke-dasharray\":a},t(null)})}),L.defer(function(t){var n=d.rotate();d.rotate([0,0,0]),S.mapBorder.append(\"path\").datum(N.outline).attr(\"class\",\"mapBorder\").attr(\"d\",j),z.mapBorder={fill:\"none\",stroke:i.background.stroke,\"stroke-width\":i.background.width,\"stroke-opacity\":1,\"stroke-dasharray\":\"none\"},d.rotate(n),t(null)}),i.constellations.names&&L.defer(function(t){d3.json(o+Q(\"constellations\"),function(n,e){n&&t(n);var r=_(e,i.transform);S.constNames.selectAll(\".constnames\").data(r.features.filter(function(t){return 1===U(t.geometry.coordinates)})).enter().append(\"text\").attr(\"class\",function(t){return\"constNames\"+t.properties.rank}).attr(\"transform\",function(t,n){return H(t.geometry.coordinates)}).text(function(t){return function(t){return t.properties[i.constellations.namesType]}(t)}),z.constNames1={fill:i.constellations.nameStyle.fill[0],\"fill-opacity\":i.constellations.nameStyle.opacity[0],font:i.constellations.nameStyle.font[0],\"text-anchor\":W(i.constellations.nameStyle.align)},z.constNames2={fill:i.constellations.nameStyle.fill[1],\"fill-opacity\":i.constellations.nameStyle.opacity[1],font:i.constellations.nameStyle.font[1],\"text-anchor\":W(i.constellations.nameStyle.align)},z.constNames3={fill:i.constellations.nameStyle.fill[2],\"fill-opacity\":i.constellations.nameStyle.opacity[2],font:i.constellations.nameStyle.font[2],\"text-anchor\":W(i.constellations.nameStyle.align)},t(null)})}),i.stars.show&&L.defer(function(t){d3.json(o+i.stars.data,function(n,e){n&&t(n);var r=_(e,i.transform);S.stars.selectAll(\".stars\").data(r.features.filter(function(t){return t.properties.mag<=i.stars.limit})).enter().append(\"path\").attr(\"class\",function(t){return\"stars\"+(n=t.properties.bv,!i.stars.colors||isNaN(n)?\"\":Math.round(10*n).toString());var n}).attr(\"d\",j.pointRadius(function(t){return t.properties?function(t){if(null===t)return.1;var n=i.stars.size*v*Math.exp(i.stars.exponent*(t+2));return Math.max(n,.1)}(t.properties.mag):1})),z.stars=G(i.stars.style);var a=D.domain();for(A=B(a[1],1);A<=B(a[0],1);A+=.1)z[\"stars\"+Math.round(10*A).toString()]={fill:D(A)};i.stars.designation&&(S.starDesignations.selectAll(\".stardesigs\").data(r.features.filter(function(t){return t.properties.mag<=i.stars.designationLimit*v&&1===U(t.geometry.coordinates)})).enter().append(\"text\").attr(\"transform\",function(t){return H(t.geometry.coordinates)}).text(function(t){return function(t){return V(c,t)?c[t][i.stars.designationType]:\"\"}(t.id)}).attr({dy:\".85em\",dx:\".35em\",class:\"starDesignations\"}),z.starDesignations=Y(i.stars.designationStyle)),i.stars.propername&&(S.starNames.selectAll(\".starnames\").data(r.features.filter(function(t){return t.properties.mag<=i.stars.propernameLimit*v&&1===U(t.geometry.coordinates)})).enter().append(\"text\").attr(\"transform\",function(t){return H(t.geometry.coordinates)}).text(function(t){return function(t){var n=i.stars.propernameType;return V(c,t)?V(c[t],n)?c[t][n]:c[t].name:\"\"}(t.id)}).attr({dy:\"-.5em\",dx:\"-.35em\",class:\"starNames\"}),z.starNames=Y(i.stars.propernameStyle)),t(null)})}),i.dsos.show&&L.defer(function(t){d3.json(o+i.dsos.data,function(n,r){n&&t(n);var a=_(r,i.transform);for(O in S.dsos.selectAll(\".dsos\").data(a.features.filter(function(t){return 1===U(t.geometry.coordinates)&&(999===t.properties.mag&&Math.sqrt(parseInt(t.properties.dim))>i.dsos.limit*v||999!==t.properties.mag&&t.properties.mag<=i.dsos.limit)})).enter().append(\"path\").attr(\"class\",function(t){return\"dsos\"+t.properties.type}).attr(\"transform\",function(t){return H(t.geometry.coordinates)}).attr(\"d\",function(t){return o=(n=t.properties).dim,e=((a=n.mag)&&999!==a?Math.pow(2*i.dsos.size*v-a,i.dsos.exponent):Math.pow(parseInt(o)*i.dsos.size*v/7,.5))||9,r=function(t){return t&&V(i.dsos.symbols,t)?i.dsos.symbols[t].shape:\"circle\"}(n.type),-1!==d3.svg.symbolTypes.indexOf(r)?d3.svg.symbol().type(r).size(e)():d3.svg.customSymbol().type(r).size(e)();var n,e,r,a,o}),z.dsos=G(i.dsos.style),i.dsos.symbols)V(i.dsos.symbols,O)&&(z[e=\"dsos\"+O]={\"fill-opacity\":i.dsos.style.opacity,\"stroke-opacity\":i.dsos.style.opacity},V(i.dsos.symbols[O],\"stroke\")?(z[e].fill=\"none\",z[e].stroke=i.dsos.colors?i.dsos.symbols[O].stroke:i.dsos.style.stroke,z[e][\"stroke-width\"]=i.dsos.colors?i.dsos.symbols[O].width:i.dsos.style.width):(z[e].stroke=\"none\",z[e].fill=i.dsos.colors?i.dsos.symbols[O].fill:i.dsos.style.fill));if(i.dsos.names)for(O in S.dsoNames.selectAll(\".dsonames\").data(a.features.filter(function(t){return 1===U(t.geometry.coordinates)&&(999==t.properties.mag&&Math.sqrt(parseInt(t.properties.dim))>i.dsos.nameLimit||999!=t.properties.mag&&t.properties.mag<=i.dsos.nameLimit)})).enter().append(\"text\").attr(\"class\",function(t){return\"dsoNames \"+t.properties.type}).attr(\"transform\",function(t){return H(t.geometry.coordinates)}).text(function(t){return function(t){var n=i.dsos.namesType,e=t.id;return\"desig\"!==n&&V(h,e)&&V(h[e],n)?h[e][n]:t.properties.desig}(t)}).attr({dy:\"-.5em\",dx:\".35em\"}),z.dsoNames={\"fill-opacity\":i.dsos.style.opacity,font:i.dsos.nameStyle.font,\"text-anchor\":W(i.dsos.nameStyle.align)},i.dsos.symbols)V(i.dsos.symbols,O)&&(z[O]={fill:i.dsos.colors?i.dsos.symbols[O].fill:i.dsos.style.fill});t(null)})}),(i.location||i.formFields.location)&&i.planets.show&&s.origin&&L.defer(function(t){var n,e,r=s.date(),a=s.origin(r).spherical(),o={type:\"FeatureCollection\",features:[]},l={type:\"FeatureCollection\",features:[]};if(s.container.selectAll(\".planet\").each(function(t){var n=t.id(),e=t(r).equatorial(a);e.ephemeris.pos=y(e.ephemeris.pos,w[i.transform]),1===U(e.ephemeris.pos)&&(\"lun\"===n?l.features.push($(e)):o.features.push($(e)))}),\"disk\"===i.planets.symbolType?S.planets.selectAll(\".planets\").data(o.features).enter().append(\"path\").attr(\"transform\",function(t){return H(t.geometry.coordinates)}).attr(\"d\",function(t){var n=V(i.planets.symbols[t.id],\"size\")?(i.planets.symbols[t.id].size-1)*v:null;return function(t,n){var e=n?n*n:function(t){var n=4*v*Math.exp(-.05*((t||2)+2));return Math.max(n,2)}(t.mag);return d3.svg.symbol().type(\"circle\").size(e)()}(t.properties,n)}).attr(\"class\",function(t){return\"planets \"+t.id}):S.planets.selectAll(\".planets\").data(o.features).enter().append(\"text\").attr(\"transform\",function(t){return H(t.geometry.coordinates)}).text(function(t){return t.properties.symbol}).attr(\"class\",function(t){return\"planets \"+t.id}).attr({dy:\".35em\"}),l.features.length>0)if(\"letter\"===i.planets.symbolType)S.planets.selectAll(\".moon\").data(l.features).enter().append(\"text\").attr(\"transform\",function(t){return H(t.geometry.coordinates)}).text(function(t){return t.properties.symbol}).attr(\"class\",function(t){return\"planets \"+t.id}).attr({dy:\".35em\"});else{var u=V(i.planets.symbols.lun,\"size\")?(i.planets.symbols.lun.size-1)*v:11*v;S.planets.selectAll(\".dmoon\").data(l.features).enter().append(\"path\").attr(\"class\",\"darkluna\").attr(\"transform\",function(t){return H(t.geometry.coordinates)}).attr(\"d\",function(t){return d3.svg.symbol().type(\"circle\").size(u*u)()}),S.planets.selectAll(\".moon\").data(l.features).enter().append(\"path\").attr(\"class\",function(t){return\"planets \"+t.id}).attr(\"transform\",function(t){return H(t.geometry.coordinates)}).attr(\"d\",function(t){return n=t.properties,r=(e=u)?e*e:121,d3.svg.customSymbol().type(\"crescent\").size(r).ratio(n.age)();var n,e,r})}for(O in z.planets=Y(i.planets.symbolStyle),z.planets.font=(e=(n=i.planets.symbolStyle.font).replace(/(^\\D*)(\\d+)(\\D.+$)/i,\"$2\"),e=Math.round(v*e),n.replace(/(^\\D*)(\\d+)(\\D.+$)/i,\"$1\"+e+\"$3\")),z.darkluna={fill:\"#557\"},i.planets.symbols)V(i.planets.symbols,O)&&(z[O]={fill:i.planets.symbols[O].fill});i.planets.names&&(S.planetNames.selectAll(\".planetnames\").data(o.features).enter().append(\"text\").attr(\"transform\",function(t){return H(t.geometry.coordinates)}).text(function(t){return t.properties.name}).attr({dy:\".85em\",dx:\"-.35em\"}).attr(\"class\",function(t){return\"planetNames \"+t.id}),l.features.length>0&&S.planetNames.selectAll(\".moonname\").data(l.features).enter().append(\"text\").attr(\"transform\",function(t){return H(t.geometry.coordinates)}).text(function(t){return t.properties.name}).attr({dy:\".85em\",dx:\"-.35em\"}).attr(\"class\",function(t){return\"planetNames \"+t.id})),z.planetNames=Y(i.planets.nameStyle),t(null)}),(i.location||i.formFields.location)&&i.daylight.show&&l.clip&&L.defer(function(t){var n=q(\"sol\");if(n){var e=s.zenith(),r=n.ephemeris.pos,a=d3.geo.distance(e,r),i=d(r),o=d3.geo.circle().angle([179.95]).origin(r);S.daylight.append(\"path\").datum(o).attr(\"class\",\"daylight\").attr(\"d\",j),z.daylight=function(t,n){var e,r,a,i,o=1.36;if(t>1.885)return{fill:\"transparent\"};t<=o?(r=\"#daf1fa\",a=\"#93d7f0\",i=\"#57c0e8\",e=-(o-t)/10):(e=(t-o)/(1.885-o),r=d3.interpolateLab(\"#daf1fa\",\"#e8c866\")(e),a=d3.interpolateLab(\"#93c7d0\",\"#ff854a\")(e),i=d3.interpolateLab(\"#57b0c8\",\"#6caae2\")(e));var s,l=S.daylight.append(\"radialGradient\").attr(\"cx\",n[0]).attr(\"cy\",n[1]).attr(\"fr\",\"0\").attr(\"r\",\"300\").attr(\"id\",\"skygradient\").attr(\"gradientUnits\",\"userSpaceOnUse\");return l.append(\"stop\").attr(\"offset\",\"0\").attr(\"stop-color\",r),l.append(\"stop\").attr(\"offset\",.2+.4*e).attr(\"stop-color\",a),l.append(\"stop\").attr(\"offset\",\"1\").attr(\"stop-color\",i),{fill:\"url(#skygradient)\",\"fill-opacity\":(s=e,1.4,.9*(1-(Math.pow(Math.E,1.4*s)-1)/(Math.pow(Math.E,1.4)-1)))}}(a,i),1===U(r)&&a<M&&S.daylight.append(\"circle\").attr(\"cx\",i[0]).attr(\"cy\",i[1]).attr(\"r\",5).style(\"fill\",\"#fff\")}t(null)}),(i.location||i.formFields.location)&&i.horizon.show&&!l.clip&&L.defer(function(t){var n=d3.geo.circle().angle([90]).origin(s.nadir());S.horizon.append(\"path\").datum(n).attr(\"class\",\"horizon\").attr(\"d\",j),z.horizon=G(i.horizon),t(null)}),s.data.length>0&&s.data.forEach(function(t){V(t,\"save\")&&L.defer(function(n){t.save(),n(null)})}),L.await(function(n){if(n)throw n;var e=d3.select(\"#d3-celestial-svg svg\").attr(\"title\",\"D3-Celestial\").attr(\"version\",1.1).attr(\"encoding\",\"UTF-8\").attr(\"xmlns\",\"http://www.w3.org/2000/svg\").attr(\"xmlns:xlink\",\"http://www.w3.org/1999/xlink\").attr(\"xmlns:sodipodi\",\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\").attr(\"xmlns:inkscape\",\"http://www.inkscape.org/namespaces/inkscape\").attr(\"viewBox\",\" 0 0 \"+a.width+\" \"+a.height);if(x.append(\"style\").attr(\"type\",\"text/css\").text(function(){var t=\"\";for(var n in z)V(z,n)&&(t+=\" .\"+n+Z(z[n]));return\"/*<![CDATA[*/\\n\"+t+\"\\n/*]]>*/\"}()),t){var r=new Blob([e.node().outerHTML],{type:\"image/svg+xml;charset=utf-8\"}),i=d3.select(\"body\").append(\"a\").node();i.download=t||\"d3-celestial.svg\",i.rel=\"noopener\",i.href=URL.createObjectURL(r),i.click(),d3.select(i).remove()}else null!==wt&&wt(e.node().outerHTML);d3.select(\"#d3-celestial-svg\").remove()})}var bt=d3.map({ellipse:function(t,n){var e=Math.sqrt(t),r=.666*e,a=e/3;return\"M\"+-r+\",\"+-a+\" m\"+-r+\",0 a\"+r+\",\"+a+\" 0 1,0\"+2*r+\",0 a\"+r+\",\"+a+\" 0 1,0\"+-2*r+\",0\"},marker:function(t,n){var e=(t>48?t/4:12)/2,r=e-3;return\"M \"+-e+\" 0 h \"+r+\" M 0 \"+-e+\" v \"+r+\" M \"+e+\" 0 h \"+-r+\" M 0 \"+e+\" v \"+-r},\"cross-circle\":function(t,n){var e=Math.sqrt(t),r=e/2;return\"M\"+-r+\",\"+-r+\" m\"+-r+\",0 a\"+r+\",\"+r+\" 0 1,0\"+2*r+\",0 a\"+r+\",\"+r+\" 0 1,0\"+-2*r+\",0 M\"+-r+\" 0 h \"+e+\" M 0 \"+-r+\" v \"+e},\"stroke-circle\":function(t,n){var e=Math.sqrt(t),r=e/2;return\"M\"+-r+\",\"+-r+\" m\"+-r+\",0 a\"+r+\",\"+r+\" 0 1,0\"+2*r+\",0 a\"+r+\",\"+r+\" 0 1,0\"+-2*r+\",0 M\"+(-e-2)+\",\"+(-e-2)+\" l\"+(e+4)+\",\"+(e+4)},crescent:function(t,n){var e=Math.sqrt(t)/2,r=.5*(1-Math.cos(n)),a=1.6*Math.abs(r-.5)+.01,i=n>Math.PI?0:1;return\"M -1,-1 m 1,\"+(1-e)+\" a\"+e+\",\"+e+\" 0 1 \"+i+\" 0,\"+2*e+\" a\"+e*a+\",\"+e+\" 0 1 \"+(Math.abs(r)>.5?i:Math.abs(i-1))+\" 0,\"+-2*e+\"z\"}});d3.svg.customSymbol=function(){var t,n=64,e=d3.functor(1);function r(r,a){return bt.get(t.call(this,r,a))(n.call(this,r,a),e.call(this,r,a))}return r.type=function(n){return arguments.length?(t=d3.functor(n),r):t},r.size=function(t){return arguments.length?(n=d3.functor(t),r):n},r.ratio=function(t){return arguments.length?(e=d3.functor(t),r):e},r};var wt=null;s.exportSVG=function(t){t&&(wt=t,yt())};var xt,kt=function(t,n){var r,a,i,o=new Date,s=(d3.time.format(\"%Z\"),[{\"\\u221212:00\":-720},{\"\\u221211:00\":-660},{\"\\u221210:00\":-600},{\"\\u221209:30\":-570},{\"\\u221209:00\":-540},{\"\\u221208:00\":-480},{\"\\u221207:00\":-420},{\"\\u221206:00\":-360},{\"\\u221205:00\":-300},{\"\\u221204:30\":-270},{\"\\u221204:00\":-240},{\"\\u221203:30\":-210},{\"\\u221203:00\":-180},{\"\\u221202:30\":-150},{\"\\u221202:00\":-120},{\"\\u221201:00\":-60},{\"\\xb100:00\":0},{\"+01:00\":60},{\"+02:00\":120},{\"+03:00\":180},{\"+03:30\":210},{\"+04:00\":240},{\"+04:30\":270},{\"+05:00\":300},{\"+05:30\":330},{\"+05:45\":345},{\"+06:00\":360},{\"+06:30\":390},{\"+07:00\":420},{\"+08:00\":480},{\"+08:30\":510},{\"+08:45\":525},{\"+09:00\":540},{\"+09:30\":570},{\"+10:00\":600},{\"+10:30\":630},{\"+11:00\":660},{\"+12:00\":720},{\"+12:45\":765},{\"+13:00\":780},{\"+14:00\":840}]),l=[\"Su\",\"M\",\"Tu\",\"W\",\"Th\",\"F\",\"Sa\"],u=(g(o),d3.time.format(\"%Y-%m-%d\")),c=t.daterange||[],h=d3.select(e+\" ~ #celestial-form\").append(\"div\").attr(\"id\",\"celestial-date\");function f(){var t=ct(\"mon\").value,n=ct(\"yr\").value,r=new Date(n,t,1),a=d3.select(e+\" ~ #celestial-form\").select(\"#cal\"),i=new Date;n=parseInt(n),t=parseInt(t),r.setDate(r.getDate()-r.getDay());for(var s=a.node();s.firstChild;)s.removeChild(s.firstChild);for(var c=0;c<7;c++)a.append(\"div\").classed({date:!0,weekday:!0}).html(l[c]);for(c=0;c<42;c++){var h=r.getMonth(),f=r.getDay(),p=u(r);a.append(\"div\").classed({date:!0,grey:h!==t,weekend:h===t&&(0===f||6===f),today:0===W(r,i),selected:0===W(r,o)}).attr(\"id\",p).on(\"click\",y).html(r.getDate().toString()),r.setDate(r.getDate()+1)}}function p(){var t=d3.select(e+\" ~ #celestial-form\").select(\"select#yr\"),n=o.getFullYear(),r=0,a=g(o);t.selectAll(\"*\").remove(),t.selectAll(\"option\").data(a).enter().append(\"option\").text(function(t,e){return t===n&&(r=e),t.toString()}),t.property(\"selectedIndex\",r)}function d(t){h.append(\"div\").attr(\"id\",t).on(\"click\",function(){var n=ct(\"mon\"),e=ct(\"yr\");\"left\"===t?0===n.selectedIndex?(n.selectedIndex=11,e.selectedIndex--):n.selectedIndex--:11===n.selectedIndex?(n.selectedIndex=0,e.selectedIndex++):n.selectedIndex++,f()})}function g(t){for(var n=(a=t.getFullYear(),!c||c.length<1?[a-10,a+10]:1===c.length&&G(c[0])?c[0]>=100?[c[0]-10,c[0]+10]:[a-c[0],a+c[0]]:2===c.length&&G(c[0])&&G(c[1])?c[1]>=100?[c[0],c[1]]:[c[0]-c[1],c[0]+c[1]]:[a-10,a+10]),e=[],r=n[0];r<=n[1];r++)e.push(r);var a;return e}function v(t,n){for(var e=ct(t),r=0;r<e.childNodes.length;r++)if(e.childNodes[r].value==n){e.selectedIndex=r;break}}function M(t){t&&o.setTime(t.valueOf()),v(\"yr\",o.getFullYear()),v(\"mon\",o.getMonth()),f(),ct(\"hr\").value=o.getHours(),ct(\"min\").value=o.getMinutes(),ct(\"sec\").value=o.getSeconds()}function m(){d3.select(e+\" ~ #celestial-form\").select(\"#celestial-date\").style(\"opacity\",0),d3.select(\"#error\").style({top:\"-9999px\",left:\"-9999px\",opacity:0}),d3.select(e+\" ~ #celestial-form\").select(\"#datepick\").classed(\"active\",!1),setTimeout(function(){ct(\"celestial-date\").style.top=H(-9999)},600)}function y(){var t=ct(\"hr\").value,e=ct(\"min\").value,r=ct(\"sec\").value,a=ct(\"tz\").value;this.id&&-1!==this.id.search(/^\\d/)&&(o=u.parse(this.id)),p(),o.setHours(t,e,r),M(),n(o,a)}d(\"left\"),r=h.append(\"select\").attr(\"title\",\"Month\").attr(\"id\",\"mon\").on(\"change\",f),a=0,i=o.getMonth(),r.selectAll(\"option\").data([\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"]).enter().append(\"option\").attr(\"value\",function(t,n){return n===i&&(a=n),n}).text(function(t){return t}),r.property(\"selectedIndex\",a),h.append(\"select\").attr(\"title\",\"Year\").attr(\"id\",\"yr\").on(\"change\",f),p(),d(\"right\"),h.append(\"div\").attr(\"id\",\"cal\"),f(),h.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"hr\").attr(\"title\",\"Hours\").attr(\"max\",\"24\").attr(\"min\",\"-1\").attr(\"step\",\"1\").attr(\"value\",o.getHours()).on(\"change\",function(){!0===at(this)&&y()}),h.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"min\").attr(\"title\",\"Minutes\").attr(\"max\",\"60\").attr(\"min\",\"-1\").attr(\"step\",\"1\").attr(\"value\",o.getMinutes()).on(\"change\",function(){!0===at(this)&&y()}),h.append(\"input\").attr(\"type\",\"number\").attr(\"id\",\"sec\").attr(\"title\",\"Seconds\").attr(\"max\",\"60\").attr(\"min\",\"-1\").attr(\"step\",\"1\").attr(\"value\",o.getSeconds()).on(\"change\",function(){!0===at(this)&&y()}),function(){var t=h.append(\"select\").attr(\"title\",\"Time zone offset from UTC\").attr(\"id\",\"tz\").on(\"change\",y),n=15,e=-o.getTimezoneOffset();t.selectAll(\"option\").data(s).enter().append(\"option\").attr(\"value\",function(t,r){var a=Object.keys(t)[0];return t[a]===e&&(n=r),t[a]}).text(function(t){return Object.keys(t)[0]}),t.property(\"selectedIndex\",n)}(),this.show=function(t,n){var r=ct(\"celestial-date\"),a=ct(\"datepick\"),i=a.offsetLeft+a.offsetWidth-r.offsetWidth,s=a.offsetTop-r.offsetHeight-1;-9999===r.offsetTop?(o.setTime(t.valueOf()),v(\"tz\",n),M(),d3.select(e+\" ~ #celestial-form\").select(\"#celestial-date\").style({top:H(s),left:H(i),opacity:1}),d3.select(e+\" ~ #celestial-form\").select(\"#datepick\").classed(\"active\",!0)):m()},this.isVisible=function(){return!!document.getElementById(\"datepick\")&&!0===d3.select(e+\" ~ #celestial-form\").select(\"#datepick\").classed(\"active\")},this.hide=function(){m()}};!function(){var t=Math.PI/180,n=180/Math.PI;function e(t,n,e){var r=t.translate(),a=Math.atan2(n[1]-r[1],n[0]-r[0])-Math.atan2(e[1]-r[1],e[0]-r[0]);return[Math.cos(a/2),0,0,Math.sin(a/2)]}function r(t,n){var e=t.invert(n);return e&&isFinite(e[0])&&isFinite(e[1])&&u(e)}function a(n){var e=.5*n[0]*t,r=.5*n[1]*t,a=.5*n[2]*t,i=Math.sin(e),o=Math.cos(e),s=Math.sin(r),l=Math.cos(r),u=Math.sin(a),c=Math.cos(a);return[o*l*c+i*s*u,i*l*c-o*s*u,o*s*c+i*l*u,o*l*u-i*s*c]}function i(t,n){var e=t[0],r=t[1],a=t[2],i=t[3],o=n[0],s=n[1],l=n[2],u=n[3];return[e*o-r*s-a*l-i*u,e*s+r*o+a*u-i*l,e*l-r*u+a*o+i*s,e*u+r*l-a*s+i*o]}function o(t,n){if(t&&n){var e=function(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}(t,n),r=Math.sqrt(c(e,e)),a=.5*Math.acos(Math.max(-1,Math.min(1,c(t,n)))),i=Math.sin(a)/r;return r&&[Math.cos(a),e[2]*i,-e[1]*i,e[0]*i]}}function s(t,n){var e=Math.max(-1,Math.min(1,c(t,n))),r=e<0?-1:1,a=Math.acos(r*e),i=Math.sin(a);return i?function(e){var o=r*Math.sin((1-e)*a)/i,s=Math.sin(e*a)/i;return[t[0]*o+n[0]*s,t[1]*o+n[1]*s,t[2]*o+n[2]*s,t[3]*o+n[3]*s]}:function(){return t}}function l(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*n,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*n,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*n]}function u(n){var e=n[0]*t,r=n[1]*t,a=Math.cos(r);return[a*Math.cos(e),a*Math.sin(e),Math.sin(r)]}function c(t,n){for(var e=0,r=t.length,a=0;e<r;++e)a+=t[e]*n[e];return a}d3.geo.zoom=function(){var t,n,c,h=0,f=function(t){for(var n=0,e=arguments.length,r=[];++n<e;)r.push(arguments[n]);var a=d3.dispatch.apply(null,r);return a.of=function(n,e){return function(r){try{var i=r.sourceEvent=d3.event;r.target=t,d3.event=r,a[r.type].apply(n,e)}finally{d3.event=i}}},a}(p,\"zoomstart\",\"zoom\",\"zoomend\"),p=d3.behavior.zoom().on(\"zoomstart\",function(){var n=d3.mouse(this),s=a(t.rotate()),u=r(t,n);u&&(c=u),d.call(p,\"zoom\",function(){t.scale(g.k=d3.event.scale);var a=d3.mouse(this),u=o(c,r(t,a));t.rotate(g.r=l(s=u?i(s,u):i(e(t,n,a),s))),n=a,M(f.of(this,arguments))}),v(f.of(this,arguments))}).on(\"zoomend\",function(){d.call(p,\"zoom\",null),m(f.of(this,arguments))}),d=p.on,g={r:[0,0,0],k:1};function v(t){h++||t({type:\"zoomstart\"})}function M(t){t({type:\"zoom\"})}function m(t){--h||t({type:\"zoomend\"})}return p.rotateTo=function(t){var n=o(u(t),u([-g.r[0],-g.r[1]]));return l(i(a(g.r),n))},p.projection=function(n){return arguments.length?(g={r:(t=n).rotate(),k:t.scale()},p.scale(g.k)):t},p.duration=function(t){return arguments.length?(n=t,p):n},p.event=function(e){e.each(function(){var e=d3.select(this),r=f.of(this,arguments),i=g,o=d3.transition(e);if(o!==e){o.each(\"start.zoom\",function(){this.__chart__&&((g=this.__chart__).hasOwnProperty(\"r\")||(g.r=t.rotate())),t.rotate(g.r).scale(g.k),v(r)}).tween(\"zoom:zoom\",function(){var e=p.size()[0],u=s(a(g.r),a(i.r)),c=d3.geo.distance(g.r,i.r),h=d3.interpolateZoom([0,0,e/g.k],[c,0,e/i.k]);return n&&o.duration(n(.001*h.duration)),function(n){var a=h(n);this.__chart__=g={r:l(u(a[0]/c)),k:e/a[2]},t.rotate(g.r).scale(g.k),p.scale(g.k),M(r)}}).each(\"end.zoom\",function(){m(r)});try{o.each(\"interrupt.zoom\",function(){m(r)})}catch(u){console.log(u)}}else this.__chart__=g,v(r),M(r),m(r)})},d3.rebind(p,f,\"on\")}}(),xt=function(t){\"use strict\";var n=[].slice,e={};function r(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function a(t){if(!t._start)try{!function(t){for(;t._start=t._waiting&&t._active<t._size;){var n=t._ended+t._active,r=t._tasks[n],a=r.length-1,o=r[a];r[a]=i(t,n),--t._waiting,++t._active,r=o.apply(null,r),t._tasks[n]&&(t._tasks[n]=r||e)}}(t)}catch(n){if(t._tasks[t._ended+t._active-1])o(t,n);else if(!t._data)throw n}}function i(t,n){return function(e,r){t._tasks[n]&&(--t._active,++t._ended,t._tasks[n]=null,null==t._error&&(null!=e?o(t,e):(t._data[n]=r,t._waiting?a(t):s(t))))}}function o(t,n){var e,r=t._tasks.length;for(t._error=n,t._data=void 0,t._waiting=NaN;--r>=0;)if((e=t._tasks[r])&&(t._tasks[r]=null,e.abort))try{e.abort()}catch(n){}t._active=NaN,s(t)}function s(t){if(!t._active&&t._call){var n=t._data;t._data=void 0,t._call(t._error,n)}}function l(t){if(null==t)t=1/0;else if(!((t=+t)>=1))throw new Error(\"invalid concurrency\");return new r(t)}r.prototype=l.prototype={constructor:r,defer:function(t){if(\"function\"!=typeof t)throw new Error(\"invalid callback\");if(this._call)throw new Error(\"defer after await\");if(null!=this._error)return this;var e=n.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),a(this),this},abort:function(){return null==this._error&&o(this,new Error(\"abort\")),this},await:function(t){if(\"function\"!=typeof t)throw new Error(\"invalid callback\");if(this._call)throw new Error(\"multiple await\");return this._call=function(n,e){t.apply(null,[n].concat(e))},s(this),this},awaitAll:function(t){if(\"function\"!=typeof t)throw new Error(\"invalid callback\");if(this._call)throw new Error(\"multiple await\");return this._call=t,s(this),this}},t.queue=l,d3.queue=l,Object.defineProperty(t,\"__esModule\",{value:!0})},\"object\"==typeof exports&&\"undefined\"!=typeof module?xt(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],xt):xt(this.d3=this.d3||{}),this.Celestial=s}(),function(){var t={version:\"3.5.17\"},n=[].slice,e=function(t){return n.call(t)},r=this.document;function a(t){return t&&(t.ownerDocument||t.document||t).documentElement}function i(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}if(r)try{e(r.documentElement.childNodes)}catch(sl){e=function(t){for(var n=t.length,e=new Array(n);n--;)e[n]=t[n];return e}}if(Date.now||(Date.now=function(){return+new Date}),r)try{r.createElement(\"DIV\").style.setProperty(\"opacity\",0,\"\")}catch(ll){var o=this.Element.prototype,s=o.setAttribute,l=o.setAttributeNS,u=this.CSSStyleDeclaration.prototype,c=u.setProperty;o.setAttribute=function(t,n){s.call(this,t,n+\"\")},o.setAttributeNS=function(t,n,e){l.call(this,t,n,e+\"\")},u.setProperty=function(t,n,e){c.call(this,t,n+\"\",e)}}function h(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function f(t){return null===t?NaN:+t}function p(t){return!isNaN(t)}function d(t){return{left:function(n,e,r,a){for(arguments.length<3&&(r=0),arguments.length<4&&(a=n.length);r<a;){var i=r+a>>>1;t(n[i],e)<0?r=i+1:a=i}return r},right:function(n,e,r,a){for(arguments.length<3&&(r=0),arguments.length<4&&(a=n.length);r<a;){var i=r+a>>>1;t(n[i],e)>0?a=i:r=i+1}return r}}}t.ascending=h,t.descending=function(t,n){return n<t?-1:n>t?1:n>=t?0:NaN},t.min=function(t,n){var e,r,a=-1,i=t.length;if(1===arguments.length){for(;++a<i;)if(null!=(r=t[a])&&r>=r){e=r;break}for(;++a<i;)null!=(r=t[a])&&e>r&&(e=r)}else{for(;++a<i;)if(null!=(r=n.call(t,t[a],a))&&r>=r){e=r;break}for(;++a<i;)null!=(r=n.call(t,t[a],a))&&e>r&&(e=r)}return e},t.max=function(t,n){var e,r,a=-1,i=t.length;if(1===arguments.length){for(;++a<i;)if(null!=(r=t[a])&&r>=r){e=r;break}for(;++a<i;)null!=(r=t[a])&&r>e&&(e=r)}else{for(;++a<i;)if(null!=(r=n.call(t,t[a],a))&&r>=r){e=r;break}for(;++a<i;)null!=(r=n.call(t,t[a],a))&&r>e&&(e=r)}return e},t.extent=function(t,n){var e,r,a,i=-1,o=t.length;if(1===arguments.length){for(;++i<o;)if(null!=(r=t[i])&&r>=r){e=a=r;break}for(;++i<o;)null!=(r=t[i])&&(e>r&&(e=r),a<r&&(a=r))}else{for(;++i<o;)if(null!=(r=n.call(t,t[i],i))&&r>=r){e=a=r;break}for(;++i<o;)null!=(r=n.call(t,t[i],i))&&(e>r&&(e=r),a<r&&(a=r))}return[e,a]},t.sum=function(t,n){var e,r=0,a=t.length,i=-1;if(1===arguments.length)for(;++i<a;)p(e=+t[i])&&(r+=e);else for(;++i<a;)p(e=+n.call(t,t[i],i))&&(r+=e);return r},t.mean=function(t,n){var e,r=0,a=t.length,i=-1,o=a;if(1===arguments.length)for(;++i<a;)p(e=f(t[i]))?r+=e:--o;else for(;++i<a;)p(e=f(n.call(t,t[i],i)))?r+=e:--o;if(o)return r/o},t.quantile=function(t,n){var e=(t.length-1)*n+1,r=Math.floor(e),a=+t[r-1],i=e-r;return i?a+i*(t[r]-a):a},t.median=function(n,e){var r,a=[],i=n.length,o=-1;if(1===arguments.length)for(;++o<i;)p(r=f(n[o]))&&a.push(r);else for(;++o<i;)p(r=f(e.call(n,n[o],o)))&&a.push(r);if(a.length)return t.quantile(a.sort(h),.5)},t.variance=function(t,n){var e,r,a=t.length,i=0,o=0,s=-1,l=0;if(1===arguments.length)for(;++s<a;)p(e=f(t[s]))&&(o+=(r=e-i)*(e-(i+=r/++l)));else for(;++s<a;)p(e=f(n.call(t,t[s],s)))&&(o+=(r=e-i)*(e-(i+=r/++l)));if(l>1)return o/(l-1)},t.deviation=function(){var n=t.variance.apply(this,arguments);return n?Math.sqrt(n):n};var g=d(h);function v(t){return t.length}t.bisectLeft=g.left,t.bisect=t.bisectRight=g.right,t.bisector=function(t){return d(1===t.length?function(n,e){return h(t(n),e)}:t)},t.shuffle=function(t,n,e){(i=arguments.length)<3&&(e=t.length,i<2&&(n=0));for(var r,a,i=e-n;i;)a=Math.random()*i--|0,r=t[i+n],t[i+n]=t[a+n],t[a+n]=r;return t},t.permute=function(t,n){for(var e=n.length,r=new Array(e);e--;)r[e]=t[n[e]];return r},t.pairs=function(t){for(var n=0,e=t.length-1,r=t[0],a=new Array(e<0?0:e);n<e;)a[n]=[r,r=t[++n]];return a},t.transpose=function(n){if(!(i=n.length))return[];for(var e=-1,r=t.min(n,v),a=new Array(r);++e<r;)for(var i,o=-1,s=a[e]=new Array(i);++o<i;)s[o]=n[o][e];return a},t.zip=function(){return t.transpose(arguments)},t.keys=function(t){var n=[];for(var e in t)n.push(e);return n},t.values=function(t){var n=[];for(var e in t)n.push(t[e]);return n},t.entries=function(t){var n=[];for(var e in t)n.push({key:e,value:t[e]});return n},t.merge=function(t){for(var n,e,r,a=t.length,i=-1,o=0;++i<a;)o+=t[i].length;for(e=new Array(o);--a>=0;)for(n=(r=t[a]).length;--n>=0;)e[--o]=r[n];return e};var M=Math.abs;function m(t){for(var n=1;t*n%1;)n*=10;return n}function y(t,n){for(var e in n)Object.defineProperty(t.prototype,e,{value:n[e],enumerable:!1})}function b(){this._=Object.create(null)}function w(t){return\"__proto__\"==(t+=\"\")||\"\\0\"===t[0]?\"\\0\"+t:t}function x(t){return\"\\0\"===(t+=\"\")[0]?t.slice(1):t}function k(t){return w(t)in this._}function S(t){return(t=w(t))in this._&&delete this._[t]}function _(){var t=[];for(var n in this._)t.push(x(n));return t}function q(){var t=0;for(var n in this._)++t;return t}function T(){for(var t in this._)return!1;return!0}function z(){this._=Object.create(null)}function E(t){return t}function A(t,n,e){return function(){var r=e.apply(n,arguments);return r===n?t:r}}function N(t,n){if(n in t)return n;n=n.charAt(0).toUpperCase()+n.slice(1);for(var e=0,r=j.length;e<r;++e){var a=j[e]+n;if(a in t)return a}}t.range=function(t,n,e){if(arguments.length<3&&(e=1,arguments.length<2&&(n=t,t=0)),(n-t)/e==1/0)throw new Error(\"infinite range\");var r,a=[],i=m(M(e)),o=-1;if(t*=i,n*=i,(e*=i)<0)for(;(r=t+e*++o)>n;)a.push(r/i);else for(;(r=t+e*++o)<n;)a.push(r/i);return a},t.map=function(t,n){var e=new b;if(t instanceof b)t.forEach(function(t,n){e.set(t,n)});else if(Array.isArray(t)){var r,a=-1,i=t.length;if(1===arguments.length)for(;++a<i;)e.set(a,t[a]);else for(;++a<i;)e.set(n.call(t,r=t[a],a),r)}else for(var o in t)e.set(o,t[o]);return e},y(b,{has:k,get:function(t){return this._[w(t)]},set:function(t,n){return this._[w(t)]=n},remove:S,keys:_,values:function(){var t=[];for(var n in this._)t.push(this._[n]);return t},entries:function(){var t=[];for(var n in this._)t.push({key:x(n),value:this._[n]});return t},size:q,empty:T,forEach:function(t){for(var n in this._)t.call(this,x(n),this._[n])}}),t.nest=function(){var n,e,r={},a=[],i=[];function o(t,i,s){if(s>=a.length)return e?e.call(r,i):n?i.sort(n):i;for(var l,u,c,h,f=-1,p=i.length,d=a[s++],g=new b;++f<p;)(h=g.get(l=d(u=i[f])))?h.push(u):g.set(l,[u]);return t?(u=t(),c=function(n,e){u.set(n,o(t,e,s))}):(u={},c=function(n,e){u[n]=o(t,e,s)}),g.forEach(c),u}function s(t,n){if(n>=a.length)return t;var e=[],r=i[n++];return t.forEach(function(t,r){e.push({key:t,values:s(r,n)})}),r?e.sort(function(t,n){return r(t.key,n.key)}):e}return r.map=function(t,n){return o(n,t,0)},r.entries=function(n){return s(o(t.map,n,0),0)},r.key=function(t){return a.push(t),r},r.sortKeys=function(t){return i[a.length-1]=t,r},r.sortValues=function(t){return n=t,r},r.rollup=function(t){return e=t,r},r},t.set=function(t){var n=new z;if(t)for(var e=0,r=t.length;e<r;++e)n.add(t[e]);return n},y(z,{has:k,add:function(t){return this._[w(t+=\"\")]=!0,t},remove:S,values:_,size:q,empty:T,forEach:function(t){for(var n in this._)t.call(this,x(n))}}),t.behavior={},t.rebind=function(t,n){for(var e,r=1,a=arguments.length;++r<a;)t[e=arguments[r]]=A(t,n,n[e]);return t};var j=[\"webkit\",\"ms\",\"moz\",\"Moz\",\"o\",\"O\"];function L(){}function P(){}function C(t){var n=[],e=new b;function r(){for(var e,r=n,a=-1,i=r.length;++a<i;)(e=r[a].on)&&e.apply(this,arguments);return t}return r.on=function(r,a){var i,o=e.get(r);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,i=n.indexOf(o)).concat(n.slice(i+1)),e.remove(r)),a&&n.push(e.set(r,{on:a})),t)},r}function D(){t.event.preventDefault()}function I(){for(var n,e=t.event;n=e.sourceEvent;)e=n;return e}function R(n){for(var e=new P,r=0,a=arguments.length;++r<a;)e[arguments[r]]=C(e);return e.of=function(r,a){return function(i){try{var o=i.sourceEvent=t.event;i.target=n,t.event=i,e[i.type].apply(r,a)}finally{t.event=o}}},e}t.dispatch=function(){for(var t=new P,n=-1,e=arguments.length;++n<e;)t[arguments[n]]=C(t);return t},P.prototype.on=function(t,n){var e=t.indexOf(\".\"),r=\"\";if(e>=0&&(r=t.slice(e+1),t=t.slice(0,e)),t)return arguments.length<2?this[t].on(r):this[t].on(r,n);if(2===arguments.length){if(null==n)for(t in this)this.hasOwnProperty(t)&&this[t].on(r,null);return this}},t.event=null,t.requote=function(t){return t.replace(F,\"\\\\$&\")};var F=/[\\\\\\^\\$\\*\\+\\?\\|\\[\\]\\(\\)\\.\\{\\}]/g,O={}.__proto__?function(t,n){t.__proto__=n}:function(t,n){for(var e in n)t[e]=n[e]};function U(t){return O(t,V),t}var H=function(t,n){return n.querySelector(t)},B=function(t,n){return n.querySelectorAll(t)},Q=function(t,n){var e=t.matches||t[N(t,\"matchesSelector\")];return(Q=function(t,n){return e.call(t,n)})(t,n)};\"function\"==typeof Sizzle&&(H=function(t,n){return Sizzle(t,n)[0]||null},B=Sizzle,Q=Sizzle.matchesSelector),t.selection=function(){return t.select(r.documentElement)};var V=t.selection.prototype=[];function G(t){return\"function\"==typeof t?t:function(){return H(t,this)}}function Y(t){return\"function\"==typeof t?t:function(){return B(t,this)}}V.select=function(t){var n,e,r,a,i=[];t=G(t);for(var o=-1,s=this.length;++o<s;){i.push(n=[]),n.parentNode=(r=this[o]).parentNode;for(var l=-1,u=r.length;++l<u;)(a=r[l])?(n.push(e=t.call(a,a.__data__,l,o)),e&&\"__data__\"in a&&(e.__data__=a.__data__)):n.push(null)}return U(i)},V.selectAll=function(t){var n,r,a=[];t=Y(t);for(var i=-1,o=this.length;++i<o;)for(var s=this[i],l=-1,u=s.length;++l<u;)(r=s[l])&&(a.push(n=e(t.call(r,r.__data__,l,i))),n.parentNode=r);return U(a)};var W=\"http://www.w3.org/1999/xhtml\",$={svg:\"http://www.w3.org/2000/svg\",xhtml:W,xlink:\"http://www.w3.org/1999/xlink\",xml:\"http://www.w3.org/XML/1998/namespace\",xmlns:\"http://www.w3.org/2000/xmlns/\"};function Z(n,e){return n=t.ns.qualify(n),null==e?n.local?function(){this.removeAttributeNS(n.space,n.local)}:function(){this.removeAttribute(n)}:\"function\"==typeof e?n.local?function(){var t=e.apply(this,arguments);null==t?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}:function(){var t=e.apply(this,arguments);null==t?this.removeAttribute(n):this.setAttribute(n,t)}:n.local?function(){this.setAttributeNS(n.space,n.local,e)}:function(){this.setAttribute(n,e)}}function X(t){return t.trim().replace(/\\s+/g,\" \")}function J(n){return new RegExp(\"(?:^|\\\\s+)\"+t.requote(n)+\"(?:\\\\s+|$)\",\"g\")}function K(t){return(t+\"\").trim().split(/^|\\s+/)}function tt(t,n){var e=(t=K(t).map(nt)).length;return\"function\"==typeof n?function(){for(var r=-1,a=n.apply(this,arguments);++r<e;)t[r](this,a)}:function(){for(var r=-1;++r<e;)t[r](this,n)}}function nt(t){var n=J(t);return function(e,r){if(a=e.classList)return r?a.add(t):a.remove(t);var a=e.getAttribute(\"class\")||\"\";r?(n.lastIndex=0,n.test(a)||e.setAttribute(\"class\",X(a+\" \"+t))):e.setAttribute(\"class\",X(a.replace(n,\" \")))}}function et(t,n,e){return null==n?function(){this.style.removeProperty(t)}:\"function\"==typeof n?function(){var r=n.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,e)}:function(){this.style.setProperty(t,n,e)}}function rt(t,n){return null==n?function(){delete this[t]}:\"function\"==typeof n?function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}:function(){this[t]=n}}function at(n){return\"function\"==typeof n?n:(n=t.ns.qualify(n)).local?function(){return this.ownerDocument.createElementNS(n.space,n.local)}:function(){var t=this.ownerDocument,e=this.namespaceURI;return e===W&&t.documentElement.namespaceURI===W?t.createElement(n):t.createElementNS(e,n)}}function it(){var t=this.parentNode;t&&t.removeChild(this)}function ot(t){return{__data__:t}}function st(t){return function(){return Q(this,t)}}function lt(t){return arguments.length||(t=h),function(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}}function ut(t,n){for(var e=0,r=t.length;e<r;e++)for(var a,i=t[e],o=0,s=i.length;o<s;o++)(a=i[o])&&n(a,o,e);return t}function ct(t){return O(t,ht),t}t.ns={prefix:$,qualify:function(t){var n=t.indexOf(\":\"),e=t;return n>=0&&\"xmlns\"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),$.hasOwnProperty(e)?{space:$[e],local:t}:t}},V.attr=function(n,e){if(arguments.length<2){if(\"string\"==typeof n){var r=this.node();return(n=t.ns.qualify(n)).local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}for(e in n)this.each(Z(e,n[e]));return this}return this.each(Z(n,e))},V.classed=function(t,n){if(arguments.length<2){if(\"string\"==typeof t){var e=this.node(),r=(t=K(t)).length,a=-1;if(n=e.classList){for(;++a<r;)if(!n.contains(t[a]))return!1}else for(n=e.getAttribute(\"class\");++a<r;)if(!J(t[a]).test(n))return!1;return!0}for(n in t)this.each(tt(n,t[n]));return this}return this.each(tt(t,n))},V.style=function(t,n,e){var r=arguments.length;if(r<3){if(\"string\"!=typeof t){for(e in r<2&&(n=\"\"),t)this.each(et(e,t[e],n));return this}if(r<2){var a=this.node();return i(a).getComputedStyle(a,null).getPropertyValue(t)}e=\"\"}return this.each(et(t,n,e))},V.property=function(t,n){if(arguments.length<2){if(\"string\"==typeof t)return this.node()[t];for(n in t)this.each(rt(n,t[n]));return this}return this.each(rt(t,n))},V.text=function(t){return arguments.length?this.each(\"function\"==typeof t?function(){var n=t.apply(this,arguments);this.textContent=null==n?\"\":n}:null==t?function(){this.textContent=\"\"}:function(){this.textContent=t}):this.node().textContent},V.html=function(t){return arguments.length?this.each(\"function\"==typeof t?function(){var n=t.apply(this,arguments);this.innerHTML=null==n?\"\":n}:null==t?function(){this.innerHTML=\"\"}:function(){this.innerHTML=t}):this.node().innerHTML},V.append=function(t){return t=at(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},V.insert=function(t,n){return t=at(t),n=G(n),this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})},V.remove=function(){return this.each(it)},V.data=function(t,n){var e,r,a=-1,i=this.length;if(!arguments.length){for(t=new Array(i=(e=this[0]).length);++a<i;)(r=e[a])&&(t[a]=r.__data__);return t}function o(t,e){var r,a,i,o=t.length,c=e.length,h=Math.min(o,c),f=new Array(c),p=new Array(c),d=new Array(o);if(n){var g,v=new b,M=new Array(o);for(r=-1;++r<o;)(a=t[r])&&(v.has(g=n.call(a,a.__data__,r))?d[r]=a:v.set(g,a),M[r]=g);for(r=-1;++r<c;)(a=v.get(g=n.call(e,i=e[r],r)))?!0!==a&&(f[r]=a,a.__data__=i):p[r]=ot(i),v.set(g,!0);for(r=-1;++r<o;)r in M&&!0!==v.get(M[r])&&(d[r]=t[r])}else{for(r=-1;++r<h;)i=e[r],(a=t[r])?(a.__data__=i,f[r]=a):p[r]=ot(i);for(;r<c;++r)p[r]=ot(e[r]);for(;r<o;++r)d[r]=t[r]}p.update=f,p.parentNode=f.parentNode=d.parentNode=t.parentNode,s.push(p),l.push(f),u.push(d)}var s=ct([]),l=U([]),u=U([]);if(\"function\"==typeof t)for(;++a<i;)o(e=this[a],t.call(e,e.parentNode.__data__,a));else for(;++a<i;)o(e=this[a],t);return l.enter=function(){return s},l.exit=function(){return u},l},V.datum=function(t){return arguments.length?this.property(\"__data__\",t):this.property(\"__data__\")},V.filter=function(t){var n,e,r,a=[];\"function\"!=typeof t&&(t=st(t));for(var i=0,o=this.length;i<o;i++){a.push(n=[]),n.parentNode=(e=this[i]).parentNode;for(var s=0,l=e.length;s<l;s++)(r=e[s])&&t.call(r,r.__data__,s,i)&&n.push(r)}return U(a)},V.order=function(){for(var t=-1,n=this.length;++t<n;)for(var e,r=this[t],a=r.length-1,i=r[a];--a>=0;)(e=r[a])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},V.sort=function(t){t=lt.apply(this,arguments);for(var n=-1,e=this.length;++n<e;)this[n].sort(t);return this.order()},V.each=function(t){return ut(this,function(n,e,r){t.call(n,n.__data__,e,r)})},V.call=function(t){var n=e(arguments);return t.apply(n[0]=this,n),this},V.empty=function(){return!this.node()},V.node=function(){for(var t=0,n=this.length;t<n;t++)for(var e=this[t],r=0,a=e.length;r<a;r++){var i=e[r];if(i)return i}return null},V.size=function(){var t=0;return ut(this,function(){++t}),t};var ht=[];function ft(t){var n,e;return function(r,a,i){var o,s=t[i].update,l=s.length;for(i!=e&&(e=i,n=0),a>=n&&(n=a+1);!(o=s[n])&&++n<l;);return o}}function pt(n,r,a){var i=\"__on\"+n,o=n.indexOf(\".\"),s=gt;o>0&&(n=n.slice(0,o));var l=dt.get(n);function u(){var t=this[i];t&&(this.removeEventListener(n,t,t.$),delete this[i])}return l&&(n=l,s=vt),o?r?function(){var t=s(r,e(arguments));u.call(this),this.addEventListener(n,this[i]=t,t.$=a),t._=r}:u:r?L:function(){var e,r=new RegExp(\"^__on([^.]+)\"+t.requote(n)+\"$\");for(var a in this)if(e=a.match(r)){var i=this[a];this.removeEventListener(e[1],i,i.$),delete this[a]}}}t.selection.enter=ct,t.selection.enter.prototype=ht,ht.append=V.append,ht.empty=V.empty,ht.node=V.node,ht.call=V.call,ht.size=V.size,ht.select=function(t){for(var n,e,r,a,i,o=[],s=-1,l=this.length;++s<l;){r=(a=this[s]).update,o.push(n=[]),n.parentNode=a.parentNode;for(var u=-1,c=a.length;++u<c;)(i=a[u])?(n.push(r[u]=e=t.call(a.parentNode,i.__data__,u,s)),e.__data__=i.__data__):n.push(null)}return U(o)},ht.insert=function(t,n){return arguments.length<2&&(n=ft(this)),V.insert.call(this,t,n)},t.select=function(t){var n;return\"string\"==typeof t?(n=[H(t,r)]).parentNode=r.documentElement:(n=[t]).parentNode=a(t),U([n])},t.selectAll=function(t){var n;return\"string\"==typeof t?(n=e(B(t,r))).parentNode=r.documentElement:(n=e(t)).parentNode=null,U([n])},V.on=function(t,n,e){var r=arguments.length;if(r<3){if(\"string\"!=typeof t){for(e in r<2&&(n=!1),t)this.each(pt(e,t[e],n));return this}if(r<2)return(r=this.node()[\"__on\"+t])&&r._;e=!1}return this.each(pt(t,n,e))};var dt=t.map({mouseenter:\"mouseover\",mouseleave:\"mouseout\"});function gt(n,e){return function(r){var a=t.event;t.event=r,e[0]=this.__data__;try{n.apply(this,e)}finally{t.event=a}}}function vt(t,n){var e=gt(t,n);return function(t){var n=this,r=t.relatedTarget;r&&(r===n||8&r.compareDocumentPosition(n))||e.call(n,t)}}r&&dt.forEach(function(t){\"on\"+t in r&&dt.remove(t)});var Mt,mt=0;function yt(n){var e=\".dragsuppress-\"+ ++mt,r=\"click\"+e,o=t.select(i(n)).on(\"touchmove\"+e,D).on(\"dragstart\"+e,D).on(\"selectstart\"+e,D);if(null==Mt&&(Mt=!(\"onselectstart\"in n)&&N(n.style,\"userSelect\")),Mt){var s=a(n).style,l=s[Mt];s[Mt]=\"none\"}return function(t){if(o.on(e,null),Mt&&(s[Mt]=l),t){var n=function(){o.on(r,null)};o.on(r,function(){D(),n()},!0),setTimeout(n,0)}}}t.mouse=function(t){return wt(t,I())};var bt=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function wt(n,e){e.changedTouches&&(e=e.changedTouches[0]);var r=n.ownerSVGElement||n;if(r.createSVGPoint){var a=r.createSVGPoint();if(bt<0){var o=i(n);if(o.scrollX||o.scrollY){var s=(r=t.select(\"body\").append(\"svg\").style({position:\"absolute\",top:0,left:0,margin:0,padding:0,border:\"none\"},\"important\"))[0][0].getScreenCTM();bt=!(s.f||s.e),r.remove()}}return bt?(a.x=e.pageX,a.y=e.pageY):(a.x=e.clientX,a.y=e.clientY),[(a=a.matrixTransform(n.getScreenCTM().inverse())).x,a.y]}var l=n.getBoundingClientRect();return[e.clientX-l.left-n.clientLeft,e.clientY-l.top-n.clientTop]}function xt(){return t.event.changedTouches[0].identifier}t.touch=function(t,n,e){if(arguments.length<3&&(e=n,n=I().changedTouches),n)for(var r,a=0,i=n.length;a<i;++a)if((r=n[a]).identifier===e)return wt(t,r)},t.behavior.drag=function(){var n=R(o,\"drag\",\"dragstart\",\"dragend\"),e=null,r=s(L,t.mouse,i,\"mousemove\",\"mouseup\"),a=s(xt,t.touch,E,\"touchmove\",\"touchend\");function o(){this.on(\"mousedown.drag\",r).on(\"touchstart.drag\",a)}function s(r,a,i,o,s){return function(){var l,u=this,c=t.event.target.correspondingElement||t.event.target,h=u.parentNode,f=n.of(u,arguments),p=0,d=r(),g=\".drag\"+(null==d?\"\":\"-\"+d),v=t.select(i(c)).on(o+g,y).on(s+g,b),M=yt(c),m=a(h,d);function y(){var t,n,e=a(h,d);e&&(p|=(t=e[0]-m[0])|(n=e[1]-m[1]),m=e,f({type:\"drag\",x:e[0]+l[0],y:e[1]+l[1],dx:t,dy:n}))}function b(){a(h,d)&&(v.on(o+g,null).on(s+g,null),M(p),f({type:\"dragend\"}))}l=e?[(l=e.apply(u,arguments)).x-m[0],l.y-m[1]]:[0,0],f({type:\"dragstart\"})}}return o.origin=function(t){return arguments.length?(e=t,o):e},t.rebind(o,n,\"on\")},t.touches=function(t,n){return arguments.length<2&&(n=I().touches),n?e(n).map(function(n){var e=wt(t,n);return e.identifier=n.identifier,e}):[]};var kt=1e-6,St=kt*kt,_t=Math.PI,qt=2*_t,Tt=qt-kt,zt=_t/2,Et=_t/180,At=180/_t;function Nt(t){return t>0?1:t<0?-1:0}function jt(t,n,e){return(n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0])}function Lt(t){return t>1?0:t<-1?_t:Math.acos(t)}function Pt(t){return t>1?zt:t<-1?-zt:Math.asin(t)}function Ct(t){return((t=Math.exp(t))+1/t)/2}function Dt(t){return(t=Math.sin(t/2))*t}var It=Math.SQRT2;t.interpolateZoom=function(t,n){var e,r,a=t[0],i=t[1],o=t[2],s=n[2],l=n[0]-a,u=n[1]-i,c=l*l+u*u;if(c<St)r=Math.log(s/o)/It,e=function(t){return[a+t*l,i+t*u,o*Math.exp(It*t*r)]};else{var h=Math.sqrt(c),f=(s*s-o*o+4*c)/(2*o*2*h),p=(s*s-o*o-4*c)/(2*s*2*h),d=Math.log(Math.sqrt(f*f+1)-f),g=Math.log(Math.sqrt(p*p+1)-p);r=(g-d)/It,e=function(t){var n,e=t*r,s=Ct(d),c=o/(2*h)*(s*(n=It*e+d,((n=Math.exp(2*n))-1)/(n+1))-function(t){return((t=Math.exp(t))-1/t)/2}(d));return[a+c*l,i+c*u,o*s/Ct(It*e+d)]}}return e.duration=1e3*r,e},t.behavior.zoom=function(){var n,e,a,o,s,l,u,c,h,f={x:0,y:0,k:1},p=[960,500],d=Ot,g=250,v=0,M=\"mousedown.zoom\",m=\"mousemove.zoom\",y=\"mouseup.zoom\",b=\"touchstart.zoom\",w=R(x,\"zoomstart\",\"zoom\",\"zoomend\");function x(t){t.on(M,N).on(Ft+\".zoom\",L).on(\"dblclick.zoom\",P).on(b,j)}function k(t){return[(t[0]-f.x)/f.k,(t[1]-f.y)/f.k]}function S(t){f.k=Math.max(d[0],Math.min(d[1],t))}function _(t,n){n=function(t){return[t[0]*f.k+f.x,t[1]*f.k+f.y]}(n),f.x+=t[0]-n[0],f.y+=t[1]-n[1]}function q(n,r,a,i){n.__chart__={x:f.x,y:f.y,k:f.k},S(Math.pow(2,i)),_(e=r,a),n=t.select(n),g>0&&(n=n.transition().duration(g)),n.call(x.event)}function T(){u&&u.domain(l.range().map(function(t){return(t-f.x)/f.k}).map(l.invert)),h&&h.domain(c.range().map(function(t){return(t-f.y)/f.k}).map(c.invert))}function z(t){v++||t({type:\"zoomstart\"})}function E(t){T(),t({type:\"zoom\",scale:f.k,translate:[f.x,f.y]})}function A(t){--v||(t({type:\"zoomend\"}),e=null)}function N(){var n=this,e=w.of(n,arguments),r=0,a=t.select(i(n)).on(m,l).on(y,u),o=k(t.mouse(n)),s=yt(n);function l(){r=1,_(t.mouse(n),o),E(e)}function u(){a.on(m,null).on(y,null),s(r),A(e)}As.call(n),z(e)}function j(){var n,e=this,r=w.of(e,arguments),a={},i=0,o=\".zoom-\"+t.event.changedTouches[0].identifier,l=\"touchmove\"+o,u=\"touchend\"+o,c=[],h=t.select(e),p=yt(e);function d(){var r=t.touches(e);return n=f.k,r.forEach(function(t){t.identifier in a&&(a[t.identifier]=k(t))}),r}function g(){var n=t.event.target;t.select(n).on(l,v).on(u,m),c.push(n);for(var r=t.event.changedTouches,o=0,h=r.length;o<h;++o)a[r[o].identifier]=null;var p=d(),g=Date.now();if(1===p.length)g-s<500&&(q(e,M=p[0],a[M.identifier],Math.floor(Math.log(f.k)/Math.LN2)+1),D()),s=g;else if(p.length>1){var M,y=p[1],b=(M=p[0])[0]-y[0],w=M[1]-y[1];i=b*b+w*w}}function v(){var o,l,u,c,h=t.touches(e);As.call(e);for(var f=0,p=h.length;f<p;++f,c=null)if(c=a[(u=h[f]).identifier]){if(l)break;o=u,l=c}if(c){var d=(d=u[0]-o[0])*d+(d=u[1]-o[1])*d,g=i&&Math.sqrt(d/i);o=[(o[0]+u[0])/2,(o[1]+u[1])/2],l=[(l[0]+c[0])/2,(l[1]+c[1])/2],S(g*n)}s=null,_(o,l),E(r)}function m(){if(t.event.touches.length){for(var n=t.event.changedTouches,e=0,i=n.length;e<i;++e)delete a[n[e].identifier];for(var s in a)return void d()}t.selectAll(c).on(o,null),h.on(M,N).on(b,j),p(),A(r)}g(),z(r),h.on(M,null).on(b,g)}function L(){var r=w.of(this,arguments);o?clearTimeout(o):(As.call(this),n=k(e=a||t.mouse(this)),z(r)),o=setTimeout(function(){o=null,A(r)},50),D(),S(Math.pow(2,.002*Rt())*f.k),_(e,n),E(r)}function P(){}return Ft||(Ft=\"onwheel\"in r?(Rt=function(){return-t.event.deltaY*(t.event.deltaMode?120:1)},\"wheel\"):\"onmousewheel\"in r?(Rt=function(){return t.event.wheelDelta},\"mousewheel\"):(Rt=function(){return-t.event.detail},\"MozMousePixelScroll\")),x.event=function(n){n.each(function(){var n=w.of(this,arguments),r=f;Ls?t.select(this).transition().each(\"start.zoom\",function(){f=this.__chart__||{x:0,y:0,k:1},z(n)}).tween(\"zoom:zoom\",function(){var a=p[0],i=e?e[0]:a/2,o=e?e[1]:p[1]/2,s=t.interpolateZoom([(i-f.x)/f.k,(o-f.y)/f.k,a/f.k],[(i-r.x)/r.k,(o-r.y)/r.k,a/r.k]);return function(t){var e=s(t),r=a/e[2];this.__chart__=f={x:i-e[0]*r,y:o-e[1]*r,k:r},E(n)}}).each(\"interrupt.zoom\",function(){A(n)}).each(\"end.zoom\",function(){A(n)}):(this.__chart__=f,z(n),E(n),A(n))})},x.translate=function(t){return arguments.length?(f={x:+t[0],y:+t[1],k:f.k},T(),x):[f.x,f.y]},x.scale=function(t){return arguments.length?(f={x:f.x,y:f.y,k:null},S(+t),T(),x):f.k},x.scaleExtent=function(t){return arguments.length?(d=null==t?Ot:[+t[0],+t[1]],x):d},x.center=function(t){return arguments.length?(a=t&&[+t[0],+t[1]],x):a},x.size=function(t){return arguments.length?(p=t&&[+t[0],+t[1]],x):p},x.duration=function(t){return arguments.length?(g=+t,x):g},x.x=function(t){return arguments.length?(u=t,l=t.copy(),f={x:0,y:0,k:1},x):u},x.y=function(t){return arguments.length?(h=t,c=t.copy(),f={x:0,y:0,k:1},x):h},t.rebind(x,w,\"on\")};var Rt,Ft,Ot=[0,1/0];function Ut(){}function Ht(t,n,e){return this instanceof Ht?(this.h=+t,this.s=+n,void(this.l=+e)):arguments.length<2?t instanceof Ht?new Ht(t.h,t.s,t.l):cn(\"\"+t,hn,Ht):new Ht(t,n,e)}t.color=Ut,Ut.prototype.toString=function(){return this.rgb()+\"\"},t.hsl=Ht;var Bt=Ht.prototype=new Ut;function Qt(t,n,e){var r,a;function i(t){return Math.round(255*function(t){return t>360?t-=360:t<0&&(t+=360),t<60?r+(a-r)*t/60:t<180?a:t<240?r+(a-r)*(240-t)/60:r}(t))}return t=isNaN(t)?0:(t%=360)<0?t+360:t,n=isNaN(n)||n<0?0:n>1?1:n,r=2*(e=e<0?0:e>1?1:e)-(a=e<=.5?e*(1+n):e+n-e*n),new an(i(t+120),i(t),i(t-120))}function Vt(n,e,r){return this instanceof Vt?(this.h=+n,this.c=+e,void(this.l=+r)):arguments.length<2?n instanceof Vt?new Vt(n.h,n.c,n.l):tn(n instanceof Wt?n.l:(n=fn((n=t.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new Vt(n,e,r)}Bt.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new Ht(this.h,this.s,this.l/t)},Bt.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new Ht(this.h,this.s,t*this.l)},Bt.rgb=function(){return Qt(this.h,this.s,this.l)},t.hcl=Vt;var Gt=Vt.prototype=new Ut;function Yt(t,n,e){return isNaN(t)&&(t=0),isNaN(n)&&(n=0),new Wt(e,Math.cos(t*=Et)*n,Math.sin(t)*n)}function Wt(t,n,e){return this instanceof Wt?(this.l=+t,this.a=+n,void(this.b=+e)):arguments.length<2?t instanceof Wt?new Wt(t.l,t.a,t.b):t instanceof Vt?Yt(t.h,t.c,t.l):fn((t=an(t)).r,t.g,t.b):new Wt(t,n,e)}Gt.brighter=function(t){return new Vt(this.h,this.c,Math.min(100,this.l+$t*(arguments.length?t:1)))},Gt.darker=function(t){return new Vt(this.h,this.c,Math.max(0,this.l-$t*(arguments.length?t:1)))},Gt.rgb=function(){return Yt(this.h,this.c,this.l).rgb()},t.lab=Wt;var $t=18,Zt=.95047,Xt=1.08883,Jt=Wt.prototype=new Ut;function Kt(t,n,e){var r=(t+16)/116,a=r+n/500,i=r-e/200;return new an(rn(3.2404542*(a=nn(a)*Zt)-1.5371385*(r=1*nn(r))-.4985314*(i=nn(i)*Xt)),rn(-.969266*a+1.8760108*r+.041556*i),rn(.0556434*a-.2040259*r+1.0572252*i))}function tn(t,n,e){return t>0?new Vt(Math.atan2(e,n)*At,Math.sqrt(n*n+e*e),t):new Vt(NaN,NaN,t)}function nn(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function en(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function rn(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function an(t,n,e){return this instanceof an?(this.r=~~t,this.g=~~n,void(this.b=~~e)):arguments.length<2?t instanceof an?new an(t.r,t.g,t.b):cn(\"\"+t,an,Qt):new an(t,n,e)}function on(t){return new an(t>>16,t>>8&255,255&t)}function sn(t){return on(t)+\"\"}Jt.brighter=function(t){return new Wt(Math.min(100,this.l+$t*(arguments.length?t:1)),this.a,this.b)},Jt.darker=function(t){return new Wt(Math.max(0,this.l-$t*(arguments.length?t:1)),this.a,this.b)},Jt.rgb=function(){return Kt(this.l,this.a,this.b)},t.rgb=an;var ln=an.prototype=new Ut;function un(t){return t<16?\"0\"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function cn(t,n,e){var r,a,i,o=0,s=0,l=0;if(r=/([a-z]+)\\((.*)\\)/.exec(t=t.toLowerCase()))switch(a=r[2].split(\",\"),r[1]){case\"hsl\":return e(parseFloat(a[0]),parseFloat(a[1])/100,parseFloat(a[2])/100);case\"rgb\":return n(dn(a[0]),dn(a[1]),dn(a[2]))}return(i=gn.get(t))?n(i.r,i.g,i.b):(null==t||\"#\"!==t.charAt(0)||isNaN(i=parseInt(t.slice(1),16))||(4===t.length?(o=(3840&i)>>4,o|=o>>4,s=240&i,s|=s>>4,l=15&i,l|=l<<4):7===t.length&&(o=(16711680&i)>>16,s=(65280&i)>>8,l=255&i)),n(o,s,l))}function hn(t,n,e){var r,a,i=Math.min(t/=255,n/=255,e/=255),o=Math.max(t,n,e),s=o-i,l=(o+i)/2;return s?(a=l<.5?s/(o+i):s/(2-o-i),r=t==o?(n-e)/s+(n<e?6:0):n==o?(e-t)/s+2:(t-n)/s+4,r*=60):(r=NaN,a=l>0&&l<1?0:r),new Ht(r,a,l)}function fn(t,n,e){var r=en((.4124564*(t=pn(t))+.3575761*(n=pn(n))+.1804375*(e=pn(e)))/Zt),a=en((.2126729*t+.7151522*n+.072175*e)/1);return Wt(116*a-16,500*(r-a),200*(a-en((.0193339*t+.119192*n+.9503041*e)/Xt)))}function pn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function dn(t){var n=parseFloat(t);return\"%\"===t.charAt(t.length-1)?Math.round(2.55*n):n}ln.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var n=this.r,e=this.g,r=this.b,a=30;return n||e||r?(n&&n<a&&(n=a),e&&e<a&&(e=a),r&&r<a&&(r=a),new an(Math.min(255,n/t),Math.min(255,e/t),Math.min(255,r/t))):new an(a,a,a)},ln.darker=function(t){return new an((t=Math.pow(.7,arguments.length?t:1))*this.r,t*this.g,t*this.b)},ln.hsl=function(){return hn(this.r,this.g,this.b)},ln.toString=function(){return\"#\"+un(this.r)+un(this.g)+un(this.b)};var gn=t.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});function vn(t){return\"function\"==typeof t?t:function(){return t}}function Mn(t){return function(n,e,r){return 2===arguments.length&&\"function\"==typeof e&&(r=e,e=null),mn(n,e,t,r)}}function mn(n,r,a,i){var o={},s=t.dispatch(\"beforesend\",\"progress\",\"load\",\"error\"),l={},u=new XMLHttpRequest,c=null;function h(){var t,n=u.status;if(!n&&function(t){var n=t.responseType;return n&&\"text\"!==n?t.response:t.responseText}(u)||n>=200&&n<300||304===n){try{t=a.call(o,u)}catch(sl){return void s.error.call(o,sl)}s.load.call(o,t)}else s.error.call(o,u)}return this.XDomainRequest&&!(\"withCredentials\"in u)&&/^(http(s)?:)?\\/\\//.test(n)&&(u=new XDomainRequest),\"onload\"in u?u.onload=u.onerror=h:u.onreadystatechange=function(){u.readyState>3&&h()},u.onprogress=function(n){var e=t.event;t.event=n;try{s.progress.call(o,u)}finally{t.event=e}},o.header=function(t,n){return t=(t+\"\").toLowerCase(),arguments.length<2?l[t]:(null==n?delete l[t]:l[t]=n+\"\",o)},o.mimeType=function(t){return arguments.length?(r=null==t?null:t+\"\",o):r},o.responseType=function(t){return arguments.length?(c=t,o):c},o.response=function(t){return a=t,o},[\"get\",\"post\"].forEach(function(t){o[t]=function(){return o.send.apply(o,[t].concat(e(arguments)))}}),o.send=function(t,e,a){if(2===arguments.length&&\"function\"==typeof e&&(a=e,e=null),u.open(t,n,!0),null==r||\"accept\"in l||(l.accept=r+\",*/*\"),u.setRequestHeader)for(var i in l)u.setRequestHeader(i,l[i]);return null!=r&&u.overrideMimeType&&u.overrideMimeType(r),null!=c&&(u.responseType=c),null!=a&&o.on(\"error\",a).on(\"load\",function(t){a(null,t)}),s.beforesend.call(o,u),u.send(null==e?null:e),o},o.abort=function(){return u.abort(),o},t.rebind(o,s,\"on\"),null==i?o:o.get(function(t){return 1===t.length?function(n,e){t(null==n?e:null)}:t}(i))}gn.forEach(function(t,n){gn.set(t,on(n))}),t.functor=vn,t.xhr=Mn(E),t.dsv=function(t,n){var e=new RegExp('[\"'+t+\"\\n]\"),r=t.charCodeAt(0);function a(t,e,r){arguments.length<3&&(r=e,e=null);var a=mn(t,n,null==e?i:o(e),r);return a.row=function(t){return arguments.length?a.response(null==(e=t)?i:o(t)):e},a}function i(t){return a.parse(t.responseText)}function o(t){return function(n){return a.parse(n.responseText,t)}}function s(n){return n.map(l).join(t)}function l(t){return e.test(t)?'\"'+t.replace(/\\\"/g,'\"\"')+'\"':t}return a.parse=function(t,n){var e;return a.parseRows(t,function(t,r){if(e)return e(t,r-1);var a=new Function(\"d\",\"return {\"+t.map(function(t,n){return JSON.stringify(t)+\": d[\"+n+\"]\"}).join(\",\")+\"}\");e=n?function(t,e){return n(a(t),e)}:a})},a.parseRows=function(t,n){var e,a,i={},o={},s=[],l=t.length,u=0,c=0;function h(){if(u>=l)return o;if(a)return a=!1,i;var n=u;if(34===t.charCodeAt(n)){for(var e=n;e++<l;)if(34===t.charCodeAt(e)){if(34!==t.charCodeAt(e+1))break;++e}return u=e+2,13===(s=t.charCodeAt(e+1))?(a=!0,10===t.charCodeAt(e+2)&&++u):10===s&&(a=!0),t.slice(n+1,e).replace(/\"\"/g,'\"')}for(;u<l;){var s,c=1;if(10===(s=t.charCodeAt(u++)))a=!0;else if(13===s)a=!0,10===t.charCodeAt(u)&&(++u,++c);else if(s!==r)continue;return t.slice(n,u-c)}return t.slice(n)}for(;(e=h())!==o;){for(var f=[];e!==i&&e!==o;)f.push(e),e=h();n&&null==(f=n(f,c++))||s.push(f)}return s},a.format=function(n){if(Array.isArray(n[0]))return a.formatRows(n);var e=new z,r=[];return n.forEach(function(t){for(var n in t)e.has(n)||r.push(e.add(n))}),[r.map(l).join(t)].concat(n.map(function(n){return r.map(function(t){return l(n[t])}).join(t)})).join(\"\\n\")},a.formatRows=function(t){return t.map(s).join(\"\\n\")},a},t.csv=t.dsv(\",\",\"text/csv\"),t.tsv=t.dsv(\"\\t\",\"text/tab-separated-values\");var yn,bn,wn,xn,kn=this[N(this,\"requestAnimationFrame\")]||function(t){setTimeout(t,17)};function Sn(t,n,e){var r=arguments.length;r<2&&(n=0),r<3&&(e=Date.now());var a=e+n,i={c:t,t:a,n:null};return bn?bn.n=i:yn=i,bn=i,wn||(xn=clearTimeout(xn),wn=1,kn(_n)),i}function _n(){var t=qn(),n=Tn()-t;n>24?(isFinite(n)&&(clearTimeout(xn),xn=setTimeout(_n,n)),wn=0):(wn=1,kn(_n))}function qn(){for(var t=Date.now(),n=yn;n;)t>=n.t&&n.c(t-n.t)&&(n.c=null),n=n.n;return t}function Tn(){for(var t,n=yn,e=1/0;n;)n.c?(n.t<e&&(e=n.t),n=(t=n).n):n=t?t.n=n.n:yn=n.n;return bn=t,e}function zn(t,n){return n-(t?Math.ceil(Math.log(t)/Math.LN10):1)}t.timer=function(){Sn.apply(this,arguments)},t.timer.flush=function(){qn(),Tn()},t.round=function(t,n){return n?Math.round(t*(n=Math.pow(10,n)))/n:Math.round(t)};var En=[\"y\",\"z\",\"a\",\"f\",\"p\",\"n\",\"\\xb5\",\"m\",\"\",\"k\",\"M\",\"G\",\"T\",\"P\",\"E\",\"Z\",\"Y\"].map(function(t,n){var e=Math.pow(10,3*M(8-n));return{scale:n>8?function(t){return t/e}:function(t){return t*e},symbol:t}});function An(n){var e=n.decimal,r=n.thousands,a=n.grouping,i=n.currency,o=a&&r?function(t,n){for(var e=t.length,i=[],o=0,s=a[0],l=0;e>0&&s>0&&(l+s+1>n&&(s=Math.max(1,n-l)),i.push(t.substring(e-=s,e+s)),!((l+=s+1)>n));)s=a[o=(o+1)%a.length];return i.reverse().join(r)}:E;return function(n){var r=Nn.exec(n),a=r[1]||\" \",s=r[2]||\">\",l=r[3]||\"-\",u=r[4]||\"\",c=r[5],h=+r[6],f=r[7],p=r[8],d=r[9],g=1,v=\"\",M=\"\",m=!1,y=!0;switch(p&&(p=+p.substring(1)),(c||\"0\"===a&&\"=\"===s)&&(c=a=\"0\",s=\"=\"),d){case\"n\":f=!0,d=\"g\";break;case\"%\":g=100,M=\"%\",d=\"f\";break;case\"p\":g=100,M=\"%\",d=\"r\";break;case\"b\":case\"o\":case\"x\":case\"X\":\"#\"===u&&(v=\"0\"+d.toLowerCase());case\"c\":y=!1;case\"d\":m=!0,p=0;break;case\"s\":g=-1,d=\"r\"}\"$\"===u&&(v=i[0],M=i[1]),\"r\"!=d||p||(d=\"g\"),null!=p&&(\"g\"==d?p=Math.max(1,Math.min(21,p)):\"e\"!=d&&\"f\"!=d||(p=Math.max(0,Math.min(20,p)))),d=jn.get(d)||Ln;var b=c&&f;return function(n){var r=M;if(m&&n%1)return\"\";var i=n<0||0===n&&1/n<0?(n=-n,\"-\"):\"-\"===l?\"\":l;if(g<0){var u=t.formatPrefix(n,p);n=u.scale(n),r=u.symbol+M}else n*=g;var w,x,k=(n=d(n,p)).lastIndexOf(\".\");if(k<0){var S=y?n.lastIndexOf(\"e\"):-1;S<0?(w=n,x=\"\"):(w=n.substring(0,S),x=n.substring(S))}else w=n.substring(0,k),x=e+n.substring(k+1);!c&&f&&(w=o(w,1/0));var _=v.length+w.length+x.length+(b?0:i.length),q=_<h?new Array(_=h-_+1).join(a):\"\";return b&&(w=o(q+w,q.length?h-x.length:1/0)),i+=v,n=w+x,(\"<\"===s?i+n+q:\">\"===s?q+i+n:\"^\"===s?q.substring(0,_>>=1)+i+n+q.substring(_):i+(b?n:q+n))+r}}}t.formatPrefix=function(n,e){var r=0;return(n=+n)&&(n<0&&(n*=-1),e&&(n=t.round(n,zn(n,e))),r=1+Math.floor(1e-12+Math.log(n)/Math.LN10),r=Math.max(-24,Math.min(24,3*Math.floor((r-1)/3)))),En[8+r/3]};var Nn=/(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i,jn=t.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,n){return t.toPrecision(n)},e:function(t,n){return t.toExponential(n)},f:function(t,n){return t.toFixed(n)},r:function(n,e){return(n=t.round(n,zn(n,e))).toFixed(Math.max(0,Math.min(20,zn(n*(1+1e-15),e))))}});function Ln(t){return t+\"\"}var Pn=t.time={},Cn=Date;function Dn(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}Dn.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){In.setUTCDate.apply(this._,arguments)},setDay:function(){In.setUTCDay.apply(this._,arguments)},setFullYear:function(){In.setUTCFullYear.apply(this._,arguments)},setHours:function(){In.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){In.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){In.setUTCMinutes.apply(this._,arguments)},setMonth:function(){In.setUTCMonth.apply(this._,arguments)},setSeconds:function(){In.setUTCSeconds.apply(this._,arguments)},setTime:function(){In.setTime.apply(this._,arguments)}};var In=Date.prototype;function Rn(t,n,e){function r(n){var e=t(n),r=i(e,1);return n-e<r-n?e:r}function a(e){return n(e=t(new Cn(e-1)),1),e}function i(t,e){return n(t=new Cn(+t),e),t}function o(t,r,i){var o=a(t),s=[];if(i>1)for(;o<r;)e(o)%i||s.push(new Date(+o)),n(o,1);else for(;o<r;)s.push(new Date(+o)),n(o,1);return s}t.floor=t,t.round=r,t.ceil=a,t.offset=i,t.range=o;var s=t.utc=Fn(t);return s.floor=s,s.round=Fn(r),s.ceil=Fn(a),s.offset=Fn(i),s.range=function(t,n,e){try{Cn=Dn;var r=new Dn;return r._=t,o(r,n,e)}finally{Cn=Date}},t}function Fn(t){return function(n,e){try{Cn=Dn;var r=new Dn;return r._=n,t(r,e)._}finally{Cn=Date}}}function On(n){var e=n.dateTime,r=n.date,a=n.time,i=n.periods,o=n.days,s=n.shortDays,l=n.months,u=n.shortMonths;function c(t){var n=t.length;function e(e){for(var r,a,i,o=[],s=-1,l=0;++s<n;)37===t.charCodeAt(s)&&(o.push(t.slice(l,s)),null!=(a=Un[r=t.charAt(++s)])&&(r=t.charAt(++s)),(i=w[r])&&(r=i(e,null==a?\"e\"===r?\" \":\"0\":a)),o.push(r),l=s+1);return o.push(t.slice(l,s)),o.join(\"\")}return e.parse=function(n){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(h(e,t,n,0)!=n.length)return null;\"p\"in e&&(e.H=e.H%12+12*e.p);var r=null!=e.Z&&Cn!==Dn,a=new(r?Dn:Cn);return\"j\"in e?a.setFullYear(e.y,0,e.j):\"W\"in e||\"U\"in e?(\"w\"in e||(e.w=\"W\"in e?1:0),a.setFullYear(e.y,0,1),a.setFullYear(e.y,0,\"W\"in e?(e.w+6)%7+7*e.W-(a.getDay()+5)%7:e.w+7*e.U-(a.getDay()+6)%7)):a.setFullYear(e.y,e.m,e.d),a.setHours(e.H+(e.Z/100|0),e.M+e.Z%100,e.S,e.L),r?a._:a},e.toString=function(){return t},e}function h(t,n,e,r){for(var a,i,o,s=0,l=n.length,u=e.length;s<l;){if(r>=u)return-1;if(37===(a=n.charCodeAt(s++))){if(o=n.charAt(s++),!(i=x[o in Un?n.charAt(s++):o])||(r=i(t,e,r))<0)return-1}else if(a!=e.charCodeAt(r++))return-1}return r}c.utc=function(t){var n=c(t);function e(t){try{var e=new(Cn=Dn);return e._=t,n(e)}finally{Cn=Date}}return e.parse=function(t){try{Cn=Dn;var e=n.parse(t);return e&&e._}finally{Cn=Date}},e.toString=n.toString,e},c.multi=c.utc.multi=le;var f=t.map(),p=Vn(o),d=Gn(o),g=Vn(s),v=Gn(s),M=Vn(l),m=Gn(l),y=Vn(u),b=Gn(u);i.forEach(function(t,n){f.set(t.toLowerCase(),n)});var w={a:function(t){return s[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return l[t.getMonth()]},c:c(e),d:function(t,n){return Qn(t.getDate(),n,2)},e:function(t,n){return Qn(t.getDate(),n,2)},H:function(t,n){return Qn(t.getHours(),n,2)},I:function(t,n){return Qn(t.getHours()%12||12,n,2)},j:function(t,n){return Qn(1+Pn.dayOfYear(t),n,3)},L:function(t,n){return Qn(t.getMilliseconds(),n,3)},m:function(t,n){return Qn(t.getMonth()+1,n,2)},M:function(t,n){return Qn(t.getMinutes(),n,2)},p:function(t){return i[+(t.getHours()>=12)]},S:function(t,n){return Qn(t.getSeconds(),n,2)},U:function(t,n){return Qn(Pn.sundayOfYear(t),n,2)},w:function(t){return t.getDay()},W:function(t,n){return Qn(Pn.mondayOfYear(t),n,2)},x:c(r),X:c(a),y:function(t,n){return Qn(t.getFullYear()%100,n,2)},Y:function(t,n){return Qn(t.getFullYear()%1e4,n,4)},Z:oe,\"%\":function(){return\"%\"}},x={a:function(t,n,e){g.lastIndex=0;var r=g.exec(n.slice(e));return r?(t.w=v.get(r[0].toLowerCase()),e+r[0].length):-1},A:function(t,n,e){p.lastIndex=0;var r=p.exec(n.slice(e));return r?(t.w=d.get(r[0].toLowerCase()),e+r[0].length):-1},b:function(t,n,e){y.lastIndex=0;var r=y.exec(n.slice(e));return r?(t.m=b.get(r[0].toLowerCase()),e+r[0].length):-1},B:function(t,n,e){M.lastIndex=0;var r=M.exec(n.slice(e));return r?(t.m=m.get(r[0].toLowerCase()),e+r[0].length):-1},c:function(t,n,e){return h(t,w.c.toString(),n,e)},d:te,e:te,H:ee,I:ee,j:ne,L:ie,m:Kn,M:re,p:function(t,n,e){var r=f.get(n.slice(e,e+=2).toLowerCase());return null==r?-1:(t.p=r,e)},S:ae,U:Wn,w:Yn,W:$n,x:function(t,n,e){return h(t,w.x.toString(),n,e)},X:function(t,n,e){return h(t,w.X.toString(),n,e)},y:Xn,Y:Zn,Z:Jn,\"%\":se};return c}Pn.year=Rn(function(t){return(t=Pn.day(t)).setMonth(0,1),t},function(t,n){t.setFullYear(t.getFullYear()+n)},function(t){return t.getFullYear()}),Pn.years=Pn.year.range,Pn.years.utc=Pn.year.utc.range,Pn.day=Rn(function(t){var n=new Cn(2e3,0);return n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n},function(t,n){t.setDate(t.getDate()+n)},function(t){return t.getDate()-1}),Pn.days=Pn.day.range,Pn.days.utc=Pn.day.utc.range,Pn.dayOfYear=function(t){var n=Pn.year(t);return Math.floor((t-n-6e4*(t.getTimezoneOffset()-n.getTimezoneOffset()))/864e5)},[\"sunday\",\"monday\",\"tuesday\",\"wednesday\",\"thursday\",\"friday\",\"saturday\"].forEach(function(t,n){n=7-n;var e=Pn[t]=Rn(function(t){return(t=Pn.day(t)).setDate(t.getDate()-(t.getDay()+n)%7),t},function(t,n){t.setDate(t.getDate()+7*Math.floor(n))},function(t){var e=Pn.year(t).getDay();return Math.floor((Pn.dayOfYear(t)+(e+n)%7)/7)-(e!==n)});Pn[t+\"s\"]=e.range,Pn[t+\"s\"].utc=e.utc.range,Pn[t+\"OfYear\"]=function(t){var e=Pn.year(t).getDay();return Math.floor((Pn.dayOfYear(t)+(e+n)%7)/7)}}),Pn.week=Pn.sunday,Pn.weeks=Pn.sunday.range,Pn.weeks.utc=Pn.sunday.utc.range,Pn.weekOfYear=Pn.sundayOfYear;var Un={\"-\":\"\",_:\" \",0:\"0\"},Hn=/^\\s*\\d+/,Bn=/^%/;function Qn(t,n,e){var r=t<0?\"-\":\"\",a=(r?-t:t)+\"\",i=a.length;return r+(i<e?new Array(e-i+1).join(n)+a:a)}function Vn(n){return new RegExp(\"^(?:\"+n.map(t.requote).join(\"|\")+\")\",\"i\")}function Gn(t){for(var n=new b,e=-1,r=t.length;++e<r;)n.set(t[e].toLowerCase(),e);return n}function Yn(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+1));return r?(t.w=+r[0],e+r[0].length):-1}function Wn(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e));return r?(t.U=+r[0],e+r[0].length):-1}function $n(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e));return r?(t.W=+r[0],e+r[0].length):-1}function Zn(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+4));return r?(t.y=+r[0],e+r[0].length):-1}function Xn(t,n,e){Hn.lastIndex=0;var r,a=Hn.exec(n.slice(e,e+2));return a?(t.y=(r=+a[0])+(r>68?1900:2e3),e+a[0].length):-1}function Jn(t,n,e){return/^[+-]\\d{4}$/.test(n=n.slice(e,e+5))?(t.Z=-n,e+5):-1}function Kn(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+2));return r?(t.m=r[0]-1,e+r[0].length):-1}function te(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+2));return r?(t.d=+r[0],e+r[0].length):-1}function ne(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+3));return r?(t.j=+r[0],e+r[0].length):-1}function ee(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+2));return r?(t.H=+r[0],e+r[0].length):-1}function re(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+2));return r?(t.M=+r[0],e+r[0].length):-1}function ae(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+2));return r?(t.S=+r[0],e+r[0].length):-1}function ie(t,n,e){Hn.lastIndex=0;var r=Hn.exec(n.slice(e,e+3));return r?(t.L=+r[0],e+r[0].length):-1}function oe(t){var n=t.getTimezoneOffset(),e=n>0?\"-\":\"+\",r=M(n)/60|0,a=M(n)%60;return e+Qn(r,\"0\",2)+Qn(a,\"0\",2)}function se(t,n,e){Bn.lastIndex=0;var r=Bn.exec(n.slice(e,e+1));return r?e+r[0].length:-1}function le(t){for(var n=t.length,e=-1;++e<n;)t[e][0]=this(t[e][0]);return function(n){for(var e=0,r=t[e];!r[1](n);)r=t[++e];return r[0](n)}}t.locale=function(t){return{numberFormat:An(t),timeFormat:On(t)}};var ue=t.locale({decimal:\".\",thousands:\",\",grouping:[3],currency:[\"$\",\"\"],dateTime:\"%a %b %e %X %Y\",date:\"%m/%d/%Y\",time:\"%H:%M:%S\",periods:[\"AM\",\"PM\"],days:[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"],shortDays:[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],months:[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],shortMonths:[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]});function ce(){}t.format=ue.numberFormat,t.geo={},ce.prototype={s:0,t:0,add:function(t){fe(t,this.t,he),fe(he.s,this.s,this),this.s?this.t+=he.t:this.s=he.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var he=new ce;function fe(t,n,e){var r=e.s=t+n,a=r-t;e.t=t-(r-a)+(n-a)}function pe(t,n){t&&ge.hasOwnProperty(t.type)&&ge[t.type](t,n)}t.geo.stream=function(t,n){t&&de.hasOwnProperty(t.type)?de[t.type](t,n):pe(t,n)};var de={Feature:function(t,n){pe(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,a=e.length;++r<a;)pe(e[r].geometry,n)}},ge={Sphere:function(t,n){n.sphere()},Point:function(t,n){n.point((t=t.coordinates)[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,a=e.length;++r<a;)n.point((t=e[r])[0],t[1],t[2])},LineString:function(t,n){ve(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,a=e.length;++r<a;)ve(e[r],n,0)},Polygon:function(t,n){Me(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,a=e.length;++r<a;)Me(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,a=e.length;++r<a;)pe(e[r],n)}};function ve(t,n,e){var r,a=-1,i=t.length-e;for(n.lineStart();++a<i;)n.point((r=t[a])[0],r[1],r[2]);n.lineEnd()}function Me(t,n){var e=-1,r=t.length;for(n.polygonStart();++e<r;)ve(t[e],n,1);n.polygonEnd()}t.geo.area=function(n){return me=0,t.geo.stream(n,Ne),me};var me,ye,be,we,xe,ke,Se,_e,qe,Te,ze,Ee,Ae=new ce,Ne={sphere:function(){me+=4*_t},point:L,lineStart:L,lineEnd:L,polygonStart:function(){Ae.reset(),Ne.lineStart=je},polygonEnd:function(){var t=2*Ae;me+=t<0?4*_t+t:t,Ne.lineStart=Ne.lineEnd=Ne.point=L}};function je(){var t,n,e,r,a;function i(t,n){n=n*Et/2+_t/4;var i=(t*=Et)-e,o=i>=0?1:-1,s=o*i,l=Math.cos(n),u=Math.sin(n),c=a*u,h=r*l+c*Math.cos(s),f=c*o*Math.sin(s);Ae.add(Math.atan2(f,h)),e=t,r=l,a=u}Ne.point=function(o,s){Ne.point=i,e=(t=o)*Et,r=Math.cos(s=(n=s)*Et/2+_t/4),a=Math.sin(s)},Ne.lineEnd=function(){i(t,n)}}function Le(t){var n=t[0],e=t[1],r=Math.cos(e);return[r*Math.cos(n),r*Math.sin(n),Math.sin(e)]}function Pe(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function Ce(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function De(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function Ie(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function Re(t){var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}function Fe(t){return[Math.atan2(t[1],t[0]),Pt(t[2])]}function Oe(t,n){return M(t[0]-n[0])<kt&&M(t[1]-n[1])<kt}t.geo.bounds=function(){var n,e,r,a,i,o,s,l,u,c,h,f={point:p,lineStart:g,lineEnd:v,polygonStart:function(){f.point=m,f.lineStart=y,f.lineEnd=b,u=0,Ne.polygonStart()},polygonEnd:function(){Ne.polygonEnd(),f.point=p,f.lineStart=g,f.lineEnd=v,Ae<0?(n=-(r=180),e=-(a=90)):u>kt?a=90:u<-kt&&(e=-90),h[0]=n,h[1]=r}};function p(t,i){c.push(h=[n=t,r=t]),i<e&&(e=i),i>a&&(a=i)}function d(t,o){var s=Le([t*Et,o*Et]);if(l){var u=Ce(l,s),c=Ce([u[1],-u[0],0],u);Re(c),c=Fe(c);var h=t-i,f=h>0?1:-1,d=c[0]*At*f,g=M(h)>180;if(g^(f*i<d&&d<f*t))(v=c[1]*At)>a&&(a=v);else if(g^(f*i<(d=(d+360)%360-180)&&d<f*t)){var v;(v=-c[1]*At)<e&&(e=v)}else o<e&&(e=o),o>a&&(a=o);g?t<i?w(n,t)>w(n,r)&&(r=t):w(t,r)>w(n,r)&&(n=t):r>=n?(t<n&&(n=t),t>r&&(r=t)):t>i?w(n,t)>w(n,r)&&(r=t):w(t,r)>w(n,r)&&(n=t)}else p(t,o);l=s,i=t}function g(){f.point=d}function v(){h[0]=n,h[1]=r,f.point=p,l=null}function m(t,n){if(l){var e=t-i;u+=M(e)>180?e+(e>0?360:-360):e}else o=t,s=n;Ne.point(t,n),d(t,n)}function y(){Ne.lineStart()}function b(){m(o,s),Ne.lineEnd(),M(u)>kt&&(n=-(r=180)),h[0]=n,h[1]=r,l=null}function w(t,n){return(n-=t)<0?n+360:n}function x(t,n){return t[0]-n[0]}function k(t,n){return n[0]<=n[1]?n[0]<=t&&t<=n[1]:t<n[0]||n[1]<t}return function(i){if(a=r=-(n=e=1/0),c=[],t.geo.stream(i,f),u=c.length){c.sort(x);for(var o=1,s=[g=c[0]];o<u;++o)k((p=c[o])[0],g)||k(p[1],g)?(w(g[0],p[1])>w(g[0],g[1])&&(g[1]=p[1]),w(p[0],g[1])>w(g[0],g[1])&&(g[0]=p[0])):s.push(g=p);for(var l,u,p,d=-1/0,g=(o=0,s[u=s.length-1]);o<=u;g=p,++o)(l=w(g[1],(p=s[o])[0]))>d&&(d=l,n=p[0],r=g[1])}return c=h=null,n===1/0||e===1/0?[[NaN,NaN],[NaN,NaN]]:[[n,e],[r,a]]}}(),t.geo.centroid=function(n){ye=be=we=xe=ke=Se=_e=qe=Te=ze=Ee=0,t.geo.stream(n,Ue);var e=Te,r=ze,a=Ee,i=e*e+r*r+a*a;return i<St&&(e=Se,r=_e,a=qe,be<kt&&(e=we,r=xe,a=ke),(i=e*e+r*r+a*a)<St)?[NaN,NaN]:[Math.atan2(r,e)*At,Pt(a/Math.sqrt(i))*At]};var Ue={sphere:L,point:He,lineStart:Qe,lineEnd:Ve,polygonStart:function(){Ue.lineStart=Ge},polygonEnd:function(){Ue.lineStart=Qe}};function He(t,n){t*=Et;var e=Math.cos(n*=Et);Be(e*Math.cos(t),e*Math.sin(t),Math.sin(n))}function Be(t,n,e){++ye,we+=(t-we)/ye,xe+=(n-xe)/ye,ke+=(e-ke)/ye}function Qe(){var t,n,e;function r(r,a){r*=Et;var i=Math.cos(a*=Et),o=i*Math.cos(r),s=i*Math.sin(r),l=Math.sin(a),u=Math.atan2(Math.sqrt((u=n*l-e*s)*u+(u=e*o-t*l)*u+(u=t*s-n*o)*u),t*o+n*s+e*l);be+=u,Se+=u*(t+(t=o)),_e+=u*(n+(n=s)),qe+=u*(e+(e=l)),Be(t,n,e)}Ue.point=function(a,i){a*=Et;var o=Math.cos(i*=Et);t=o*Math.cos(a),n=o*Math.sin(a),e=Math.sin(i),Ue.point=r,Be(t,n,e)}}function Ve(){Ue.point=He}function Ge(){var t,n,e,r,a;function i(t,n){t*=Et;var i=Math.cos(n*=Et),o=i*Math.cos(t),s=i*Math.sin(t),l=Math.sin(n),u=r*l-a*s,c=a*o-e*l,h=e*s-r*o,f=Math.sqrt(u*u+c*c+h*h),p=e*o+r*s+a*l,d=f&&-Lt(p)/f,g=Math.atan2(f,p);Te+=d*u,ze+=d*c,Ee+=d*h,be+=g,Se+=g*(e+(e=o)),_e+=g*(r+(r=s)),qe+=g*(a+(a=l)),Be(e,r,a)}Ue.point=function(o,s){t=o,n=s,Ue.point=i,o*=Et;var l=Math.cos(s*=Et);e=l*Math.cos(o),r=l*Math.sin(o),a=Math.sin(s),Be(e,r,a)},Ue.lineEnd=function(){i(t,n),Ue.lineEnd=Ve,Ue.point=He}}function Ye(t,n){function e(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(e.invert=function(e,r){return(e=n.invert(e,r))&&t.invert(e[0],e[1])}),e}function We(){return!0}function $e(t,n,e,r,a){var i=[],o=[];if(t.forEach(function(t){if(!((n=t.length-1)<=0)){var n,e=t[0],r=t[n];if(Oe(e,r)){a.lineStart();for(var s=0;s<n;++s)a.point((e=t[s])[0],e[1]);a.lineEnd()}else{var l=new Xe(e,t,null,!0),u=new Xe(e,null,l,!1);l.o=u,i.push(l),o.push(u),l=new Xe(r,t,null,!1),u=new Xe(r,null,l,!0),l.o=u,i.push(l),o.push(u)}}}),o.sort(n),Ze(i),Ze(o),i.length){for(var s=0,l=e,u=o.length;s<u;++s)o[s].e=l=!l;for(var c,h,f=i[0];;){for(var p=f,d=!0;p.v;)if((p=p.n)===f)return;c=p.z,a.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(s=0,u=c.length;s<u;++s)a.point((h=c[s])[0],h[1]);else r(p.x,p.n.x,1,a);p=p.n}else{if(d)for(s=(c=p.p.z).length-1;s>=0;--s)a.point((h=c[s])[0],h[1]);else r(p.x,p.p.x,-1,a);p=p.p}c=(p=p.o).z,d=!d}while(!p.v);a.lineEnd()}}}function Ze(t){if(n=t.length){for(var n,e,r=0,a=t[0];++r<n;)a.n=e=t[r],e.p=a,a=e;a.n=e=t[0],e.p=a}}function Xe(t,n,e,r){this.x=t,this.z=n,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Je(n,e,r,a){return function(i,o){var s,l=e(o),u=i.invert(a[0],a[1]),c={point:h,lineStart:p,lineEnd:d,polygonStart:function(){c.point=b,c.lineStart=w,c.lineEnd=x,s=[],g=[]},polygonEnd:function(){c.point=h,c.lineStart=p,c.lineEnd=d,s=t.merge(s);var n=function(t,n){var e=t[0],r=t[1],a=[Math.sin(e),-Math.cos(e),0],i=0,o=0;Ae.reset();for(var s=0,l=n.length;s<l;++s){var u=n[s],c=u.length;if(c)for(var h=u[0],f=h[0],p=h[1]/2+_t/4,d=Math.sin(p),g=Math.cos(p),v=1;;){v===c&&(v=0);var M=(t=u[v])[0],m=t[1]/2+_t/4,y=Math.sin(m),b=Math.cos(m),w=M-f,x=w>=0?1:-1,k=x*w,S=k>_t,_=d*y;if(Ae.add(Math.atan2(_*x*Math.sin(k),g*b+_*Math.cos(k))),i+=S?w+x*qt:w,S^f>=e^M>=e){var q=Ce(Le(h),Le(t));Re(q);var T=Ce(a,q);Re(T);var z=(S^w>=0?-1:1)*Pt(T[2]);(r>z||r===z&&(q[0]||q[1]))&&(o+=S^w>=0?1:-1)}if(!v++)break;f=M,d=y,g=b,h=t}}return(i<-kt||i<kt&&Ae<-kt)^1&o}(u,g);s.length?(y||(o.polygonStart(),y=!0),$e(s,nr,n,r,o)):n&&(y||(o.polygonStart(),y=!0),o.lineStart(),r(null,null,1,o),o.lineEnd()),y&&(o.polygonEnd(),y=!1),s=g=null},sphere:function(){o.polygonStart(),o.lineStart(),r(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function h(t,e){var r=i(t,e);n(t=r[0],e=r[1])&&o.point(t,e)}function f(t,n){var e=i(t,n);l.point(e[0],e[1])}function p(){c.point=f,l.lineStart()}function d(){c.point=h,l.lineEnd()}var g,v,M=tr(),m=e(M),y=!1;function b(t,n){v.push([t,n]);var e=i(t,n);m.point(e[0],e[1])}function w(){m.lineStart(),v=[]}function x(){b(v[0][0],v[0][1]),m.lineEnd();var t,n=m.clean(),e=M.buffer(),r=e.length;if(v.pop(),g.push(v),v=null,r)if(1&n){var a,i=-1;if((r=(t=e[0]).length-1)>0){for(y||(o.polygonStart(),y=!0),o.lineStart();++i<r;)o.point((a=t[i])[0],a[1]);o.lineEnd()}}else r>1&&2&n&&e.push(e.pop().concat(e.shift())),s.push(e.filter(Ke))}return c}}function Ke(t){return t.length>1}function tr(){var t,n=[];return{lineStart:function(){n.push(t=[])},point:function(n,e){t.push([n,e])},lineEnd:L,buffer:function(){var e=n;return n=[],t=null,e},rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))}}}function nr(t,n){return((t=t.x)[0]<0?t[1]-zt-kt:zt-t[1])-((n=n.x)[0]<0?n[1]-zt-kt:zt-n[1])}var er=Je(We,function(t){var n,e=NaN,r=NaN,a=NaN;return{lineStart:function(){t.lineStart(),n=1},point:function(i,o){var s=i>0?_t:-_t,l=M(i-e);M(l-_t)<kt?(t.point(e,r=(r+o)/2>0?zt:-zt),t.point(a,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(i,r),n=0):a!==s&&l>=_t&&(M(e-a)<kt&&(e-=a*kt),M(i-s)<kt&&(i-=s*kt),r=function(t,n,e,r){var a,i,o=Math.sin(t-e);return M(o)>kt?Math.atan((Math.sin(n)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(a=Math.cos(n))*Math.sin(t))/(a*i*o)):(n+r)/2}(e,r,i,o),t.point(a,r),t.lineEnd(),t.lineStart(),t.point(s,r),n=0),t.point(e=i,r=o),a=s},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-n}}},function(t,n,e,r){var a;if(null==t)r.point(-_t,a=e*zt),r.point(0,a),r.point(_t,a),r.point(_t,0),r.point(_t,-a),r.point(0,-a),r.point(-_t,-a),r.point(-_t,0),r.point(-_t,a);else if(M(t[0]-n[0])>kt){var i=t[0]<n[0]?_t:-_t;r.point(-i,a=e*i/2),r.point(0,a),r.point(i,a)}else r.point(n[0],n[1])},[-_t,-_t/2]);function rr(t){var n=Math.cos(t),e=n>0,r=M(n)>kt;return Je(a,function(t){var n,s,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(h,f){var p,d=[h,f],g=a(h,f),v=e?g?0:o(h,f):g?o(h+(h<0?_t:-_t),f):0;if(!n&&(u=l=g)&&t.lineStart(),g!==l&&(p=i(n,d),(Oe(n,p)||Oe(d,p))&&(d[0]+=kt,d[1]+=kt,g=a(d[0],d[1]))),g!==l)c=0,g?(t.lineStart(),p=i(d,n),t.point(p[0],p[1])):(p=i(n,d),t.point(p[0],p[1]),t.lineEnd()),n=p;else if(r&&n&&e^g){var M;v&s||!(M=i(d,n,!0))||(c=0,e?(t.lineStart(),t.point(M[0][0],M[0][1]),t.point(M[1][0],M[1][1]),t.lineEnd()):(t.point(M[1][0],M[1][1]),t.lineEnd(),t.lineStart(),t.point(M[0][0],M[0][1])))}!g||n&&Oe(n,d)||t.point(d[0],d[1]),n=d,l=g,s=v},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return c|(u&&l)<<1}}},Or(t,6*Et),e?[0,-t]:[-_t,t-_t]);function a(t,e){return Math.cos(t)*Math.cos(e)>n}function i(t,e,r){var a=[1,0,0],i=Ce(Le(t),Le(e)),o=Pe(i,i),s=i[0],l=o-s*s;if(!l)return!r&&t;var u=n*o/l,c=-n*s/l,h=Ce(a,i),f=Ie(a,u);De(f,Ie(i,c));var p=h,d=Pe(f,p),g=Pe(p,p),v=d*d-g*(Pe(f,f)-1);if(!(v<0)){var m=Math.sqrt(v),y=Ie(p,(-d-m)/g);if(De(y,f),y=Fe(y),!r)return y;var b,w=t[0],x=e[0],k=t[1],S=e[1];x<w&&(b=w,w=x,x=b);var _=x-w,q=M(_-_t)<kt;if(!q&&S<k&&(b=k,k=S,S=b),q||_<kt?q?k+S>0^y[1]<(M(y[0]-w)<kt?k:S):k<=y[1]&&y[1]<=S:_>_t^(w<=y[0]&&y[0]<=x)){var T=Ie(p,(-d+m)/g);return De(T,f),[y,Fe(T)]}}}function o(n,r){var a=e?t:_t-t,i=0;return n<-a?i|=1:n>a&&(i|=2),r<-a?i|=4:r>a&&(i|=8),i}}function ar(t,n,e,r){return function(a){var i,o=a.a,s=a.b,l=o.x,u=o.y,c=0,h=1,f=s.x-l,p=s.y-u;if(i=t-l,f||!(i>0)){if(i/=f,f<0){if(i<c)return;i<h&&(h=i)}else if(f>0){if(i>h)return;i>c&&(c=i)}if(i=e-l,f||!(i<0)){if(i/=f,f<0){if(i>h)return;i>c&&(c=i)}else if(f>0){if(i<c)return;i<h&&(h=i)}if(i=n-u,p||!(i>0)){if(i/=p,p<0){if(i<c)return;i<h&&(h=i)}else if(p>0){if(i>h)return;i>c&&(c=i)}if(i=r-u,p||!(i<0)){if(i/=p,p<0){if(i>h)return;i>c&&(c=i)}else if(p>0){if(i<c)return;i<h&&(h=i)}return c>0&&(a.a={x:l+c*f,y:u+c*p}),h<1&&(a.b={x:l+h*f,y:u+h*p}),a}}}}}}var ir=1e9;function or(n,e,r,a){return function(l){var u,c,h,f,p,d,g,v,M,m,y,b=l,w=tr(),x=ar(n,e,r,a),k={point:q,lineStart:function(){k.point=T,c&&c.push(h=[]),m=!0,M=!1,g=v=NaN},lineEnd:function(){u&&(T(f,p),d&&M&&w.rejoin(),u.push(w.buffer())),k.point=q,M&&l.lineEnd()},polygonStart:function(){l=w,u=[],c=[],y=!0},polygonEnd:function(){l=b,u=t.merge(u);var e=function(t){for(var n=0,e=c.length,r=t[1],a=0;a<e;++a)for(var i,o=1,s=c[a],l=s.length,u=s[0];o<l;++o)i=s[o],u[1]<=r?i[1]>r&&jt(u,i,t)>0&&++n:i[1]<=r&&jt(u,i,t)<0&&--n,u=i;return 0!==n}([n,a]),r=y&&e,i=u.length;(r||i)&&(l.polygonStart(),r&&(l.lineStart(),S(null,null,1,l),l.lineEnd()),i&&$e(u,o,e,S,l),l.polygonEnd()),u=c=h=null}};function S(t,o,l,u){var c=0,h=0;if(null==t||(c=i(t,l))!==(h=i(o,l))||s(t,o)<0^l>0)do{u.point(0===c||3===c?n:r,c>1?a:e)}while((c=(c+l+4)%4)!==h);else u.point(o[0],o[1])}function _(t,i){return n<=t&&t<=r&&e<=i&&i<=a}function q(t,n){_(t,n)&&l.point(t,n)}function T(t,n){var e=_(t=Math.max(-1e9,Math.min(ir,t)),n=Math.max(-1e9,Math.min(ir,n)));if(c&&h.push([t,n]),m)f=t,p=n,d=e,m=!1,e&&(l.lineStart(),l.point(t,n));else if(e&&M)l.point(t,n);else{var r={a:{x:g,y:v},b:{x:t,y:n}};x(r)?(M||(l.lineStart(),l.point(r.a.x,r.a.y)),l.point(r.b.x,r.b.y),e||l.lineEnd(),y=!1):e&&(l.lineStart(),l.point(t,n),y=!1)}g=t,v=n,M=e}return k};function i(t,a){return M(t[0]-n)<kt?a>0?0:3:M(t[0]-r)<kt?a>0?2:1:M(t[1]-e)<kt?a>0?1:0:a>0?3:2}function o(t,n){return s(t.x,n.x)}function s(t,n){var e=i(t,1),r=i(n,1);return e!==r?e-r:0===e?n[1]-t[1]:1===e?t[0]-n[0]:2===e?t[1]-n[1]:n[0]-t[0]}}function sr(t){var n=0,e=_t/3,r=jr(t),a=r(n,e);return a.parallels=function(t){return arguments.length?r(n=t[0]*_t/180,e=t[1]*_t/180):[n/_t*180,e/_t*180]},a}function lr(t,n){var e=Math.sin(t),r=(e+Math.sin(n))/2,a=1+e*(2*r-e),i=Math.sqrt(a)/r;function o(t,n){var e=Math.sqrt(a-2*r*Math.sin(n))/r;return[e*Math.sin(t*=r),i-e*Math.cos(t)]}return o.invert=function(t,n){var e=i-n;return[Math.atan2(t,e)/r,Pt((a-(t*t+e*e)*r*r)/(2*r))]},o}t.geo.clipExtent=function(){var t,n,e,r,a,i,o={stream:function(t){return a&&(a.valid=!1),(a=i(t)).valid=!0,a},extent:function(s){return arguments.length?(i=or(t=+s[0][0],n=+s[0][1],e=+s[1][0],r=+s[1][1]),a&&(a.valid=!1,a=null),o):[[t,n],[e,r]]}};return o.extent([[0,0],[960,500]])},(t.geo.conicEqualArea=function(){return sr(lr)}).raw=lr,t.geo.albers=function(){return t.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},t.geo.albersUsa=function(){var n,e,r,a,i=t.geo.albers(),o=t.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=t.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,e){n=[t,e]}};function u(t){var i=t[0],o=t[1];return n=null,e(i,o),n||(r(i,o),n)||a(i,o),n}return u.invert=function(t){var n=i.scale(),e=i.translate(),r=(t[0]-e[0])/n,a=(t[1]-e[1])/n;return(a>=.12&&a<.234&&r>=-.425&&r<-.214?o:a>=.166&&a<.234&&r>=-.214&&r<-.115?s:i).invert(t)},u.stream=function(t){var n=i.stream(t),e=o.stream(t),r=s.stream(t);return{point:function(t,a){n.point(t,a),e.point(t,a),r.point(t,a)},sphere:function(){n.sphere(),e.sphere(),r.sphere()},lineStart:function(){n.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){n.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){n.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){n.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},u.precision=function(t){return arguments.length?(i.precision(t),o.precision(t),s.precision(t),u):i.precision()},u.scale=function(t){return arguments.length?(i.scale(t),o.scale(.35*t),s.scale(t),u.translate(i.translate())):i.scale()},u.translate=function(t){if(!arguments.length)return i.translate();var n=i.scale(),c=+t[0],h=+t[1];return e=i.translate(t).clipExtent([[c-.455*n,h-.238*n],[c+.455*n,h+.238*n]]).stream(l).point,r=o.translate([c-.307*n,h+.201*n]).clipExtent([[c-.425*n+kt,h+.12*n+kt],[c-.214*n-kt,h+.234*n-kt]]).stream(l).point,a=s.translate([c-.205*n,h+.212*n]).clipExtent([[c-.214*n+kt,h+.166*n+kt],[c-.115*n-kt,h+.234*n-kt]]).stream(l).point,u},u.scale(1070)};var ur,cr,hr,fr,pr,dr,gr={point:L,lineStart:L,lineEnd:L,polygonStart:function(){cr=0,gr.lineStart=vr},polygonEnd:function(){gr.lineStart=gr.lineEnd=gr.point=L,ur+=M(cr/2)}};function vr(){var t,n,e,r;function a(t,n){cr+=r*t-e*n,e=t,r=n}gr.point=function(i,o){gr.point=a,t=e=i,n=r=o},gr.lineEnd=function(){a(t,n)}}var Mr={point:function(t,n){t<hr&&(hr=t),t>pr&&(pr=t),n<fr&&(fr=n),n>dr&&(dr=n)},lineStart:L,lineEnd:L,polygonStart:L,polygonEnd:L};function mr(){var t=yr(4.5),n=[],e={point:r,lineStart:function(){e.point=a},lineEnd:o,polygonStart:function(){e.lineEnd=s},polygonEnd:function(){e.lineEnd=o,e.point=r},pointRadius:function(n){return t=yr(n),e},result:function(){if(n.length){var t=n.join(\"\");return n=[],t}}};function r(e,r){n.push(\"M\",e,\",\",r,t)}function a(t,r){n.push(\"M\",t,\",\",r),e.point=i}function i(t,e){n.push(\"L\",t,\",\",e)}function o(){e.point=r}function s(){n.push(\"Z\")}return e}function yr(t){return\"m0,\"+t+\"a\"+t+\",\"+t+\" 0 1,1 0,\"+-2*t+\"a\"+t+\",\"+t+\" 0 1,1 0,\"+2*t+\"z\"}var br,wr={point:xr,lineStart:kr,lineEnd:Sr,polygonStart:function(){wr.lineStart=_r},polygonEnd:function(){wr.point=xr,wr.lineStart=kr,wr.lineEnd=Sr}};function xr(t,n){we+=t,xe+=n,++ke}function kr(){var t,n;function e(e,r){var a=e-t,i=r-n,o=Math.sqrt(a*a+i*i);Se+=o*(t+e)/2,_e+=o*(n+r)/2,qe+=o,xr(t=e,n=r)}wr.point=function(r,a){wr.point=e,xr(t=r,n=a)}}function Sr(){wr.point=xr}function _r(){var t,n,e,r;function a(t,n){var a=t-e,i=n-r,o=Math.sqrt(a*a+i*i);Se+=o*(e+t)/2,_e+=o*(r+n)/2,qe+=o,Te+=(o=r*t-e*n)*(e+t),ze+=o*(r+n),Ee+=3*o,xr(e=t,r=n)}wr.point=function(i,o){wr.point=a,xr(t=e=i,n=r=o)},wr.lineEnd=function(){a(t,n)}}function qr(t){var n=4.5,e={point:r,lineStart:function(){e.point=a},lineEnd:o,polygonStart:function(){e.lineEnd=s},polygonEnd:function(){e.lineEnd=o,e.point=r},pointRadius:function(t){return n=t,e},result:L};function r(e,r){t.moveTo(e+n,r),t.arc(e,r,n,0,qt)}function a(n,r){t.moveTo(n,r),e.point=i}function i(n,e){t.lineTo(n,e)}function o(){e.point=r}function s(){t.closePath()}return e}function Tr(t){var n=.5,e=Math.cos(30*Et),r=16;function a(t){return(r?o:i)(t)}function i(n){return Ar(n,function(e,r){e=t(e,r),n.point(e[0],e[1])})}function o(n){var e,a,i,o,l,u,c,h,f,p,d,g,v={point:M,lineStart:m,lineEnd:b,polygonStart:function(){n.polygonStart(),v.lineStart=w},polygonEnd:function(){n.polygonEnd(),v.lineStart=m}};function M(e,r){e=t(e,r),n.point(e[0],e[1])}function m(){h=NaN,v.point=y,n.lineStart()}function y(e,a){var i=Le([e,a]),o=t(e,a);s(h,f,c,p,d,g,h=o[0],f=o[1],c=e,p=i[0],d=i[1],g=i[2],r,n),n.point(h,f)}function b(){v.point=M,n.lineEnd()}function w(){m(),v.point=x,v.lineEnd=k}function x(t,n){y(e=t,n),a=h,i=f,o=p,l=d,u=g,v.point=y}function k(){s(h,f,c,p,d,g,a,i,e,o,l,u,r,n),v.lineEnd=b,b()}return v}function s(r,a,i,o,l,u,c,h,f,p,d,g,v,m){var y=c-r,b=h-a,w=y*y+b*b;if(w>4*n&&v--){var x=o+p,k=l+d,S=u+g,_=Math.sqrt(x*x+k*k+S*S),q=Math.asin(S/=_),T=M(M(S)-1)<kt||M(i-f)<kt?(i+f)/2:Math.atan2(k,x),z=t(T,q),E=z[0],A=z[1],N=E-r,j=A-a,L=b*N-y*j;(L*L/w>n||M((y*N+b*j)/w-.5)>.3||o*p+l*d+u*g<e)&&(s(r,a,i,o,l,u,E,A,T,x/=_,k/=_,S,v,m),m.point(E,A),s(E,A,T,x,k,S,c,h,f,p,d,g,v,m))}}return a.precision=function(t){return arguments.length?(r=(n=t*t)>0&&16,a):Math.sqrt(n)},a}function zr(t){var n=Tr(function(n,e){return t([n*At,e*At])});return function(t){return Lr(n(t))}}function Er(t){this.stream=t}function Ar(t,n){return{point:n,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function Nr(t){return jr(function(){return t})()}function jr(n){var e,r,a,i,o,s,l=Tr(function(t,n){return[(t=e(t,n))[0]*u+i,o-t[1]*u]}),u=150,c=480,h=250,f=0,p=0,d=0,g=0,v=0,M=er,m=E,y=null,b=null;function w(t){return[(t=a(t[0]*Et,t[1]*Et))[0]*u+i,o-t[1]*u]}function x(t){return(t=a.invert((t[0]-i)/u,(o-t[1])/u))&&[t[0]*At,t[1]*At]}function k(){a=Ye(r=Dr(d,g,v),e);var t=e(f,p);return i=c-t[0]*u,o=h+t[1]*u,S()}function S(){return s&&(s.valid=!1,s=null),w}return w.stream=function(t){return s&&(s.valid=!1),(s=Lr(M(r,l(m(t))))).valid=!0,s},w.clipAngle=function(t){return arguments.length?(M=null==t?(y=t,er):rr((y=+t)*Et),S()):y},w.clipExtent=function(t){return arguments.length?(b=t,m=t?or(t[0][0],t[0][1],t[1][0],t[1][1]):E,S()):b},w.scale=function(t){return arguments.length?(u=+t,k()):u},w.translate=function(t){return arguments.length?(c=+t[0],h=+t[1],k()):[c,h]},w.center=function(t){return arguments.length?(f=t[0]%360*Et,p=t[1]%360*Et,k()):[f*At,p*At]},w.rotate=function(t){return arguments.length?(d=t[0]%360*Et,g=t[1]%360*Et,v=t.length>2?t[2]%360*Et:0,k()):[d*At,g*At,v*At]},t.rebind(w,l,\"precision\"),function(){return e=n.apply(this,arguments),w.invert=e.invert&&x,k()}}function Lr(t){return Ar(t,function(n,e){t.point(n*Et,e*Et)})}function Pr(t,n){return[t,n]}function Cr(t,n){return[t>_t?t-qt:t<-_t?t+qt:t,n]}function Dr(t,n,e){return t?n||e?Ye(Rr(t),Fr(n,e)):Rr(t):n||e?Fr(n,e):Cr}function Ir(t){return function(n,e){return[(n+=t)>_t?n-qt:n<-_t?n+qt:n,e]}}function Rr(t){var n=Ir(t);return n.invert=Ir(-t),n}function Fr(t,n){var e=Math.cos(t),r=Math.sin(t),a=Math.cos(n),i=Math.sin(n);function o(t,n){var o=Math.cos(n),s=Math.cos(t)*o,l=Math.sin(t)*o,u=Math.sin(n),c=u*e+s*r;return[Math.atan2(l*a-c*i,s*e-u*r),Pt(c*a+l*i)]}return o.invert=function(t,n){var o=Math.cos(n),s=Math.cos(t)*o,l=Math.sin(t)*o,u=Math.sin(n),c=u*a-l*i;return[Math.atan2(l*a+u*i,s*e+c*r),Pt(c*e-s*r)]},o}function Or(t,n){var e=Math.cos(t),r=Math.sin(t);return function(a,i,o,s){var l=o*n;null!=a?(a=Ur(e,a),i=Ur(e,i),(o>0?a<i:a>i)&&(a+=o*qt)):(a=t+o*qt,i=t-.5*l);for(var u,c=a;o>0?c>i:c<i;c-=l)s.point((u=Fe([e,-r*Math.cos(c),-r*Math.sin(c)]))[0],u[1])}}function Ur(t,n){var e=Le(n);e[0]-=t,Re(e);var r=Lt(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-kt)%(2*Math.PI)}function Hr(n,e,r){var a=t.range(n,e-kt,r).concat(e);return function(t){return a.map(function(n){return[t,n]})}}function Br(n,e,r){var a=t.range(n,e-kt,r).concat(e);return function(t){return a.map(function(n){return[n,t]})}}function Qr(t){return t.source}function Vr(t){return t.target}t.geo.path=function(){var n,e,r,a,i,o=4.5;function s(n){return n&&(\"function\"==typeof o&&a.pointRadius(+o.apply(this,arguments)),i&&i.valid||(i=r(a)),t.geo.stream(n,i)),a.result()}function l(){return i=null,s}return s.area=function(n){return ur=0,t.geo.stream(n,r(gr)),ur},s.centroid=function(n){return we=xe=ke=Se=_e=qe=Te=ze=Ee=0,t.geo.stream(n,r(wr)),Ee?[Te/Ee,ze/Ee]:qe?[Se/qe,_e/qe]:ke?[we/ke,xe/ke]:[NaN,NaN]},s.bounds=function(n){return pr=dr=-(hr=fr=1/0),t.geo.stream(n,r(Mr)),[[hr,fr],[pr,dr]]},s.projection=function(t){return arguments.length?(r=(n=t)?t.stream||zr(t):E,l()):n},s.context=function(t){return arguments.length?(a=null==(e=t)?new mr:new qr(t),\"function\"!=typeof o&&a.pointRadius(o),l()):e},s.pointRadius=function(t){return arguments.length?(o=\"function\"==typeof t?t:(a.pointRadius(+t),+t),s):o},s.projection(t.geo.albersUsa()).context(null)},t.geo.transform=function(t){return{stream:function(n){var e=new Er(n);for(var r in t)e[r]=t[r];return e}}},Er.prototype={point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},t.geo.projection=Nr,t.geo.projectionMutator=jr,(t.geo.equirectangular=function(){return Nr(Pr)}).raw=Pr.invert=Pr,t.geo.rotation=function(t){function n(n){return(n=t(n[0]*Et,n[1]*Et))[0]*=At,n[1]*=At,n}return t=Dr(t[0]%360*Et,t[1]*Et,t.length>2?t[2]*Et:0),n.invert=function(n){return(n=t.invert(n[0]*Et,n[1]*Et))[0]*=At,n[1]*=At,n},n},Cr.invert=Pr,t.geo.circle=function(){var t,n,e=[0,0],r=6;function a(){var t=\"function\"==typeof e?e.apply(this,arguments):e,r=Dr(-t[0]*Et,-t[1]*Et,0).invert,a=[];return n(null,null,1,{point:function(t,n){a.push(t=r(t,n)),t[0]*=At,t[1]*=At}}),{type:\"Polygon\",coordinates:[a]}}return a.origin=function(t){return arguments.length?(e=t,a):e},a.angle=function(e){return arguments.length?(n=Or((t=+e)*Et,r*Et),a):t},a.precision=function(e){return arguments.length?(n=Or(t*Et,(r=+e)*Et),a):r},a.angle(90)},t.geo.distance=function(t,n){var e,r=(n[0]-t[0])*Et,a=t[1]*Et,i=n[1]*Et,o=Math.sin(r),s=Math.cos(r),l=Math.sin(a),u=Math.cos(a),c=Math.sin(i),h=Math.cos(i);return Math.atan2(Math.sqrt((e=h*o)*e+(e=u*c-l*h*s)*e),l*c+u*h*s)},t.geo.graticule=function(){var n,e,r,a,i,o,s,l,u,c,h,f,p=10,d=p,g=90,v=360,m=2.5;function y(){return{type:\"MultiLineString\",coordinates:b()}}function b(){return t.range(Math.ceil(a/g)*g,r,g).map(h).concat(t.range(Math.ceil(l/v)*v,s,v).map(f)).concat(t.range(Math.ceil(e/p)*p,n,p).filter(function(t){return M(t%g)>kt}).map(u)).concat(t.range(Math.ceil(o/d)*d,i,d).filter(function(t){return M(t%v)>kt}).map(c))}return y.lines=function(){return b().map(function(t){return{type:\"LineString\",coordinates:t}})},y.outline=function(){return{type:\"Polygon\",coordinates:[h(a).concat(f(s).slice(1),h(r).reverse().slice(1),f(l).reverse().slice(1))]}},y.extent=function(t){return arguments.length?y.majorExtent(t).minorExtent(t):y.minorExtent()},y.majorExtent=function(t){return arguments.length?(l=+t[0][1],s=+t[1][1],(a=+t[0][0])>(r=+t[1][0])&&(t=a,a=r,r=t),l>s&&(t=l,l=s,s=t),y.precision(m)):[[a,l],[r,s]]},y.minorExtent=function(t){return arguments.length?(o=+t[0][1],i=+t[1][1],(e=+t[0][0])>(n=+t[1][0])&&(t=e,e=n,n=t),o>i&&(t=o,o=i,i=t),y.precision(m)):[[e,o],[n,i]]},y.step=function(t){return arguments.length?y.majorStep(t).minorStep(t):y.minorStep()},y.majorStep=function(t){return arguments.length?(g=+t[0],v=+t[1],y):[g,v]},y.minorStep=function(t){return arguments.length?(p=+t[0],d=+t[1],y):[p,d]},y.precision=function(t){return arguments.length?(m=+t,u=Hr(o,i,90),c=Br(e,n,m),h=Hr(l,s,90),f=Br(a,r,m),y):m},y.majorExtent([[-180,-90+kt],[180,90-kt]]).minorExtent([[-180,-80-kt],[180,80+kt]])},t.geo.greatArc=function(){var n,e,r=Qr,a=Vr;function i(){return{type:\"LineString\",coordinates:[n||r.apply(this,arguments),e||a.apply(this,arguments)]}}return i.distance=function(){return t.geo.distance(n||r.apply(this,arguments),e||a.apply(this,arguments))},i.source=function(t){return arguments.length?(r=t,n=\"function\"==typeof t?null:t,i):r},i.target=function(t){return arguments.length?(a=t,e=\"function\"==typeof t?null:t,i):a},i.precision=function(){return arguments.length?i:0},i},t.geo.interpolate=function(t,n){return e=t[0]*Et,r=t[1]*Et,a=n[0]*Et,i=n[1]*Et,o=Math.cos(r),s=Math.sin(r),l=Math.cos(i),u=Math.sin(i),c=o*Math.cos(e),h=o*Math.sin(e),f=l*Math.cos(a),p=l*Math.sin(a),d=2*Math.asin(Math.sqrt(Dt(i-r)+o*l*Dt(a-e))),g=1/Math.sin(d),(v=d?function(t){var n=Math.sin(t*=d)*g,e=Math.sin(d-t)*g,r=e*c+n*f,a=e*h+n*p,i=e*s+n*u;return[Math.atan2(a,r)*At,Math.atan2(i,Math.sqrt(r*r+a*a))*At]}:function(){return[e*At,r*At]}).distance=d,v;var e,r,a,i,o,s,l,u,c,h,f,p,d,g,v},t.geo.length=function(n){return br=0,t.geo.stream(n,Gr),br};var Gr={sphere:L,point:L,lineStart:function(){var t,n,e;function r(r,a){var i=Math.sin(a*=Et),o=Math.cos(a),s=M((r*=Et)-t),l=Math.cos(s);br+=Math.atan2(Math.sqrt((s=o*Math.sin(s))*s+(s=e*i-n*o*l)*s),n*i+e*o*l),t=r,n=i,e=o}Gr.point=function(a,i){t=a*Et,n=Math.sin(i*=Et),e=Math.cos(i),Gr.point=r},Gr.lineEnd=function(){Gr.point=Gr.lineEnd=L}},lineEnd:L,polygonStart:L,polygonEnd:L};function Yr(t,n){function e(n,e){var r=Math.cos(n),a=Math.cos(e),i=t(r*a);return[i*a*Math.sin(n),i*Math.sin(e)]}return e.invert=function(t,e){var r=Math.sqrt(t*t+e*e),a=n(r),i=Math.sin(a),o=Math.cos(a);return[Math.atan2(t*i,r*o),Math.asin(r&&e*i/r)]},e}var Wr=Yr(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(t.geo.azimuthalEqualArea=function(){return Nr(Wr)}).raw=Wr;var $r=Yr(function(t){var n=Math.acos(t);return n&&n/Math.sin(n)},E);function Zr(t,n){var e=Math.cos(t),r=function(t){return Math.tan(_t/4+t/2)},a=t===n?Math.sin(t):Math.log(e/Math.cos(n))/Math.log(r(n)/r(t)),i=e*Math.pow(r(t),a)/a;if(!a)return Kr;function o(t,n){i>0?n<-zt+kt&&(n=-zt+kt):n>zt-kt&&(n=zt-kt);var e=i/Math.pow(r(n),a);return[e*Math.sin(a*t),i-e*Math.cos(a*t)]}return o.invert=function(t,n){var e=i-n,r=Nt(a)*Math.sqrt(t*t+e*e);return[Math.atan2(t,e)/a,2*Math.atan(Math.pow(i/r,1/a))-zt]},o}function Xr(t,n){var e=Math.cos(t),r=t===n?Math.sin(t):(e-Math.cos(n))/(n-t),a=e/r+t;if(M(r)<kt)return Pr;function i(t,n){var e=a-n;return[e*Math.sin(r*t),a-e*Math.cos(r*t)]}return i.invert=function(t,n){var e=a-n;return[Math.atan2(t,e)/r,a-Nt(r)*Math.sqrt(t*t+e*e)]},i}(t.geo.azimuthalEquidistant=function(){return Nr($r)}).raw=$r,(t.geo.conicConformal=function(){return sr(Zr)}).raw=Zr,(t.geo.conicEquidistant=function(){return sr(Xr)}).raw=Xr;var Jr=Yr(function(t){return 1/t},Math.atan);function Kr(t,n){return[t,Math.log(Math.tan(_t/4+n/2))]}function ta(t){var n,e=Nr(t),r=e.scale,a=e.translate,i=e.clipExtent;return e.scale=function(){var t=r.apply(e,arguments);return t===e?n?e.clipExtent(null):e:t},e.translate=function(){var t=a.apply(e,arguments);return t===e?n?e.clipExtent(null):e:t},e.clipExtent=function(t){var o=i.apply(e,arguments);if(o===e){if(n=null==t){var s=_t*r(),l=a();i([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else n&&(o=null);return o},e.clipExtent(null)}(t.geo.gnomonic=function(){return Nr(Jr)}).raw=Jr,Kr.invert=function(t,n){return[t,2*Math.atan(Math.exp(n))-zt]},(t.geo.mercator=function(){return ta(Kr)}).raw=Kr;var na=Yr(function(){return 1},Math.asin);(t.geo.orthographic=function(){return Nr(na)}).raw=na;var ea=Yr(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});function ra(t,n){return[Math.log(Math.tan(_t/4+n/2)),-t]}function aa(t){return t[0]}function ia(t){return t[1]}function oa(t){for(var n=t.length,e=[0,1],r=2,a=2;a<n;a++){for(;r>1&&jt(t[e[r-2]],t[e[r-1]],t[a])<=0;)--r;e[r++]=a}return e.slice(0,r)}function sa(t,n){return t[0]-n[0]||t[1]-n[1]}(t.geo.stereographic=function(){return Nr(ea)}).raw=ea,ra.invert=function(t,n){return[-n,2*Math.atan(Math.exp(t))-zt]},(t.geo.transverseMercator=function(){var t=ta(ra),n=t.center,e=t.rotate;return t.center=function(t){return t?n([-t[1],t[0]]):[(t=n())[1],-t[0]]},t.rotate=function(t){return t?e([t[0],t[1],t.length>2?t[2]+90:90]):[(t=e())[0],t[1],t[2]-90]},e([0,0,90])}).raw=ra,t.geom={},t.geom.hull=function(t){var n=aa,e=ia;if(arguments.length)return r(t);function r(t){if(t.length<3)return[];var r,a=vn(n),i=vn(e),o=t.length,s=[],l=[];for(r=0;r<o;r++)s.push([+a.call(this,t[r],r),+i.call(this,t[r],r),r]);for(s.sort(sa),r=0;r<o;r++)l.push([s[r][0],-s[r][1]]);var u=oa(s),c=oa(l),h=c[0]===u[0],f=c[c.length-1]===u[u.length-1],p=[];for(r=u.length-1;r>=0;--r)p.push(t[s[u[r]][2]]);for(r=+h;r<c.length-f;++r)p.push(t[s[c[r]][2]]);return p}return r.x=function(t){return arguments.length?(n=t,r):n},r.y=function(t){return arguments.length?(e=t,r):e},r},t.geom.polygon=function(t){return O(t,la),t};var la=t.geom.polygon.prototype=[];function ua(t,n,e){return(e[0]-n[0])*(t[1]-n[1])<(e[1]-n[1])*(t[0]-n[0])}function ca(t,n,e,r){var a=t[0],i=e[0],o=n[0]-a,s=r[0]-i,l=t[1],u=e[1],c=n[1]-l,h=r[1]-u,f=(s*(l-u)-h*(a-i))/(h*o-s*c);return[a+f*o,l+f*c]}function ha(t){var n=t[0],e=t[t.length-1];return!(n[0]-e[0]||n[1]-e[1])}la.area=function(){for(var t,n=-1,e=this.length,r=this[e-1],a=0;++n<e;)a+=(t=r)[1]*(r=this[n])[0]-t[0]*r[1];return.5*a},la.centroid=function(t){var n,e,r=-1,a=this.length,i=0,o=0,s=this[a-1];for(arguments.length||(t=-1/(6*this.area()));++r<a;)i+=((n=s)[0]+(s=this[r])[0])*(e=n[0]*s[1]-s[0]*n[1]),o+=(n[1]+s[1])*e;return[i*t,o*t]},la.clip=function(t){for(var n,e,r,a,i,o,s=ha(t),l=-1,u=this.length-ha(this),c=this[u-1];++l<u;){for(n=t.slice(),t.length=0,a=this[l],i=n[(r=n.length-s)-1],e=-1;++e<r;)ua(o=n[e],c,a)?(ua(i,c,a)||t.push(ca(i,o,c,a)),t.push(o)):ua(i,c,a)&&t.push(ca(i,o,c,a)),i=o;s&&t.push(t[0]),c=a}return t};var fa,pa,da,ga,va,Ma=[],ma=[];function ya(){Ia(this),this.edge=this.site=this.circle=null}function ba(t){var n=Ma.pop()||new ya;return n.site=t,n}function wa(t){Aa(t),da.remove(t),Ma.push(t),Ia(t)}function xa(t){var n=t.circle,e=n.x,r=n.cy,a={x:e,y:r},i=t.P,o=t.N,s=[t];wa(t);for(var l=i;l.circle&&M(e-l.circle.x)<kt&&M(r-l.circle.cy)<kt;)i=l.P,s.unshift(l),wa(l),l=i;s.unshift(l),Aa(l);for(var u=o;u.circle&&M(e-u.circle.x)<kt&&M(r-u.circle.cy)<kt;)o=u.N,s.push(u),wa(u),u=o;s.push(u),Aa(u);var c,h=s.length;for(c=1;c<h;++c)Pa((u=s[c]).edge,(l=s[c-1]).site,u.site,a);(u=s[h-1]).edge=La((l=s[0]).site,u.site,null,a),Ea(l),Ea(u)}function ka(t){for(var n,e,r,a,i=t.x,o=t.y,s=da._;s;)if((r=Sa(s,o)-i)>kt)s=s.L;else{if(!((a=i-_a(s,o))>kt)){r>-kt?(n=s.P,e=s):a>-kt?(n=s,e=s.N):n=e=s;break}if(!s.R){n=s;break}s=s.R}var l=ba(t);if(da.insert(n,l),n||e){if(n===e)return Aa(n),e=ba(n.site),da.insert(l,e),l.edge=e.edge=La(n.site,l.site),Ea(n),void Ea(e);if(e){Aa(n),Aa(e);var u=n.site,c=u.x,h=u.y,f=t.x-c,p=t.y-h,d=e.site,g=d.x-c,v=d.y-h,M=2*(f*v-p*g),m=f*f+p*p,y=g*g+v*v,b={x:(v*m-p*y)/M+c,y:(f*y-g*m)/M+h};Pa(e.edge,u,d,b),l.edge=La(u,t,null,b),e.edge=La(t,d,null,b),Ea(n),Ea(e)}else l.edge=La(n.site,l.site)}}function Sa(t,n){var e=t.site,r=e.x,a=e.y,i=a-n;if(!i)return r;var o=t.P;if(!o)return-1/0;var s=(e=o.site).x,l=e.y,u=l-n;if(!u)return s;var c=s-r,h=1/i-1/u,f=c/u;return h?(-f+Math.sqrt(f*f-2*h*(c*c/(-2*u)-l+u/2+a-i/2)))/h+r:(r+s)/2}function _a(t,n){var e=t.N;if(e)return Sa(e,n);var r=t.site;return r.y===n?r.x:1/0}function qa(t){this.site=t,this.edges=[]}function Ta(t,n){return n.angle-t.angle}function za(){Ia(this),this.x=this.y=this.arc=this.site=this.cy=null}function Ea(t){var n=t.P,e=t.N;if(n&&e){var r=n.site,a=t.site,i=e.site;if(r!==i){var o=a.x,s=a.y,l=r.x-o,u=r.y-s,c=i.x-o,h=2*(l*(v=i.y-s)-u*c);if(!(h>=-St)){var f=l*l+u*u,p=c*c+v*v,d=(v*f-u*p)/h,g=(l*p-c*f)/h,v=g+s,M=ma.pop()||new za;M.arc=t,M.site=a,M.x=d+o,M.y=v+Math.sqrt(d*d+g*g),M.cy=v,t.circle=M;for(var m=null,y=va._;y;)if(M.y<y.y||M.y===y.y&&M.x<=y.x){if(!y.L){m=y.P;break}y=y.L}else{if(!y.R){m=y;break}y=y.R}va.insert(m,M),m||(ga=M)}}}}function Aa(t){var n=t.circle;n&&(n.P||(ga=n.N),va.remove(n),ma.push(n),Ia(n),t.circle=null)}function Na(t,n){var e=t.b;if(e)return!0;var r,a,i=t.a,o=n[0][0],s=n[1][0],l=n[0][1],u=n[1][1],c=t.l,h=t.r,f=c.x,p=c.y,d=h.x,g=h.y,v=(f+d)/2;if(g===p){if(v<o||v>=s)return;if(f>d){if(i){if(i.y>=u)return}else i={x:v,y:l};e={x:v,y:u}}else{if(i){if(i.y<l)return}else i={x:v,y:u};e={x:v,y:l}}}else if(a=(p+g)/2-(r=(f-d)/(g-p))*v,r<-1||r>1)if(f>d){if(i){if(i.y>=u)return}else i={x:(l-a)/r,y:l};e={x:(u-a)/r,y:u}}else{if(i){if(i.y<l)return}else i={x:(u-a)/r,y:u};e={x:(l-a)/r,y:l}}else if(p<g){if(i){if(i.x>=s)return}else i={x:o,y:r*o+a};e={x:s,y:r*s+a}}else{if(i){if(i.x<o)return}else i={x:s,y:r*s+a};e={x:o,y:r*o+a}}return t.a=i,t.b=e,!0}function ja(t,n){this.l=t,this.r=n,this.a=this.b=null}function La(t,n,e,r){var a=new ja(t,n);return fa.push(a),e&&Pa(a,t,n,e),r&&Pa(a,n,t,r),pa[t.i].edges.push(new Ca(a,t,n)),pa[n.i].edges.push(new Ca(a,n,t)),a}function Pa(t,n,e,r){t.a||t.b?t.l===e?t.b=r:t.a=r:(t.a=r,t.l=n,t.r=e)}function Ca(t,n,e){var r=t.a,a=t.b;this.edge=t,this.site=n,this.angle=e?Math.atan2(e.y-n.y,e.x-n.x):t.l===n?Math.atan2(a.x-r.x,r.y-a.y):Math.atan2(r.x-a.x,a.y-r.y)}function Da(){this._=null}function Ia(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Ra(t,n){var e=n,r=n.R,a=e.U;a?a.L===e?a.L=r:a.R=r:t._=r,r.U=a,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function Fa(t,n){var e=n,r=n.L,a=e.U;a?a.L===e?a.L=r:a.R=r:t._=r,r.U=a,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function Oa(t){for(;t.L;)t=t.L;return t}function Ua(t,n){var e,r,a,i=t.sort(Ha).pop();for(fa=[],pa=new Array(t.length),da=new Da,va=new Da;;)if(a=ga,i&&(!a||i.y<a.y||i.y===a.y&&i.x<a.x))i.x===e&&i.y===r||(pa[i.i]=new qa(i),ka(i),e=i.x,r=i.y),i=t.pop();else{if(!a)break;xa(a.arc)}n&&(function(t){for(var n,e=fa,r=ar(t[0][0],t[0][1],t[1][0],t[1][1]),a=e.length;a--;)(!Na(n=e[a],t)||!r(n)||M(n.a.x-n.b.x)<kt&&M(n.a.y-n.b.y)<kt)&&(n.a=n.b=null,e.splice(a,1))}(n),function(t){for(var n,e,r,a,i,o,s,l,u,c,h=t[0][0],f=t[1][0],p=t[0][1],d=t[1][1],g=pa,v=g.length;v--;)if((i=g[v])&&i.prepare())for(l=(s=i.edges).length,o=0;o<l;)r=(c=s[o].end()).x,a=c.y,e=(u=s[++o%l].start()).y,(M(r-(n=u.x))>kt||M(a-e)>kt)&&(s.splice(o,0,new Ca((m=i.site,y=c,b=M(r-h)<kt&&d-a>kt?{x:h,y:M(n-h)<kt?e:d}:M(a-d)<kt&&f-r>kt?{x:M(e-d)<kt?n:f,y:d}:M(r-f)<kt&&a-p>kt?{x:f,y:M(n-f)<kt?e:p}:M(a-p)<kt&&r-h>kt?{x:M(e-p)<kt?n:h,y:p}:null,w=void 0,(w=new ja(m,null)).a=y,w.b=b,fa.push(w),w),i.site,null)),++l);var m,y,b,w}(n));var o={cells:pa,edges:fa};return da=va=fa=pa=null,o}function Ha(t,n){return n.y-t.y||n.x-t.x}qa.prototype.prepare=function(){for(var t,n=this.edges,e=n.length;e--;)(t=n[e].edge).b&&t.a||n.splice(e,1);return n.sort(Ta),n.length},Ca.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Da.prototype={insert:function(t,n){var e,r,a;if(t){if(n.P=t,n.N=t.N,t.N&&(t.N.P=n),t.N=n,t.R){for(t=t.R;t.L;)t=t.L;t.L=n}else t.R=n;e=t}else this._?(t=Oa(this._),n.P=null,n.N=t,t.P=t.L=n,e=t):(n.P=n.N=null,this._=n,e=null);for(n.L=n.R=null,n.U=e,n.C=!0,t=n;e&&e.C;)e===(r=e.U).L?(a=r.R)&&a.C?(e.C=a.C=!1,r.C=!0,t=r):(t===e.R&&(Ra(this,e),e=(t=e).U),e.C=!1,r.C=!0,Fa(this,r)):(a=r.L)&&a.C?(e.C=a.C=!1,r.C=!0,t=r):(t===e.L&&(Fa(this,e),e=(t=e).U),e.C=!1,r.C=!0,Ra(this,r)),e=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var n,e,r,a=t.U,i=t.L,o=t.R;if(e=i?o?Oa(o):i:o,a?a.L===t?a.L=e:a.R=e:this._=e,i&&o?(r=e.C,e.C=t.C,e.L=i,i.U=e,e!==o?(a=e.U,e.U=t.U,a.L=t=e.R,e.R=o,o.U=e):(e.U=a,a=e,t=e.R)):(r=t.C,t=e),t&&(t.U=a),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===a.L){if((n=a.R).C&&(n.C=!1,a.C=!0,Ra(this,a),n=a.R),n.L&&n.L.C||n.R&&n.R.C){n.R&&n.R.C||(n.L.C=!1,n.C=!0,Fa(this,n),n=a.R),n.C=a.C,a.C=n.R.C=!1,Ra(this,a),t=this._;break}}else if((n=a.L).C&&(n.C=!1,a.C=!0,Fa(this,a),n=a.L),n.L&&n.L.C||n.R&&n.R.C){n.L&&n.L.C||(n.R.C=!1,n.C=!0,Ra(this,n),n=a.L),n.C=a.C,a.C=n.L.C=!1,Fa(this,a),t=this._;break}n.C=!0,t=a,a=a.U}while(!t.C);t&&(t.C=!1)}}},t.geom.voronoi=function(t){var n=aa,e=ia,r=n,a=e,i=Ba;if(t)return o(t);function o(t){var n=new Array(t.length),e=i[0][0],r=i[0][1],a=i[1][0],o=i[1][1];return Ua(s(t),i).cells.forEach(function(i,s){var l=i.edges,u=i.site;(n[s]=l.length?l.map(function(t){var n=t.start();return[n.x,n.y]}):u.x>=e&&u.x<=a&&u.y>=r&&u.y<=o?[[e,o],[a,o],[a,r],[e,r]]:[]).point=t[s]}),n}function s(t){return t.map(function(t,n){return{x:Math.round(r(t,n)/kt)*kt,y:Math.round(a(t,n)/kt)*kt,i:n}})}return o.links=function(t){return Ua(s(t)).edges.filter(function(t){return t.l&&t.r}).map(function(n){return{source:t[n.l.i],target:t[n.r.i]}})},o.triangles=function(t){var n=[];return Ua(s(t)).cells.forEach(function(e,r){for(var a,i,o,s,l=e.site,u=e.edges.sort(Ta),c=-1,h=u.length,f=u[h-1].edge,p=f.l===l?f.r:f.l;++c<h;)a=p,p=(f=u[c].edge).l===l?f.r:f.l,r<a.i&&r<p.i&&((i=l).x-(s=p).x)*((o=a).y-i.y)-(i.x-o.x)*(s.y-i.y)<0&&n.push([t[r],t[a.i],t[p.i]])}),n},o.x=function(t){return arguments.length?(r=vn(n=t),o):n},o.y=function(t){return arguments.length?(a=vn(e=t),o):e},o.clipExtent=function(t){return arguments.length?(i=null==t?Ba:t,o):i===Ba?null:i},o.size=function(t){return arguments.length?o.clipExtent(t&&[[0,0],t]):i===Ba?null:i&&i[1]},o};var Ba=[[-1e6,-1e6],[1e6,1e6]];function Qa(t){return t.x}function Va(t){return t.y}function Ga(t,n,e,r,a,i){if(!t(n,e,r,a,i)){var o=.5*(e+a),s=.5*(r+i),l=n.nodes;l[0]&&Ga(t,l[0],e,r,o,s),l[1]&&Ga(t,l[1],o,r,a,s),l[2]&&Ga(t,l[2],e,s,o,i),l[3]&&Ga(t,l[3],o,s,a,i)}}function Ya(t,n,e,r,a,i,o){var s,l=1/0;return function t(u,c,h,f,p){if(!(c>i||h>o||f<r||p<a)){if(d=u.point){var d,g=n-u.x,v=e-u.y,M=g*g+v*v;if(M<l){var m=Math.sqrt(l=M);r=n-m,a=e-m,i=n+m,o=e+m,s=d}}for(var y=u.nodes,b=.5*(c+f),w=.5*(h+p),x=(e>=w)<<1|n>=b,k=x+4;x<k;++x)if(u=y[3&x])switch(3&x){case 0:t(u,c,h,b,w);break;case 1:t(u,b,h,f,w);break;case 2:t(u,c,w,b,p);break;case 3:t(u,b,w,f,p)}}}(t,r,a,i,o),s}function Wa(n,e){n=t.rgb(n),e=t.rgb(e);var r=n.r,a=n.g,i=n.b,o=e.r-r,s=e.g-a,l=e.b-i;return function(t){return\"#\"+un(Math.round(r+o*t))+un(Math.round(a+s*t))+un(Math.round(i+l*t))}}function $a(t,n){var e,r={},a={};for(e in t)e in n?r[e]=ti(t[e],n[e]):a[e]=t[e];for(e in n)e in t||(a[e]=n[e]);return function(t){for(e in r)a[e]=r[e](t);return a}}function Za(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}function Xa(t,n){var e,r,a,i=Ja.lastIndex=Ka.lastIndex=0,o=-1,s=[],l=[];for(t+=\"\",n+=\"\";(e=Ja.exec(t))&&(r=Ka.exec(n));)(a=r.index)>i&&(a=n.slice(i,a),s[o]?s[o]+=a:s[++o]=a),(e=e[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:Za(e,r)})),i=Ka.lastIndex;return i<n.length&&(a=n.slice(i),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?(n=l[0].x,function(t){return n(t)+\"\"}):function(){return n}:(n=l.length,function(t){for(var e,r=0;r<n;++r)s[(e=l[r]).i]=e.x(t);return s.join(\"\")})}t.geom.delaunay=function(n){return t.geom.voronoi().triangles(n)},t.geom.quadtree=function(t,n,e,r,a){var i,o=aa,s=ia;if(i=arguments.length)return o=Qa,s=Va,3===i&&(a=e,r=n,e=n=0),l(t);function l(t){var l,u,c,h,f,p,d,g,v,m=vn(o),y=vn(s);if(null!=n)p=n,d=e,g=r,v=a;else if(g=v=-(p=d=1/0),u=[],c=[],f=t.length,i)for(h=0;h<f;++h)(l=t[h]).x<p&&(p=l.x),l.y<d&&(d=l.y),l.x>g&&(g=l.x),l.y>v&&(v=l.y),u.push(l.x),c.push(l.y);else for(h=0;h<f;++h){var b=+m(l=t[h],h),w=+y(l,h);b<p&&(p=b),w<d&&(d=w),b>g&&(g=b),w>v&&(v=w),u.push(b),c.push(w)}var x=g-p,k=v-d;function S(t,n,e,r,a,i,o,s){if(!isNaN(e)&&!isNaN(r))if(t.leaf){var l=t.x,u=t.y;if(null!=l)if(M(l-e)+M(u-r)<.01)_(t,n,e,r,a,i,o,s);else{var c=t.point;t.x=t.y=t.point=null,_(t,c,l,u,a,i,o,s),_(t,n,e,r,a,i,o,s)}else t.x=e,t.y=r,t.point=n}else _(t,n,e,r,a,i,o,s)}function _(t,n,e,r,a,i,o,s){var l=.5*(a+o),u=.5*(i+s),c=e>=l,h=r>=u,f=h<<1|c;t.leaf=!1,c?a=l:o=l,h?i=u:s=u,S(t=t.nodes[f]||(t.nodes[f]={leaf:!0,nodes:[],point:null,x:null,y:null}),n,e,r,a,i,o,s)}x>k?v=d+x:g=p+k;var q={leaf:!0,nodes:[],point:null,x:null,y:null,add:function(t){S(q,t,+m(t,++h),+y(t,h),p,d,g,v)},visit:function(t){Ga(t,q,p,d,g,v)},find:function(t){return Ya(q,t[0],t[1],p,d,g,v)}};if(h=-1,null==n){for(;++h<f;)S(q,t[h],u[h],c[h],p,d,g,v);--h}else t.forEach(q.add);return u=c=t=l=null,q}return l.x=function(t){return arguments.length?(o=t,l):o},l.y=function(t){return arguments.length?(s=t,l):s},l.extent=function(t){return arguments.length?(null==t?n=e=r=a=null:(n=+t[0][0],e=+t[0][1],r=+t[1][0],a=+t[1][1]),l):null==n?null:[[n,e],[r,a]]},l.size=function(t){return arguments.length?(null==t?n=e=r=a=null:(n=e=0,r=+t[0],a=+t[1]),l):null==n?null:[r-n,a-e]},l},t.interpolateRgb=Wa,t.interpolateObject=$a,t.interpolateNumber=Za,t.interpolateString=Xa;var Ja=/[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,Ka=new RegExp(Ja.source,\"g\");function ti(n,e){for(var r,a=t.interpolators.length;--a>=0&&!(r=t.interpolators[a](n,e)););return r}function ni(t,n){var e,r=[],a=[],i=t.length,o=n.length,s=Math.min(t.length,n.length);for(e=0;e<s;++e)r.push(ti(t[e],n[e]));for(;e<i;++e)a[e]=t[e];for(;e<o;++e)a[e]=n[e];return function(t){for(e=0;e<s;++e)a[e]=r[e](t);return a}}t.interpolate=ti,t.interpolators=[function(t,n){var e=typeof n;return(\"string\"===e?gn.has(n.toLowerCase())||/^(#|rgb\\(|hsl\\()/i.test(n)?Wa:Xa:n instanceof Ut?Wa:Array.isArray(n)?ni:\"object\"===e&&isNaN(n)?$a:Za)(t,n)}],t.interpolateArray=ni;var ei=function(){return E},ri=t.map({linear:ei,poly:function(t){return function(n){return Math.pow(n,t)}},quad:function(){return li},cubic:function(){return ui},sin:function(){return hi},exp:function(){return fi},circle:function(){return pi},elastic:function(t,n){var e;return arguments.length<2&&(n=.45),arguments.length?e=n/qt*Math.asin(1/t):(t=1,e=n/4),function(r){return 1+t*Math.pow(2,-10*r)*Math.sin((r-e)*qt/n)}},back:function(t){return t||(t=1.70158),function(n){return n*n*((t+1)*n-t)}},bounce:function(){return di}}),ai=t.map({in:E,out:oi,\"in-out\":si,\"out-in\":function(t){return si(oi(t))}});function ii(t){return function(n){return n<=0?0:n>=1?1:t(n)}}function oi(t){return function(n){return 1-t(1-n)}}function si(t){return function(n){return.5*(n<.5?t(2*n):2-t(2-2*n))}}function li(t){return t*t}function ui(t){return t*t*t}function ci(t){if(t<=0)return 0;if(t>=1)return 1;var n=t*t,e=n*t;return 4*(t<.5?e:3*(t-n)+e-.75)}function hi(t){return 1-Math.cos(t*zt)}function fi(t){return Math.pow(2,10*(t-1))}function pi(t){return 1-Math.sqrt(1-t*t)}function di(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function gi(t,n){return n-=t,function(e){return Math.round(t+n*e)}}function vi(t){var n,e,r,a=[t.a,t.b],i=[t.c,t.d],o=mi(a),s=Mi(a,i),l=mi(((n=i)[0]+=(r=-s)*(e=a)[0],n[1]+=r*e[1],n))||0;a[0]*i[1]<i[0]*a[1]&&(a[0]*=-1,a[1]*=-1,o*=-1,s*=-1),this.rotate=(o?Math.atan2(a[1],a[0]):Math.atan2(-i[0],i[1]))*At,this.translate=[t.e,t.f],this.scale=[o,l],this.skew=l?Math.atan2(s,l)*At:0}function Mi(t,n){return t[0]*n[0]+t[1]*n[1]}function mi(t){var n=Math.sqrt(Mi(t,t));return n&&(t[0]/=n,t[1]/=n),n}t.ease=function(t){var e=t.indexOf(\"-\"),r=e>=0?t.slice(0,e):t,a=e>=0?t.slice(e+1):\"in\";return r=ri.get(r)||ei,ii((a=ai.get(a)||E)(r.apply(null,n.call(arguments,1))))},t.interpolateHcl=function(n,e){n=t.hcl(n),e=t.hcl(e);var r=n.h,a=n.c,i=n.l,o=e.h-r,s=e.c-a,l=e.l-i;return isNaN(s)&&(s=0,a=isNaN(a)?e.c:a),isNaN(o)?(o=0,r=isNaN(r)?e.h:r):o>180?o-=360:o<-180&&(o+=360),function(t){return Yt(r+o*t,a+s*t,i+l*t)+\"\"}},t.interpolateHsl=function(n,e){n=t.hsl(n),e=t.hsl(e);var r=n.h,a=n.s,i=n.l,o=e.h-r,s=e.s-a,l=e.l-i;return isNaN(s)&&(s=0,a=isNaN(a)?e.s:a),isNaN(o)?(o=0,r=isNaN(r)?e.h:r):o>180?o-=360:o<-180&&(o+=360),function(t){return Qt(r+o*t,a+s*t,i+l*t)+\"\"}},t.interpolateLab=function(n,e){n=t.lab(n),e=t.lab(e);var r=n.l,a=n.a,i=n.b,o=e.l-r,s=e.a-a,l=e.b-i;return function(t){return Kt(r+o*t,a+s*t,i+l*t)+\"\"}},t.interpolateRound=gi,t.transform=function(n){var e=r.createElementNS(t.ns.prefix.svg,\"g\");return(t.transform=function(t){if(null!=t){e.setAttribute(\"transform\",t);var n=e.transform.baseVal.consolidate()}return new vi(n?n.matrix:yi)})(n)},vi.prototype.toString=function(){return\"translate(\"+this.translate+\")rotate(\"+this.rotate+\")skewX(\"+this.skew+\")scale(\"+this.scale+\")\"};var yi={a:1,b:0,c:0,d:1,e:0,f:0};function bi(t){return t.length?t.pop()+\",\":\"\"}function wi(n,e){var r=[],a=[];return n=t.transform(n),e=t.transform(e),function(t,n,e,r){if(t[0]!==n[0]||t[1]!==n[1]){var a=e.push(\"translate(\",null,\",\",null,\")\");r.push({i:a-4,x:Za(t[0],n[0])},{i:a-2,x:Za(t[1],n[1])})}else(n[0]||n[1])&&e.push(\"translate(\"+n+\")\")}(n.translate,e.translate,r,a),function(t,n,e,r){t!==n?(t-n>180?n+=360:n-t>180&&(t+=360),r.push({i:e.push(bi(e)+\"rotate(\",null,\")\")-2,x:Za(t,n)})):n&&e.push(bi(e)+\"rotate(\"+n+\")\")}(n.rotate,e.rotate,r,a),function(t,n,e,r){t!==n?r.push({i:e.push(bi(e)+\"skewX(\",null,\")\")-2,x:Za(t,n)}):n&&e.push(bi(e)+\"skewX(\"+n+\")\")}(n.skew,e.skew,r,a),function(t,n,e,r){if(t[0]!==n[0]||t[1]!==n[1]){var a=e.push(bi(e)+\"scale(\",null,\",\",null,\")\");r.push({i:a-4,x:Za(t[0],n[0])},{i:a-2,x:Za(t[1],n[1])})}else 1===n[0]&&1===n[1]||e.push(bi(e)+\"scale(\"+n+\")\")}(n.scale,e.scale,r,a),n=e=null,function(t){for(var n,e=-1,i=a.length;++e<i;)r[(n=a[e]).i]=n.x(t);return r.join(\"\")}}function xi(t,n){return n=(n-=t=+t)||1/n,function(e){return(e-t)/n}}function ki(t,n){return n=(n-=t=+t)||1/n,function(e){return Math.max(0,Math.min(1,(e-t)/n))}}function Si(t){for(var n=t.source,e=t.target,r=function(t,n){if(t===n)return t;for(var e=_i(t),r=_i(n),a=e.pop(),i=r.pop(),o=null;a===i;)o=a,a=e.pop(),i=r.pop();return o}(n,e),a=[n];n!==r;)a.push(n=n.parent);for(var i=a.length;e!==r;)a.splice(i,0,e),e=e.parent;return a}function _i(t){for(var n=[],e=t.parent;null!=e;)n.push(t),t=e,e=e.parent;return n.push(t),n}function qi(t){t.fixed|=2}function Ti(t){t.fixed&=-7}function zi(t){t.fixed|=4,t.px=t.x,t.py=t.y}function Ei(t){t.fixed&=-5}function Ai(t,n,e){var r=0,a=0;if(t.charge=0,!t.leaf)for(var i,o=t.nodes,s=o.length,l=-1;++l<s;)null!=(i=o[l])&&(Ai(i,n,e),t.charge+=i.charge,r+=i.charge*i.cx,a+=i.charge*i.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var u=n*e[t.point.index];t.charge+=t.pointCharge=u,r+=u*t.point.x,a+=u*t.point.y}t.cx=r/t.charge,t.cy=a/t.charge}t.interpolateTransform=wi,t.layout={},t.layout.bundle=function(){return function(t){for(var n=[],e=-1,r=t.length;++e<r;)n.push(Si(t[e]));return n}},t.layout.chord=function(){var n,e,r,a,i,o,s,l={},u=0;function c(){var l,c,f,p,d,g={},v=[],M=t.range(a),m=[];for(n=[],e=[],l=0,p=-1;++p<a;){for(c=0,d=-1;++d<a;)c+=r[p][d];v.push(c),m.push(t.range(a)),l+=c}for(i&&M.sort(function(t,n){return i(v[t],v[n])}),o&&m.forEach(function(t,n){t.sort(function(t,e){return o(r[n][t],r[n][e])})}),l=(qt-u*a)/l,c=0,p=-1;++p<a;){for(f=c,d=-1;++d<a;){var y=M[p],b=m[y][d],w=r[y][b],x=c,k=c+=w*l;g[y+\"-\"+b]={index:y,subindex:b,startAngle:x,endAngle:k,value:w}}e[y]={index:y,startAngle:f,endAngle:c,value:v[y]},c+=u}for(p=-1;++p<a;)for(d=p-1;++d<a;){var S=g[p+\"-\"+d],_=g[d+\"-\"+p];(S.value||_.value)&&n.push(S.value<_.value?{source:_,target:S}:{source:S,target:_})}s&&h()}function h(){n.sort(function(t,n){return s((t.source.value+t.target.value)/2,(n.source.value+n.target.value)/2)})}return l.matrix=function(t){return arguments.length?(a=(r=t)&&r.length,n=e=null,l):r},l.padding=function(t){return arguments.length?(u=t,n=e=null,l):u},l.sortGroups=function(t){return arguments.length?(i=t,n=e=null,l):i},l.sortSubgroups=function(t){return arguments.length?(o=t,n=null,l):o},l.sortChords=function(t){return arguments.length?(s=t,n&&h(),l):s},l.chords=function(){return n||c(),n},l.groups=function(){return e||c(),e},l},t.layout.force=function(){var n,e,r,a,i,o,s={},l=t.dispatch(\"start\",\"tick\",\"end\"),u=[1,1],c=.9,h=Ni,f=ji,p=-30,d=Li,g=.1,v=.64,M=[],m=[];function y(t){return function(n,e,r,a){if(n.point!==t){var i,o=n.cx-t.x,s=n.cy-t.y,l=a-e,u=o*o+s*s;if(l*l/v<u)return u<d&&(t.px-=o*(i=n.charge/u),t.py-=s*i),!0;n.point&&u&&u<d&&(t.px-=o*(i=n.pointCharge/u),t.py-=s*i)}return!n.charge}}function b(n){n.px=t.event.x,n.py=t.event.y,s.resume()}return s.tick=function(){if((r*=.99)<.005)return n=null,l.end({type:\"end\",alpha:r=0}),!0;var e,s,h,f,d,v,b,w,x,k=M.length,S=m.length;for(s=0;s<S;++s)(v=(w=(d=(h=m[s]).target).x-(f=h.source).x)*w+(x=d.y-f.y)*x)&&(x*=v=r*i[s]*((v=Math.sqrt(v))-a[s])/v,d.x-=(w*=v)*(b=f.weight+d.weight?f.weight/(f.weight+d.weight):.5),d.y-=x*b,f.x+=w*(b=1-b),f.y+=x*b);if((b=r*g)&&(w=u[0]/2,x=u[1]/2,s=-1,b))for(;++s<k;)(h=M[s]).x+=(w-h.x)*b,h.y+=(x-h.y)*b;if(p)for(Ai(e=t.geom.quadtree(M),r,o),s=-1;++s<k;)(h=M[s]).fixed||e.visit(y(h));for(s=-1;++s<k;)(h=M[s]).fixed?(h.x=h.px,h.y=h.py):(h.x-=(h.px-(h.px=h.x))*c,h.y-=(h.py-(h.py=h.y))*c);l.tick({type:\"tick\",alpha:r})},s.nodes=function(t){return arguments.length?(M=t,s):M},s.links=function(t){return arguments.length?(m=t,s):m},s.size=function(t){return arguments.length?(u=t,s):u},s.linkDistance=function(t){return arguments.length?(h=\"function\"==typeof t?t:+t,s):h},s.distance=s.linkDistance,s.linkStrength=function(t){return arguments.length?(f=\"function\"==typeof t?t:+t,s):f},s.friction=function(t){return arguments.length?(c=+t,s):c},s.charge=function(t){return arguments.length?(p=\"function\"==typeof t?t:+t,s):p},s.chargeDistance=function(t){return arguments.length?(d=t*t,s):Math.sqrt(d)},s.gravity=function(t){return arguments.length?(g=+t,s):g},s.theta=function(t){return arguments.length?(v=t*t,s):Math.sqrt(v)},s.alpha=function(t){return arguments.length?(t=+t,r?t>0?r=t:(n.c=null,n.t=NaN,n=null,l.end({type:\"end\",alpha:r=0})):t>0&&(l.start({type:\"start\",alpha:r=t}),n=Sn(s.tick)),s):r},s.start=function(){var t,n,e,r=M.length,l=m.length,c=u[0],d=u[1];for(t=0;t<r;++t)(e=M[t]).index=t,e.weight=0;for(t=0;t<l;++t)\"number\"==typeof(e=m[t]).source&&(e.source=M[e.source]),\"number\"==typeof e.target&&(e.target=M[e.target]),++e.source.weight,++e.target.weight;for(t=0;t<r;++t)e=M[t],isNaN(e.x)&&(e.x=g(\"x\",c)),isNaN(e.y)&&(e.y=g(\"y\",d)),isNaN(e.px)&&(e.px=e.x),isNaN(e.py)&&(e.py=e.y);if(a=[],\"function\"==typeof h)for(t=0;t<l;++t)a[t]=+h.call(this,m[t],t);else for(t=0;t<l;++t)a[t]=h;if(i=[],\"function\"==typeof f)for(t=0;t<l;++t)i[t]=+f.call(this,m[t],t);else for(t=0;t<l;++t)i[t]=f;if(o=[],\"function\"==typeof p)for(t=0;t<r;++t)o[t]=+p.call(this,M[t],t);else for(t=0;t<r;++t)o[t]=p;function g(e,a){if(!n){for(n=new Array(r),u=0;u<r;++u)n[u]=[];for(u=0;u<l;++u){var i=m[u];n[i.source.index].push(i.target),n[i.target.index].push(i.source)}}for(var o,s=n[t],u=-1,c=s.length;++u<c;)if(!isNaN(o=s[u][e]))return o;return Math.random()*a}return s.resume()},s.resume=function(){return s.alpha(.1)},s.stop=function(){return s.alpha(0)},s.drag=function(){if(e||(e=t.behavior.drag().origin(E).on(\"dragstart.force\",qi).on(\"drag.force\",b).on(\"dragend.force\",Ti)),!arguments.length)return e;this.on(\"mouseover.force\",zi).on(\"mouseout.force\",Ei).call(e)},t.rebind(s,l,\"on\")};var Ni=20,ji=1,Li=1/0;function Pi(n,e){return t.rebind(n,e,\"sort\",\"children\",\"value\"),n.nodes=n,n.links=Oi,n}function Ci(t,n){for(var e=[t];null!=(t=e.pop());)if(n(t),(a=t.children)&&(r=a.length))for(var r,a;--r>=0;)e.push(a[r])}function Di(t,n){for(var e=[t],r=[];null!=(t=e.pop());)if(r.push(t),(i=t.children)&&(a=i.length))for(var a,i,o=-1;++o<a;)e.push(i[o]);for(;null!=(t=r.pop());)n(t)}function Ii(t){return t.children}function Ri(t){return t.value}function Fi(t,n){return n.value-t.value}function Oi(n){return t.merge(n.map(function(t){return(t.children||[]).map(function(n){return{source:t,target:n}})}))}t.layout.hierarchy=function(){var t=Fi,n=Ii,e=Ri;function r(a){var i,o=[a],s=[];for(a.depth=0;null!=(i=o.pop());)if(s.push(i),(u=n.call(r,i,i.depth))&&(l=u.length)){for(var l,u,c;--l>=0;)o.push(c=u[l]),c.parent=i,c.depth=i.depth+1;e&&(i.value=0),i.children=u}else e&&(i.value=+e.call(r,i,i.depth)||0),delete i.children;return Di(a,function(n){var r,a;t&&(r=n.children)&&r.sort(t),e&&(a=n.parent)&&(a.value+=n.value)}),s}return r.sort=function(n){return arguments.length?(t=n,r):t},r.children=function(t){return arguments.length?(n=t,r):n},r.value=function(t){return arguments.length?(e=t,r):e},r.revalue=function(t){return e&&(Ci(t,function(t){t.children&&(t.value=0)}),Di(t,function(t){var n;t.children||(t.value=+e.call(r,t,t.depth)||0),(n=t.parent)&&(n.value+=t.value)})),t},r},t.layout.partition=function(){var n=t.layout.hierarchy(),e=[1,1];function r(t,n,e,a){var i=t.children;if(t.x=n,t.y=t.depth*a,t.dx=e,t.dy=a,i&&(o=i.length)){var o,s,l,u=-1;for(e=t.value?e/t.value:0;++u<o;)r(s=i[u],n,l=s.value*e,a),n+=l}}function a(t){var n=t.children,e=0;if(n&&(r=n.length))for(var r,i=-1;++i<r;)e=Math.max(e,a(n[i]));return 1+e}function i(t,i){var o=n.call(this,t,i);return r(o[0],0,e[0],e[1]/a(o[0])),o}return i.size=function(t){return arguments.length?(e=t,i):e},Pi(i,n)},t.layout.pie=function(){var n=Number,e=Ui,r=0,a=qt,i=0;function o(s){var l,u=s.length,c=s.map(function(t,e){return+n.call(o,t,e)}),h=+(\"function\"==typeof r?r.apply(this,arguments):r),f=(\"function\"==typeof a?a.apply(this,arguments):a)-h,p=Math.min(Math.abs(f)/u,+(\"function\"==typeof i?i.apply(this,arguments):i)),d=p*(f<0?-1:1),g=t.sum(c),v=g?(f-u*d)/g:0,M=t.range(u),m=[];return null!=e&&M.sort(e===Ui?function(t,n){return c[n]-c[t]}:function(t,n){return e(s[t],s[n])}),M.forEach(function(t){m[t]={data:s[t],value:l=c[t],startAngle:h,endAngle:h+=l*v+d,padAngle:p}}),m}return o.value=function(t){return arguments.length?(n=t,o):n},o.sort=function(t){return arguments.length?(e=t,o):e},o.startAngle=function(t){return arguments.length?(r=t,o):r},o.endAngle=function(t){return arguments.length?(a=t,o):a},o.padAngle=function(t){return arguments.length?(i=t,o):i},o};var Ui={};function Hi(t){return t.x}function Bi(t){return t.y}function Qi(t,n,e){t.y0=n,t.y=e}t.layout.stack=function(){var n=E,e=Yi,r=Wi,a=Qi,i=Hi,o=Bi;function s(l,u){if(!(p=l.length))return l;var c=l.map(function(t,e){return n.call(s,t,e)}),h=c.map(function(t){return t.map(function(t,n){return[i.call(s,t,n),o.call(s,t,n)]})}),f=e.call(s,h,u);c=t.permute(c,f),h=t.permute(h,f);var p,d,g,v,M=r.call(s,h,u),m=c[0].length;for(g=0;g<m;++g)for(a.call(s,c[0][g],v=M[g],h[0][g][1]),d=1;d<p;++d)a.call(s,c[d][g],v+=h[d-1][g][1],h[d][g][1]);return l}return s.values=function(t){return arguments.length?(n=t,s):n},s.order=function(t){return arguments.length?(e=\"function\"==typeof t?t:Vi.get(t)||Yi,s):e},s.offset=function(t){return arguments.length?(r=\"function\"==typeof t?t:Gi.get(t)||Wi,s):r},s.x=function(t){return arguments.length?(i=t,s):i},s.y=function(t){return arguments.length?(o=t,s):o},s.out=function(t){return arguments.length?(a=t,s):a},s};var Vi=t.map({\"inside-out\":function(n){var e,r,a=n.length,i=n.map($i),o=n.map(Zi),s=t.range(a).sort(function(t,n){return i[t]-i[n]}),l=0,u=0,c=[],h=[];for(e=0;e<a;++e)r=s[e],l<u?(l+=o[r],c.push(r)):(u+=o[r],h.push(r));return h.reverse().concat(c)},reverse:function(n){return t.range(n.length).reverse()},default:Yi}),Gi=t.map({silhouette:function(t){var n,e,r,a=t.length,i=t[0].length,o=[],s=0,l=[];for(e=0;e<i;++e){for(n=0,r=0;n<a;n++)r+=t[n][e][1];r>s&&(s=r),o.push(r)}for(e=0;e<i;++e)l[e]=(s-o[e])/2;return l},wiggle:function(t){var n,e,r,a,i,o,s,l,u,c=t.length,h=t[0],f=h.length,p=[];for(p[0]=l=u=0,e=1;e<f;++e){for(n=0,a=0;n<c;++n)a+=t[n][e][1];for(n=0,i=0,s=h[e][0]-h[e-1][0];n<c;++n){for(r=0,o=(t[n][e][1]-t[n][e-1][1])/(2*s);r<n;++r)o+=(t[r][e][1]-t[r][e-1][1])/s;i+=o*t[n][e][1]}p[e]=l-=a?i/a*s:0,l<u&&(u=l)}for(e=0;e<f;++e)p[e]-=u;return p},expand:function(t){var n,e,r,a=t.length,i=t[0].length,o=1/a,s=[];for(e=0;e<i;++e){for(n=0,r=0;n<a;n++)r+=t[n][e][1];if(r)for(n=0;n<a;n++)t[n][e][1]/=r;else for(n=0;n<a;n++)t[n][e][1]=o}for(e=0;e<i;++e)s[e]=0;return s},zero:Wi});function Yi(n){return t.range(n.length)}function Wi(t){for(var n=-1,e=t[0].length,r=[];++n<e;)r[n]=0;return r}function $i(t){for(var n,e=1,r=0,a=t[0][1],i=t.length;e<i;++e)(n=t[e][1])>a&&(r=e,a=n);return r}function Zi(t){return t.reduce(Xi,0)}function Xi(t,n){return t+n[1]}function Ji(t,n){return Ki(t,Math.ceil(Math.log(n.length)/Math.LN2+1))}function Ki(t,n){for(var e=-1,r=+t[0],a=(t[1]-r)/n,i=[];++e<=n;)i[e]=a*e+r;return i}function to(n){return[t.min(n),t.max(n)]}function no(t,n){return t.value-n.value}function eo(t,n){var e=t._pack_next;t._pack_next=n,n._pack_prev=t,n._pack_next=e,e._pack_prev=n}function ro(t,n){t._pack_next=n,n._pack_prev=t}function ao(t,n){var e=n.x-t.x,r=n.y-t.y,a=t.r+n.r;return.999*a*a>e*e+r*r}function io(t){if((n=t.children)&&(l=n.length)){var n,e,r,a,i,o,s,l,u=1/0,c=-1/0,h=1/0,f=-1/0;if(n.forEach(oo),(e=n[0]).x=-e.r,e.y=0,y(e),l>1&&((r=n[1]).x=r.r,r.y=0,y(r),l>2))for(uo(e,r,a=n[2]),y(a),eo(e,a),e._pack_prev=a,eo(a,r),r=e._pack_next,i=3;i<l;i++){uo(e,r,a=n[i]);var p=0,d=1,g=1;for(o=r._pack_next;o!==r;o=o._pack_next,d++)if(ao(o,a)){p=1;break}if(1==p)for(s=e._pack_prev;s!==o._pack_prev&&!ao(s,a);s=s._pack_prev,g++);p?(d<g||d==g&&r.r<e.r?ro(e,r=o):ro(e=s,r),i--):(eo(e,a),r=a,y(a))}var v=(u+c)/2,M=(h+f)/2,m=0;for(i=0;i<l;i++)(a=n[i]).x-=v,a.y-=M,m=Math.max(m,a.r+Math.sqrt(a.x*a.x+a.y*a.y));t.r=m,n.forEach(so)}function y(t){u=Math.min(t.x-t.r,u),c=Math.max(t.x+t.r,c),h=Math.min(t.y-t.r,h),f=Math.max(t.y+t.r,f)}}function oo(t){t._pack_next=t._pack_prev=t}function so(t){delete t._pack_next,delete t._pack_prev}function lo(t,n,e,r){var a=t.children;if(t.x=n+=r*t.x,t.y=e+=r*t.y,t.r*=r,a)for(var i=-1,o=a.length;++i<o;)lo(a[i],n,e,r)}function uo(t,n,e){var r=t.r+e.r,a=n.x-t.x,i=n.y-t.y;if(r&&(a||i)){var o=n.r+e.r,s=a*a+i*i,l=.5+((r*=r)-(o*=o))/(2*s),u=Math.sqrt(Math.max(0,2*o*(r+s)-(r-=s)*r-o*o))/(2*s);e.x=t.x+l*a+u*i,e.y=t.y+l*i-u*a}else e.x=t.x+r,e.y=t.y}function co(t,n){return t.parent==n.parent?1:2}function ho(t){var n=t.children;return n.length?n[0]:t.t}function fo(t){var n,e=t.children;return(n=e.length)?e[n-1]:t.t}function po(t,n,e){var r=e/(n.i-t.i);n.c-=r,n.s+=e,t.c+=r,n.z+=e,n.m+=e}function go(t,n,e){return t.a.parent===n.parent?t.a:e}function vo(t){var n=t.children;return n&&n.length?vo(n[0]):t}function Mo(t){var n,e=t.children;return e&&(n=e.length)?Mo(e[n-1]):t}function mo(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function yo(t,n){var e=t.x+n[3],r=t.y+n[0],a=t.dx-n[1]-n[3],i=t.dy-n[0]-n[2];return a<0&&(e+=a/2,a=0),i<0&&(r+=i/2,i=0),{x:e,y:r,dx:a,dy:i}}function bo(t){var n=t[0],e=t[t.length-1];return n<e?[n,e]:[e,n]}function wo(t){return t.rangeExtent?t.rangeExtent():bo(t.range())}function xo(t,n,e,r){var a=e(t[0],t[1]),i=r(n[0],n[1]);return function(t){return i(a(t))}}function ko(t,n){var e,r=0,a=t.length-1,i=t[r],o=t[a];return o<i&&(e=r,r=a,a=e,e=i,i=o,o=e),t[r]=n.floor(i),t[a]=n.ceil(o),t}function So(t){return t?{floor:function(n){return Math.floor(n/t)*t},ceil:function(n){return Math.ceil(n/t)*t}}:_o}t.layout.histogram=function(){var n=!0,e=Number,r=to,a=Ji;function i(i,o){for(var s,l,u=[],c=i.map(e,this),h=r.call(this,c,o),f=a.call(this,h,c,o),p=(o=-1,c.length),d=f.length-1,g=n?1:1/p;++o<d;)(s=u[o]=[]).dx=f[o+1]-(s.x=f[o]),s.y=0;if(d>0)for(o=-1;++o<p;)(l=c[o])>=h[0]&&l<=h[1]&&((s=u[t.bisect(f,l,1,d)-1]).y+=g,s.push(i[o]));return u}return i.value=function(t){return arguments.length?(e=t,i):e},i.range=function(t){return arguments.length?(r=vn(t),i):r},i.bins=function(t){return arguments.length?(a=\"number\"==typeof t?function(n){return Ki(n,t)}:vn(t),i):a},i.frequency=function(t){return arguments.length?(n=!!t,i):n},i},t.layout.pack=function(){var n,e=t.layout.hierarchy().sort(no),r=0,a=[1,1];function i(t,i){var o=e.call(this,t,i),s=o[0],l=a[0],u=a[1],c=null==n?Math.sqrt:\"function\"==typeof n?n:function(){return n};if(s.x=s.y=0,Di(s,function(t){t.r=+c(t.value)}),Di(s,io),r){var h=r*(n?1:Math.max(2*s.r/l,2*s.r/u))/2;Di(s,function(t){t.r+=h}),Di(s,io),Di(s,function(t){t.r-=h})}return lo(s,l/2,u/2,n?1:1/Math.max(2*s.r/l,2*s.r/u)),o}return i.size=function(t){return arguments.length?(a=t,i):a},i.radius=function(t){return arguments.length?(n=null==t||\"function\"==typeof t?t:+t,i):n},i.padding=function(t){return arguments.length?(r=+t,i):r},Pi(i,e)},t.layout.tree=function(){var n=t.layout.hierarchy().sort(null).value(null),e=co,r=[1,1],a=null;function i(t,i){var u=n.call(this,t,i),c=u[0],h=function(t){for(var n,e={A:null,children:[t]},r=[e];null!=(n=r.pop());)for(var a,i=n.children,o=0,s=i.length;o<s;++o)r.push((i[o]=a={_:i[o],parent:n,children:(a=i[o].children)&&a.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=a);return e.children[0]}(c);if(Di(h,o),h.parent.m=-h.z,Ci(h,s),a)Ci(c,l);else{var f=c,p=c,d=c;Ci(c,function(t){t.x<f.x&&(f=t),t.x>p.x&&(p=t),t.depth>d.depth&&(d=t)});var g=e(f,p)/2-f.x,v=r[0]/(p.x+e(p,f)/2+g),M=r[1]/(d.depth||1);Ci(c,function(t){t.x=(t.x+g)*v,t.y=t.depth*M})}return u}function o(t){var n=t.children,r=t.parent.children,a=t.i?r[t.i-1]:null;if(n.length){!function(t){for(var n,e=0,r=0,a=t.children,i=a.length;--i>=0;)(n=a[i]).z+=e,n.m+=e,e+=n.s+(r+=n.c)}(t);var i=(n[0].z+n[n.length-1].z)/2;a?(t.z=a.z+e(t._,a._),t.m=t.z-i):t.z=i}else a&&(t.z=a.z+e(t._,a._));t.parent.A=function(t,n,r){if(n){for(var a,i=t,o=t,s=n,l=i.parent.children[0],u=i.m,c=o.m,h=s.m,f=l.m;s=fo(s),i=ho(i),s&&i;)l=ho(l),(o=fo(o)).a=t,(a=s.z+h-i.z-u+e(s._,i._))>0&&(po(go(s,t,r),t,a),u+=a,c+=a),h+=s.m,u+=i.m,f+=l.m,c+=o.m;s&&!fo(o)&&(o.t=s,o.m+=h-c),i&&!ho(l)&&(l.t=i,l.m+=u-f,r=t)}return r}(t,a,t.parent.A||r[0])}function s(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function l(t){t.x*=r[0],t.y=t.depth*r[1]}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(t){return arguments.length?(a=null==(r=t)?l:null,i):a?null:r},i.nodeSize=function(t){return arguments.length?(a=null==(r=t)?null:l,i):a?r:null},Pi(i,n)},t.layout.cluster=function(){var n=t.layout.hierarchy().sort(null).value(null),e=co,r=[1,1],a=!1;function i(i,o){var s,l=n.call(this,i,o),u=l[0],c=0;Di(u,function(n){var r=n.children;r&&r.length?(n.x=function(t){return t.reduce(function(t,n){return t+n.x},0)/t.length}(r),n.y=function(n){return 1+t.max(n,function(t){return t.y})}(r)):(n.x=s?c+=e(n,s):0,n.y=0,s=n)});var h=vo(u),f=Mo(u),p=h.x-e(h,f)/2,d=f.x+e(f,h)/2;return Di(u,a?function(t){t.x=(t.x-u.x)*r[0],t.y=(u.y-t.y)*r[1]}:function(t){t.x=(t.x-p)/(d-p)*r[0],t.y=(1-(u.y?t.y/u.y:1))*r[1]}),l}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(t){return arguments.length?(a=null==(r=t),i):a?null:r},i.nodeSize=function(t){return arguments.length?(a=null!=(r=t),i):a?r:null},Pi(i,n)},t.layout.treemap=function(){var n,e=t.layout.hierarchy(),r=Math.round,a=[1,1],i=null,o=mo,s=!1,l=\"squarify\",u=.5*(1+Math.sqrt(5));function c(t,n){for(var e,r,a=-1,i=t.length;++a<i;)r=(e=t[a]).value*(n<0?0:n),e.area=isNaN(r)||r<=0?0:r}function h(t){var n=t.children;if(n&&n.length){var e,r,a,i=o(t),s=[],u=n.slice(),f=1/0,g=\"slice\"===l?i.dx:\"dice\"===l?i.dy:\"slice-dice\"===l?1&t.depth?i.dy:i.dx:Math.min(i.dx,i.dy);for(c(u,i.dx*i.dy/t.value),s.area=0;(a=u.length)>0;)s.push(e=u[a-1]),s.area+=e.area,\"squarify\"!==l||(r=p(s,g))<=f?(u.pop(),f=r):(s.area-=s.pop().area,d(s,g,i,!1),g=Math.min(i.dx,i.dy),s.length=s.area=0,f=1/0);s.length&&(d(s,g,i,!0),s.length=s.area=0),n.forEach(h)}}function f(t){var n=t.children;if(n&&n.length){var e,r=o(t),a=n.slice(),i=[];for(c(a,r.dx*r.dy/t.value),i.area=0;e=a.pop();)i.push(e),i.area+=e.area,null!=e.z&&(d(i,e.z?r.dx:r.dy,r,!a.length),i.length=i.area=0);n.forEach(f)}}function p(t,n){for(var e,r=t.area,a=0,i=1/0,o=-1,s=t.length;++o<s;)(e=t[o].area)&&(e<i&&(i=e),e>a&&(a=e));return n*=n,(r*=r)?Math.max(n*a*u/r,r/(n*i*u)):1/0}function d(t,n,e,a){var i,o=-1,s=t.length,l=e.x,u=e.y,c=n?r(t.area/n):0;if(n==e.dx){for((a||c>e.dy)&&(c=e.dy);++o<s;)(i=t[o]).x=l,i.y=u,i.dy=c,l+=i.dx=Math.min(e.x+e.dx-l,c?r(i.area/c):0);i.z=!0,i.dx+=e.x+e.dx-l,e.y+=c,e.dy-=c}else{for((a||c>e.dx)&&(c=e.dx);++o<s;)(i=t[o]).x=l,i.y=u,i.dx=c,u+=i.dy=Math.min(e.y+e.dy-u,c?r(i.area/c):0);i.z=!1,i.dy+=e.y+e.dy-u,e.x+=c,e.dx-=c}}function g(t){var r=n||e(t),i=r[0];return i.x=i.y=0,i.value?(i.dx=a[0],i.dy=a[1]):i.dx=i.dy=0,n&&e.revalue(i),c([i],i.dx*i.dy/i.value),(n?f:h)(i),s&&(n=r),r}return g.size=function(t){return arguments.length?(a=t,g):a},g.padding=function(t){if(!arguments.length)return i;function n(n){var e=t.call(g,n,n.depth);return null==e?mo(n):yo(n,\"number\"==typeof e?[e,e,e,e]:e)}function e(n){return yo(n,t)}var r;return o=null==(i=t)?mo:\"function\"==(r=typeof t)?n:\"number\"===r?(t=[t,t,t,t],e):e,g},g.round=function(t){return arguments.length?(r=t?Math.round:Number,g):r!=Number},g.sticky=function(t){return arguments.length?(s=t,n=null,g):s},g.ratio=function(t){return arguments.length?(u=t,g):u},g.mode=function(t){return arguments.length?(l=t+\"\",g):l},Pi(g,e)},t.random={normal:function(t,n){var e=arguments.length;return e<2&&(n=1),e<1&&(t=0),function(){var e,r,a;do{a=(e=2*Math.random()-1)*e+(r=2*Math.random()-1)*r}while(!a||a>1);return t+n*e*Math.sqrt(-2*Math.log(a)/a)}},logNormal:function(){var n=t.random.normal.apply(t,arguments);return function(){return Math.exp(n())}},bates:function(n){var e=t.random.irwinHall(n);return function(){return e()/n}},irwinHall:function(t){return function(){for(var n=0,e=0;e<t;e++)n+=Math.random();return n}}},t.scale={};var _o={floor:E,ceil:E};function qo(n,e,r,a){var i=[],o=[],s=0,l=Math.min(n.length,e.length)-1;for(n[l]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++s<=l;)i.push(r(n[s-1],n[s])),o.push(a(e[s-1],e[s]));return function(e){var r=t.bisect(n,e,1,l)-1;return o[r](i[r](e))}}function To(t,n,e,r){var a,i;function o(){var o=Math.min(t.length,n.length)>2?qo:xo,l=r?ki:xi;return a=o(t,n,l,e),i=o(n,t,l,ti),s}function s(t){return a(t)}return s.invert=function(t){return i(t)},s.domain=function(n){return arguments.length?(t=n.map(Number),o()):t},s.range=function(t){return arguments.length?(n=t,o()):n},s.rangeRound=function(t){return s.range(t).interpolate(gi)},s.clamp=function(t){return arguments.length?(r=t,o()):r},s.interpolate=function(t){return arguments.length?(e=t,o()):e},s.ticks=function(n){return No(t,n)},s.tickFormat=function(n,e){return jo(t,n,e)},s.nice=function(n){return Eo(t,n),o()},s.copy=function(){return To(t,n,e,r)},o()}function zo(n,e){return t.rebind(n,e,\"range\",\"rangeRound\",\"interpolate\",\"clamp\")}function Eo(t,n){return ko(t,So(Ao(t,n)[2])),ko(t,So(Ao(t,n)[2])),t}function Ao(t,n){null==n&&(n=10);var e=bo(t),r=e[1]-e[0],a=Math.pow(10,Math.floor(Math.log(r/n)/Math.LN10)),i=n/r*a;return i<=.15?a*=10:i<=.35?a*=5:i<=.75&&(a*=2),e[0]=Math.ceil(e[0]/a)*a,e[1]=Math.floor(e[1]/a)*a+.5*a,e[2]=a,e}function No(n,e){return t.range.apply(t,Ao(n,e))}function jo(n,e,r){var a=Ao(n,e);if(r){var i=Nn.exec(r);if(i.shift(),\"s\"===i[8]){var o=t.formatPrefix(Math.max(M(a[0]),M(a[1])));return i[7]||(i[7]=\".\"+Po(o.scale(a[2]))),i[8]=\"f\",r=t.format(i.join(\"\")),function(t){return r(o.scale(t))+o.symbol}}i[7]||(i[7]=\".\"+function(t,n){var e=Po(n[2]);return t in Lo?Math.abs(e-Po(Math.max(M(n[0]),M(n[1]))))+ +(\"e\"!==t):e-2*(\"%\"===t)}(i[8],a)),r=i.join(\"\")}else r=\",.\"+Po(a[2])+\"f\";return t.format(r)}t.scale.linear=function(){return To([0,1],[0,1],ti,!1)};var Lo={s:1,g:1,p:1,r:1,e:1};function Po(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function Co(n,e,r,a){function i(t){return(r?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function o(t){return r?Math.pow(e,t):-Math.pow(e,-t)}function s(t){return n(i(t))}return s.invert=function(t){return o(n.invert(t))},s.domain=function(t){return arguments.length?(r=t[0]>=0,n.domain((a=t.map(Number)).map(i)),s):a},s.base=function(t){return arguments.length?(e=+t,n.domain(a.map(i)),s):e},s.nice=function(){var t=ko(a.map(i),r?Math:Io);return n.domain(t),a=t.map(o),s},s.ticks=function(){var t=bo(a),n=[],s=t[0],l=t[1],u=Math.floor(i(s)),c=Math.ceil(i(l)),h=e%1?2:e;if(isFinite(c-u)){if(r){for(;u<c;u++)for(var f=1;f<h;f++)n.push(o(u)*f);n.push(o(u))}else for(n.push(o(u));u++<c;)for(f=h-1;f>0;f--)n.push(o(u)*f);for(u=0;n[u]<s;u++);for(c=n.length;n[c-1]>l;c--);n=n.slice(u,c)}return n},s.tickFormat=function(n,r){if(!arguments.length)return Do;arguments.length<2?r=Do:\"function\"!=typeof r&&(r=t.format(r));var a=Math.max(1,e*n/s.ticks().length);return function(t){var n=t/o(Math.round(i(t)));return n*e<e-.5&&(n*=e),n<=a?r(t):\"\"}},s.copy=function(){return Co(n.copy(),e,r,a)},zo(s,n)}t.scale.log=function(){return Co(t.scale.linear().domain([0,1]),10,!0,[1,10])};var Do=t.format(\".0e\"),Io={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};function Ro(t,n,e){var r=Fo(n),a=Fo(1/n);function i(n){return t(r(n))}return i.invert=function(n){return a(t.invert(n))},i.domain=function(n){return arguments.length?(t.domain((e=n.map(Number)).map(r)),i):e},i.ticks=function(t){return No(e,t)},i.tickFormat=function(t,n){return jo(e,t,n)},i.nice=function(t){return i.domain(Eo(e,t))},i.exponent=function(o){return arguments.length?(r=Fo(n=o),a=Fo(1/n),t.domain(e.map(r)),i):n},i.copy=function(){return Ro(t.copy(),n,e)},zo(i,t)}function Fo(t){return function(n){return n<0?-Math.pow(-n,t):Math.pow(n,t)}}function Oo(n,e){var r,a,i;function o(t){return a[((r.get(t)||(\"range\"===e.t?r.set(t,n.push(t)):NaN))-1)%a.length]}function s(e,r){return t.range(n.length).map(function(t){return e+r*t})}return o.domain=function(t){if(!arguments.length)return n;n=[],r=new b;for(var a,i=-1,s=t.length;++i<s;)r.has(a=t[i])||r.set(a,n.push(a));return o[e.t].apply(o,e.a)},o.range=function(t){return arguments.length?(a=t,i=0,e={t:\"range\",a:arguments},o):a},o.rangePoints=function(t,r){arguments.length<2&&(r=0);var l=t[0],u=t[1],c=n.length<2?(l=(l+u)/2,0):(u-l)/(n.length-1+r);return a=s(l+c*r/2,c),i=0,e={t:\"rangePoints\",a:arguments},o},o.rangeRoundPoints=function(t,r){arguments.length<2&&(r=0);var l=t[0],u=t[1],c=n.length<2?(l=u=Math.round((l+u)/2),0):(u-l)/(n.length-1+r)|0;return a=s(l+Math.round(c*r/2+(u-l-(n.length-1+r)*c)/2),c),i=0,e={t:\"rangeRoundPoints\",a:arguments},o},o.rangeBands=function(t,r,l){arguments.length<2&&(r=0),arguments.length<3&&(l=r);var u=t[1]<t[0],c=t[u-0],h=t[1-u],f=(h-c)/(n.length-r+2*l);return a=s(c+f*l,f),u&&a.reverse(),i=f*(1-r),e={t:\"rangeBands\",a:arguments},o},o.rangeRoundBands=function(t,r,l){arguments.length<2&&(r=0),arguments.length<3&&(l=r);var u=t[1]<t[0],c=t[u-0],h=t[1-u],f=Math.floor((h-c)/(n.length-r+2*l));return a=s(c+Math.round((h-c-(n.length-r)*f)/2),f),u&&a.reverse(),i=Math.round(f*(1-r)),e={t:\"rangeRoundBands\",a:arguments},o},o.rangeBand=function(){return i},o.rangeExtent=function(){return bo(e.a[0])},o.copy=function(){return Oo(n,e)},o.domain(n)}t.scale.pow=function(){return Ro(t.scale.linear(),1,[0,1])},t.scale.sqrt=function(){return t.scale.pow().exponent(.5)},t.scale.ordinal=function(){return Oo([],{t:\"range\",a:[[]]})},t.scale.category10=function(){return t.scale.ordinal().range(Uo)},t.scale.category20=function(){return t.scale.ordinal().range(Ho)},t.scale.category20b=function(){return t.scale.ordinal().range(Bo)},t.scale.category20c=function(){return t.scale.ordinal().range(Qo)};var Uo=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(sn),Ho=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(sn),Bo=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(sn),Qo=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(sn);function Vo(n,e){var r;function a(){var a=0,o=e.length;for(r=[];++a<o;)r[a-1]=t.quantile(n,a/o);return i}function i(n){if(!isNaN(n=+n))return e[t.bisect(r,n)]}return i.domain=function(t){return arguments.length?(n=t.map(f).filter(p).sort(h),a()):n},i.range=function(t){return arguments.length?(e=t,a()):e},i.quantiles=function(){return r},i.invertExtent=function(t){return(t=e.indexOf(t))<0?[NaN,NaN]:[t>0?r[t-1]:n[0],t<r.length?r[t]:n[n.length-1]]},i.copy=function(){return Vo(n,e)},a()}function Go(t,n,e){var r,a;function i(n){return e[Math.max(0,Math.min(a,Math.floor(r*(n-t))))]}function o(){return r=e.length/(n-t),a=e.length-1,i}return i.domain=function(e){return arguments.length?(t=+e[0],n=+e[e.length-1],o()):[t,n]},i.range=function(t){return arguments.length?(e=t,o()):e},i.invertExtent=function(n){return[n=(n=e.indexOf(n))<0?NaN:n/r+t,n+1/r]},i.copy=function(){return Go(t,n,e)},o()}function Yo(n,e){function r(r){if(r<=r)return e[t.bisect(n,r)]}return r.domain=function(t){return arguments.length?(n=t,r):n},r.range=function(t){return arguments.length?(e=t,r):e},r.invertExtent=function(t){return t=e.indexOf(t),[n[t-1],n[t]]},r.copy=function(){return Yo(n,e)},r}function Wo(t){function n(t){return+t}return n.invert=n,n.domain=n.range=function(e){return arguments.length?(t=e.map(n),n):t},n.ticks=function(n){return No(t,n)},n.tickFormat=function(n,e){return jo(t,n,e)},n.copy=function(){return Wo(t)},n}function $o(){return 0}t.scale.quantile=function(){return Vo([],[])},t.scale.quantize=function(){return Go(0,1,[0,1])},t.scale.threshold=function(){return Yo([.5],[0,1])},t.scale.identity=function(){return Wo([0,1])},t.svg={},t.svg.arc=function(){var t=Xo,n=Jo,e=$o,r=Zo,a=Ko,i=ts,o=ns;function s(){var s=Math.max(0,+t.apply(this,arguments)),u=Math.max(0,+n.apply(this,arguments)),c=a.apply(this,arguments)-zt,h=i.apply(this,arguments)-zt,f=Math.abs(h-c),p=c>h?0:1;if(u<s&&(d=u,u=s,s=d),f>=Tt)return l(u,p)+(s?l(s,1-p):\"\")+\"Z\";var d,g,v,M,m,y,b,w,x,k,S,_,q=0,T=0,z=[];if((M=(+o.apply(this,arguments)||0)/2)&&(v=r===Zo?Math.sqrt(s*s+u*u):+r.apply(this,arguments),p||(T*=-1),u&&(T=Pt(v/u*Math.sin(M))),s&&(q=Pt(v/s*Math.sin(M)))),u){m=u*Math.cos(c+T),y=u*Math.sin(c+T),b=u*Math.cos(h-T),w=u*Math.sin(h-T);var E=Math.abs(h-c-2*T)<=_t?0:1;if(T&&es(m,y,b,w)===p^E){var A=(c+h)/2;m=u*Math.cos(A),y=u*Math.sin(A),b=w=null}}else m=y=0;if(s){x=s*Math.cos(h-q),k=s*Math.sin(h-q),S=s*Math.cos(c+q),_=s*Math.sin(c+q);var N=Math.abs(c-h+2*q)<=_t?0:1;if(q&&es(x,k,S,_)===1-p^N){var j=(c+h)/2;x=s*Math.cos(j),k=s*Math.sin(j),S=_=null}}else x=k=0;if(f>kt&&(d=Math.min(Math.abs(u-s)/2,+e.apply(this,arguments)))>.001){g=s<u^p?0:1;var L=d,P=d;if(f<_t){var C=null==S?[x,k]:null==b?[m,y]:ca([m,y],[S,_],[b,w],[x,k]),D=m-C[0],I=y-C[1],R=b-C[0],F=w-C[1],O=1/Math.sin(Math.acos((D*R+I*F)/(Math.sqrt(D*D+I*I)*Math.sqrt(R*R+F*F)))/2),U=Math.sqrt(C[0]*C[0]+C[1]*C[1]);P=Math.min(d,(s-U)/(O-1)),L=Math.min(d,(u-U)/(O+1))}if(null!=b){var H=rs(null==S?[x,k]:[S,_],[m,y],u,L,p),B=rs([b,w],[x,k],u,L,p);d===L?z.push(\"M\",H[0],\"A\",L,\",\",L,\" 0 0,\",g,\" \",H[1],\"A\",u,\",\",u,\" 0 \",1-p^es(H[1][0],H[1][1],B[1][0],B[1][1]),\",\",p,\" \",B[1],\"A\",L,\",\",L,\" 0 0,\",g,\" \",B[0]):z.push(\"M\",H[0],\"A\",L,\",\",L,\" 0 1,\",g,\" \",B[0])}else z.push(\"M\",m,\",\",y);if(null!=S){var Q=rs([m,y],[S,_],s,-P,p),V=rs([x,k],null==b?[m,y]:[b,w],s,-P,p);d===P?z.push(\"L\",V[0],\"A\",P,\",\",P,\" 0 0,\",g,\" \",V[1],\"A\",s,\",\",s,\" 0 \",p^es(V[1][0],V[1][1],Q[1][0],Q[1][1]),\",\",1-p,\" \",Q[1],\"A\",P,\",\",P,\" 0 0,\",g,\" \",Q[0]):z.push(\"L\",V[0],\"A\",P,\",\",P,\" 0 0,\",g,\" \",Q[0])}else z.push(\"L\",x,\",\",k)}else z.push(\"M\",m,\",\",y),null!=b&&z.push(\"A\",u,\",\",u,\" 0 \",E,\",\",p,\" \",b,\",\",w),z.push(\"L\",x,\",\",k),null!=S&&z.push(\"A\",s,\",\",s,\" 0 \",N,\",\",1-p,\" \",S,\",\",_);return z.push(\"Z\"),z.join(\"\")}function l(t,n){return\"M0,\"+t+\"A\"+t+\",\"+t+\" 0 1,\"+n+\" 0,\"+-t+\"A\"+t+\",\"+t+\" 0 1,\"+n+\" 0,\"+t}return s.innerRadius=function(n){return arguments.length?(t=vn(n),s):t},s.outerRadius=function(t){return arguments.length?(n=vn(t),s):n},s.cornerRadius=function(t){return arguments.length?(e=vn(t),s):e},s.padRadius=function(t){return arguments.length?(r=t==Zo?Zo:vn(t),s):r},s.startAngle=function(t){return arguments.length?(a=vn(t),s):a},s.endAngle=function(t){return arguments.length?(i=vn(t),s):i},s.padAngle=function(t){return arguments.length?(o=vn(t),s):o},s.centroid=function(){var e=(+t.apply(this,arguments)+ +n.apply(this,arguments))/2,r=(+a.apply(this,arguments)+ +i.apply(this,arguments))/2-zt;return[Math.cos(r)*e,Math.sin(r)*e]},s};var Zo=\"auto\";function Xo(t){return t.innerRadius}function Jo(t){return t.outerRadius}function Ko(t){return t.startAngle}function ts(t){return t.endAngle}function ns(t){return t&&t.padAngle}function es(t,n,e,r){return(t-e)*n-(n-r)*t>0?0:1}function rs(t,n,e,r,a){var i=t[0]-n[0],o=t[1]-n[1],s=(a?r:-r)/Math.sqrt(i*i+o*o),l=s*o,u=-s*i,c=t[0]+l,h=t[1]+u,f=n[0]+l,p=n[1]+u,d=(c+f)/2,g=(h+p)/2,v=f-c,M=p-h,m=v*v+M*M,y=e-r,b=c*p-f*h,w=(M<0?-1:1)*Math.sqrt(Math.max(0,y*y*m-b*b)),x=(b*M-v*w)/m,k=(-b*v-M*w)/m,S=(b*M+v*w)/m,_=(-b*v+M*w)/m,q=x-d,T=k-g,z=S-d,E=_-g;return q*q+T*T>z*z+E*E&&(x=S,k=_),[[x-l,k-u],[x*e/y,k*e/y]]}function as(t){var n=aa,e=ia,r=We,a=os,i=a.key,o=.7;function s(i){var s,l=[],u=[],c=-1,h=i.length,f=vn(n),p=vn(e);function d(){l.push(\"M\",a(t(u),o))}for(;++c<h;)r.call(this,s=i[c],c)?u.push([+f.call(this,s,c),+p.call(this,s,c)]):u.length&&(d(),u=[]);return u.length&&d(),l.length?l.join(\"\"):null}return s.x=function(t){return arguments.length?(n=t,s):n},s.y=function(t){return arguments.length?(e=t,s):e},s.defined=function(t){return arguments.length?(r=t,s):r},s.interpolate=function(t){return arguments.length?(i=\"function\"==typeof t?a=t:(a=is.get(t)||os).key,s):i},s.tension=function(t){return arguments.length?(o=t,s):o},s}t.svg.line=function(){return as(E)};var is=t.map({linear:os,\"linear-closed\":ss,step:function(t){for(var n=0,e=t.length,r=t[0],a=[r[0],\",\",r[1]];++n<e;)a.push(\"H\",(r[0]+(r=t[n])[0])/2,\"V\",r[1]);return e>1&&a.push(\"H\",r[0]),a.join(\"\")},\"step-before\":ls,\"step-after\":us,basis:fs,\"basis-open\":function(t){if(t.length<4)return os(t);for(var n,e=[],r=-1,a=t.length,i=[0],o=[0];++r<3;)i.push((n=t[r])[0]),o.push(n[1]);for(e.push(ps(vs,i)+\",\"+ps(vs,o)),--r;++r<a;)n=t[r],i.shift(),i.push(n[0]),o.shift(),o.push(n[1]),Ms(e,i,o);return e.join(\"\")},\"basis-closed\":function(t){for(var n,e,r=-1,a=t.length,i=a+4,o=[],s=[];++r<4;)o.push((e=t[r%a])[0]),s.push(e[1]);for(n=[ps(vs,o),\",\",ps(vs,s)],--r;++r<i;)e=t[r%a],o.shift(),o.push(e[0]),s.shift(),s.push(e[1]),Ms(n,o,s);return n.join(\"\")},bundle:function(t,n){var e=t.length-1;if(e)for(var r,a,i=t[0][0],o=t[0][1],s=t[e][0]-i,l=t[e][1]-o,u=-1;++u<=e;)(r=t[u])[0]=n*r[0]+(1-n)*(i+(a=u/e)*s),r[1]=n*r[1]+(1-n)*(o+a*l);return fs(t)},cardinal:function(t,n){return t.length<3?os(t):t[0]+cs(t,hs(t,n))},\"cardinal-open\":function(t,n){return t.length<4?os(t):t[1]+cs(t.slice(1,-1),hs(t,n))},\"cardinal-closed\":function(t,n){return t.length<3?ss(t):t[0]+cs((t.push(t[0]),t),hs([t[t.length-2]].concat(t,[t[1]]),n))},monotone:function(t){return t.length<3?os(t):t[0]+cs(t,function(t){for(var n,e,r,a,i=[],o=function(t){for(var n=0,e=t.length-1,r=[],a=t[0],i=t[1],o=r[0]=ms(a,i);++n<e;)r[n]=(o+(o=ms(a=i,i=t[n+1])))/2;return r[n]=o,r}(t),s=-1,l=t.length-1;++s<l;)n=ms(t[s],t[s+1]),M(n)<kt?o[s]=o[s+1]=0:(a=(e=o[s]/n)*e+(r=o[s+1]/n)*r)>9&&(a=3*n/Math.sqrt(a),o[s]=a*e,o[s+1]=a*r);for(s=-1;++s<=l;)a=(t[Math.min(l,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),i.push([a||0,o[s]*a||0]);return i}(t))}});function os(t){return t.length>1?t.join(\"L\"):t+\"Z\"}function ss(t){return t.join(\"L\")+\"Z\"}function ls(t){for(var n=0,e=t.length,r=t[0],a=[r[0],\",\",r[1]];++n<e;)a.push(\"V\",(r=t[n])[1],\"H\",r[0]);return a.join(\"\")}function us(t){for(var n=0,e=t.length,r=t[0],a=[r[0],\",\",r[1]];++n<e;)a.push(\"H\",(r=t[n])[0],\"V\",r[1]);return a.join(\"\")}function cs(t,n){if(n.length<1||t.length!=n.length&&t.length!=n.length+2)return os(t);var e=t.length!=n.length,r=\"\",a=t[0],i=t[1],o=n[0],s=o,l=1;if(e&&(r+=\"Q\"+(i[0]-2*o[0]/3)+\",\"+(i[1]-2*o[1]/3)+\",\"+i[0]+\",\"+i[1],a=t[1],l=2),n.length>1){i=t[l],l++,r+=\"C\"+(a[0]+o[0])+\",\"+(a[1]+o[1])+\",\"+(i[0]-(s=n[1])[0])+\",\"+(i[1]-s[1])+\",\"+i[0]+\",\"+i[1];for(var u=2;u<n.length;u++,l++)r+=\"S\"+((i=t[l])[0]-(s=n[u])[0])+\",\"+(i[1]-s[1])+\",\"+i[0]+\",\"+i[1]}if(e){var c=t[l];r+=\"Q\"+(i[0]+2*s[0]/3)+\",\"+(i[1]+2*s[1]/3)+\",\"+c[0]+\",\"+c[1]}return r}function hs(t,n){for(var e,r=[],a=(1-n)/2,i=t[0],o=t[1],s=1,l=t.length;++s<l;)e=i,i=o,r.push([a*((o=t[s])[0]-e[0]),a*(o[1]-e[1])]);return r}function fs(t){if(t.length<3)return os(t);var n=1,e=t.length,r=t[0],a=r[0],i=r[1],o=[a,a,a,(r=t[1])[0]],s=[i,i,i,r[1]],l=[a,\",\",i,\"L\",ps(vs,o),\",\",ps(vs,s)];for(t.push(t[e-1]);++n<=e;)r=t[n],o.shift(),o.push(r[0]),s.shift(),s.push(r[1]),Ms(l,o,s);return t.pop(),l.push(\"L\",r),l.join(\"\")}function ps(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}is.forEach(function(t,n){n.key=t,n.closed=/-closed$/.test(t)});var ds=[0,2/3,1/3,0],gs=[0,1/3,2/3,0],vs=[0,1/6,2/3,1/6];function Ms(t,n,e){t.push(\"C\",ps(ds,n),\",\",ps(ds,e),\",\",ps(gs,n),\",\",ps(gs,e),\",\",ps(vs,n),\",\",ps(vs,e))}function ms(t,n){return(n[1]-t[1])/(n[0]-t[0])}function ys(t){for(var n,e,r,a=-1,i=t.length;++a<i;)r=(n=t[a])[1]-zt,n[0]=(e=n[0])*Math.cos(r),n[1]=e*Math.sin(r);return t}function bs(t){var n=aa,e=aa,r=0,a=ia,i=We,o=os,s=o.key,l=o,u=\"L\",c=.7;function h(s){var h,f,p,d=[],g=[],v=[],M=-1,m=s.length,y=vn(n),b=vn(r),w=n===e?function(){return f}:vn(e),x=r===a?function(){return p}:vn(a);function k(){d.push(\"M\",o(t(v),c),u,l(t(g.reverse()),c),\"Z\")}for(;++M<m;)i.call(this,h=s[M],M)?(g.push([f=+y.call(this,h,M),p=+b.call(this,h,M)]),v.push([+w.call(this,h,M),+x.call(this,h,M)])):g.length&&(k(),g=[],v=[]);return g.length&&k(),d.length?d.join(\"\"):null}return h.x=function(t){return arguments.length?(n=e=t,h):e},h.x0=function(t){return arguments.length?(n=t,h):n},h.x1=function(t){return arguments.length?(e=t,h):e},h.y=function(t){return arguments.length?(r=a=t,h):a},h.y0=function(t){return arguments.length?(r=t,h):r},h.y1=function(t){return arguments.length?(a=t,h):a},h.defined=function(t){return arguments.length?(i=t,h):i},h.interpolate=function(t){return arguments.length?(s=\"function\"==typeof t?o=t:(o=is.get(t)||os).key,l=o.reverse||o,u=o.closed?\"M\":\"L\",h):s},h.tension=function(t){return arguments.length?(c=t,h):c},h}function ws(t){return t.radius}function xs(t){return[t.x,t.y]}function ks(t){return function(){var n=t.apply(this,arguments),e=n[0],r=n[1]-zt;return[e*Math.cos(r),e*Math.sin(r)]}}function Ss(){return 64}function _s(){return\"circle\"}function qs(t){var n=Math.sqrt(t/_t);return\"M0,\"+n+\"A\"+n+\",\"+n+\" 0 1,1 0,\"+-n+\"A\"+n+\",\"+n+\" 0 1,1 0,\"+n+\"Z\"}t.svg.line.radial=function(){var t=as(ys);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},ls.reverse=us,us.reverse=ls,t.svg.area=function(){return bs(E)},t.svg.area.radial=function(){var t=bs(ys);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},t.svg.chord=function(){var t=Qr,n=Vr,e=ws,r=Ko,a=ts;function i(e,r){var a,i,u=o(this,t,e,r),c=o(this,n,e,r);return\"M\"+u.p0+s(u.r,u.p1,u.a1-u.a0)+((a=u).a0==(i=c).a0&&a.a1==i.a1?l(0,0,0,u.p0):l(0,0,0,c.p0)+s(c.r,c.p1,c.a1-c.a0)+l(0,0,0,u.p0))+\"Z\"}function o(t,n,i,o){var s=n.call(t,i,o),l=e.call(t,s,o),u=r.call(t,s,o)-zt,c=a.call(t,s,o)-zt;return{r:l,a0:u,a1:c,p0:[l*Math.cos(u),l*Math.sin(u)],p1:[l*Math.cos(c),l*Math.sin(c)]}}function s(t,n,e){return\"A\"+t+\",\"+t+\" 0 \"+ +(e>_t)+\",1 \"+n}function l(t,n,e,r){return\"Q 0,0 \"+r}return i.radius=function(t){return arguments.length?(e=vn(t),i):e},i.source=function(n){return arguments.length?(t=vn(n),i):t},i.target=function(t){return arguments.length?(n=vn(t),i):n},i.startAngle=function(t){return arguments.length?(r=vn(t),i):r},i.endAngle=function(t){return arguments.length?(a=vn(t),i):a},i},t.svg.diagonal=function(){var t=Qr,n=Vr,e=xs;function r(r,a){var i=t.call(this,r,a),o=n.call(this,r,a),s=(i.y+o.y)/2,l=[i,{x:i.x,y:s},{x:o.x,y:s},o];return\"M\"+(l=l.map(e))[0]+\"C\"+l[1]+\" \"+l[2]+\" \"+l[3]}return r.source=function(n){return arguments.length?(t=vn(n),r):t},r.target=function(t){return arguments.length?(n=vn(t),r):n},r.projection=function(t){return arguments.length?(e=t,r):e},r},t.svg.diagonal.radial=function(){var n=t.svg.diagonal(),e=xs,r=n.projection;return n.projection=function(t){return arguments.length?r(ks(e=t)):e},n},t.svg.symbol=function(){var t=_s,n=Ss;function e(e,r){return(Ts.get(t.call(this,e,r))||qs)(n.call(this,e,r))}return e.type=function(n){return arguments.length?(t=vn(n),e):t},e.size=function(t){return arguments.length?(n=vn(t),e):n},e};var Ts=t.map({circle:qs,cross:function(t){var n=Math.sqrt(t/5)/2;return\"M\"+-3*n+\",\"+-n+\"H\"+-n+\"V\"+-3*n+\"H\"+n+\"V\"+-n+\"H\"+3*n+\"V\"+n+\"H\"+n+\"V\"+3*n+\"H\"+-n+\"V\"+n+\"H\"+-3*n+\"Z\"},diamond:function(t){var n=Math.sqrt(t/(2*Es)),e=n*Es;return\"M0,\"+-n+\"L\"+e+\",0 0,\"+n+\" \"+-e+\",0Z\"},square:function(t){var n=Math.sqrt(t)/2;return\"M\"+-n+\",\"+-n+\"L\"+n+\",\"+-n+\" \"+n+\",\"+n+\" \"+-n+\",\"+n+\"Z\"},\"triangle-down\":function(t){var n=Math.sqrt(t/zs),e=n*zs/2;return\"M0,\"+e+\"L\"+n+\",\"+-e+\" \"+-n+\",\"+-e+\"Z\"},\"triangle-up\":function(t){var n=Math.sqrt(t/zs),e=n*zs/2;return\"M0,\"+-e+\"L\"+n+\",\"+e+\" \"+-n+\",\"+e+\"Z\"}});t.svg.symbolTypes=Ts.keys();var zs=Math.sqrt(3),Es=Math.tan(30*Et);V.transition=function(t){for(var n,e,r=Ls||++Ds,a=Fs(t),i=[],o=Ps||{time:Date.now(),ease:ci,delay:0,duration:250},s=-1,l=this.length;++s<l;){i.push(n=[]);for(var u=this[s],c=-1,h=u.length;++c<h;)(e=u[c])&&Os(e,c,a,r,o),n.push(e)}return js(i,a,r)},V.interrupt=function(t){return this.each(null==t?As:Ns(Fs(t)))};var As=Ns(Fs());function Ns(t){return function(){var n,e,r;(n=this[t])&&(r=n[e=n.active])&&(r.timer.c=null,r.timer.t=NaN,--n.count?delete n[e]:delete this[t],n.active+=.5,r.event&&r.event.interrupt.call(this,this.__data__,r.index))}}function js(t,n,e){return O(t,Cs),t.namespace=n,t.id=e,t}var Ls,Ps,Cs=[],Ds=0;function Is(t,n,e,r){var a=t.id,i=t.namespace;return ut(t,\"function\"==typeof e?function(t,o,s){t[i][a].tween.set(n,r(e.call(t,t.__data__,o,s)))}:(e=r(e),function(t){t[i][a].tween.set(n,e)}))}function Rs(t){return null==t&&(t=\"\"),function(){this.textContent=t}}function Fs(t){return null==t?\"__transition__\":\"__transition_\"+t+\"__\"}function Os(t,n,e,r,a){var i,o,s,l,u,c=t[e]||(t[e]={active:0,count:0}),h=c[r];function f(e){var a=c.active,f=c[a];for(var d in f&&(f.timer.c=null,f.timer.t=NaN,--c.count,delete c[a],f.event&&f.event.interrupt.call(t,t.__data__,f.index)),c)if(+d<r){var g=c[d];g.timer.c=null,g.timer.t=NaN,--c.count,delete c[d]}o.c=p,Sn(function(){return o.c&&p(e||1)&&(o.c=null,o.t=NaN),1},0,i),c.active=r,h.event&&h.event.start.call(t,t.__data__,n),u=[],h.tween.forEach(function(e,r){(r=r.call(t,t.__data__,n))&&u.push(r)}),l=h.ease,s=h.duration}function p(a){for(var i=a/s,o=l(i),f=u.length;f>0;)u[--f].call(t,o);if(i>=1)return h.event&&h.event.end.call(t,t.__data__,n),--c.count?delete c[r]:delete t[e],1}h||(o=Sn(function(t){var n=h.delay;if(o.t=n+i,n<=t)return f(t-n);o.c=f},0,i=a.time),h=c[r]={tween:new b,time:i,timer:o,delay:a.delay,duration:a.duration,ease:a.ease,index:n},a=null,++c.count)}Cs.call=V.call,Cs.empty=V.empty,Cs.node=V.node,Cs.size=V.size,t.transition=function(n,e){return n&&n.transition?Ls?n.transition(e):n:t.selection().transition(n)},t.transition.prototype=Cs,Cs.select=function(t){var n,e,r,a=this.id,i=this.namespace,o=[];t=G(t);for(var s=-1,l=this.length;++s<l;){o.push(n=[]);for(var u=this[s],c=-1,h=u.length;++c<h;)(r=u[c])&&(e=t.call(r,r.__data__,c,s))?(\"__data__\"in r&&(e.__data__=r.__data__),Os(e,c,i,a,r[i][a]),n.push(e)):n.push(null)}return js(o,i,a)},Cs.selectAll=function(t){var n,e,r,a,i,o=this.id,s=this.namespace,l=[];t=Y(t);for(var u=-1,c=this.length;++u<c;)for(var h=this[u],f=-1,p=h.length;++f<p;)if(r=h[f]){i=r[s][o],e=t.call(r,r.__data__,f,u),l.push(n=[]);for(var d=-1,g=e.length;++d<g;)(a=e[d])&&Os(a,d,s,o,i),n.push(a)}return js(l,s,o)},Cs.filter=function(t){var n,e,r=[];\"function\"!=typeof t&&(t=st(t));for(var a=0,i=this.length;a<i;a++){r.push(n=[]);for(var o,s=0,l=(o=this[a]).length;s<l;s++)(e=o[s])&&t.call(e,e.__data__,s,a)&&n.push(e)}return js(r,this.namespace,this.id)},Cs.tween=function(t,n){var e=this.id,r=this.namespace;return arguments.length<2?this.node()[r][e].tween.get(t):ut(this,null==n?function(n){n[r][e].tween.remove(t)}:function(a){a[r][e].tween.set(t,n)})},Cs.attr=function(n,e){if(arguments.length<2){for(e in n)this.attr(e,n[e]);return this}var r=\"transform\"==n?wi:ti,a=t.ns.qualify(n);function i(){this.removeAttribute(a)}function o(){this.removeAttributeNS(a.space,a.local)}function s(t){return null==t?i:(t+=\"\",function(){var n,e=this.getAttribute(a);return e!==t&&(n=r(e,t),function(t){this.setAttribute(a,n(t))})})}function l(t){return null==t?o:(t+=\"\",function(){var n,e=this.getAttributeNS(a.space,a.local);return e!==t&&(n=r(e,t),function(t){this.setAttributeNS(a.space,a.local,n(t))})})}return Is(this,\"attr.\"+n,e,a.local?l:s)},Cs.attrTween=function(n,e){var r=t.ns.qualify(n);return this.tween(\"attr.\"+n,r.local?function(t,n){var a=e.call(this,t,n,this.getAttributeNS(r.space,r.local));return a&&function(t){this.setAttributeNS(r.space,r.local,a(t))}}:function(t,n){var a=e.call(this,t,n,this.getAttribute(r));return a&&function(t){this.setAttribute(r,a(t))}})},Cs.style=function(t,n,e){var r=arguments.length;if(r<3){if(\"string\"!=typeof t){for(e in r<2&&(n=\"\"),t)this.style(e,t[e],n);return this}e=\"\"}function a(){this.style.removeProperty(t)}function o(n){return null==n?a:(n+=\"\",function(){var r,a=i(this).getComputedStyle(this,null).getPropertyValue(t);return a!==n&&(r=ti(a,n),function(n){this.style.setProperty(t,r(n),e)})})}return Is(this,\"style.\"+t,n,o)},Cs.styleTween=function(t,n,e){function r(r,a){var o=n.call(this,r,a,i(this).getComputedStyle(this,null).getPropertyValue(t));return o&&function(n){this.style.setProperty(t,o(n),e)}}return arguments.length<3&&(e=\"\"),this.tween(\"style.\"+t,r)},Cs.text=function(t){return Is(this,\"text\",t,Rs)},Cs.remove=function(){var t=this.namespace;return this.each(\"end.transition\",function(){var n;this[t].count<2&&(n=this.parentNode)&&n.removeChild(this)})},Cs.ease=function(n){var e=this.id,r=this.namespace;return arguments.length<1?this.node()[r][e].ease:(\"function\"!=typeof n&&(n=t.ease.apply(t,arguments)),ut(this,function(t){t[r][e].ease=n}))},Cs.delay=function(t){var n=this.id,e=this.namespace;return arguments.length<1?this.node()[e][n].delay:ut(this,\"function\"==typeof t?function(r,a,i){r[e][n].delay=+t.call(r,r.__data__,a,i)}:(t=+t,function(r){r[e][n].delay=t}))},Cs.duration=function(t){var n=this.id,e=this.namespace;return arguments.length<1?this.node()[e][n].duration:ut(this,\"function\"==typeof t?function(r,a,i){r[e][n].duration=Math.max(1,t.call(r,r.__data__,a,i))}:(t=Math.max(1,t),function(r){r[e][n].duration=t}))},Cs.each=function(n,e){var r=this.id,a=this.namespace;if(arguments.length<2){var i=Ps,o=Ls;try{Ls=r,ut(this,function(t,e,i){Ps=t[a][r],n.call(t,t.__data__,e,i)})}finally{Ps=i,Ls=o}}else ut(this,function(i){var o=i[a][r];(o.event||(o.event=t.dispatch(\"start\",\"end\",\"interrupt\"))).on(n,e)});return this},Cs.transition=function(){for(var t,n,e,r=this.id,a=++Ds,i=this.namespace,o=[],s=0,l=this.length;s<l;s++){o.push(t=[]);for(var u,c=0,h=(u=this[s]).length;c<h;c++)(n=u[c])&&Os(n,c,i,a,{time:(e=n[i][r]).time,ease:e.ease,delay:e.delay+e.duration,duration:e.duration}),t.push(n)}return js(o,i,a)},t.svg.axis=function(){var n,r=t.scale.linear(),a=Us,i=6,o=6,s=3,l=[10],u=null;function c(e){e.each(function(){var e,c=t.select(this),h=this.__chart__||r,f=this.__chart__=r.copy(),p=null==u?f.ticks?f.ticks.apply(f,l):f.domain():u,d=null==n?f.tickFormat?f.tickFormat.apply(f,l):E:n,g=c.selectAll(\".tick\").data(p,f),v=g.enter().insert(\"g\",\".domain\").attr(\"class\",\"tick\").style(\"opacity\",kt),M=t.transition(g.exit()).style(\"opacity\",kt).remove(),m=t.transition(g.order()).style(\"opacity\",1),y=Math.max(i,0)+s,b=wo(f),w=c.selectAll(\".domain\").data([0]),x=(w.enter().append(\"path\").attr(\"class\",\"domain\"),t.transition(w));v.append(\"line\"),v.append(\"text\");var k,S,_,q,T=v.select(\"line\"),z=m.select(\"line\"),A=g.select(\"text\").text(d),N=v.select(\"text\"),j=m.select(\"text\"),L=\"top\"===a||\"left\"===a?-1:1;if(\"bottom\"===a||\"top\"===a?(e=Bs,k=\"x\",_=\"y\",S=\"x2\",q=\"y2\",A.attr(\"dy\",L<0?\"0em\":\".71em\").style(\"text-anchor\",\"middle\"),x.attr(\"d\",\"M\"+b[0]+\",\"+L*o+\"V0H\"+b[1]+\"V\"+L*o)):(e=Qs,k=\"y\",_=\"x\",S=\"y2\",q=\"x2\",A.attr(\"dy\",\".32em\").style(\"text-anchor\",L<0?\"end\":\"start\"),x.attr(\"d\",\"M\"+L*o+\",\"+b[0]+\"H0V\"+b[1]+\"H\"+L*o)),T.attr(q,L*i),N.attr(_,L*y),z.attr(S,0).attr(q,L*i),j.attr(k,0).attr(_,L*y),f.rangeBand){var P=f,C=P.rangeBand()/2;h=f=function(t){return P(t)+C}}else h.rangeBand?h=f:M.call(e,f,h);v.call(e,h,f),m.call(e,f,f)})}return c.scale=function(t){return arguments.length?(r=t,c):r},c.orient=function(t){return arguments.length?(a=t in Hs?t+\"\":Us,c):a},c.ticks=function(){return arguments.length?(l=e(arguments),c):l},c.tickValues=function(t){return arguments.length?(u=t,c):u},c.tickFormat=function(t){return arguments.length?(n=t,c):n},c.tickSize=function(t){var n=arguments.length;return n?(i=+t,o=+arguments[n-1],c):i},c.innerTickSize=function(t){return arguments.length?(i=+t,c):i},c.outerTickSize=function(t){return arguments.length?(o=+t,c):o},c.tickPadding=function(t){return arguments.length?(s=+t,c):s},c.tickSubdivide=function(){return arguments.length&&c},c};var Us=\"bottom\",Hs={top:1,right:1,bottom:1,left:1};function Bs(t,n,e){t.attr(\"transform\",function(t){var r=n(t);return\"translate(\"+(isFinite(r)?r:e(t))+\",0)\"})}function Qs(t,n,e){t.attr(\"transform\",function(t){var r=n(t);return\"translate(0,\"+(isFinite(r)?r:e(t))+\")\"})}t.svg.brush=function(){var n,e,r=R(f,\"brushstart\",\"brush\",\"brushend\"),a=null,o=null,s=[0,0],l=[0,0],u=!0,c=!0,h=Gs[0];function f(n){n.each(function(){var n=t.select(this).style(\"pointer-events\",\"all\").style(\"-webkit-tap-highlight-color\",\"rgba(0,0,0,0)\").on(\"mousedown.brush\",v).on(\"touchstart.brush\",v),e=n.selectAll(\".background\").data([0]);e.enter().append(\"rect\").attr(\"class\",\"background\").style(\"visibility\",\"hidden\").style(\"cursor\",\"crosshair\"),n.selectAll(\".extent\").data([0]).enter().append(\"rect\").attr(\"class\",\"extent\").style(\"cursor\",\"move\");var r=n.selectAll(\".resize\").data(h,E);r.exit().remove(),r.enter().append(\"g\").attr(\"class\",function(t){return\"resize \"+t}).style(\"cursor\",function(t){return Vs[t]}).append(\"rect\").attr(\"x\",function(t){return/[ew]$/.test(t)?-3:null}).attr(\"y\",function(t){return/^[ns]/.test(t)?-3:null}).attr(\"width\",6).attr(\"height\",6).style(\"visibility\",\"hidden\"),r.style(\"display\",f.empty()?\"none\":null);var i,s=t.transition(n),l=t.transition(e);a&&(i=wo(a),l.attr(\"x\",i[0]).attr(\"width\",i[1]-i[0]),d(s)),o&&(i=wo(o),l.attr(\"y\",i[0]).attr(\"height\",i[1]-i[0]),g(s)),p(s)})}function p(t){t.selectAll(\".resize\").attr(\"transform\",function(t){return\"translate(\"+s[+/e$/.test(t)]+\",\"+l[+/^s/.test(t)]+\")\"})}function d(t){t.select(\".extent\").attr(\"x\",s[0]),t.selectAll(\".extent,.n>rect,.s>rect\").attr(\"width\",s[1]-s[0])}function g(t){t.select(\".extent\").attr(\"y\",l[0]),t.selectAll(\".extent,.e>rect,.w>rect\").attr(\"height\",l[1]-l[0])}function v(){var h,v,M=this,m=t.select(t.event.target),y=r.of(M,arguments),b=t.select(M),w=m.datum(),x=!/^(n|s)$/.test(w)&&a,k=!/^(e|w)$/.test(w)&&o,S=m.classed(\"extent\"),_=yt(M),q=t.mouse(M),T=t.select(i(M)).on(\"keydown.brush\",A).on(\"keyup.brush\",N);if(t.event.changedTouches?T.on(\"touchmove.brush\",j).on(\"touchend.brush\",P):T.on(\"mousemove.brush\",j).on(\"mouseup.brush\",P),b.interrupt().selectAll(\"*\").interrupt(),S)q[0]=s[0]-q[0],q[1]=l[0]-q[1];else if(w){var z=+/w$/.test(w),E=+/^n/.test(w);v=[s[1-z]-q[0],l[1-E]-q[1]],q[0]=s[z],q[1]=l[E]}else t.event.altKey&&(h=q.slice());function A(){32==t.event.keyCode&&(S||(h=null,q[0]-=s[1],q[1]-=l[1],S=2),D())}function N(){32==t.event.keyCode&&2==S&&(q[0]+=s[1],q[1]+=l[1],S=0,D())}function j(){var n=t.mouse(M),e=!1;v&&(n[0]+=v[0],n[1]+=v[1]),S||(t.event.altKey?(h||(h=[(s[0]+s[1])/2,(l[0]+l[1])/2]),q[0]=s[+(n[0]<h[0])],q[1]=l[+(n[1]<h[1])]):h=null),x&&L(n,a,0)&&(d(b),e=!0),k&&L(n,o,1)&&(g(b),e=!0),e&&(p(b),y({type:\"brush\",mode:S?\"move\":\"resize\"}))}function L(t,r,a){var i,o,f=wo(r),p=f[0],d=f[1],g=q[a],v=a?l:s,M=v[1]-v[0];if(S&&(p-=g,d-=M+g),i=(a?c:u)?Math.max(p,Math.min(d,t[a])):t[a],S?o=(i+=g)+M:(h&&(g=Math.max(p,Math.min(d,2*h[a]-i))),g<i?(o=i,i=g):o=g),v[0]!=i||v[1]!=o)return a?e=null:n=null,v[0]=i,v[1]=o,!0}function P(){j(),b.style(\"pointer-events\",\"all\").selectAll(\".resize\").style(\"display\",f.empty()?\"none\":null),t.select(\"body\").style(\"cursor\",null),T.on(\"mousemove.brush\",null).on(\"mouseup.brush\",null).on(\"touchmove.brush\",null).on(\"touchend.brush\",null).on(\"keydown.brush\",null).on(\"keyup.brush\",null),_(),y({type:\"brushend\"})}b.style(\"pointer-events\",\"none\").selectAll(\".resize\").style(\"display\",null),t.select(\"body\").style(\"cursor\",m.style(\"cursor\")),y({type:\"brushstart\"}),j()}return f.event=function(a){a.each(function(){var a=r.of(this,arguments),i={x:s,y:l,i:n,j:e},o=this.__chart__||i;this.__chart__=i,Ls?t.select(this).transition().each(\"start.brush\",function(){n=o.i,e=o.j,s=o.x,l=o.y,a({type:\"brushstart\"})}).tween(\"brush:brush\",function(){var t=ni(s,i.x),r=ni(l,i.y);return n=e=null,function(n){s=i.x=t(n),l=i.y=r(n),a({type:\"brush\",mode:\"resize\"})}}).each(\"end.brush\",function(){n=i.i,e=i.j,a({type:\"brush\",mode:\"resize\"}),a({type:\"brushend\"})}):(a({type:\"brushstart\"}),a({type:\"brush\",mode:\"resize\"}),a({type:\"brushend\"}))})},f.x=function(t){return arguments.length?(h=Gs[!(a=t)<<1|!o],f):a},f.y=function(t){return arguments.length?(h=Gs[!a<<1|!(o=t)],f):o},f.clamp=function(t){return arguments.length?(a&&o?(u=!!t[0],c=!!t[1]):a?u=!!t:o&&(c=!!t),f):a&&o?[u,c]:a?u:o?c:null},f.extent=function(t){var r,i,u,c,h;return arguments.length?(a&&(r=t[0],i=t[1],o&&(r=r[0],i=i[0]),n=[r,i],a.invert&&(r=a(r),i=a(i)),i<r&&(h=r,r=i,i=h),r==s[0]&&i==s[1]||(s=[r,i])),o&&(u=t[0],c=t[1],a&&(u=u[1],c=c[1]),e=[u,c],o.invert&&(u=o(u),c=o(c)),c<u&&(h=u,u=c,c=h),u==l[0]&&c==l[1]||(l=[u,c])),f):(a&&(n?(r=n[0],i=n[1]):(r=s[0],i=s[1],a.invert&&(r=a.invert(r),i=a.invert(i)),i<r&&(h=r,r=i,i=h))),o&&(e?(u=e[0],c=e[1]):(u=l[0],c=l[1],o.invert&&(u=o.invert(u),c=o.invert(c)),c<u&&(h=u,u=c,c=h))),a&&o?[[r,u],[i,c]]:a?[r,i]:o&&[u,c])},f.clear=function(){return f.empty()||(s=[0,0],l=[0,0],n=e=null),f},f.empty=function(){return!!a&&s[0]==s[1]||!!o&&l[0]==l[1]},t.rebind(f,r,\"on\")};var Vs={n:\"ns-resize\",e:\"ew-resize\",s:\"ns-resize\",w:\"ew-resize\",nw:\"nwse-resize\",ne:\"nesw-resize\",se:\"nwse-resize\",sw:\"nesw-resize\"},Gs=[[\"n\",\"e\",\"s\",\"w\",\"nw\",\"ne\",\"se\",\"sw\"],[\"e\",\"w\"],[\"n\",\"s\"],[]],Ys=Pn.format=ue.timeFormat,Ws=Ys.utc,$s=Ws(\"%Y-%m-%dT%H:%M:%S.%LZ\");function Zs(t){return t.toISOString()}function Xs(n,e,r){function a(t){return n(t)}function i(n,r){var a=(n[1]-n[0])/r,i=t.bisect(Ks,a);return i==Ks.length?[e.year,Ao(n.map(function(t){return t/31536e6}),r)[2]]:i?e[a/Ks[i-1]<Ks[i]/a?i-1:i]:[el,Ao(n,r)[2]]}return a.invert=function(t){return Js(n.invert(t))},a.domain=function(t){return arguments.length?(n.domain(t),a):n.domain().map(Js)},a.nice=function(t,n){var e=a.domain(),r=bo(e),o=null==t?i(r,10):\"number\"==typeof t&&i(r,t);function s(e){return!isNaN(e)&&!t.range(e,Js(+e+1),n).length}return o&&(t=o[0],n=o[1]),a.domain(ko(e,n>1?{floor:function(n){for(;s(n=t.floor(n));)n=Js(n-1);return n},ceil:function(n){for(;s(n=t.ceil(n));)n=Js(+n+1);return n}}:t))},a.ticks=function(t,n){var e=bo(a.domain()),r=null==t?i(e,10):\"number\"==typeof t?i(e,t):!t.range&&[{range:t},n];return r&&(t=r[0],n=r[1]),t.range(e[0],Js(+e[1]+1),n<1?1:n)},a.tickFormat=function(){return r},a.copy=function(){return Xs(n.copy(),e,r)},zo(a,n)}function Js(t){return new Date(t)}Ys.iso=Date.prototype.toISOString&&+new Date(\"2000-01-01T00:00:00.000Z\")?Zs:$s,Zs.parse=function(t){var n=new Date(t);return isNaN(n)?null:n},Zs.toString=$s.toString,Pn.second=Rn(function(t){return new Cn(1e3*Math.floor(t/1e3))},function(t,n){t.setTime(t.getTime()+1e3*Math.floor(n))},function(t){return t.getSeconds()}),Pn.seconds=Pn.second.range,Pn.seconds.utc=Pn.second.utc.range,Pn.minute=Rn(function(t){return new Cn(6e4*Math.floor(t/6e4))},function(t,n){t.setTime(t.getTime()+6e4*Math.floor(n))},function(t){return t.getMinutes()}),Pn.minutes=Pn.minute.range,Pn.minutes.utc=Pn.minute.utc.range,Pn.hour=Rn(function(t){var n=t.getTimezoneOffset()/60;return new Cn(36e5*(Math.floor(t/36e5-n)+n))},function(t,n){t.setTime(t.getTime()+36e5*Math.floor(n))},function(t){return t.getHours()}),Pn.hours=Pn.hour.range,Pn.hours.utc=Pn.hour.utc.range,Pn.month=Rn(function(t){return(t=Pn.day(t)).setDate(1),t},function(t,n){t.setMonth(t.getMonth()+n)},function(t){return t.getMonth()}),Pn.months=Pn.month.range,Pn.months.utc=Pn.month.utc.range;var Ks=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],tl=[[Pn.second,1],[Pn.second,5],[Pn.second,15],[Pn.second,30],[Pn.minute,1],[Pn.minute,5],[Pn.minute,15],[Pn.minute,30],[Pn.hour,1],[Pn.hour,3],[Pn.hour,6],[Pn.hour,12],[Pn.day,1],[Pn.day,2],[Pn.week,1],[Pn.month,1],[Pn.month,3],[Pn.year,1]],nl=Ys.multi([[\".%L\",function(t){return t.getMilliseconds()}],[\":%S\",function(t){return t.getSeconds()}],[\"%I:%M\",function(t){return t.getMinutes()}],[\"%I %p\",function(t){return t.getHours()}],[\"%a %d\",function(t){return t.getDay()&&1!=t.getDate()}],[\"%b %d\",function(t){return 1!=t.getDate()}],[\"%B\",function(t){return t.getMonth()}],[\"%Y\",We]]),el={range:function(n,e,r){return t.range(Math.ceil(n/r)*r,+e,r).map(Js)},floor:E,ceil:E};tl.year=Pn.year,Pn.scale=function(){return Xs(t.scale.linear(),tl,nl)};var rl=tl.map(function(t){return[t[0].utc,t[1]]}),al=Ws.multi([[\".%L\",function(t){return t.getUTCMilliseconds()}],[\":%S\",function(t){return t.getUTCSeconds()}],[\"%I:%M\",function(t){return t.getUTCMinutes()}],[\"%I %p\",function(t){return t.getUTCHours()}],[\"%a %d\",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],[\"%b %d\",function(t){return 1!=t.getUTCDate()}],[\"%B\",function(t){return t.getUTCMonth()}],[\"%Y\",We]]);function il(t){return JSON.parse(t.responseText)}function ol(t){var n=r.createRange();return n.selectNode(r.body),n.createContextualFragment(t.responseText)}rl.year=Pn.year.utc,Pn.scale.utc=function(){return Xs(t.scale.linear(),rl,al)},t.text=Mn(function(t){return t.responseText}),t.json=function(t,n){return mn(t,\"application/json\",il,n)},t.html=function(t,n){return mn(t,\"text/html\",ol,n)},t.xml=Mn(function(t){return t.responseXML}),\"function\"==typeof define&&define.amd?(this.d3=t,define(t)):\"object\"==typeof module&&module.exports?module.exports=t:this.d3=t}(),function(){function t(t,e){return{type:\"Feature\",id:t.id,properties:t.properties,geometry:n(t.geometry,e)}}function n(t,e){if(!t)return null;if(\"GeometryCollection\"===t.type)return{type:\"GeometryCollection\",geometries:object.geometries.map(function(t){return n(t,e)})};if(!l.hasOwnProperty(t.type))return null;var r=l[t.type];return d3.geo.stream(t,e(r)),r.result()}d3.geo.project=function(t,r){var a=r.stream;if(!a)throw new Error(\"not yet supported\");return(t&&e.hasOwnProperty(t.type)?e[t.type]:n)(t,a)};var e={Feature:t,FeatureCollection:function(n,e){return{type:\"FeatureCollection\",features:n.features.map(function(n){return t(n,e)})}}},r=[],a=[],i={point:function(t,n){r.push([t,n])},result:function(){var t=r.length?r.length<2?{type:\"Point\",coordinates:r[0]}:{type:\"MultiPoint\",coordinates:r}:null;return r=[],t}},o={lineStart:u,point:function(t,n){r.push([t,n])},lineEnd:function(){r.length&&(a.push(r),r=[])},result:function(){var t=a.length?a.length<2?{type:\"LineString\",coordinates:a[0]}:{type:\"MultiLineString\",coordinates:a}:null;return a=[],t}},s={polygonStart:u,lineStart:u,point:function(t,n){r.push([t,n])},lineEnd:function(){var t=r.length;if(t){do{r.push(r[0].slice())}while(++t<4);a.push(r),r=[]}},polygonEnd:u,result:function(){if(!a.length)return null;var t=[],n=[];return a.forEach(function(e){!function(t){if((n=t.length)<4)return!1;for(var n,e=0,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r<=0}(e)?n.push(e):t.push([e])}),n.forEach(function(n){var e=n[0];t.some(function(t){if(function(t,n){for(var e=n[0],r=n[1],a=!1,i=0,o=t.length,s=o-1;i<o;s=i++){var l=t[i],u=l[0],c=l[1],h=t[s],f=h[1];c>r^f>r&&e<(h[0]-u)*(r-c)/(f-c)+u&&(a=!a)}return a}(t[0],e))return t.push(n),!0})||t.push([n])}),a=[],t.length?t.length>1?{type:\"MultiPolygon\",coordinates:t}:{type:\"Polygon\",coordinates:t[0]}:null}},l={Point:i,MultiPoint:i,LineString:o,MultiLineString:o,Polygon:s,MultiPolygon:s,Sphere:s};function u(){}var c=1e-6,h=c*c,f=Math.PI,p=f/2,d=Math.sqrt(f),g=f/180,v=180/f;function M(t){return t>0?1:t<0?-1:0}function m(t){return t>1?p:t<-1?-p:Math.asin(t)}function y(t){return t>1?0:t<-1?f:Math.acos(t)}function b(t){return t>0?Math.sqrt(t):0}var w=d3.geo.projection,x=d3.geo.projectionMutator;function k(t){var n=Math.tan(.5*t),e=2*Math.log(Math.cos(.5*t))/(n*n);function r(t,n){var r=Math.cos(t),a=Math.cos(n),i=Math.sin(n),o=a*r,s=-((1-o?Math.log(.5*(1+o))/(1-o):-.5)+e/(1+o));return[s*a*Math.sin(t),s*i]}return r.invert=function(n,r){var a,i=Math.sqrt(n*n+r*r),o=-.5*t,s=50;if(!i)return[0,0];do{var l=.5*o,u=Math.cos(l),h=Math.sin(l),f=Math.tan(l),p=Math.log(1/u);o-=a=(2/f*p-e*f-i)/(-p/(h*h)+1-e/(2*u*u))}while(Math.abs(a)>c&&--s>0);var d=Math.sin(o);return[Math.atan2(n*d,i*Math.cos(o)),m(r*d/i)]},r}function S(t,n){var e,r=Math.cos(n),a=(e=y(r*Math.cos(t/=2)))?e/Math.sin(e):1;return[2*r*Math.sin(t)*a,Math.sin(n)*a]}function _(t){var n=Math.sin(t),e=Math.cos(t),r=t>0?1:-1,a=Math.tan(r*t),i=(1+n-e)/2;function o(t,o){var s=Math.cos(o),l=Math.cos(t/=2);return[(1+s)*Math.sin(t),(r*o>-Math.atan2(l,a)-.001?0:10*-r)+i+Math.sin(o)*e-(1+s)*n*l]}return o.invert=function(t,o){var s=0,l=0,u=50;do{var h=Math.cos(s),f=Math.sin(s),p=Math.cos(l),d=Math.sin(l),g=1+p,v=g*f-t,M=i+d*e-g*n*h-o,m=.5*g*h,y=-f*d,b=.5*n*g*f,w=e*p+n*h*d,x=y*b-w*m,k=.5*(M*y-v*w)/x,S=(v*b-M*m)/x;s-=k,l-=S}while((Math.abs(k)>c||Math.abs(S)>c)&&--u>0);return r*l>-Math.atan2(Math.cos(s),a)-.001?[2*s,l]:null},o}function q(t){return.5*(Math.exp(t)-Math.exp(-t))}function T(t){return.5*(Math.exp(t)+Math.exp(-t))}function z(t,n){var e=Math.tan(n/2),r=b(1-e*e),a=1+r*Math.cos(t/=2),i=Math.sin(t)*r/a,o=e/a,s=i*i,l=o*o;return[4/3*i*(3+s-3*l),4/3*o*(3+3*s-l)]}d3.geo.interrupt=function(t){var n,e=[[[[-f,0],[0,p],[f,0]]],[[[-f,0],[0,-p],[f,0]]]];function r(n,r){for(var a=r<0?-1:1,i=e[+(r<0)],o=0,s=i.length-1;o<s&&n>i[o][2][0];++o);var l=t(n-i[o][1][0],r);return l[0]+=t(i[o][1][0],a*r>a*i[o][0][1]?i[o][0][1]:r)[0],l}function a(){n=e.map(function(n){return n.map(function(n){var e,r=t(n[0][0],n[0][1])[0],a=t(n[2][0],n[2][1])[0],i=t(n[1][0],n[0][1])[1],o=t(n[1][0],n[1][1])[1];return i>o&&(e=i,i=o,o=e),[[r,i],[a,o]]})})}t.invert&&(r.invert=function(a,i){for(var o=n[+(i<0)],s=e[+(i<0)],u=0,c=o.length;u<c;++u){var h=o[u];if(h[0][0]<=a&&a<h[1][0]&&h[0][1]<=i&&i<h[1][1]){var f=t.invert(a-t(s[u][1][0],0)[0],i);return f[0]+=s[u][1][0],l(r(f[0],f[1]),[a,i])?f:null}}});var i=d3.geo.projection(r),o=i.stream;function s(t,n){for(var e,r,a,i=-1,o=t.length,s=t[0],l=[];++i<o;){r=((e=t[i])[0]-s[0])/n,a=(e[1]-s[1])/n;for(var u=0;u<n;++u)l.push([s[0]+u*r,s[1]+u*a]);s=e}return l.push(e),l}function l(t,n){return Math.abs(t[0]-n[0])<c&&Math.abs(t[1]-n[1])<c}return i.stream=function(t){var n=i.rotate(),r=o(t),a=(i.rotate([0,0]),o(t));return i.rotate(n),r.sphere=function(){d3.geo.stream(function(){for(var t=1e-6,n=[],r=0,a=e[0].length;r<a;++r)n.push(s([[(o=180*(i=e[0][r])[0][0]/f)+t,180*i[0][1]/f+t],[o+t,(l=180*i[1][1]/f)-t],[(u=180*i[2][0]/f)-t,l-t],[u-t,180*i[2][1]/f+t]],30));for(r=e[1].length-1;r>=0;--r){var i,o,l,u;n.push(s([[(u=180*(i=e[1][r])[2][0]/f)-t,180*i[2][1]/f-t],[u-t,(l=180*i[1][1]/f)+t],[(o=180*i[0][0]/f)+t,l+t],[o+t,180*i[0][1]/f-t]],30))}return{type:\"Polygon\",coordinates:[d3.merge(n)]}}(),a)},r},i.lobes=function(t){return arguments.length?(e=t.map(function(t){return t.map(function(t){return[[t[0][0]*f/180,t[0][1]*f/180],[t[1][0]*f/180,t[1][1]*f/180],[t[2][0]*f/180,t[2][1]*f/180]]})}),a(),i):e.map(function(t){return t.map(function(t){return[[180*t[0][0]/f,180*t[0][1]/f],[180*t[1][0]/f,180*t[1][1]/f],[180*t[2][0]/f,180*t[2][1]/f]]})})},i},(d3.geo.airy=function(){var t=p,n=x(k),e=n(t);return e.radius=function(e){return arguments.length?n(t=e*f/180):t/f*180},e}).raw=k,S.invert=function(t,n){if(!(t*t+4*n*n>f*f+c)){var e=t,r=n,a=25;do{var i,o=Math.sin(e),s=Math.sin(e/2),l=Math.cos(e/2),u=Math.sin(r),h=Math.cos(r),p=Math.sin(2*r),d=u*u,g=h*h,v=s*s,M=1-g*l*l,m=M?y(h*l)*Math.sqrt(i=1/M):i=0,b=2*m*h*s-t,w=m*u-n,x=i*(g*v+m*h*l*d),k=i*(.5*o*p-2*m*u*s),S=.25*i*(p*s-m*u*g*o),_=i*(d*l+m*v*h),q=k*S-_*x;if(!q)break;var T=(w*k-b*_)/q,z=(b*S-w*x)/q;e-=T,r-=z}while((Math.abs(T)>c||Math.abs(z)>c)&&--a>0);return[e,r]}},(d3.geo.aitoff=function(){return w(S)}).raw=S,(d3.geo.armadillo=function(){var t=f/9,n=t>0?1:-1,e=Math.tan(n*t),r=x(_),a=r(t),i=a.stream;return a.parallel=function(a){return arguments.length?(e=Math.tan((n=(t=a*f/180)>0?1:-1)*t),r(t)):t/f*180},a.stream=function(r){var o=a.rotate(),s=i(r),l=(a.rotate([0,0]),i(r));return a.rotate(o),s.sphere=function(){l.polygonStart(),l.lineStart();for(var r=-180*n;n*r<180;r+=90*n)l.point(r,90*n);for(;n*(r-=t)>=-180;)l.point(r,n*-Math.atan2(Math.cos(r*g/2),e)*v);l.lineEnd(),l.polygonEnd()},s},a}).raw=_,z.invert=function(t,n){if(n*=3/8,!(t*=3/8)&&Math.abs(n)>1)return null;var e=1+t*t+n*n,r=Math.sqrt(.5*(e-Math.sqrt(e*e-4*n*n))),a=m(r)/3,i=r?function(t){return Math.log(t+b(t*t-1))}(Math.abs(n/r))/3:function(t){return Math.log(t+b(t*t+1))}(Math.abs(t))/3,o=Math.cos(a),s=T(i),l=s*s-o*o;return[2*M(t)*Math.atan2(q(i)*o,.25-l),2*M(n)*Math.atan2(s*Math.sin(a),.25+l)]},(d3.geo.august=function(){return w(z)}).raw=z;var E=Math.log(1+Math.SQRT2);function A(t,n){var e=Math.abs(n);return e<f/4?[t,Math.log(Math.tan(f/4+n/2))]:[t*Math.cos(e)*(2*Math.SQRT2-1/Math.sin(e)),M(n)*(2*Math.SQRT2*(e-f/4)-Math.log(Math.tan(e/2)))]}A.invert=function(t,n){if((r=Math.abs(n))<E)return[t,2*Math.atan(Math.exp(n))-p];var e,r,a=Math.sqrt(8),i=f/4,o=25;do{var s=Math.cos(i/2),l=Math.tan(i/2);i-=e=(a*(i-f/4)-Math.log(l)-r)/(a-.5*s*s/l)}while(Math.abs(e)>h&&--o>0);return[t/(Math.cos(i)*(a-1/Math.sin(i))),M(n)*i]},(d3.geo.baker=function(){return w(A)}).raw=A;var N=d3.geo.azimuthalEquidistant.raw;function j(t){var n=2*f/t;function e(t,e){var r=N(t,e);if(Math.abs(t)>p){var a=Math.atan2(r[1],r[0]),i=Math.sqrt(r[0]*r[0]+r[1]*r[1]),o=n*Math.round((a-p)/n)+p,s=Math.atan2(Math.sin(a-=o),2-Math.cos(a));a=o+m(f/i*Math.sin(s))-s,r[0]=i*Math.cos(a),r[1]=i*Math.sin(a)}return r}return e.invert=function(t,e){var r=Math.sqrt(t*t+e*e);if(r>p){var a=Math.atan2(e,t),i=n*Math.round((a-p)/n)+p,o=a>i?-1:1,s=r*Math.cos(i-a),l=1/Math.tan(o*Math.acos((s-f)/Math.sqrt(f*(f-2*s)+r*r)));a=i+2*Math.atan((l+o*Math.sqrt(l*l-3))/3),t=r*Math.cos(a),e=r*Math.sin(a)}return N.invert(t,e)},e}function L(t){return function(n){var e,r=t*Math.sin(n),a=30;do{n-=e=(n+Math.sin(n)-r)/(1+Math.cos(n))}while(Math.abs(e)>c&&--a>0);return n/2}}function P(t,n,e){var r=L(e);function a(e,a){return[t*e*Math.cos(a=r(a)),n*Math.sin(a)]}return a.invert=function(r,a){var i=m(a/n);return[r/(t*Math.cos(i)),m((2*i+Math.sin(2*i))/e)]},a}(d3.geo.berghaus=function(){var t=5,n=x(j),e=n(t),r=e.stream,a=.01,i=-Math.cos(a*g),o=Math.sin(a*g);return e.lobes=function(e){return arguments.length?n(t=+e):t},e.stream=function(n){var s=e.rotate(),l=r(n),u=(e.rotate([0,0]),r(n));return e.rotate(s),l.sphere=function(){u.polygonStart(),u.lineStart();for(var n=0,e=360/t,r=2*f/t,s=90-180/t,l=p;n<t;++n,s-=e,l-=r)u.point(Math.atan2(o*Math.cos(l),i)*v,m(o*Math.sin(l))*v),s<-90?(u.point(-90,-180-s-a),u.point(-90,-180-s+a)):(u.point(90,s+a),u.point(90,s-a));u.lineEnd(),u.polygonEnd()},l},e}).raw=j;var C=L(f),D=P(Math.SQRT2/p,Math.SQRT2,f);function I(t,n){var e=2.00276,r=C(n);return[e*t/(1/Math.cos(n)+1.11072/Math.cos(r)),(n+Math.SQRT2*Math.sin(r))/e]}function R(t){var n=0,e=x(t),r=e(n);return r.parallel=function(t){return arguments.length?e(n=t*f/180):n/f*180},r}function F(t,n){return[t*Math.cos(n),n]}function O(t){if(!t)return F;var n=1/Math.tan(t);function e(e,r){var a=n+t-r,i=a?e*Math.cos(r)/a:a;return[a*Math.sin(i),n-a*Math.cos(i)]}return e.invert=function(e,r){var a=Math.sqrt(e*e+(r=n-r)*r),i=n+t-a;return[a/Math.cos(i)*Math.atan2(e,r),i]},e}function U(t){var n=Math.sin(t);function e(t,e){var r=p-e,a=r?t*n*Math.sin(r)/r:r;return[r*Math.sin(a)/n,p-r*Math.cos(a)]}return e.invert=function(t,e){var r=t*n,a=p-e,i=Math.sqrt(r*r+a*a),o=Math.atan2(r,a);return[(i?i/Math.sin(i):1)*o/n,p-i]},e}(d3.geo.mollweide=function(){return w(D)}).raw=D,I.invert=function(t,n){var e,r,a=2.00276,i=a*n,o=n<0?-f/4:f/4,s=25;do{r=i-Math.SQRT2*Math.sin(o),o-=e=(Math.sin(2*o)+2*o-f*Math.sin(r))/(2*Math.cos(2*o)+2+f*Math.cos(r)*Math.SQRT2*Math.cos(o))}while(Math.abs(e)>c&&--s>0);return r=i-Math.SQRT2*Math.sin(o),[t*(1/Math.cos(r)+1.11072/Math.cos(o))/a,r]},(d3.geo.boggs=function(){return w(I)}).raw=I,F.invert=function(t,n){return[t/Math.cos(n),n]},(d3.geo.sinusoidal=function(){return w(F)}).raw=F,(d3.geo.bonne=function(){return R(O).parallel(45)}).raw=O,(d3.geo.bottomley=function(){var t=f/6,n=d3.geo.projectionMutator(U),e=n(t);return e.variant=function(e){return arguments.length?n(t=+e):t},e}).raw=U;var H=P(1,4/f,f);function B(t){for(var n,e=(t=t.map(function(t){return[t[0],t[1],Math.sin(t[1]),Math.cos(t[1])]}))[2],r=0;r<3;++r,e=n)e.v=Q((n=t[r])[1]-e[1],e[3],e[2],n[3],n[2],n[0]-e[0]),e.point=[0,0];var a=V(t[0].v[0],t[2].v[0],t[1].v[0]),i=V(t[0].v[0],t[1].v[0],t[2].v[0]),o=f-a;t[2].point[1]=0,t[0].point[0]=-(t[1].point[0]=.5*t[0].v[0]);var s=[t[2].point[0]=t[0].point[0]+t[2].v[0]*Math.cos(a),2*(t[0].point[1]=t[1].point[1]=t[2].v[0]*Math.sin(a))];return function(n,e){for(var r=Math.sin(e),a=Math.cos(e),l=new Array(3),u=0;u<3;++u){var c=t[u];if(l[u]=Q(e-c[1],c[3],c[2],a,r,n-c[0]),!l[u][0])return c.point;l[u][1]=G(l[u][1]-c.v[1])}var h=s.slice();for(u=0;u<3;++u){var f=V(t[u].v[0],l[u][0],l[2==u?0:u+1][0]);l[u][1]<0&&(f=-f),u?1==u?(f=i-f,h[0]-=l[u][0]*Math.cos(f),h[1]-=l[u][0]*Math.sin(f)):(f=o-f,h[0]+=l[u][0]*Math.cos(f),h[1]+=l[u][0]*Math.sin(f)):(h[0]+=l[u][0]*Math.cos(f),h[1]-=l[u][0]*Math.sin(f))}return h[0]/=3,h[1]/=3,h}}function Q(t,n,e,r,a,i){var o,s=Math.cos(i);if(Math.abs(t)>1||Math.abs(i)>1)o=y(e*a+n*r*s);else{var l=Math.sin(.5*t),u=Math.sin(.5*i);o=2*m(Math.sqrt(l*l+n*r*u*u))}return Math.abs(o)>c?[o,Math.atan2(r*Math.sin(i),n*a-e*r*s)]:[0,0]}function V(t,n,e){return y(.5*(t*t+n*n-e*e)/(t*n))}function G(t){return t-2*f*Math.floor((t+f)/(2*f))}function Y(t){return[t[0]*g,t[1]*g]}function W(t,n){var e=b(1-Math.sin(n));return[2/d*t*e,d*(1-e)]}function $(t){var n=Math.tan(t);function e(t,e){return[t,(t?t/Math.sin(t):1)*(Math.sin(e)*Math.cos(t)-n*Math.cos(e))]}return e.invert=n?function(t,e){t&&(e*=Math.sin(t)/t);var r=Math.cos(t);return[t,2*Math.atan2(Math.sqrt(r*r+n*n-e*e)-r,n-e)]}:function(t,n){return[t,m(t?n*Math.tan(t)/t:n)]},e}function Z(t,n){var e=Math.sqrt(3);return[e*t*(2*Math.cos(2*n/3)-1)/d,e*d*Math.sin(n/3)]}function X(t){var n=Math.cos(t);function e(t,e){return[t*n,Math.sin(e)/n]}return e.invert=function(t,e){return[t/n,m(e*n)]},e}function J(t){var n=Math.cos(t);function e(t,e){return[t*n,(1+n)*Math.tan(.5*e)]}return e.invert=function(t,e){return[t/n,2*Math.atan(e/(1+n))]},e}function K(t,n){var e=Math.sqrt(8/(3*f));return[e*t*(1-Math.abs(n)/f),e*n]}function tt(t,n){var e=Math.sqrt(4-3*Math.sin(Math.abs(n)));return[2/Math.sqrt(6*f)*t*e,M(n)*Math.sqrt(2*f/3)*(2-e)]}function nt(t,n){var e=Math.sqrt(f*(4+f));return[2/e*t*(1+Math.sqrt(1-4*n*n/(f*f))),4/e*n]}function et(t,n){var e=(2+p)*Math.sin(n);n/=2;for(var r=0,a=1/0;r<10&&Math.abs(a)>c;r++){var i=Math.cos(n);n-=a=(n+Math.sin(n)*(i+2)-e)/(2*i*(1+i))}return[2/Math.sqrt(f*(4+f))*t*(1+Math.cos(n)),2*Math.sqrt(f/(4+f))*Math.sin(n)]}function rt(t,n){return[t*(1+Math.cos(n))/Math.sqrt(2+f),2*n/Math.sqrt(2+f)]}function at(t,n){for(var e=(1+p)*Math.sin(n),r=0,a=1/0;r<10&&Math.abs(a)>c;r++)n-=a=(n+Math.sin(n)-e)/(1+Math.cos(n));return e=Math.sqrt(2+f),[t*(1+Math.cos(n))/e,2*n/e]}function it(t,n){var e=Math.sin(t/=2),r=Math.cos(t),a=Math.sqrt(Math.cos(n)),i=Math.cos(n/=2),o=Math.sin(n)/(i+Math.SQRT2*r*a),s=Math.sqrt(2/(1+o*o)),l=Math.sqrt((Math.SQRT2*i+(r+e)*a)/(Math.SQRT2*i+(r-e)*a));return[ot*(s*(l-1/l)-2*Math.log(l)),ot*(s*o*(l+1/l)-2*Math.atan(o))]}(d3.geo.bromley=function(){return w(H)}).raw=H,(d3.geo.chamberlin=function(){var t=[[0,0],[0,0],[0,0]],n=x(B),e=n(t),r=e.rotate;return delete e.rotate,e.points=function(a){if(!arguments.length)return t;t=a;var i=d3.geo.centroid({type:\"MultiPoint\",coordinates:t}),o=[-i[0],-i[1]];return r.call(e,o),n(t.map(d3.geo.rotation(o)).map(Y))},e.points([[-150,55],[-35,55],[-92.5,10]])}).raw=B,W.invert=function(t,n){var e=(e=n/d-1)*e;return[e>0?t*Math.sqrt(f/e)/2:0,m(1-e)]},(d3.geo.collignon=function(){return w(W)}).raw=W,(d3.geo.craig=function(){return R($)}).raw=$,Z.invert=function(t,n){var e=Math.sqrt(3),r=3*m(n/(e*d));return[d*t/(e*(2*Math.cos(2*r/3)-1)),r]},(d3.geo.craster=function(){return w(Z)}).raw=Z,(d3.geo.cylindricalEqualArea=function(){return R(X)}).raw=X,(d3.geo.cylindricalStereographic=function(){return R(J)}).raw=J,K.invert=function(t,n){var e=Math.sqrt(8/(3*f)),r=n/e;return[t/(e*(1-Math.abs(r)/f)),r]},(d3.geo.eckert1=function(){return w(K)}).raw=K,tt.invert=function(t,n){var e=2-Math.abs(n)/Math.sqrt(2*f/3);return[t*Math.sqrt(6*f)/(2*e),M(n)*m((4-e*e)/3)]},(d3.geo.eckert2=function(){return w(tt)}).raw=tt,nt.invert=function(t,n){var e=Math.sqrt(f*(4+f))/2;return[t*e/(1+b(1-n*n*(4+f)/(4*f))),n*e/2]},(d3.geo.eckert3=function(){return w(nt)}).raw=nt,et.invert=function(t,n){var e=.5*n*Math.sqrt((4+f)/f),r=m(e),a=Math.cos(r);return[t/(2/Math.sqrt(f*(4+f))*(1+a)),m((r+e*(a+2))/(2+p))]},(d3.geo.eckert4=function(){return w(et)}).raw=et,rt.invert=function(t,n){var e=Math.sqrt(2+f),r=n*e/2;return[e*t/(1+Math.cos(r)),r]},(d3.geo.eckert5=function(){return w(rt)}).raw=rt,at.invert=function(t,n){var e=1+p,r=Math.sqrt(e/2);return[2*t*r/(1+Math.cos(n*=r)),m((n+Math.sin(n))/e)]},(d3.geo.eckert6=function(){return w(at)}).raw=at,it.invert=function(t,n){var e=d3.geo.august.raw.invert(t/1.2,1.065*n);if(!e)return null;var r=e[0],a=e[1],i=20;t/=ot,n/=ot;do{var o=r/2,s=a/2,l=Math.sin(o),u=Math.cos(o),h=Math.sin(s),f=Math.cos(s),d=Math.cos(a),g=Math.sqrt(d),v=h/(f+Math.SQRT2*u*g),M=v*v,m=Math.sqrt(2/(1+M)),y=(Math.SQRT2*f+(u+l)*g)/(Math.SQRT2*f+(u-l)*g),b=Math.sqrt(y),w=b-1/b,x=b+1/b,k=m*w-2*Math.log(b)-t,S=m*v*x-2*Math.atan(v)-n,_=h&&Math.SQRT1_2*g*l*M/h,q=(Math.SQRT2*u*f+g)/(2*(f+Math.SQRT2*u*g)*(f+Math.SQRT2*u*g)*g),T=-.5*v*m*m*m,z=T*_,E=T*q,A=(A=2*f+Math.SQRT2*g*(u-l))*A*b,N=(Math.SQRT2*u*f*g+d)/A,j=-Math.SQRT2*l*h/(g*A),L=w*z-2*N/b+m*(N+N/y),P=w*E-2*j/b+m*(j+j/y),C=v*x*z-2*_/(1+M)+m*x*_+m*v*(N-N/y),D=v*x*E-2*q/(1+M)+m*x*q+m*v*(j-j/y),I=P*C-D*L;if(!I)break;var R=(S*P-k*D)/I,F=(k*C-S*L)/I;r-=R,a=Math.max(-p,Math.min(p,a-F))}while((Math.abs(R)>c||Math.abs(F)>c)&&--i>0);return Math.abs(Math.abs(a)-p)<c?[0,a]:i&&[r,a]};var ot=3+2*Math.SQRT2;function st(t,n){var e=Math.tan(n/2);return[t*lt*b(1-e*e),(1+lt)*e]}(d3.geo.eisenlohr=function(){return w(it)}).raw=it,st.invert=function(t,n){var e=n/(1+lt);return[t?t/(lt*b(1-e*e)):0,2*Math.atan(e)]};var lt=Math.cos(35*g);function ut(t,n){var e=n/2,r=Math.cos(e);return[2*t/d*Math.cos(n)*r*r,d*Math.tan(e)]}(d3.geo.fahey=function(){return w(st)}).raw=st,ut.invert=function(t,n){var e=Math.atan(n/d),r=Math.cos(e),a=2*e;return[t*d*.5/(Math.cos(a)*r*r),a]},(d3.geo.foucaut=function(){return w(ut)}).raw=ut,d3.geo.gilbert=function(t){var n=d3.geo.equirectangular().scale(v).translate([0,0]);function e(n){return t([.5*n[0],m(Math.tan(.5*n[1]*g))*v])}return t.invert&&(e.invert=function(n){return(n=t.invert(n))[0]*=2,n[1]=2*Math.atan(Math.sin(n[1]*g))*v,n}),e.stream=function(e){e=t.stream(e);var r=n.stream({point:function(t,n){e.point(.5*t,m(Math.tan(.5*-n*g))*v)},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}});return r.sphere=function(){e.sphere()},r.valid=!1,r},e};var ct=d3.geo.azimuthalEquidistant.raw;function ht(t,n){var e=2*f/n,r=t*t;function a(n,a){var i=ct(n,a),o=i[0],s=i[1],l=o*o+s*s;if(l>r){var u=Math.sqrt(l),h=Math.atan2(s,o),d=e*Math.round(h/e),g=h-d,v=t*Math.cos(g),M=(t*Math.sin(g)-g*Math.sin(v))/(p-v),m=ft(g,M),y=(f-t)/pt(m,v,f);o=u;var b,w=50;do{o-=b=(t+pt(m,v,o)*y-u)/(m(o)*y)}while(Math.abs(b)>c&&--w>0);s=g*Math.sin(o),o<p&&(s-=M*(o-p));var x=Math.sin(d),k=Math.cos(d);i[0]=o*k-s*x,i[1]=o*x+s*k}return i}return a.invert=function(n,a){var i=n*n+a*a;if(i>r){var o=Math.sqrt(i),s=Math.atan2(a,n),l=e*Math.round(s/e),u=s-l;n=o*Math.cos(u),a=o*Math.sin(u);for(var c=n-p,d=Math.sin(n),g=a/d,v=n<p?1/0:0,M=10;;){var m=t*Math.sin(g),y=t*Math.cos(g),b=Math.sin(y),w=p-y,x=(m-g*b)/w,k=ft(g,x);if(Math.abs(v)<h||!--M)break;g-=v=(g*d-x*c-a)/(d-2*c*(w*(y+g*m*Math.cos(y)-b)-m*(m-g*b))/(w*w))}s=l+g,n=(o=t+pt(k,y,n)*(f-t)/pt(k,y,f))*Math.cos(s),a=o*Math.sin(s)}return ct.invert(n,a)},a}function ft(t,n){return function(e){var r=t*Math.cos(e);return e<p&&(r-=n),Math.sqrt(1+r*r)}}function pt(t,n,e){for(var r=(e-n)/50,a=t(n)+t(e),i=1,o=n;i<50;++i)a+=2*t(o+=r);return.5*a*r}function dt(t,n,e,r,a,i,o,s){function l(l,u){if(!u)return[t*l/f,0];var c=u*u,h=t+c*(n+c*(e+c*r)),p=u*(a-1+c*(i-s+c*o)),d=(h*h+p*p)/(2*p),g=l*Math.asin(h/d)/f;return[d*Math.sin(g),u*(1+c*s)+d*(1-Math.cos(g))]}return arguments.length<8&&(s=0),l.invert=function(l,u){var h,p,d=f*l/t,g=u,v=50;do{var M=g*g,m=t+M*(n+M*(e+M*r)),y=g*(a-1+M*(i-s+M*o)),w=m*m+y*y,x=2*y,k=w/x,S=k*k,_=Math.asin(m/k)/f,q=d*_;if(xB2=m*m,dxBd\\u03c6=(2*n+M*(4*e+6*M*r))*g,dyBd\\u03c6=a+M*(3*i+5*M*o),dpd\\u03c6=2*(m*dxBd\\u03c6+y*(dyBd\\u03c6-1)),dqd\\u03c6=2*(dyBd\\u03c6-1),dmd\\u03c6=(dpd\\u03c6*x-w*dqd\\u03c6)/(x*x),cos\\u03b1=Math.cos(q),sin\\u03b1=Math.sin(q),mcos\\u03b1=k*cos\\u03b1,msin\\u03b1=k*sin\\u03b1,d\\u03b1d\\u03c6=d/f*(1/b(1-xB2/S))*(dxBd\\u03c6*k-m*dmd\\u03c6)/S,fx=msin\\u03b1-l,fy=g*(1+M*s)+k-mcos\\u03b1-u,\\u03b4x\\u03b4\\u03c6=dmd\\u03c6*sin\\u03b1+mcos\\u03b1*d\\u03b1d\\u03c6,\\u03b4x\\u03b4\\u03bb=mcos\\u03b1*_,\\u03b4y\\u03b4\\u03c6=1+dmd\\u03c6-(dmd\\u03c6*cos\\u03b1-msin\\u03b1*d\\u03b1d\\u03c6),\\u03b4y\\u03b4\\u03bb=msin\\u03b1*_,denominator=\\u03b4x\\u03b4\\u03c6*\\u03b4y\\u03b4\\u03bb-\\u03b4y\\u03b4\\u03c6*\\u03b4x\\u03b4\\u03bb,!denominator)break;d-=h=(fy*\\u03b4x\\u03b4\\u03c6-fx*\\u03b4y\\u03b4\\u03c6)/denominator,g-=p=(fx*\\u03b4y\\u03b4\\u03bb-fy*\\u03b4x\\u03b4\\u03bb)/denominator}while((Math.abs(h)>c||Math.abs(p)>c)&&--v>0);return[d,g]},l}(d3.geo.gingery=function(){var t=6,n=30*g,e=Math.cos(n),r=Math.sin(n),a=x(ht),i=a(n,t),o=i.stream,s=-Math.cos(.01*g),l=Math.sin(.01*g);return i.radius=function(i){return arguments.length?(e=Math.cos(n=i*g),r=Math.sin(n),a(n,t)):n*v},i.lobes=function(e){return arguments.length?a(n,t=+e):t},i.stream=function(n){var a=i.rotate(),u=o(n),c=(i.rotate([0,0]),o(n));return i.rotate(a),u.sphere=function(){c.polygonStart(),c.lineStart();for(var n=0,a=2*f/t,i=0;n<t;++n,i-=a)c.point(Math.atan2(l*Math.cos(i),s)*v,Math.asin(l*Math.sin(i))*v),c.point(Math.atan2(r*Math.cos(i-a/2),e)*v,Math.asin(r*Math.sin(i-a/2))*v);c.lineEnd(),c.polygonEnd()},u},i}).raw=ht;var gt=dt(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555);(d3.geo.ginzburg4=function(){return w(gt)}).raw=gt;var vt=dt(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742);(d3.geo.ginzburg5=function(){return w(vt)}).raw=vt;var Mt=dt(5/6*f,-.62636,-.0344,0,1.3493,-.05524,0,.045);function mt(t,n){var e=t*t,r=n*n;return[t*(1-.162388*r)*(.87-952426e-9*e*e),n*(1+r/12)]}(d3.geo.ginzburg6=function(){return w(Mt)}).raw=Mt,mt.invert=function(t,n){var e,r=t,a=n,i=50;do{var o=a*a;a-=e=(a*(1+o/12)-n)/(1+o/4)}while(Math.abs(e)>c&&--i>0);i=50,t/=1-.162388*o;do{var s=(s=r*r)*s;r-=e=(r*(.87-952426e-9*s)-t)/(.87-.00476213*s)}while(Math.abs(e)>c&&--i>0);return[r,a]},(d3.geo.ginzburg8=function(){return w(mt)}).raw=mt;var yt=dt(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);function bt(t){var n=t(p,0)[0]-t(-p,0)[0];function e(){var t=!1,n=x(r),e=n(t);return e.quincuncial=function(e){return arguments.length?n(t=!!e):t},e}function r(e){var r=e?function(e,r){var a=Math.abs(e)<p,i=t(a?e:e>0?e-f:e+f,r),o=(i[0]-i[1])*Math.SQRT1_2,s=(i[0]+i[1])*Math.SQRT1_2;if(a)return[o,s];var l=n*Math.SQRT1_2,u=o>0^s>0?-1:1;return[u*o-M(s)*l,u*s-M(o)*l]}:function(e,r){var a=e>0?-.5:.5,i=t(e+a*f,r);return i[0]-=a*n,i};return t.invert&&(r.invert=e?function(e,r){var a=(e+r)*Math.SQRT1_2,i=(r-e)*Math.SQRT1_2,o=Math.abs(a)<.5*n&&Math.abs(i)<.5*n;if(!o){var s=n*Math.SQRT1_2,l=a>0^i>0?-1:1,u=-l*(e+(i>0?1:-1)*s),c=-l*(r+(a>0?1:-1)*s);a=(-u-c)*Math.SQRT1_2,i=(u-c)*Math.SQRT1_2}var h=t.invert(a,i);return o||(h[0]+=a>0?f:-f),h}:function(e,r){var a=e>0?-.5:.5,i=t.invert(e+a*n,r),o=i[0]-a*f;return o<-f?o+=2*f:o>f&&(o-=2*f),i[0]=o,i}),r}return e.raw=r,e}function wt(t,n){var e=M(t),r=M(n),a=Math.cos(n),i=Math.cos(t)*a,o=Math.sin(t)*a,s=Math.sin(r*n);t=Math.abs(Math.atan2(o,s)),n=m(i),Math.abs(t-p)>c&&(t%=p);var l=function(t,n){if(n===p)return[0,0];var e=Math.sin(n),r=e*e,a=r*r,i=1+a,o=1+3*a,s=1-a,l=m(1/Math.sqrt(i)),u=s+r*i*l,h=(1-e)/u,d=Math.sqrt(h),g=h*i,v=Math.sqrt(g),M=d*s;if(0===t)return[0,-(M+r*v)];var y=Math.cos(n),w=1/y,x=2*e*y,k=(-u*y-(-3*r+l*o)*x*(1-e))/(u*u),S=-w*x,_=-w*(r*i*k+h*o*x),q=-2*w*(s*(.5*k/d)-2*r*d*x),T=4*t/f;if(t>.222*f||n<f/4&&t>.175*f){var z=(M+r*b(g*(1+a)-M*M))/(1+a);if(t>f/4)return[z,z];var E=z,A=.5*z,N=50;z=.5*(A+E);do{if(!(D=z*(q+S*(L=Math.sqrt(g-z*z)))+_*m(z/v)-T))break;D<0?A=z:E=z,z=.5*(A+E)}while(Math.abs(E-A)>c&&--N>0)}else{var j;z=c,N=25;do{var L,P=z*z,C=q+S*(L=b(g-P)),D=z*C+_*m(z/v)-T;z-=j=L?D/(C+(_-S*P)/L):0}while(Math.abs(j)>c&&--N>0)}return[z,-M-r*b(g-z*z)]}(t>f/4?p-t:t,n);return t>f/4&&(s=l[0],l[0]=-l[1],l[1]=-s),l[0]*=e,l[1]*=-r,l}function xt(t,n){var e,r,a,i,o,s;if(n<c)return[(i=Math.sin(t))-(e=.25*n*(t-i*(r=Math.cos(t))))*r,r+e*i,1-.5*n*i*i,t-e];if(n>=1-c)return e=.25*(1-n),s=t,a=1/(r=T(t)),[(i=((s=Math.exp(2*s))-1)/(s+1))+e*((o=r*q(t))-t)/(r*r),a-e*i*a*(o-t),a+e*i*a*(o+t),2*Math.atan(Math.exp(t))-p+e*(o-t)/r];var l=[1,0,0,0,0,0,0,0,0],u=[Math.sqrt(n),0,0,0,0,0,0,0,0],h=0;for(r=Math.sqrt(1-n),o=1;Math.abs(u[h]/l[h])>c&&h<8;)e=l[h++],u[h]=.5*(e-r),l[h]=.5*(e+r),r=b(e*r),o*=2;a=o*l[h]*t;do{a=.5*(m(i=u[h]*Math.sin(r=a)/l[h])+a)}while(--h);return[Math.sin(a),i=Math.cos(a),i/Math.cos(a-r),a]}function kt(t,n){if(!n)return t;if(1===n)return Math.log(Math.tan(t/2+f/4));for(var e=1,r=Math.sqrt(1-n),a=Math.sqrt(n),i=0;Math.abs(a)>c;i++){if(t%f){var o=Math.atan(r*Math.tan(t)/e);o<0&&(o+=f),t+=o+~~(t/f)*f}else t+=t;a=(e+r)/2,r=Math.sqrt(e*r),a=((e=a)-r)/2}return t/(Math.pow(2,i)*e)}function St(t,n){var e=(Math.SQRT2-1)/(Math.SQRT2+1),r=Math.sqrt(1-e*e),a=kt(p,r*r),i=Math.log(Math.tan(f/4+Math.abs(n)/2)),o=Math.exp(-1*i)/Math.sqrt(e),s=function(t,n){var e=t*t,r=n+1,a=1-e-n*n;return[.5*((t>=0?p:-p)-Math.atan2(a,2*t)),-.25*Math.log(a*a+4*e)+.5*Math.log(r*r+e)]}(o*Math.cos(-1*t),o*Math.sin(-1*t)),l=function(t,n,e){var r=Math.abs(t),a=q(Math.abs(n));if(r){var i=1/Math.sin(r),o=1/(Math.tan(r)*Math.tan(r)),s=-(o+e*a*a*i*i-1+e),l=.5*(-s+Math.sqrt(s*s-(e-1)*o*4));return[kt(Math.atan(1/Math.sqrt(l)),e)*M(t),kt(Math.atan(b((l/o-1)/e)),1-e)*M(n)]}return[0,kt(Math.atan(a),1-e)*M(n)]}(s[0],s[1],r*r);return[-l[1],(n>=0?1:-1)*(.5*a-l[0])]}function _t(t){var n=Math.sin(t),e=Math.cos(t),r=qt(t);function a(t,a){var i=r(t,a);t=i[0],a=i[1];var o=Math.sin(a),s=Math.cos(a),l=Math.cos(t),u=y(n*o+e*s*l),h=Math.sin(u),f=Math.abs(h)>c?u/h:1;return[f*e*Math.sin(t),(Math.abs(t)>p?f:-f)*(n*s-e*o*l)]}return r.invert=qt(-t),a.invert=function(t,e){var a=Math.sqrt(t*t+e*e),i=-Math.sin(a),o=Math.cos(a),s=a*o,l=-e*i,u=a*n,c=b(s*s+l*l-u*u),h=Math.atan2(s*u+l*c,l*u-s*c),f=(a>p?-1:1)*Math.atan2(t*i,a*Math.cos(h)*o+e*Math.sin(h)*i);return r.invert(f,h)},a}function qt(t){var n=Math.sin(t),e=Math.cos(t);return function(t,r){var a=Math.cos(r),i=Math.cos(t)*a,o=Math.sin(t)*a,s=Math.sin(r);return[Math.atan2(o,i*e-s*n),m(s*e+i*n)]}}(d3.geo.ginzburg9=function(){return w(yt)}).raw=yt,wt.invert=function(t,n){var e=M(t),r=M(n),a=-e*t,i=-r*n,o=i/a<1,s=function(t,n){for(var e=0,r=1,a=.5,i=50;;){var o=a*a,s=Math.sqrt(a),l=Math.asin(1/Math.sqrt(1+o)),u=1-o+a*(1+o)*l,c=(1-s)/u,p=Math.sqrt(c),d=c*(1+o),g=p*(1-o),v=Math.sqrt(d-t*t),M=n+g+a*v;if(Math.abs(r-e)<h||0==--i||0===M)break;M>0?e=a:r=a,a=.5*(e+r)}if(!i)return null;var m=Math.asin(s),y=Math.cos(m),b=1/y,w=2*s*y,x=(-u*y-(-3*a+l*(1+3*o))*w*(1-s))/(u*u);return[f/4*(t*(-2*b*(.5*x/p*(1-o)-2*a*p*w)+-b*w*v)+-b*(a*(1+o)*x+c*(1+3*o)*w)*Math.asin(t/Math.sqrt(d))),m]}(o?i:a,o?a:i),l=s[0],u=s[1];o&&(l=-p-l);var c=Math.cos(u),d=(t=Math.cos(l)*c,n=Math.sin(l)*c,Math.sin(u));return[e*(Math.atan2(n,-d)+f),r*m(t)]},d3.geo.gringorten=bt(wt),St.invert=function(t,n){var e=(Math.SQRT2-1)/(Math.SQRT2+1),r=Math.sqrt(1-e*e),a=function(t,n,e){if(!t)return[[0,(a=xt(n,1-e))[0]/a[1]],[1/a[1],0],[a[2]/a[1],0]];var r=xt(t,e);if(!n)return[[r[0],0],[r[1],0],[r[2],0]];var a,i=(a=xt(n,1-e))[1]*a[1]+e*r[0]*r[0]*a[0]*a[0];return[[r[0]*a[2]/i,r[1]*r[2]*a[0]*a[1]/i],[r[1]*a[1]/i,-r[0]*r[2]*a[0]*a[2]/i],[r[2]*a[1]*a[2]/i,-e*r[0]*r[1]*a[0]/i]]}(.5*kt(p,r*r)-n,-t,r*r),i=function(t,n){var e=n[0]*n[0]+n[1]*n[1];return[(t[0]*n[0]+t[1]*n[1])/e,(t[1]*n[0]-t[0]*n[1])/e]}(a[0],a[1]);return[Math.atan2(i[1],i[0])/-1,2*Math.atan(Math.exp(-.5*Math.log(e*i[0]*i[0]+e*i[1]*i[1])))-p]},d3.geo.guyou=bt(St),(d3.geo.hammerRetroazimuthal=function(){var t=0,n=x(_t),e=n(t),r=e.rotate,a=e.stream,i=d3.geo.circle();return e.parallel=function(r){if(!arguments.length)return t/f*180;var a=e.rotate();return n(t=r*f/180).rotate(a)},e.rotate=function(n){return arguments.length?(r.call(e,[n[0],n[1]-t/f*180]),i.origin([-n[0],-n[1]]),e):((n=r.call(e))[1]+=t/f*180,n)},e.stream=function(t){return(t=a(t)).sphere=function(){t.polygonStart();var n,e=i.angle(89.99)().coordinates[0],r=e.length-1,a=-1;for(t.lineStart();++a<r;)t.point((n=e[a])[0],n[1]);for(t.lineEnd(),r=(e=i.angle(90.01)().coordinates[0]).length-1,t.lineStart();--a>=0;)t.point((n=e[a])[0],n[1]);t.lineEnd(),t.polygonEnd()},t},e}).raw=_t;var Tt=d3.geo.azimuthalEqualArea.raw;function zt(t,n){if(arguments.length<2&&(n=t),1===n)return Tt;if(n===1/0)return Et;function e(e,r){var a=Tt(e/n,r);return a[0]*=t,a}return e.invert=function(e,r){var a=Tt.invert(e/t,r);return a[0]*=n,a},e}function Et(t,n){return[t*Math.cos(n)/Math.cos(n/=2),2*Math.sin(n)]}function At(t,n){for(var e,r=Math.sin(n)*(n<0?2.43763:2.67595),a=0;a<20&&(n-=e=(n+Math.sin(n)-r)/(1+Math.cos(n)),!(Math.abs(e)<c));a++);return[.85*t*Math.cos(n*=.5),Math.sin(n)*(n<0?1.93052:1.75859)]}Et.invert=function(t,n){var e=2*m(n/2);return[t*Math.cos(e/2)/Math.cos(e),e]},(d3.geo.hammer=function(){var t=2,n=x(zt),e=n(t);return e.coefficient=function(e){return arguments.length?n(t=+e):t},e}).raw=zt,At.invert=function(t,n){var e=Math.abs(e=n*(n<0?.5179951515653813:.5686373742600607))>1-c?e>0?p:-p:m(e);return[1.1764705882352942*t/Math.cos(e),Math.abs(e=((e+=e)+Math.sin(e))*(n<0?.4102345310814193:.3736990601468637))>1-c?e>0?p:-p:m(e)]},(d3.geo.hatano=function(){return w(At)}).raw=At;var Nt=41+48/36+37/3600;function jt(t){var n=d3.geo.cylindricalEqualArea.raw(0),e=Nt*f/180,r=2*f,a=d3.geo.collignon.raw(f,e)[0]-d3.geo.collignon.raw(-f,e)[0],i=n(0,e)[1],o=d3.geo.collignon.raw(0,e)[1],s=d3.geo.collignon.raw(0,p)[1]-o,l=2*f/t;function u(u,c){var h,p=Math.abs(c);if(p>e){var d=Math.min(t-1,Math.max(0,Math.floor((u+f)/l)));u+=f*(t-1)/t-d*l,(h=d3.geo.collignon.raw(u,p))[0]=h[0]*r/a-r*(t-1)/(2*t)+d*r/t,h[1]=i+4*(h[1]-o)*s/r,c<0&&(h[1]=-h[1])}else h=n(u,c);return h[0]/=2,h}return u.invert=function(e,u){e*=2;var c=Math.abs(u);if(c>i){var h=Math.min(t-1,Math.max(0,Math.floor((e+f)/l)));e=(e+f*(t-1)/t-h*l)*a/r;var p=d3.geo.collignon.raw.invert(e,.25*(c-i)*r/s+o);return p[0]-=f*(t-1)/t-h*l,u<0&&(p[1]=-p[1]),p}return n.invert(e,u)},u}function Lt(t){var n,e=1+t,r=m(Math.sin(1/e)),a=2*Math.sqrt(f/(n=f+4*r*e)),i=.5*a*(e+Math.sqrt(t*(2+t))),o=t*t,s=e*e;function l(l,u){var c,d,g=1-Math.sin(u);if(g&&g<2){var v,M=p-u,m=25;do{var y=Math.sin(M),b=Math.cos(M),w=r+Math.atan2(y,e-b),x=1+s-2*e*b;M-=v=(M-o*r-e*y+x*w-.5*g*n)/(2*e*y*w)}while(Math.abs(v)>h&&--m>0);c=a*Math.sqrt(x),d=l*w/f}else c=a*(t+g),d=l*r/f;return[c*Math.sin(d),i-c*Math.cos(d)]}return l.invert=function(t,l){var u=t*t+(l-=i)*l,c=(1+s-u/(a*a))/(2*e),h=y(c),p=Math.sin(h),d=r+Math.atan2(p,e-c);return[m(t/Math.sqrt(u))*f/d,m(1-2*(h-o*r-e*p+(1+s-2*e*c)*d)/n)]},l}(d3.geo.healpix=function(){var t=2,n=x(jt),e=n(t),r=e.stream;return e.lobes=function(e){return arguments.length?n(t=+e):t},e.stream=function(n){var a=e.rotate(),i=r(n),o=(e.rotate([0,0]),r(n));return e.rotate(a),i.sphere=function(){var n;d3.geo.stream((n=180/t,{type:\"Polygon\",coordinates:[d3.range(-180,180+n/2,n).map(function(t,n){return[t,1&n?89.999999:Nt]}).concat(d3.range(180,-180-n/2,-n).map(function(t,n){return[t,1&n?-89.999999:-Nt]}))]}),o)},i},e}).raw=jt,(d3.geo.hill=function(){var t=1,n=x(Lt),e=n(t);return e.ratio=function(e){return arguments.length?n(t=+e):t},e}).raw=Lt;var Pt=.7109889596207567,Ct=.0528035274542;function Dt(t,n){return n>-Pt?((t=D(t,n))[1]+=Ct,t):F(t,n)}function It(t,n){return Math.abs(n)>Pt?((t=D(t,n))[1]-=n>0?Ct:-Ct,t):F(t,n)}function Rt(t,n){return[3*t/(2*f)*Math.sqrt(f*f/3-n*n),n]}function Ft(t){function n(n,e){if(Math.abs(Math.abs(e)-p)<c)return[0,e<0?-2:2];var r=Math.sin(e),a=Math.pow((1+r)/(1-r),t/2),i=.5*(a+1/a)+Math.cos(n*=t);return[2*Math.sin(n)/i,(a-1/a)/i]}return n.invert=function(n,e){var r=Math.abs(e);if(Math.abs(r-2)<c)return n?null:[0,M(e)*p];if(r>2)return null;var a=(n/=2)*n,i=(e/=2)*e,o=2*e/(1+a+i);return o=Math.pow((1+o)/(1-o),1/t),[Math.atan2(2*n,1-a-i)/t,m((o-1)/(o+1))]},n}function Ot(t,n){return[t*(1+Math.sqrt(Math.cos(n)))/2,n/(Math.cos(n/2)*Math.cos(t/6))]}function Ut(t,n){var e=t*t,r=n*n;return[t*(.975534+r*(-.0143059*e-.119161+-.0547009*r)),n*(1.00384+e*(.0802894+-.02855*r+199025e-9*e)+r*(.0998909+-.0491032*r))]}function Ht(t,n){return[Math.sin(t)/Math.cos(n),Math.tan(n)*Math.cos(t)]}function Bt(t){var n=Math.cos(t),e=Math.tan(f/4+t/2);function r(r,a){var i=a-t,o=Math.abs(i)<c?r*n:Math.abs(o=f/4+a/2)<c||Math.abs(Math.abs(o)-p)<c?0:r*i/Math.log(Math.tan(o)/e);return[o,i]}return r.invert=function(r,a){var i,o=a+t;return[Math.abs(a)<c?r/n:Math.abs(i=f/4+o/2)<c||Math.abs(Math.abs(i)-p)<c?0:r*Math.log(Math.tan(i)/e)/a,o]},r}function Qt(t,n){return[t,1.25*Math.log(Math.tan(f/4+.4*n))]}function Vt(t){var n=t.length-1;function e(e,r){for(var a,i=Math.cos(r),o=2/(1+i*Math.cos(e)),s=o*i*Math.sin(e),l=o*Math.sin(r),u=n,c=t[u],h=c[0],f=c[1];--u>=0;)h=(c=t[u])[0]+s*(a=h)-l*f,f=c[1]+s*f+l*a;return[h=s*(a=h)-l*f,f=s*f+l*a]}return e.invert=function(e,r){var a=20,i=e,o=r;do{for(var s,l=n,u=t[l],h=u[0],f=u[1],p=0,d=0;--l>=0;)p=h+i*(s=p)-o*d,d=f+i*d+o*s,h=(u=t[l])[0]+i*(s=h)-o*f,f=u[1]+i*f+o*s;var g,v,M=(p=h+i*(s=p)-o*d)*p+(d=f+i*d+o*s)*d;i-=g=((h=i*(s=h)-o*f-e)*p+(f=i*f+o*s-r)*d)/M,o-=v=(f*p-h*d)/M}while(Math.abs(g)+Math.abs(v)>c*c&&--a>0);if(a){var y=Math.sqrt(i*i+o*o),b=2*Math.atan(.5*y),w=Math.sin(b);return[Math.atan2(i*w,y*Math.cos(b)),y?m(o*w/y):0]}},e}Dt.invert=function(t,n){return n>-Pt?D.invert(t,n-Ct):F.invert(t,n)},(d3.geo.sinuMollweide=function(){return w(Dt).rotate([-20,-55])}).raw=Dt,It.invert=function(t,n){return Math.abs(n)>Pt?D.invert(t,n+(n>0?Ct:-Ct)):F.invert(t,n)},(d3.geo.homolosine=function(){return w(It)}).raw=It,Rt.invert=function(t,n){return[2/3*f*t/Math.sqrt(f*f/3-n*n),n]},(d3.geo.kavrayskiy7=function(){return w(Rt)}).raw=Rt,(d3.geo.lagrange=function(){var t=.5,n=x(Ft),e=n(t);return e.spacing=function(e){return arguments.length?n(t=+e):t},e}).raw=Ft,Ot.invert=function(t,n){var e=Math.abs(t),r=Math.abs(n),a=f/Math.SQRT2,i=c,o=p;r<a?o*=r/a:i+=6*y(a/r);for(var s=0;s<25;s++){var l=Math.sin(o),u=b(Math.cos(o)),h=Math.sin(o/2),d=Math.cos(o/2),g=Math.sin(i/6),v=Math.cos(i/6),M=.5*i*(1+u)-e,m=o/(d*v)-r,w=u?-.25*i*l/u:0,x=.5*(1+u),k=(1+.5*o*h/d)/(d*v),S=o/d*(g/6)/(v*v),_=w*S-k*x,q=(M*S-m*x)/_,T=(m*w-M*k)/_;if(o-=q,i-=T,Math.abs(q)<c&&Math.abs(T)<c)break}return[t<0?-i:i,n<0?-o:o]},(d3.geo.larrivee=function(){return w(Ot)}).raw=Ot,Ut.invert=function(t,n){var e=M(t)*f,r=n/2,a=50;do{var i=e*e,o=r*r,s=e*r,l=e*(.975534+o*(-.0143059*i-.119161+-.0547009*o))-t,u=r*(1.00384+i*(.0802894+-.02855*o+199025e-9*i)+o*(.0998909+-.0491032*o))-n,h=.975534-o*(.119161+3*i*.0143059+.0547009*o),p=-s*(.238322+.2188036*o+.0286118*i),d=s*(.1605788+7961e-7*i+-.0571*o),g=1.00384+i*(.0802894+199025e-9*i)+o*(3*(.0998909-.02855*i)-.245516*o),v=p*d-g*h,m=(u*p-l*g)/v,y=(l*d-u*h)/v;e-=m,r-=y}while((Math.abs(m)>c||Math.abs(y)>c)&&--a>0);return a&&[e,r]},(d3.geo.laskowski=function(){return w(Ut)}).raw=Ut,Ht.invert=function(t,n){var e=t*t,r=n*n,a=r+1,i=t?Math.SQRT1_2*Math.sqrt((a-Math.sqrt(e*e+2*e*(r-1)+a*a))/e+1):1/Math.sqrt(a);return[m(t*i),M(n)*y(i)]},(d3.geo.littrow=function(){return w(Ht)}).raw=Ht,(d3.geo.loximuthal=function(){return R(Bt).parallel(40)}).raw=Bt,Qt.invert=function(t,n){return[t,2.5*Math.atan(Math.exp(.8*n))-.625*f]},(d3.geo.miller=function(){return w(Qt)}).raw=Qt;var Gt={alaska:[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48:[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-.00881625,-.00617325]]};function Yt(t,n){var e=Math.sqrt(6),r=Math.sqrt(7),a=Math.asin(7*Math.sin(n)/(3*e));return[e*t*(2*Math.cos(2*a/3)-1)/r,9*Math.sin(a/3)/r]}function Wt(t,n){for(var e,r=(1+Math.SQRT1_2)*Math.sin(n),a=n,i=0;i<25&&(a-=e=(Math.sin(a/2)+Math.sin(a)-r)/(.5*Math.cos(a/2)+Math.cos(a)),!(Math.abs(e)<c));i++);return[t*(1+2*Math.cos(a)/Math.cos(a/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(a/2)/Math.sqrt(2+Math.SQRT2)]}function $t(t,n){for(var e,r=Math.sqrt(6/(4+f)),a=(1+f/4)*Math.sin(n),i=n/2,o=0;o<25&&(i-=e=(i/2+Math.sin(i)-a)/(.5+Math.cos(i)),!(Math.abs(e)<c));o++);return[r*(.5+Math.cos(i))*t/1.5,r*i]}function Zt(t,n){var e=n*n,r=e*e;return[t*(.8707-.131979*e+r*(r*(.003971*e-.001529*r)-.013791)),n*(1.007226+e*(.015085+r*(.028874*e-.044475-.005916*r)))]}function Xt(t,n){return[t*(1+Math.cos(n))/2,2*(n-Math.tan(n/2))]}(d3.geo.modifiedStereographic=function(){var t=Gt.miller,n=x(Vt),e=n(t);return e.coefficients=function(e){return arguments.length?n(t=\"string\"==typeof e?Gt[e]:e):t},e}).raw=Vt,Yt.invert=function(t,n){var e=Math.sqrt(6),r=Math.sqrt(7),a=3*m(n*r/9);return[t*r/(e*(2*Math.cos(2*a/3)-1)),m(3*Math.sin(a)*e/7)]},(d3.geo.mtFlatPolarParabolic=function(){return w(Yt)}).raw=Yt,Wt.invert=function(t,n){var e=n*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),r=2*m(e);return[3*Math.SQRT2*t/(1+2*Math.cos(r)/Math.cos(r/2)),m((e+Math.sin(r))/(1+Math.SQRT1_2))]},(d3.geo.mtFlatPolarQuartic=function(){return w(Wt)}).raw=Wt,$t.invert=function(t,n){var e=Math.sqrt(6/(4+f)),r=n/e;return Math.abs(Math.abs(r)-p)<c&&(r=r<0?-p:p),[1.5*t/(e*(.5+Math.cos(r))),m((r/2+Math.sin(r))/(1+f/4))]},(d3.geo.mtFlatPolarSinusoidal=function(){return w($t)}).raw=$t,Zt.invert=function(t,n){var e,r=n,a=25;do{var i=r*r,o=i*i;r-=e=(r*(1.007226+i*(.015085+o*(.028874*i-.044475-.005916*o)))-n)/(1.007226+i*(.045255+o*(.259866*i-.311325-.005916*11*o)))}while(Math.abs(e)>c&&--a>0);return[t/(.8707+(i=r*r)*(i*(i*i*i*(.003971-.001529*i)-.013791)-.131979)),r]},(d3.geo.naturalEarth=function(){return w(Zt)}).raw=Zt,Xt.invert=function(t,n){for(var e=n/2,r=0,a=1/0;r<10&&Math.abs(a)>c;r++){var i=Math.cos(n/2);n-=a=(n-Math.tan(n/2)-e)/(1-.5/(i*i))}return[2*t/(1+Math.cos(n)),n]},(d3.geo.nellHammer=function(){return w(Xt)}).raw=Xt;var Jt=1.0148,Kt=.23185,tn=-.14499,nn=.02406,en=1.790857183;function rn(t,n){var e=n*n;return[t,n*(Jt+e*e*(Kt+e*(tn+nn*e)))]}rn.invert=function(t,n){n>en?n=en:n<-1.790857183&&(n=-1.790857183);var e,r=n;do{var a=r*r;r-=e=(r*(Jt+a*a*(Kt+a*(tn+nn*a)))-n)/(1.0148+a*a*(1.1592500000000001+a*(.21654*a-1.01493)))}while(Math.abs(e)>c);return[t,r]},(d3.geo.patterson=function(){return w(rn)}).raw=rn;var an=bt(St);function on(t,n){if(Math.abs(n)<c)return[t,0];var e=Math.tan(n),r=t*Math.sin(n);return[Math.sin(r)/e,n+(1-Math.cos(r))/e]}function sn(t){var n=Math.sin(t);function e(e,r){var a=n?Math.tan(e*n/2)/n:e/2;if(!r)return[2*a,-t];var i=2*Math.atan(a*Math.sin(r)),o=1/Math.tan(r);return[Math.sin(i)*o,r+(1-Math.cos(i))*o-t]}return e.invert=function(e,r){if(Math.abs(r+=t)<c)return[n?2*Math.atan(n*e/2)/n:e,0];var a,i=e*e+r*r,o=0,s=10;do{var l=Math.tan(o),u=1/Math.cos(o),h=i-2*r*o+o*o;o-=a=(l*h+2*(o-r))/(2+h*u*u+2*(o-r)*l)}while(Math.abs(a)>c&&--s>0);var p=e*(l=Math.tan(o)),d=Math.tan(Math.abs(r)<Math.abs(o+1/l)?.5*m(p):.5*y(p)+f/4)/Math.sin(o);return[n?2*Math.atan(n*d)/n:2*d,o]},e}(d3.geo.peirceQuincuncial=function(){return an().quincuncial(!0).rotate([-90,-90,45]).clipAngle(179.999999)}).raw=an.raw,on.invert=function(t,n){if(Math.abs(n)<c)return[t,0];var e,r=t*t+n*n,a=.5*n,i=10;do{var o=Math.tan(a),s=1/Math.cos(a),l=r-2*n*a+a*a;a-=e=(o*l+2*(a-n))/(2+l*s*s+2*(a-n)*o)}while(Math.abs(e)>c&&--i>0);return o=Math.tan(a),[(Math.abs(n)<Math.abs(a+1/o)?m(t*o):M(t)*(y(Math.abs(t*o))+p))/Math.sin(a),a]},(d3.geo.polyconic=function(){return w(on)}).raw=on,(d3.geo.rectangularPolyconic=function(){return R(sn)}).raw=sn;var ln=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];function un(t,n){var e,r=Math.min(18,36*Math.abs(n)/f),a=Math.floor(r),i=r-a,o=(e=ln[a])[0],s=e[1],l=(e=ln[++a])[0],u=e[1],c=(e=ln[Math.min(19,++a)])[0],h=e[1];return[t*(l+i*(c-o)/2+i*i*(c-2*l+o)/2),(n>0?p:-p)*(u+i*(h-s)/2+i*i*(h-2*u+s)/2)]}function cn(t,n){var e=function(t){function n(n,e){var r=Math.cos(e),a=(t-1)/(t-r*Math.cos(n));return[a*r*Math.sin(n),a*Math.sin(e)]}return n.invert=function(n,e){var r=n*n+e*e,a=Math.sqrt(r),i=(t-Math.sqrt(1-r*(t+1)/(t-1)))/((t-1)/a+a/(t-1));return[Math.atan2(n*i,a*Math.sqrt(1-i*i)),a?m(e*i/a):0]},n}(t);if(!n)return e;var r=Math.cos(n),a=Math.sin(n);function i(n,i){var o=e(n,i),s=o[1],l=s*a/(t-1)+r;return[o[0]*r/l,s/l]}return i.invert=function(n,i){var o=(t-1)/(t-1-i*a);return e.invert(o*n,o*i*r)},i}function hn(t,n){var e=Math.tan(n/2),r=Math.sin(f/4*e);return[t*(.74482-.34588*r*r),1.70711*e]}function fn(t){if(!t)return d3.geo.azimuthalEquidistant.raw;var n=-t/2,e=-n,r=t*t,a=Math.tan(e),i=.5/Math.sin(e);function o(a,i){var o=y(Math.cos(i)*Math.cos(a-n)),s=y(Math.cos(i)*Math.cos(a-e));return[((o*=o)-(s*=s))/(2*t),(i<0?-1:1)*b(4*r*s-(r-o+s)*(r-o+s))/(2*t)]}return o.invert=function(t,r){var o,s,l=r*r,u=Math.cos(Math.sqrt(l+(o=t+n)*o)),c=Math.cos(Math.sqrt(l+(o=t+e)*o));return[Math.atan2(s=u-c,o=(u+c)*a),(r<0?-1:1)*y(Math.sqrt(o*o+s*s)*i)]},o}function pn(t){var n=Math.cos(t);function e(t,e){var r=d3.geo.gnomonic.raw(t,e);return r[0]*=n,r}return e.invert=function(t,e){return d3.geo.gnomonic.raw.invert(t/n,e)},e}function dn(t,n){if(Math.abs(n)<c)return[t,0];var e=Math.abs(n/p),r=m(e);if(Math.abs(t)<c||Math.abs(Math.abs(n)-p)<c)return[0,M(n)*f*Math.tan(r/2)];var a=Math.cos(r),i=Math.abs(f/t-t/f)/2,o=i*i,s=a/(e+a-1),l=s*(2/e-1),u=l*l,h=u+o,d=s-u,g=o+s;return[M(t)*f*(i*d+Math.sqrt(o*d*d-h*(s*s-u)))/h,M(n)*f*(l*g-i*Math.sqrt((o+1)*h-g*g))/h]}function gn(t,n){if(Math.abs(n)<c)return[t,0];var e=Math.abs(n/p),r=m(e);if(Math.abs(t)<c||Math.abs(Math.abs(n)-p)<c)return[0,M(n)*f*Math.tan(r/2)];var a=Math.cos(r),i=Math.abs(f/t-t/f)/2,o=i*i,s=a*(Math.sqrt(1+o)-i*a)/(1+o*e*e);return[M(t)*f*s,M(n)*f*b(1-s*(2*i+s))]}function vn(t,n){if(Math.abs(n)<c)return[t,0];var e=n/p,r=m(e);if(Math.abs(t)<c||Math.abs(Math.abs(n)-p)<c)return[0,f*Math.tan(r/2)];var a=(f/t-t/f)/2,i=e/(1+Math.cos(r));return[f*(M(t)*b(a*a+1-i*i)-a),f*i]}function Mn(t,n){if(!n)return[t,0];var e=Math.abs(n);if(!t||e===p)return[0,n];var r=e/p,a=r*r,i=(8*r-a*(a+2)-5)/(2*a*(r-1)),o=i*i,s=r*i,l=a+o+2*s,u=r+3*i,c=t/p,h=c+1/c,f=M(Math.abs(t)-p)*Math.sqrt(h*h-4),d=f*f,g=(f*(l+o-1)+2*b(l*(a+o*d-1)+(1-a)*(a*(u*u+4*o)+12*s*o+4*o*o)))/(4*l+d);return[M(t)*p*g,M(n)*p*b(1+f*Math.abs(g)-g*g)]}ln.forEach(function(t){t[1]*=1.0144}),un.invert=function(t,n){var e=n/p,r=90*e,a=Math.min(18,Math.abs(r/5)),i=Math.max(0,Math.floor(a));do{var o=ln[i][1],s=ln[i+1][1],l=ln[Math.min(19,i+2)][1],u=l-o,c=l-2*s+o,f=2*(Math.abs(e)-s)/u,d=c/u,M=f*(1-d*f*(1-2*d*f));if(M>=0||1===i){r=(n>=0?5:-5)*(M+a);var m,y=50;do{M=(a=Math.min(18,Math.abs(r)/5))-(i=Math.floor(a)),o=ln[i][1],s=ln[i+1][1],l=ln[Math.min(19,i+2)][1],r-=(m=(n>=0?p:-p)*(s+M*(l-o)/2+M*M*(l-2*s+o)/2)-n)*v}while(Math.abs(m)>h&&--y>0);break}}while(--i>=0);var b=ln[i][0],w=ln[i+1][0],x=ln[Math.min(19,i+2)][0];return[t/(w+M*(x-b)/2+M*M*(x-2*w+b)/2),r*g]},(d3.geo.robinson=function(){return w(un)}).raw=un,(d3.geo.satellite=function(){var t=1.4,n=0,e=x(cn),r=e(t,n);return r.distance=function(r){return arguments.length?e(t=+r,n):t},r.tilt=function(r){return arguments.length?e(t,n=r*f/180):180*n/f},r}).raw=cn,hn.invert=function(t,n){var e=n/1.70711,r=Math.sin(f/4*e);return[t/(.74482-.34588*r*r),2*Math.atan(e)]},(d3.geo.times=function(){return w(hn)}).raw=hn,(d3.geo.twoPointEquidistant=function(){var t=[[0,0],[0,0]],n=x(fn),e=n(0),r=e.rotate;return delete e.rotate,e.points=function(e){if(!arguments.length)return t;t=e;var a=d3.geo.interpolate(e[0],e[1]),i=a(.5),o=d3.geo.rotation([-i[0],-i[1]])(e[0]),s=.5*a.distance,l=-m(Math.sin(o[1]*g)/Math.sin(s));return o[0]>0&&(l=f-l),r.call(o,[-i[0],-i[1],-l*v]),n(2*s)},e}).raw=fn,(d3.geo.twoPointAzimuthal=function(){var t=[[0,0],[0,0]],n=x(pn),e=n(0),r=e.rotate;return delete e.rotate,e.points=function(e){if(!arguments.length)return t;t=e;var a=d3.geo.interpolate(e[0],e[1]),i=a(.5),o=d3.geo.rotation([-i[0],-i[1]])(e[0]),s=.5*a.distance,l=-m(Math.sin(o[1]*g)/Math.sin(s));return o[0]>0&&(l=f-l),r.call(o,[-i[0],-i[1],-l*v]),n(s)},e}).raw=pn,dn.invert=function(t,n){if(Math.abs(n)<c)return[t,0];if(Math.abs(t)<c)return[0,p*Math.sin(2*Math.atan(n/f))];var e=(t/=f)*t,r=(n/=f)*n,a=e+r,i=a*a,o=-Math.abs(n)*(1+a),s=o-2*r+e,l=-2*o+1+2*r+i,u=r/l+(2*s*s*s/(l*l*l)-9*o*s/(l*l))/27,h=(o-s*s/(3*l))/l,d=2*Math.sqrt(-h/3),g=y(3*u/(h*d))/3;return[f*(a-1+Math.sqrt(1+2*(e-r)+i))/(2*t),M(n)*f*(-d*Math.cos(g+f/3)-s/(3*l))]},(d3.geo.vanDerGrinten=function(){return w(dn)}).raw=dn,gn.invert=function(t,n){if(!t)return[0,p*Math.sin(2*Math.atan(n/f))];var e=Math.abs(t/f),r=(1-e*e-(n/=f)*n)/(2*e),a=Math.sqrt(r*r+1);return[M(t)*f*(a-r),M(n)*p*Math.sin(2*Math.atan2(Math.sqrt((1-2*r*e)*(r+a)-e),Math.sqrt(a+r+e)))]},(d3.geo.vanDerGrinten2=function(){return w(gn)}).raw=gn,vn.invert=function(t,n){if(!n)return[t,0];var e=n/f,r=(f*f*(1-e*e)-t*t)/(2*f*t);return[t?f*(M(t)*Math.sqrt(r*r+1)-r):0,p*Math.sin(2*Math.atan(e))]},(d3.geo.vanDerGrinten3=function(){return w(vn)}).raw=vn,Mn.invert=function(t,n){if(!t||!n)return[t,n];n/=f;var e=M(t)*t/p,r=(e*e-1+4*n*n)/Math.abs(e),a=r*r,i=2*n,o=50;do{var s=i*i,l=(8*i-s*(s+2)-5)/(2*s*(i-1)),u=(3*i-s*i-10)/(2*s*i),h=l*l,d=i*l,g=i+l,v=g*g,m=i+3*l,y=-2*g*(4*d*h+(1-4*s+3*s*s)*(1+u)+h*(14*s-6-a+(8*s-8-2*a)*u)+d*(12*s-8+(10*s-10-a)*u)),b=Math.sqrt(v*(s+h*a-1)+(1-s)*(s*(m*m+4*h)+h*(12*d+4*h)));i-=\\u03b4=(r*(v+h-1)+2*b-e*(4*v+a))/(r*(2*l*u+2*g*(1+u))+y/b-8*g*(r*(-1+h+v)+2*b)*(1+u)/(a+4*v))}while(\\u03b4>c&&--o>0);return[M(t)*(Math.sqrt(r*r+4)+r)*f/4,p*i]},(d3.geo.vanDerGrinten4=function(){return w(Mn)}).raw=Mn;var mn,yn,bn=(mn=4*f+3*Math.sqrt(3),P((yn=2*Math.sqrt(2*f*Math.sqrt(3)/mn))*Math.sqrt(3)/f,yn,mn/6));function wn(t,n){return[t*Math.sqrt(1-3*n*n/(f*f)),n]}function xn(t,n){var e=.90631*Math.sin(n),r=Math.sqrt(1-e*e),a=Math.sqrt(2/(1+r*Math.cos(t/=3)));return[2.66723*r*a*Math.sin(t),1.24104*e*a]}function kn(t,n){var e=Math.cos(n),r=Math.cos(t)*e,a=1-r,i=Math.cos(t=Math.atan2(Math.sin(t)*e,-Math.sin(n))),o=Math.sin(t);return[o*(e=b(1-r*r))-i*a,-i*e-o*a]}function Sn(t,n){var e=S(t,n);return[(e[0]+t/p)/2,(e[1]+n)/2]}function _n(t,n){var e=Math.cos(n),r=Math.tan(n),a=Math.cos(t),i=Math.sin(t);return[Math.asin(e*i),Math.atan2(r,a)]}(d3.geo.wagner4=function(){return w(bn)}).raw=bn,wn.invert=function(t,n){return[t/Math.sqrt(1-3*n*n/(f*f)),n]},(d3.geo.wagner6=function(){return w(wn)}).raw=wn,xn.invert=function(t,n){var e=t/2.66723,r=n/1.24104,a=Math.sqrt(e*e+r*r),i=2*m(a/2);return[3*Math.atan2(t*Math.tan(i),2.66723*a),a&&m(n*Math.sin(i)/(1.24104*.90631*a))]},(d3.geo.wagner7=function(){return w(xn)}).raw=xn,kn.invert=function(t,n){var e=-.5*(t*t+n*n),r=Math.sqrt(-e*(2+e)),a=n*e+t*r,i=t*e-n*r,o=Math.sqrt(i*i+a*a);return[Math.atan2(r*a,o*(1+e)),o?-m(r*i/o):0]},(d3.geo.wiechel=function(){return w(kn)}).raw=kn,Sn.invert=function(t,n){var e=t,r=n,a=25;do{var i,o=Math.cos(r),s=Math.sin(r),l=Math.sin(2*r),u=s*s,h=o*o,f=Math.sin(e),d=Math.cos(e/2),g=Math.sin(e/2),v=g*g,M=1-h*d*d,m=M?y(o*d)*Math.sqrt(i=1/M):i=0,b=.5*(2*m*o*g+e/p)-t,w=.5*(m*s+r)-n,x=.5*i*(h*v+m*o*d*u)+.5/p,k=i*(f*l/4-m*s*g),S=.125*i*(l*g-m*s*h*f),_=.5*i*(u*d+m*v*o)+.5,q=k*S-_*x,T=(w*k-b*_)/q,z=(b*S-w*x)/q;e-=T,r-=z}while((Math.abs(T)>c||Math.abs(z)>c)&&--a>0);return[e,r]},(d3.geo.winkel3=function(){return w(Sn)}).raw=Sn,_n.invert=function(t,n){return[Math.asin(Math.cos(t)*Math.sin(n)),Math.atan2(Math.tan(t),Math.cos(n))]},(d3.geo.cassini=function(){return w(_n)}).raw=_n}();","name":"scripts.909df6cfe560f0770b37.js","input":"// Copyright 2015-2020 Olaf Frohn https://github.com/ofrohn, see LICENSE\n!(function() {\r\nvar Celestial = {\r\n  version: '0.7.35',\r\n  container: null,\r\n  data: []\r\n};\r\n\r\nvar ANIMDISTANCE = 0.035,  // Rotation animation threshold, ~2deg in radians\r\n    ANIMSCALE = 1.4,       // Zoom animation threshold, scale factor\r\n    ANIMINTERVAL_R = 2000, // Rotation duration scale in ms\r\n    ANIMINTERVAL_P = 2500, // Projection duration in ms\r\n    ANIMINTERVAL_Z = 1500, // Zoom duration scale in ms\r\n    zoomextent = 10,       // Default maximum extent of zoom (max/min)\r\n    zoomlevel = 1;         // Default zoom level, 1 = 100%\r\n\r\nvar cfg, mapProjection, parentElement, zoom, map, circle, daylight, starnames = {}, dsonames = {};\r\n\r\n// Show it all, with the given config, otherwise with default settings\r\nCelestial.display = function(config) {\r\n  var animationID,\r\n      container = Celestial.container,\r\n      animations = [], \r\n      current = 0, \r\n      repeat = false;\r\n  \r\n  //Mash config with default settings, todo: if globalConfig exists, make another one\r\n  cfg = settings.set(config).applyDefaults(config);\r\n  if (isNumber(cfg.zoomextend)) zoomextent = cfg.zoomextend;\r\n  if (isNumber(cfg.zoomlevel)) zoomlevel = cfg.zoomlevel;\r\n  //if (cfg.disableAnimations) ANIMDISTANCE = Infinity;\r\n\r\n  var parent = document.getElementById(cfg.container);\r\n  if (parent) { \r\n    parentElement = \"#\" + cfg.container;\r\n    var st = window.getComputedStyle(parent, null);\r\n    if (!parseInt(st.width) && !cfg.width) parent.style.width = px(parent.parentNode.clientWidth); \r\n  } else { \r\n    parentElement = \"body\"; \r\n    parent = null; \r\n  }\r\n   \r\n  var margin = [16, 16],\r\n      width = getWidth(),\r\n      canvaswidth = isNumber(cfg.background.width) ? width + cfg.background.width : width,\r\n      pixelRatio = window.devicePixelRatio || 1,\r\n      projectionSetting = getProjection(cfg.projection, cfg.projectionRatio);\r\n\r\n  if (!projectionSetting) return;\r\n\r\n  if (cfg.lines.graticule.lat && cfg.lines.graticule.lat.pos[0] === \"outline\") projectionSetting.scale -= 2;\r\n        \r\n  var ratio = projectionSetting.ratio,\r\n      height = Math.round(width / ratio),\r\n      canvasheight = Math.round(canvaswidth / ratio),\r\n      scale = projectionSetting.scale * width/1024,\r\n      starbase = cfg.stars.size, \r\n      dsobase = cfg.dsos.size || starbase,\r\n      starexp = cfg.stars.exponent,\r\n      dsoexp = cfg.dsos.exponent || starexp, //Object size base & exponent\r\n      adapt = 1,\r\n      rotation = getAngles(cfg.center),\r\n      path = cfg.datapath;\r\n     \r\n  if (parentElement !== \"body\") parent.style.height = px(canvasheight);\r\n  \r\n  mapProjection = Celestial.projection(cfg.projection).rotate(rotation).translate([canvaswidth/2, canvasheight/2]).scale(scale * zoomlevel);\r\n    \r\n  zoom = d3.geo.zoom().projection(mapProjection).center([canvaswidth/2, canvasheight/2]).scaleExtent([scale, scale * zoomextent]).on(\"zoom.redraw\", redraw);\r\n  // Set initial zoom level\r\n  scale *= zoomlevel;\r\n\r\n  var canvas = d3.select(parentElement).selectAll(\"canvas\"),\r\n      culture = (cfg.culture !== \"\" && cfg.culture !== \"iau\") ? cfg.culture : \"\";\r\n  \r\n  if (canvas[0].length === 0) canvas = d3.select(parentElement).append(\"canvas\");\r\n  //canvas.attr(\"width\", width).attr(\"height\", height);\r\n  canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\r\n  var context = canvas.node().getContext(\"2d\");  \r\n  context.setTransform(pixelRatio,0,0,pixelRatio,0,0);\r\n\r\n  var graticule = d3.geo.graticule().minorStep([15,10]);\r\n  \r\n  map = d3.geo.path().projection(mapProjection).context(context);\r\n   \r\n  //parent div with id #celestial-map or body\r\n  if (container) container.selectAll(parentElement + \" *\").remove();\r\n  else container = d3.select(parentElement).append(\"container\");\r\n\r\n  if (cfg.interactive) {\r\n    canvas.call(zoom);\r\n    d3.select(parentElement).on('dblclick', function () { zoomBy(1.5625); return false; });\r\n  } else {\r\n    canvas.attr(\"style\", \"cursor: default!important\");\r\n  }\r\n\r\n  setClip(projectionSetting.clip);\r\n\r\n  d3.select(window).on('resize', resize);\r\n\r\n  if (cfg.interactive === true && cfg.controls === true && $(\"celestial-zoomin\") === null) {\r\n    d3.select(parentElement).append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"celestial-zoomin\").attr(\"value\", \"\\u002b\").on(\"click\", function () { zoomBy(1.25); return false; });\r\n    d3.select(parentElement).append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"celestial-zoomout\").attr(\"value\", \"\\u2212\").on(\"click\", function () { zoomBy(0.8); return false; });\r\n  }\r\n  \r\n  circle = d3.geo.circle().angle([90]);  \r\n  daylight = d3.geo.circle().angle([179.9]);\r\n\r\n  form(cfg);\r\n  \r\n  if ($(\"error\") === null) d3.select(\"body\").append(\"div\").attr(\"id\", \"error\");\r\n\r\n  if ($(\"loc\") === null) geo(cfg);\r\n  else if (cfg.location === true && cfg.follow === \"zenith\") rotate({center: Celestial.zenith()});\r\n\r\n  if (cfg.location === true || cfg.formFields.location === true) {\r\n    d3.select(parentElement + \" #location\").style(\"display\", \"inline-block\");\r\n    fldEnable(\"horizon-show\", projectionSetting.clip);\r\n    fldEnable(\"daylight-show\", !projectionSetting.clip);\r\n  }\r\n\r\n  function load() {\r\n    //Background\r\n    setClip(projectionSetting.clip);\r\n    container.append(\"path\").datum(graticule.outline).attr(\"class\", \"outline\"); \r\n    container.append(\"path\").datum(circle).attr(\"class\", \"horizon\");\r\n    container.append(\"path\").datum(daylight).attr(\"class\", \"daylight\");\r\n    //Celestial planes\r\n    if (cfg.transform === \"equatorial\") graticule.minorStep([15,10]);\r\n    else  graticule.minorStep([10,10]);\r\n    for (var key in cfg.lines) {\r\n      if (!has(cfg.lines, key)) continue;\r\n      if (key === \"graticule\") {\r\n        container.append(\"path\").datum(graticule).attr(\"class\", \"graticule\"); \r\n        if (has(cfg.lines.graticule, \"lon\") && cfg.lines.graticule.lon.pos.length > 0) \r\n          container.selectAll(parentElement + \" .gridvalues_lon\")\r\n            .data(getGridValues(\"lon\", cfg.lines.graticule.lon.pos))\r\n            .enter().append(\"path\")\r\n            .attr(\"class\", \"graticule_lon\"); \r\n        if (has(cfg.lines.graticule, \"lat\") && cfg.lines.graticule.lat.pos.length > 0) \r\n          container.selectAll(parentElement + \" .gridvalues_lat\")\r\n            .data(getGridValues(\"lat\", cfg.lines.graticule.lat.pos))\r\n            .enter().append(\"path\")\r\n            .attr(\"class\", \"graticule_lat\"); \r\n      } else {\r\n        container.append(\"path\")\r\n          .datum(d3.geo.circle().angle([90]).origin(transformDeg(poles[key], euler[cfg.transform])) )\r\n          .attr(\"class\", key);\r\n      }\r\n    }\r\n\r\n    //Milky way outline\r\n    d3.json(path + \"mw.json\", function(error, json) {\r\n      if (error) { \r\n        window.alert(\"Data file could not be loaded or doesn't exist. See readme.md\");\r\n        return console.warn(error);  \r\n      }\r\n\r\n      var mw = getData(json, cfg.transform);\r\n      var mw_back = getMwbackground(mw);\r\n\r\n      container.selectAll(parentElement + \" .mway\")\r\n         .data(mw.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"mw\");\r\n      container.selectAll(parentElement + \" .mwaybg\")\r\n         .data(mw_back.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"mwbg\");\r\n      redraw();\r\n    }); \r\n\r\n    //Constellation names or designation\r\n    d3.json(path + filename(\"constellations\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      \r\n      var con = getData(json, cfg.transform);\r\n      container.selectAll(parentElement + \" .constnames\")\r\n         .data(con.features)\r\n         .enter().append(\"text\")\r\n         .attr(\"class\", \"constname\");\r\n         \r\n      Celestial.constellations = getConstellationList(con);\r\n      redraw();\r\n    });\r\n\r\n    //Constellation boundaries\r\n    d3.json(path + filename(\"constellations\", \"borders\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      \r\n      //var cb = getData(topojson.feature(json, json.objects.constellations_bounds), cfg.transform);\r\n      var cb = getData(json, cfg.transform);\r\n      \r\n      container.selectAll(parentElement + \" .bounds\")\r\n         .data(cb.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"boundaryline\");\r\n      redraw();\r\n    });\r\n\r\n    //Constellation lines\r\n    d3.json(path + filename(\"constellations\", \"lines\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n\r\n      var conl = getData(json, cfg.transform);\r\n\r\n      container.selectAll(parentElement + \" .lines\")\r\n         .data(conl.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"constline\");\r\n\r\n      listConstellations();\r\n      redraw();\r\n    });\r\n    \r\n    //Stars\r\n    d3.json(path + cfg.stars.data, function(error, json) {\r\n      if (error) return console.warn(error);\r\n\r\n      var st = getData(json, cfg.transform);\r\n\r\n      container.selectAll(parentElement + \" .stars\")\r\n         .data(st.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"star\");\r\n      redraw();\r\n\r\n    });\r\n\r\n    //Star names\r\n    d3.json(path + filename(\"starnames\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      Object.assign(starnames, json);\r\n      redraw();\r\n    });\r\n\r\n    //Deep space objects\r\n    d3.json(path + cfg.dsos.data, function(error, json) {\r\n      if (error) return console.warn(error);\r\n      \r\n      var ds = getData(json, cfg.transform);\r\n\r\n      container.selectAll(parentElement + \" .dsos\")\r\n         .data(ds.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"dso\" );\r\n      redraw();\r\n    });\r\n\r\n    //DSO names\r\n    d3.json(path + filename(\"dsonames\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      Object.assign(dsonames, json);\r\n      redraw();\r\n    });\r\n\r\n    //Planets, Sun & Moon\r\n    d3.json(path + filename(\"planets\"), function(error, json) {\r\n      if (error) return console.warn(error);\r\n      \r\n      var pl = getPlanets(json, cfg.transform);\r\n\r\n      container.selectAll(parentElement + \" .planets\")\r\n         .data(pl)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"planet\");\r\n      redraw();\r\n    });\r\n\r\n    if (Celestial.data.length > 0) { \r\n      Celestial.data.forEach( function(d) {\r\n        if (has(d, \"file\")) d3.json(d.file, d.callback);\r\n        else setTimeout(d.callback, 0);\r\n      }, this);\r\n    }\r\n  \r\n    if (cfg.lang && cfg.lang != \"\") apply(Celestial.setLanguage(cfg.lang));\r\n    //redraw();\r\n  }\r\n  \r\n  // Zoom by factor; >1 larger <1 smaller \r\n  function zoomBy(factor) {\r\n    if (!factor || factor === 1) return;\r\n    var sc0 = mapProjection.scale(),\r\n        sc1 = sc0 * factor,\r\n        ext = zoom.scaleExtent(),\r\n        interval = ANIMINTERVAL_Z * Math.sqrt(Math.abs(1-factor));\r\n        \r\n    if (sc1 < ext[0]) sc1 = ext[0];\r\n    if (sc1 > ext[1]) sc1 = ext[1];\r\n    if (cfg.disableAnimations === true) { \r\n      mapProjection.scale(sc1); \r\n      zoom.scale(sc1); \r\n      redraw(); \r\n      return 0; \r\n    }\r\n    var zTween = d3.interpolateNumber(sc0, sc1);\r\n    d3.select({}).transition().duration(interval).tween(\"scale\", function () {\r\n        return function(t) {\r\n          var z = zTween(t);\r\n          mapProjection.scale(z); \r\n          redraw(); \r\n        };\r\n    }).transition().duration(0).tween(\"scale\", function () {\r\n      zoom.scale(sc1); \r\n      redraw(); \r\n    });\r\n    return interval;\r\n  }  \r\n  \r\n  function apply(config) {\r\n    cfg = settings.set(config); \r\n    redraw();\r\n  }\r\n\r\n\r\n  function rotate(config) {\r\n    var cFrom = cfg.center, \r\n        rot = mapProjection.rotate(),\r\n        sc = mapProjection.scale(),\r\n        interval = ANIMINTERVAL_R,\r\n        keep = false, \r\n        cTween, zTween, oTween,\r\n        oof = cfg.orientationfixed;\r\n    \r\n    if (Round(rot[1], 1) === -Round(config.center[1], 1)) keep = true; //keep lat fixed if equal\r\n    cfg = cfg.set(config);\r\n    var d = Round(d3.geo.distance(cFrom, cfg.center), 2);\r\n    var o = d3.geo.distance([cFrom[2],0], [cfg.center[2],0]);\r\n    if ((d < ANIMDISTANCE && o < ANIMDISTANCE) || cfg.disableAnimations === true) { \r\n      rotation = getAngles(cfg.center);\r\n      mapProjection.rotate(rotation);\r\n      redraw();\r\n      return 0; \r\n    } \r\n    // Zoom interpolator\r\n    if (sc > scale * ANIMSCALE) zTween = d3.interpolateNumber(sc, scale);\r\n    else zTween = function () { return sc; };\r\n    // Orientation interpolator\r\n    if (o === 0) oTween = function () { return rot[2]; };\r\n    else oTween = interpolateAngle(cFrom[2], cfg.center[2]);\r\n    if (d > 3.14) cfg.center[0] -= 0.01; //180deg turn doesn't work well\r\n    cfg.orientationfixed = false;  \r\n    // Rotation interpolator\r\n    if (d === 0) cTween = function () { return cfg.center; };\r\n    else cTween = d3.geo.interpolate(cFrom, cfg.center);\r\n    interval = (d !== 0) ? interval * d : interval * o; // duration scaled by ang. distance\r\n    d3.select({}).transition().duration(interval).tween(\"center\", function () {\r\n      return function(t) {\r\n        var c = getAngles(cTween(t));\r\n        c[2] = oTween(t);\r\n        var z = t < 0.5 ? zTween(t) : zTween(1-t);\r\n        if (keep) c[1] = rot[1]; \r\n        mapProjection.scale(z);\r\n        mapProjection.rotate(c);\r\n        redraw();\r\n      };\r\n    }).transition().duration(0).tween(\"center\", function () {\r\n      cfg.orientationfixed = oof;\r\n      rotation = getAngles(cfg.center);\r\n      mapProjection.rotate(rotation);\r\n      redraw();\r\n    });\r\n    return interval;\r\n  }\r\n  \r\n  function resize(set) {\r\n    width = getWidth();\r\n    if (cfg.width === width && !set) return;\r\n    height = width/ratio;\r\n    canvaswidth = isNumber(cfg.background.width) ? width + cfg.background.width : width;\r\n    canvasheight = Math.round(canvaswidth / ratio);\r\n\r\n    scale = projectionSetting.scale * width/1024;\r\n    //canvas.attr(\"width\", width).attr(\"height\", height);\r\n    canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\r\n    zoom.scaleExtent([scale, scale * zoomextent]).scale(scale * zoomlevel);\r\n    mapProjection.translate([canvaswidth/2, canvasheight/2]).scale(scale * zoomlevel);\r\n    if (parent) parent.style.height = px(height);\r\n    scale *= zoomlevel;\r\n    redraw();\r\n  }\r\n\r\n  function reproject(config) {\r\n    var prj = getProjection(config.projection, config.projectionRatio);\r\n    if (!prj) return;\r\n    \r\n    var rot = mapProjection.rotate(), ctr = mapProjection.center(), sc = mapProjection.scale(), ext = zoom.scaleExtent(), clip = [],\r\n        prjFrom = Celestial.projection(cfg.projection).center(ctr).translate([canvaswidth/2, canvasheight/2]).scale([ext[0]]),\r\n        interval = ANIMINTERVAL_P, \r\n        delay = 0, clipTween = null,\r\n        rTween = d3.interpolateNumber(ratio, prj.ratio);\r\n\r\n    if (projectionSetting.clip != prj.clip || cfg.disableAnimations === true) {\r\n      interval = 0; // Different clip = no transition\r\n    }\r\n    /*if (projectionSetting.clip !== prj.clip) {\r\n      clipTween = d3.interpolateNumber(projectionSetting.clip ? 90 : 180, prj.clip ? 90 : 180); // Clipangle from - to\r\n    } else*/ setClip(prj.clip);\r\n    \r\n    var prjTo = Celestial.projection(config.projection).center(ctr).translate([canvaswidth/2, canvaswidth/prj.ratio/2]).scale([prj.scale * width/1024]);\r\n    var bAdapt = cfg.adaptable;\r\n\r\n    if (sc > ext[0]) {\r\n      delay = zoomBy(0.1);\r\n      setTimeout(reproject, delay, config);\r\n      return delay + interval;\r\n    }\r\n    \r\n    if (cfg.location || cfg.formFields.location) { \r\n      fldEnable(\"horizon-show\", prj.clip);\r\n      fldEnable(\"daylight-show\", !prj.clip);\r\n    }\r\n    \r\n    mapProjection = projectionTween(prjFrom, prjTo);\r\n    cfg.adaptable = false;\r\n\r\n    d3.select({}).transition().duration(interval).tween(\"projection\", function () {\r\n      return function(_) {\r\n        mapProjection.alpha(_).rotate(rot);\r\n        map.projection(mapProjection);\r\n        /*if (clipTween) mapProjection.clipAngle(clipTween(_));\r\n        else*/setClip(prj.clip);\r\n        ratio = rTween(_);\r\n        height = width/ratio;\r\n        //canvas.attr(\"width\", width).attr(\"height\", height);\r\n        canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\",  canvasheight * pixelRatio);\r\n        if (parent) parent.style.height = px(canvasheight);\r\n        redraw();\r\n      };\r\n    }).transition().duration(0).tween(\"projection\", function () {\r\n      projectionSetting = prj;\r\n      ratio = projectionSetting.ratio;\r\n      height = width / projectionSetting.ratio;\r\n      canvasheight = isNumber(cfg.background.width) ? height + cfg.background.width : height;\r\n      scale = projectionSetting.scale * width/1024;\r\n      //canvas.attr(\"width\", width).attr(\"height\", height);\r\n      canvas.style(\"width\", px(canvaswidth)).style(\"height\", px(canvasheight)).attr(\"width\", canvaswidth * pixelRatio).attr(\"height\", canvasheight * pixelRatio);\r\n      if (parent) parent.style.height = px(canvasheight);\r\n      cfg.projection = config.projection;\r\n      mapProjection = Celestial.projection(config.projection).rotate(rot).translate([canvaswidth/2, canvasheight/2]).scale(scale * zoomlevel);\r\n      map.projection(mapProjection);\r\n      setClip(projectionSetting.clip); \r\n      zoom.projection(mapProjection).scaleExtent([scale, scale * zoomextent]).scale(scale * zoomlevel);\r\n      cfg.adaptable = bAdapt;\r\n      scale *= zoomlevel;\r\n      redraw();\r\n    });\r\n    return interval;\r\n  }\r\n\r\n  \r\n  function redraw() {  \r\n    var rot = mapProjection.rotate();\r\n    \r\n    context.setTransform(pixelRatio,0,0,pixelRatio,0,0);\r\n    if (cfg.adaptable) adapt = Math.sqrt(mapProjection.scale()/scale);\r\n    if (!adapt) adapt = 1;\r\n    starbase = cfg.stars.size;\r\n    starexp = cfg.stars.exponent;\r\n    dsobase = cfg.dsos.size || starbase;\r\n    dsoexp = cfg.dsos.exponent;\r\n    \r\n    if (cfg.orientationfixed && cfg.center.length > 2) {\r\n      rot[2] = cfg.center[2]; \r\n      mapProjection.rotate(rot);\r\n    }\r\n    cfg.center = [-rot[0], -rot[1], rot[2]];\r\n    \r\n    setCenter(cfg.center, cfg.transform);\r\n    clear();\r\n    \r\n    drawOutline();\r\n    \r\n    //Draw all types of objects on the canvas\r\n    if (cfg.mw.show) { \r\n      container.selectAll(parentElement + \" .mw\").each(function(d) { setStyle(cfg.mw.style); map(d); context.fill(); });\r\n      // paint mw-outside in background color\r\n      if (cfg.transform !== \"supergalactic\" && cfg.background.opacity > 0.95)\r\n        container.selectAll(parentElement + \" .mwbg\").each(function(d) { setStyle(cfg.background); map(d); context.fill(); });\r\n    }\r\n    \r\n    for (var key in cfg.lines) {\r\n      if (!has(cfg.lines, key)) continue;\r\n      if (cfg.lines[key].show !== true) continue;\r\n      setStyle(cfg.lines[key]);\r\n      container.selectAll(parentElement + \" .\" + key).attr(\"d\", map);  \r\n      context.stroke(); \r\n    }\r\n\r\n    if (has(cfg.lines.graticule, \"lon\")) {\r\n      setTextStyle(cfg.lines.graticule.lon);\r\n      container.selectAll(parentElement + \" .graticule_lon\").each(function(d, i) { \r\n        if (clip(d.geometry.coordinates)) {\r\n          var pt = mapProjection(d.geometry.coordinates);\r\n          gridOrientation(pt, d.properties.orientation);\r\n          context.fillText(d.properties.value, pt[0], pt[1]); \r\n        }\r\n      });\r\n    }\r\n    \r\n    if (has(cfg.lines.graticule, \"lat\")) {\r\n      setTextStyle(cfg.lines.graticule.lat);\r\n      container.selectAll(parentElement + \" .graticule_lat\").each(function(d, i) { \r\n        if (clip(d.geometry.coordinates)) {\r\n          var pt = mapProjection(d.geometry.coordinates);\r\n          gridOrientation(pt, d.properties.orientation);\r\n          context.fillText(d.properties.value, pt[0], pt[1]); \r\n        }\r\n      });\r\n    }\r\n    \r\n    if (cfg.constellations.bounds) { \r\n      container.selectAll(parentElement + \" .boundaryline\").each(function(d) { \r\n        setStyle(cfg.constellations.boundStyle); \r\n        if (Celestial.constellation) {\r\n          var re = new RegExp(\"\\\\b\" + Celestial.constellation + \"\\\\b\");\r\n          if (d.ids.search(re) !== -1) {\r\n            context.lineWidth *= 1.5;\r\n            context.globalAlpha = 1;\r\n            context.setLineDash([]);\r\n          }\r\n        }\r\n        map(d); \r\n        context.stroke(); \r\n      });\r\n      context.setLineDash([]);\r\n    }\r\n\r\n    if (cfg.constellations.lines) { \r\n      container.selectAll(parentElement + \" .constline\").each(function(d) { \r\n        setStyleA(d.properties.rank, cfg.constellations.lineStyle); \r\n        map(d); \r\n        context.stroke(); \r\n      });\r\n    }\r\n    \r\n    drawOutline(true);    \r\n\r\n    if (cfg.constellations.names) { \r\n      //setTextStyle(cfg.constellations.nameStyle);\r\n      container.selectAll(parentElement + \" .constname\").each( function(d) { \r\n        if (clip(d.geometry.coordinates)) {\r\n          setStyleA(d.properties.rank, cfg.constellations.nameStyle);\r\n          var pt = mapProjection(d.geometry.coordinates);\r\n          context.fillText(constName(d), pt[0], pt[1]); \r\n        }\r\n      });\r\n    }\r\n      \r\n\r\n    if (cfg.stars.show) { \r\n      setStyle(cfg.stars.style);\r\n      container.selectAll(parentElement + \" .star\").each(function(d) {\r\n        if (clip(d.geometry.coordinates) && d.properties.mag <= cfg.stars.limit) {\r\n          var pt = mapProjection(d.geometry.coordinates),\r\n              r = starSize(d);\r\n          context.fillStyle = starColor(d); \r\n          context.beginPath();\r\n          context.arc(pt[0], pt[1], r, 0, 2 * Math.PI);\r\n          context.closePath();\r\n          context.fill();\r\n          if (cfg.stars.designation && d.properties.mag <= cfg.stars.designationLimit*adapt) {\r\n            setTextStyle(cfg.stars.designationStyle);\r\n            context.fillText(starDesignation(d.id), pt[0]+r, pt[1]);\r\n          }\r\n          if (cfg.stars.propername && d.properties.mag <= cfg.stars.propernameLimit*adapt) {\r\n            setTextStyle(cfg.stars.propernameStyle);\r\n            context.fillText(starPropername(d.id), pt[0]-r, pt[1]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    \r\n    if (cfg.dsos.show) { \r\n      container.selectAll(parentElement + \" .dso\").each(function(d) {\r\n        if (clip(d.geometry.coordinates) && dsoDisplay(d.properties, cfg.dsos.limit)) {\r\n          var pt = mapProjection(d.geometry.coordinates),\r\n              type = d.properties.type;\r\n          if (cfg.dsos.colors === true) setStyle(cfg.dsos.symbols[type]);\r\n          else setStyle(cfg.dsos.style);\r\n          var r = dsoSymbol(d, pt);\r\n          if (has(cfg.dsos.symbols[type], \"stroke\")) context.stroke();\r\n          else context.fill();\r\n          \r\n          if (cfg.dsos.names && dsoDisplay(d.properties, cfg.dsos.nameLimit*adapt)) {\r\n            setTextStyle(cfg.dsos.nameStyle);\r\n            if (cfg.dsos.colors === true) context.fillStyle = cfg.dsos.symbols[type].fill;\r\n            context.fillText(dsoName(d), pt[0]+r, pt[1]-r);      \r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if ((cfg.location || cfg.formFields.location) && cfg.planets.show && Celestial.origin) { \r\n      var dt = Celestial.date(),\r\n          o = Celestial.origin(dt).spherical();\r\n      container.selectAll(parentElement + \" .planet\").each(function(d) {\r\n        var id = d.id(), r = 12 * adapt,\r\n            p = d(dt).equatorial(o),\r\n            pos = transformDeg(p.ephemeris.pos, euler[cfg.transform]);  //transform; \r\n        if (clip(pos)) {\r\n          var pt = mapProjection(pos),\r\n              sym = cfg.planets.symbols[id];\r\n          if (cfg.planets.symbolType === \"letter\") {\r\n            setTextStyle(cfg.planets.symbolStyle);\r\n            context.fillStyle = sym.fill;\r\n            context.fillText(sym.letter, pt[0], pt[1]);\r\n          } else if (id === \"lun\") {\r\n            if (has(sym, \"size\") && isNumber(sym.size)) r = sym.size * adapt;\r\n            context.fillStyle = sym.fill;\r\n            Canvas.symbol().type(\"crescent\").size(r*r).age(p.ephemeris.age).position(pt)(context);\r\n          } else if (cfg.planets.symbolType === \"disk\") {\r\n            r = has(sym, \"size\") && isNumber(sym.size) ? sym.size * adapt : planetSize(p.ephemeris);\r\n            context.fillStyle = sym.fill;\r\n            Canvas.symbol().type(\"circle\").size(r*r).position(pt)(context);\r\n            context.fill();\r\n          } else if (cfg.planets.symbolType === \"symbol\") {\r\n            setTextStyle(cfg.planets.symbolStyle);\r\n            context.font = planetSymbol(cfg.planets.symbolStyle.font);\r\n            context.fillStyle = sym.fill;\r\n            context.fillText(sym[cfg.planets.symbolType], pt[0], pt[1]);            \r\n          }\r\n          //name\r\n          if (cfg.planets.names) {\r\n            var name = p[cfg.planets.namesType];\r\n            setTextStyle(cfg.planets.nameStyle);\r\n            //context.direction = \"ltr\" || \"rtl\" ar il ir\r\n            context.fillStyle = sym.fill;\r\n            context.fillText(name, pt[0] - r/2, pt[1] + r/2);                        \r\n          }\r\n        }\r\n      });\r\n    }\r\n    \r\n    if (Celestial.data.length > 0) { \r\n      Celestial.data.forEach( function(d) {\r\n        d.redraw();\r\n      });\r\n    }\r\n    \r\n    if ((cfg.location || cfg.formFields.location) && cfg.daylight.show && projectionSetting.clip) {\r\n      var sol = getPlanet(\"sol\");\r\n      if (sol) {\r\n        var up = Celestial.zenith(),\r\n            solpos = sol.ephemeris.pos,\r\n            dist = d3.geo.distance(up, solpos),\r\n            pt = mapProjection(solpos);\r\n\r\n        daylight.origin(solpos);\r\n        setSkyStyle(dist, pt);\r\n        container.selectAll(parentElement + \" .daylight\").datum(daylight).attr(\"d\", map);\r\n        context.fill();    \r\n        context.fillStyle = \"#fff\"; \r\n        if (clip(solpos)) {\r\n          context.beginPath();\r\n          context.arc(pt[0], pt[1], 6, 0, 2 * Math.PI);\r\n          context.closePath();\r\n          context.fill();\r\n        }\r\n      }\r\n    }\r\n\r\n    if ((cfg.location || cfg.formFields.location) && cfg.horizon.show && !projectionSetting.clip) {\r\n      circle.origin(Celestial.nadir());\r\n      setStyle(cfg.horizon);\r\n      container.selectAll(parentElement + \" .horizon\").datum(circle).attr(\"d\", map);  \r\n      context.fill(); \r\n      if (cfg.horizon.stroke) context.stroke(); \r\n    }\r\n\r\n    if (cfg.controls) { \r\n      zoomState(mapProjection.scale());\r\n    }\r\n    \r\n    if (hasCallback) { \r\n      Celestial.runCallback();\r\n    }\r\n    \r\n    //Celestial.updateForm();\r\n\r\n  }\r\n    \r\n\r\n  function drawOutline(stroke) {\r\n    var rot = mapProjection.rotate(),\r\n        prj = getProjection(cfg.projection, config.projectionRatio);\r\n    \r\n    mapProjection.rotate([0,0]);\r\n    setStyle(cfg.background);\r\n    container.selectAll(parentElement + \" .outline\").attr(\"d\", map);\r\n    if (stroke === true) {\r\n      context.globalAlpha = 1;      \r\n      context.stroke(); \r\n    } else {\r\n      context.fill();\r\n    }\r\n    mapProjection.rotate(rot);\r\n  }\r\n\r\n  // Helper functions -------------------------------------------------\r\n  \r\n  function clip(coords) {\r\n    return projectionSetting.clip && d3.geo.distance(cfg.center, coords) > halfπ ? 0 : 1;\r\n  }\r\n\r\n  function setStyle(s) {\r\n    context.fillStyle = s.fill || null;\r\n    context.strokeStyle = s.stroke || null;\r\n    context.lineWidth = s.width || null;\r\n    context.globalAlpha = s.opacity !== null ? s.opacity : 1;  \r\n    context.font = s.font || null;\r\n    if (has(s, \"dash\")) context.setLineDash(s.dash); else context.setLineDash([]);\r\n    context.beginPath();\r\n  }\r\n\r\n  function setTextStyle(s) {\r\n    context.fillStyle = s.fill;\r\n    context.textAlign = s.align || \"left\";\r\n    context.textBaseline = s.baseline || \"bottom\";\r\n    context.globalAlpha = s.opacity !== null ? s.opacity : 1;  \r\n    context.font = s.font;\r\n  }\r\n\r\n  function setStyleA(rank, s) {\r\n    rank = rank || 1;\r\n    context.fillStyle = isArray(s.fill) ? s.fill[rank-1] : null;\r\n    context.strokeStyle = isArray(s.stroke) ? s.stroke[rank-1] : null;\r\n    context.lineWidth = isArray(s.width) ? s.width[rank-1] : null;\r\n    context.globalAlpha = isArray(s.opacity) ? s.opacity[rank-1] : 1;  \r\n    context.font = isArray(s.font) ? s.font[rank-1] : null;\r\n    if (has(s, \"dash\")) context.setLineDash(s.dash); else context.setLineDash([]);\r\n    context.textAlign = s.align || \"left\";\r\n    context.textBaseline = s.baseline || \"bottom\";\r\n    context.beginPath();\r\n  }\r\n\r\n  function setSkyStyle(dist, pt) {\r\n    var factor, color1, color2, color3,\r\n        upper = 1.36, \r\n        lower = 1.885;\r\n    \r\n    if (dist > lower) {\r\n      context.fillStyle = \"transparent\"; \r\n      context.globalAlpha = 0;\r\n      return;\r\n    }\r\n    \r\n    if (dist <= upper) { \r\n      color1 = \"#daf1fa\";\r\n      color2 = \"#93d7f0\"; \r\n      color3 = \"#57c0e8\"; \r\n      factor = -(upper-dist) / 10; \r\n    } else {\r\n      factor = (dist - upper) / (lower - upper);\r\n      color1 = d3.interpolateLab(\"#daf1fa\", \"#e8c866\")(factor);\r\n      color2 = d3.interpolateLab(\"#93c7d0\", \"#ff854a\")(factor);\r\n      color3 = d3.interpolateLab(\"#57b0c8\", \"#6caae2\")(factor);\r\n    }\r\n    var grad = context.createRadialGradient(pt[0],pt[1],0, pt[0],pt[1],300);\r\n    grad.addColorStop(0, color1);\r\n    grad.addColorStop(0.2+0.4*factor, color2);\r\n    grad.addColorStop(1, color3);\r\n    context.fillStyle = grad;\r\n    context.globalAlpha = 0.9 * (1 - skyTransparency(factor, 1.4));\r\n  }\r\n  \r\n  function skyTransparency(t, a) {\r\n    return (Math.pow(Math.E, t*a) - 1) / (Math.pow(Math.E, a) - 1);\r\n  }\r\n  \r\n  function zoomState(sc) {\r\n    var czi = $(\"celestial-zoomin\"),\r\n        czo = $(\"celestial-zoomout\"),\r\n        defscale = projectionSetting.scale * width/1024;\r\n    if (!czi || !czo) return;\r\n    czi.disabled = sc >= defscale * zoomextent * 0.99;\r\n    czo.disabled = sc <= defscale; \r\n  }\r\n  \r\n  function setClip(setit) {\r\n    if (setit) { mapProjection.clipAngle(90); } \r\n    else { mapProjection.clipAngle(null); }        \r\n  }\r\n  \r\n  function filename(what, sub, ext) {\r\n    var cult = (has(formats[what], culture)) ? \".\" + culture : \"\";\r\n    ext = ext ? \".\" + ext : \".json\";\r\n    sub = sub ? \".\" + sub : \"\";\r\n    return what + sub + cult + ext;\r\n  }\r\n  \r\n  function dsoDisplay(prop, limit) {\r\n    return prop.mag === 999 && Math.sqrt(parseInt(prop.dim)) > limit ||\r\n           prop.mag !== 999 && prop.mag <= limit;\r\n  }\r\n  \r\n  function dsoSymbol(d, pt) {\r\n    var prop = d.properties;\r\n    var size = dsoSize(prop) || 9,\r\n        type = dsoShape(prop.type);\r\n    Canvas.symbol().type(type).size(size).position(pt)(context);\r\n    return Math.sqrt(size)/2;\r\n  }\r\n\r\n  function dsoShape(type) {\r\n    if (!type || !has(cfg.dsos.symbols, type)) return \"circle\"; \r\n    else return cfg.dsos.symbols[type].shape; \r\n  }\r\n\r\n  function dsoSize(prop) {\r\n    if (!prop.mag || prop.mag === 999) return Math.pow(parseInt(prop.dim) * dsobase * adapt / 7, 0.5); \r\n    return Math.pow(2 * dsobase * adapt - prop.mag, dsoexp);\r\n  }\r\n \r\n\r\n  function dsoName(d) {\r\n    //return d.properties[cfg.dsos.namesType]; \r\n    var lang = cfg.dsos.namesType, id = d.id;\r\n    if (lang === \"desig\" || !has(dsonames, id)) return d.properties.desig;\r\n    return has(dsonames[id], lang) ? dsonames[id][lang] : d.properties.desig; \r\n  }\r\n  \r\n  /* Star designation  */\r\n  function starDesignation(id) {\r\n    if (!has(starnames, id)) return \"\";\r\n    return starnames[id][cfg.stars.designationType]; \r\n  }\r\n\r\n  function starPropername(id) {\r\n    var lang = cfg.stars.propernameType;\r\n    if (!has(starnames, id)) return \"\";\r\n    return has(starnames[id], lang) ? starnames[id][lang] : starnames[id].name; \r\n  }\r\n  \r\n  function starSize(d) {\r\n    var mag = d.properties.mag;\r\n    if (mag === null) return 0.1; \r\n    var r = starbase * adapt * Math.exp(starexp * (mag+2));\r\n    return Math.max(r, 0.1);\r\n  }\r\n\r\n  \r\n  function starColor(d) {\r\n    var bv = d.properties.bv;\r\n    if (!cfg.stars.colors || isNaN(bv)) {return cfg.stars.style.fill; }\r\n    return bvcolor(bv);\r\n  }\r\n  \r\n  function constName(d) { \r\n    return d.properties[cfg.constellations.namesType]; \r\n  }\r\n\r\n  function planetSize(d) {\r\n    var mag = d.mag;\r\n    if (mag === null) return 2; \r\n    var r = 4 * adapt * Math.exp(-0.05 * (mag+2));\r\n    return Math.max(r, 2);\r\n  }\r\n \r\n  function planetSymbol(s) {\r\n    var size = s.replace(/(^\\D*)(\\d+)(\\D.+$)/i,'$2');\r\n    size = Math.round(adapt * size);\r\n    return s.replace(/(^\\D*)(\\d+)(\\D.+$)/i,'$1' + size + '$3');\r\n  }\r\n \r\n  function gridOrientation(pos, orient) {\r\n    var o = orient.split(\"\"), h = \"center\", v = \"middle\"; \r\n    for (var i = o.length-1; i >= 0; i--) {\r\n      switch(o[i]) {\r\n        case \"N\": v = \"bottom\"; break;\r\n        case \"S\": v = \"top\"; break;\r\n        case \"E\": h = \"left\"; pos[0] += 2; break;\r\n        case \"W\": h = \"right\";  pos[0] -= 2; break;\r\n      }\r\n    }\r\n    context.textAlign = h;\r\n    context.textBaseline = v;\r\n    return pos;\r\n  }\r\n  \r\n  function clear() {\r\n    context.clearRect(0, 0, canvaswidth + margin[0], canvasheight + margin[1]);\r\n  }\r\n  \r\n  function getWidth() {\r\n    var w = 0;\r\n    if (isNumber(cfg.width) && cfg.width > 0) w = cfg.width;\r\n    else if (parent) w = parent.getBoundingClientRect().width - margin[0] *2;\r\n    else w = window.getBoundingClientRect().width - margin[0]*2;\r\n    //if (isNumber(cfg.background.width)) w -= cfg.background.width;\r\n    return w;\r\n  }\r\n  \r\n  function getProjection(p, ratioOverride) {\r\n    if (!has(projections, p)) return;\r\n    var res = projections[p];\r\n    if (!has(res, \"ratio\")) res.ratio = 2;  // Default w/h ratio 2:1    \r\n    res.ratio = ratioOverride ? ratioOverride : res.ratio;\r\n    return res;\r\n  }\r\n \r\n  \r\n  function animate() {\r\n    if (!animations || animations.length < 1) return;\r\n\r\n    var d, a = animations[current];\r\n    \r\n    switch (a.param) {\r\n      case \"projection\": d = reproject({projection:a.value}); break;\r\n      case \"center\": d = rotate({center:a.value}); break;\r\n      case \"zoom\": d = zoomBy(a.value);\r\n    }\r\n    if (a.callback) setTimeout(a.callback, d);\r\n    current++;\r\n    if (repeat === true && current === animations.length) current = 0;\r\n    d = a.duration === 0 || a.duration < d ? d : a.duration;\r\n    if (current < animations.length) animationID = setTimeout(animate, d);\r\n  }\r\n  \r\n  function stop() {\r\n    clearTimeout(animationID);\r\n    //current = 0;\r\n    //repeat = false;\r\n  }\r\n\r\n  \r\n  // Exported objects and functions for adding data\r\n  this.container = container;\r\n  this.clip = clip;\r\n  this.map = map;\r\n  this.mapProjection = mapProjection;\r\n  this.context = context;\r\n  this.metrics = function() {\r\n    return {\"width\": width, \"height\": height, \"margin\": margin, \"scale\": mapProjection.scale()};\r\n  };\r\n  this.setStyle = setStyle;\r\n  this.setTextStyle = setTextStyle;\r\n  this.setStyleA = setStyleA;\r\n  this.setConstStyle = function(rank, font) { \r\n    var f = arrayfy(font);\r\n    context.font = f[rank];    \r\n  };\r\n  this.symbol = Canvas.symbol;\r\n  this.dsoSymbol = dsoSymbol;\r\n  this.redraw = redraw; \r\n  this.resize = function(config) { \r\n    if (config !== undefined) {  \r\n      if (has(config, \"width\")) cfg.width = config.width; \r\n      else if (isNumber(config)) cfg.width = config;\r\n    }\r\n    resize(true); \r\n    return cfg.width;\r\n  }; \r\n  this.reload = function(config) { \r\n    var ctr;\r\n    //if (!config || !has(config, \"transform\")) return;\r\n    //cfg.transform = config.transform; \r\n    if (config) Object.assign(cfg, settings.set(config));\r\n    if (cfg.follow === \"center\" && has(cfg, \"center\")) {\r\n      ctr = getAngles(cfg.center);\r\n    } else if (cfg.follow === \"zenith\") {\r\n      ctr = getAngles(Celestial.zenith());\r\n    } \r\n    if (ctr) mapProjection.rotate(ctr);\r\n    container.selectAll(parentElement + \" *\").remove(); \r\n    load(); \r\n  }; \r\n  this.apply = function(config) { apply(config); }; \r\n  this.reproject = function(config) { return reproject(config); }; \r\n  this.rotate = function(config) { if (!config) return cfg.center; return rotate(config); }; \r\n  this.zoomBy = function(factor) { if (!factor) return mapProjection.scale()/scale; return zoomBy(factor); };\r\n  this.color = function(type) {\r\n    if (!type) return \"#000\";\r\n    if (has(cfg.dsos.symbols, type)) return cfg.dsos.symbols[type].fill;\r\n    return \"#000\";\r\n  };\r\n  this.starColor = starColor;\r\n  this.animate = function(anims, dorepeat) { \r\n    if (!anims) return; \r\n    animations = anims; \r\n    current = 0; \r\n    repeat = dorepeat ? true : false; \r\n    animate(); \r\n  };\r\n  this.stop  = function(wipe) {\r\n    stop();\r\n    if (wipe === true) animations = [];\r\n  };\r\n  this.go = function(index) {\r\n    if (animations.length < 1) return;\r\n    if (index && index < animations.length) current = index;\r\n    animate(); \r\n  };\r\n\r\n  /* obsolete\r\n  if (!has(this, \"date\"))\r\n    this.date = function() { console.log(\"Celestial.date() needs config.location = true to work.\" ); };\r\n  */\r\n  load();\r\n};\r\n \r\n//Export entire object if invoked by require\r\nif (typeof module === \"object\" && module.exports) {\r\n  var d3js = require('./lib/d3.js'),\r\n      d3_geo_projection = require('./lib/d3.geo.projection.js');\r\n  module.exports = {\r\n    Celestial: function() { return Celestial; },\r\n    d3: function() { return d3js; },\r\n    \"d3.geo.projection\": function() { return d3_geo_projection; }\r\n  };\r\n}\r\n\r\n//Flipped projection generated on the fly\r\nCelestial.projection = function(projection) {\r\n  var p, raw, forward;\r\n  \r\n  if (!has(projections, projection)) { throw new Error(\"Projection not supported: \" + projection); }\r\n  p = projections[projection];    \r\n\r\n  if (p.arg !== null) {\r\n    raw = d3.geo[projection].raw(p.arg);\r\n  } else {\r\n    raw = d3.geo[projection].raw;  \r\n  }\r\n  \r\n  forward = function(λ, φ) {\r\n    var coords = raw(-λ, φ);\r\n    return coords;\r\n  };\r\n\r\n  forward.invert = function(x, y) {\r\n    try {\r\n      var coords = raw.invert(x, y);\r\n      coords[0] = coords && -coords[0];\r\n      return coords;\r\n    } catch(e) { console.log(e); }\r\n  };\r\n\r\n  return d3.geo.projection(forward);\r\n};\r\n\r\n\r\nfunction projectionTween(a, b) {\r\n  var prj = d3.geo.projection(raw).scale(1),\r\n      center = prj.center,\r\n      translate = prj.translate,\r\n      α;\r\n\r\n  function raw(λ, φ) {\r\n    var pa = a([λ *= 180 / Math.PI, φ *= 180 / Math.PI]), pb = b([λ, φ]);\r\n    return [(1 - α) * pa[0] + α * pb[0], (α - 1) * pa[1] - α * pb[1]];\r\n  }\r\n\r\n  prj.alpha = function(_) {\r\n    if (!arguments.length) return α;\r\n    α = +_;\r\n    var ca = a.center(), cb = b.center(),\r\n        ta = a.translate(), tb = b.translate();\r\n    \r\n    center([(1 - α) * ca[0] + α * cb[0], (1 - α) * ca[1] + α * cb[1]]);\r\n    translate([(1 - α) * ta[0] + α * tb[0], (1 - α) * ta[1] + α * tb[1]]);\r\n    return prj;\r\n  };\r\n\r\n  delete prj.translate;\r\n  delete prj.center;\r\n  return prj.alpha(0);\r\n}\r\n\r\nvar eulerAngles = {\r\n  \"equatorial\": [0.0, 0.0, 0.0],\r\n  \"ecliptic\": [0.0, 0.0, 23.4393],\r\n  \"galactic\": [93.5949, 28.9362, -58.5988],\r\n  \"supergalactic\": [137.3100, 59.5283, 57.7303]\r\n//  \"mars\": [97.5,23.5,29]\r\n};\r\n\r\nvar poles = {\r\n  \"equatorial\": [0.0, 90.0],\r\n  \"ecliptic\": [-90.0, 66.5607],\r\n  \"galactic\": [-167.1405, 27.1283],\r\n  \"supergalactic\": [-76.2458, 15.7089]\r\n//  \"mars\": [-42.3186, 52.8865]\r\n};\r\n\r\nCelestial.eulerAngles = function () { return eulerAngles; };\r\nCelestial.poles = function () { return poles; };\r\n\r\nvar τ = Math.PI*2,\r\n    halfπ = Math.PI/2,\r\n    deg2rad = Math.PI/180;\r\n\r\n\r\n//Transform equatorial into any coordinates, degrees\r\nfunction transformDeg(c, euler) {\r\n  var res = transform( c.map( function(d) { return d * deg2rad; } ), euler);\r\n  return res.map( function(d) { return d / deg2rad; } );\r\n}\r\n\r\n//Transform equatorial into any coordinates, radians\r\nfunction transform(c, euler) {\r\n  var x, y, z, β, γ, λ, φ, dψ, ψ, θ,\r\n      ε = 1.0e-5;\r\n\r\n  if (!euler) return c; \r\n\r\n  λ = c[0];  // celestial longitude 0..2pi\r\n  if (λ < 0) λ += τ; \r\n  φ = c[1];  // celestial latitude  -pi/2..pi/2\r\n  \r\n  λ -= euler[0];  // celestial longitude - celestial coordinates of the native pole\r\n  β = euler[1];  // inclination between the poles (colatitude)\r\n  γ = euler[2];  // native coordinates of the celestial pole\r\n  \r\n  x = Math.sin(φ) * Math.sin(β) - Math.cos(φ) * Math.cos(β) * Math.cos(λ);\r\n  if (Math.abs(x) < ε) {\r\n    x = -Math.cos(φ + β) + Math.cos(φ) * Math.cos(β) * (1 - Math.cos(λ));\r\n  }\r\n  y = -Math.cos(φ) * Math.sin(λ);\r\n  \r\n  if (x !== 0 || y !== 0) {\r\n    dψ = Math.atan2(y, x);\r\n  } else {\r\n    dψ = λ - Math.PI;\r\n  }\r\n  ψ = (γ + dψ); \r\n  if (ψ > Math.PI) ψ -= τ; \r\n  \r\n  if (λ % Math.PI === 0) {\r\n    θ = φ + Math.cos(λ) * β;\r\n    if (θ > halfπ) θ = Math.PI - θ; \r\n    if (θ < -halfπ) θ = -Math.PI - θ; \r\n  } else {\r\n    z = Math.sin(φ) * Math.cos(β) + Math.cos(φ) * Math.sin(β) * Math.cos(λ);\r\n    if (Math.abs(z) > 0.99) {\r\n      θ = Math.abs(Math.acos(Math.sqrt(x*x+y*y)));\r\n      if (z < 0) θ *= -1; \r\n    } else {\r\n      θ = Math.asin(z);\r\n    }\r\n  }\r\n  \r\n  return [ψ, θ];\r\n}\r\n\r\n  \r\nfunction getAngles(coords) {\r\n  if (coords === null || coords.length <= 0) return [0,0,0];\r\n  var rot = eulerAngles.equatorial; \r\n  if (!coords[2]) coords[2] = 0;\r\n  return [rot[0] - coords[0], rot[1] - coords[1], rot[2] + coords[2]];\r\n}\r\n\r\n\r\nvar euler = {\r\n  \"ecliptic\": [-90.0, 23.4393, 90.0],\r\n  \"inverse ecliptic\": [90.0, 23.4393, -90.0],\r\n  \"galactic\": [-167.1405, 62.8717, 122.9319], \r\n  \"inverse galactic\": [122.9319, 62.8717, -167.1405],\r\n  \"supergalactic\": [283.7542, 74.2911, 26.4504],\r\n  \"inverse supergalactic\": [26.4504, 74.2911, 283.7542],\r\n  \"init\": function () {\r\n    for (var key in this) {\r\n      if (this[key].constructor == Array) { \r\n        this[key] = this[key].map( function(val) { return val * deg2rad; } );\r\n      }\r\n    }\r\n  },\r\n  \"add\": function(name, ang) {\r\n    if (!ang || !name || ang.length !== 3 || this.hasOwnProperty(name)) return; \r\n    this[name] = ang.map( function(val) { return val * deg2rad; } );\r\n    return this[name];\r\n  }\r\n};\r\n\r\neuler.init();\r\nCelestial.euler = function () { return euler; };\r\n\r\nvar horizontal = function(dt, pos, loc) {\r\n  //dt: datetime, pos: celestial coordinates [lat,lng], loc: location [lat,lng]  \r\n  var ha = getMST(dt, loc[1]) - pos[0];\r\n  if (ha < 0) ha = ha + 360;\r\n  \r\n  ha  = ha * deg2rad;\r\n  var dec = pos[1] * deg2rad;\r\n  var lat = loc[0] * deg2rad;\r\n\r\n  var alt = Math.asin(Math.sin(dec) * Math.sin(lat) + Math.cos(dec) * Math.cos(lat) * Math.cos(ha));\r\n  var az = Math.acos((Math.sin(dec) - Math.sin(alt) * Math.sin(lat)) / (Math.cos(alt) * Math.cos(lat)));\r\n\r\n  if (Math.sin(ha) > 0) az = Math.PI * 2 - az;\r\n  \r\n  return [alt / deg2rad, az / deg2rad, 0];\r\n};\r\n\r\nhorizontal.inverse = function(dt, hor, loc) {\r\n  \r\n  var alt = hor[0] * deg2rad;\r\n  var az = hor[1] * deg2rad;\r\n  var lat = loc[0] * deg2rad;\r\n   \r\n  var dec = Math.asin((Math.sin(alt) * Math.sin(lat)) + (Math.cos(alt) * Math.cos(lat) * Math.cos(az)));\r\n  var ha = ((Math.sin(alt) - (Math.sin(dec) * Math.sin(lat))) / (Math.cos(dec) * Math.cos(lat))).toFixed(6);\r\n  \r\n  ha = Math.acos(ha);\r\n  ha  = ha / deg2rad;\r\n  \r\n  var ra = getMST(dt, loc[1]) - ha;\r\n  //if (ra < 0) ra = ra + 360;\r\n    \r\n  return [ra, dec / deg2rad, 0];\r\n};\r\n\r\nfunction getMST(dt, lng)\r\n{\r\n    var yr = dt.getUTCFullYear();\r\n    var mo = dt.getUTCMonth() + 1;\r\n    var dy = dt.getUTCDate();\r\n    var h = dt.getUTCHours();\r\n    var m = dt.getUTCMinutes();\r\n    var s = dt.getUTCSeconds();\r\n\r\n    if ((mo == 1)||(mo == 2)) {\r\n        yr  = yr - 1;\r\n        mo = mo + 12;\r\n    }\r\n\r\n    var a = Math.floor(yr / 100);\r\n    var b = 2 - a + Math.floor(a / 4);\r\n    var c = Math.floor(365.25 * yr);\r\n    var d = Math.floor(30.6001 * (mo + 1));\r\n\r\n    // days since J2000.0\r\n    var jd = b + c + d - 730550.5 + dy + (h + m/60.0 + s/3600.0)/24.0;\r\n    \r\n    // julian centuries since J2000.0\r\n    var jt = jd/36525.0;\r\n\r\n    // the mean sidereal time in degrees\r\n    var mst = 280.46061837 + 360.98564736629*jd + 0.000387933*jt*jt - jt*jt*jt/38710000 + lng;\r\n\r\n    // in degrees modulo 360.0\r\n    if (mst > 0.0) \r\n        while (mst > 360.0) mst = mst - 360.0;\r\n    else\r\n        while (mst < 0.0)   mst = mst + 360.0;\r\n        \r\n    return mst;\r\n}\r\n\r\nCelestial.horizontal = horizontal;\r\nCelestial.ha = function(dt, lng, ra) {\r\n  var ha = getMST(dt, lng) - ra;\r\n  if (ha < 180) ha = ha + 360;\r\n  return ha;\r\n};\r\n//Add more JSON data to the map\r\nvar hasCallback = false;\r\n\r\nCelestial.add = function(dat) {\r\n  var res = {};\r\n  //dat: {file: path, type:'json|raw', callback: func(), redraw: func()} \r\n  //or {file:file, size:null, shape:null, color:null}  TBI\r\n  //  with size,shape,color: \"prop=val:result;..\" || function(prop) { .. return res; } \r\n  if (!has(dat, \"type\")) return console.log(\"Missing type\");\r\n  \r\n  if ((dat.type === \"dso\" || dat.type === \"json\") && (!has(dat, \"file\") || !has(dat, \"callback\"))) return console.log(\"Can't add data file\");\r\n  if ((dat.type === \"line\" || dat.type === \"raw\") && !has(dat, \"callback\")) return console.log(\"Can't add data\");\r\n  \r\n  if (has(dat, \"file\")) res.file = dat.file;\r\n  res.type = dat.type;\r\n  if (has(dat, \"callback\")) res.callback = dat.callback;\r\n  if (has(dat, \"redraw\")) res.redraw = dat.redraw;\r\n  if (has(dat, \"save\")) res.save = dat.save;\r\n  Celestial.data.push(res);\r\n};\r\n\r\nCelestial.remove = function(i) {\r\n  if (i !== null && i < Celestial.data.length) {\r\n    return Celestial.data.splice(i,1);\r\n  }\r\n};\r\n\r\nCelestial.clear = function() {\r\n  Celestial.data = [];\r\n};\r\n\r\nCelestial.addCallback = function(dat) {\r\n  Celestial.callback = dat;\r\n  hasCallback = (dat !== null);\r\n};\r\n\r\nCelestial.runCallback = function(dat) {\r\n  hasCallback = false; // avoid recursion\r\n  Celestial.callback();\r\n  hasCallback = true;\r\n};\r\n//load data and transform coordinates\r\n\r\n\r\nfunction getPoint(coords, trans) {\r\n  return transformDeg(coords, euler[trans]);\r\n}\r\n \r\nfunction getData(d, trans) {\r\n  if (trans === \"equatorial\") return d;\r\n\r\n  var leo = euler[trans],\r\n      f = d.features;\r\n\r\n  for (var i=0; i<f.length; i++)\r\n    f[i].geometry.coordinates = translate(f[i], leo);\r\n  \r\n  return d;\r\n}\r\n\r\nfunction getPlanets(d) {\r\n  var res = [];\r\n  \r\n  for (var key in d) {\r\n    if (!has(d, key)) continue;\r\n    if (cfg.planets.which.indexOf(key) === -1) continue;\r\n    var dat = Kepler().id(key);\r\n    if (has(d[key], \"parent\")) dat.parentBody(d[key].parent);\r\n    dat.elements(d[key].elements[0]).params(d[key]);\r\n    if (key === \"ter\") \r\n      Celestial.origin = dat;\r\n    else res.push(dat);\r\n  }\r\n  //res.push(Kepler().id(\"sol\"));\r\n  //res.push(Kepler().id(\"lun\"));\r\n  return res;\r\n}\r\n\r\n\r\nfunction getPlanet(id, dt) {\r\n  dt = dt || Celestial.date();\r\n  if (!Celestial.origin) return;\r\n\r\n  var o = Celestial.origin(dt).spherical(), res;\r\n     \r\n  Celestial.container.selectAll(\".planet\").each(function(d) {\r\n    if (id === d.id()) {\r\n      res = d(dt).equatorial(o);\r\n    }\r\n  });\r\n  return res;\r\n}\r\n\r\nfunction getConstellationList(d) {\r\n  var res = {},\r\n      f = d.features;\r\n      \r\n  for (var i=0; i<f.length; i++) {\r\n    res[f[i].id] = {\r\n      center: f[i].properties.display.slice(0,2),\r\n      scale: f[i].properties.display[2]\r\n    };\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction getMwbackground(d) {\r\n  // geoJson object to darken the mw-outside, prevent greying of whole map in some orientations \r\n  var res = {'type': 'FeatureCollection', 'features': [ {'type': 'Feature', \r\n              'geometry': { 'type': 'MultiPolygon', 'coordinates' : [] }\r\n            }]};\r\n\r\n  // reverse the polygons, inside -> outside\r\n  var l1 = d.features[0].geometry.coordinates[0];\r\n  res.features[0].geometry.coordinates[0] = [];\r\n  for (var i=0; i<l1.length; i++) {\r\n    res.features[0].geometry.coordinates[0][i] = l1[i].slice().reverse();\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nfunction getTimezones() {\r\n  \r\n}\r\n\r\nfunction translate(d, leo) {\r\n  var res = [];\r\n  switch (d.geometry.type) {\r\n    case \"Point\": res = transformDeg(d.geometry.coordinates, leo); break;\r\n    case \"LineString\": res.push(transLine(d.geometry.coordinates, leo)); break;\r\n    case \"MultiLineString\": res = transMultiLine(d.geometry.coordinates, leo); break;\r\n    case \"Polygon\": res.push(transLine(d.geometry.coordinates[0], leo)); break;\r\n    case \"MultiPolygon\": res.push(transMultiLine(d.geometry.coordinates[0], leo)); break;\r\n  }\r\n  \r\n  return res;\r\n}\r\n\r\nfunction getGridValues(type, loc) {\r\n  var lines = [];\r\n  if (!loc) return [];\r\n  if (!isArray(loc)) loc = [loc];\r\n  //center, outline, values\r\n  for (var i=0; i < loc.length; i++) {\r\n    switch (loc[i]) {\r\n      case \"center\": \r\n        if (type === \"lat\")\r\n          lines = lines.concat(getLine(type, cfg.center[0], \"N\"));\r\n        else\r\n          lines = lines.concat(getLine(type, cfg.center[1], \"S\")); \r\n        break;\r\n      case \"outline\": \r\n        if (type === \"lon\") { \r\n          lines = lines.concat(getLine(type, cfg.center[1]-89.99, \"S\"));\r\n          lines = lines.concat(getLine(type, cfg.center[1]+89.99, \"N\"));\r\n        } else {\r\n\t\t\t\t\t// TODO: hemi\r\n          lines = lines.concat(getLine(type, cfg.center[0]-179.99, \"E\"));\r\n          lines = lines.concat(getLine(type, cfg.center[0]+179.99, \"W\"));\r\n        }\r\n        break;\r\n      default: if (isNumber(loc[i])) {\r\n        if (type === \"lat\")\r\n          lines = lines.concat(getLine(type, loc[i], \"N\"));\r\n        else\r\n          lines = lines.concat(getLine(type, loc[i], \"S\")); \r\n        break;        \r\n      }\r\n    }\r\n  }\r\n  //return [{coordinates, value, orientation}, ...]\r\n  return jsonGridValues(lines);\r\n}\r\n\r\nfunction jsonGridValues(lines) {\r\n  var res = [];\r\n  for (var i=0; i < lines.length; i++) {\r\n    var f = {type: \"Feature\", \"id\":i, properties: {}, geometry:{type:\"Point\"}};\r\n    f.properties.value = lines[i].value;\r\n    f.properties.orientation = lines[i].orientation;\r\n    f.geometry.coordinates = lines[i].coordinates;\r\n    res.push(f);\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction getLine(type, loc, orient) {\r\n  var min, max, step, val, coord,\r\n      tp = type,\r\n      res = [],\r\n      lr = loc;\r\n  if (cfg.transform === \"equatorial\" && tp === \"lon\") tp = \"ra\";\r\n  \r\n  if (tp === \"ra\") {\r\n    min = 0; max = 23; step = 1;\r\n  } else if (tp === \"lon\") {\r\n    min = 0; max = 350; step = 10;    \r\n  } else {\r\n    min = -80; max = 80; step = 10;    \r\n  }\r\n  for (var i=min; i<=max; i+=step) {\r\n    var o = orient;\r\n    if (tp === \"lat\") {\r\n      coord = [lr, i];\r\n      val = i.toString() + \"\\u00b0\";\r\n      if (i < 0) o += \"S\"; else o += \"N\";\r\n    } else if (tp === \"ra\") {\r\n      coord = [i * 15, lr];\r\n      val = i.toString() + \"\\u02b0\";\r\n    } else {\r\n      coord = [i, lr];\r\n      val = i.toString() + \"\\u00b0\";\r\n    }\r\n  \r\n    res.push({coordinates: coord, value: val, orientation: o});\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction transLine(c, leo) {\r\n  var line = [];\r\n  \r\n  for (var i=0; i<c.length; i++)\r\n    line.push(transformDeg(c[i], leo));\r\n  \r\n  return line;\r\n}\r\n\r\nfunction transMultiLine(c, leo) {\r\n  var lines = [];\r\n  \r\n  for (var i=0; i<c.length; i++)\r\n    lines.push(transLine(c[i], leo));\r\n  \r\n  return lines;\r\n}\r\n\r\nCelestial.getData = getData;\r\nCelestial.getPoint = getPoint;\r\nCelestial.getPlanet = getPlanet;\r\n\r\n// Central configuration object\r\nvar globalConfig = {};\r\n\r\n//Defaults\r\nvar settings = { \r\n  width: 0,     // Default width; height is determined by projection\r\n  projection: \"aitoff\",  // Map projection used: airy, aitoff, armadillo, august, azimuthalEqualArea, azimuthalEquidistant, baker, berghaus, boggs, bonne, bromley, collignon, craig, craster, cylindricalEqualArea, cylindricalStereographic, eckert1, eckert2, eckert3, eckert4, eckert5, eckert6, eisenlohr, equirectangular, fahey, foucaut, ginzburg4, ginzburg5, ginzburg6, ginzburg8, ginzburg9, gringorten, hammer, hatano, healpix, hill, homolosine, kavrayskiy7, lagrange, larrivee, laskowski, loximuthal, mercator, miller, mollweide, mtFlatPolarParabolic, mtFlatPolarQuartic, mtFlatPolarSinusoidal, naturalEarth, nellHammer, orthographic, patterson, polyconic, rectangularPolyconic, robinson, sinusoidal, stereographic, times, twoPointEquidistant, vanDerGrinten, vanDerGrinten2, vanDerGrinten3, vanDerGrinten4, wagner4, wagner6, wagner7, wiechel, winkel3\r\n  projectionRatio: null, // Optional override for default projection ratio\r\n  transform: \"equatorial\", // Coordinate transformation: equatorial (default), ecliptic, galactic, supergalactic\r\n  center: null,       // Initial center coordinates in equatorial transformation [hours, degrees, degrees], \r\n                      // otherwise [degrees, degrees, degrees], 3rd parameter is orientation, null = default center\r\n  geopos: null,       // optional initial geographic position [lat,lon] in degrees, overrides center\r\n  follow: \"zenith\",   // on which coordinates to center the map, default: zenith, if location enabled, otherwise center\r\n  orientationfixed: true,  // Keep orientation angle the same as center[2]\r\n  zoomlevel: null,    // initial zoom level 0...zoomextend; 0|null = default, 1 = 100%, 0 < x <= zoomextend\r\n  zoomextend: 10,     // maximum zoom level\r\n  adaptable: true,    // Sizes are increased with higher zoom-levels\r\n  interactive: true,  // Enable zooming and rotation with mousewheel and dragging\r\n  disableAnimations: false, // Disable all animations\r\n  form: false,        // Display settings form\r\n  location: false,    // Display location settings, deprecated, use formFields\r\n  // Set visiblity for each group of fields of the form\r\n  formFields: {\"location\": true, \"general\": true, \"stars\": true, \"dsos\": true, \"constellations\": true, \"lines\": true, \"other\": true, download: false},\r\n  advanced: true,     // Display fewer form fields if false\r\n  daterange: [],      // Calender date range; null: displaydate-+10; [n<100]: displaydate-+n; [yr]: yr-+10; \r\n                      // [yr, n<100]: [yr-n, yr+n]; [yr0, yr1]\r\n  settimezone: true,  // Automatcally set time zone when geolocation changes\r\n  timezoneid: \"AEFXZPQ3FDPF\", // Account ID for TimeZoneDB service, please get your own\r\n  controls: true,     // Display zoom controls\r\n  lang: \"\",           // Global language override for names, any name setting that has the chosen language available\r\n                      // Default: desig or empty string for designations, other languages as used anywhere else\r\n  culture: \"\",        // Constellation lines, default \"iau\"\r\n  container: \"celestial-map\",   // ID of parent element, e.g. div\r\n  datapath: \"data/\",  // Path/URL to data files, empty = subfolder 'data'\r\n  stars: {\r\n    show: true,    // Show stars\r\n    limit: 6,      // Show only stars brighter than limit magnitude\r\n    colors: true,  // Show stars in spectral colors, if not use fill-style\r\n    style: { fill: \"#ffffff\", opacity: 1 }, // Default style for stars\r\n    designation: true, // Show star names (Bayer, Flamsteed, Variable star, Gliese or designation, \r\n                       // i.e. whichever of the previous applies first); may vary with culture setting\r\n    designationType: \"desig\",  // Which kind of name is displayed as designation (fieldname in starnames.json)\r\n    designationStyle: { fill: \"#ddddbb\", font: \"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif\", align: \"left\", baseline: \"top\" },\r\n    designationLimit: 2.5,  // Show only names for stars brighter than nameLimit\r\n    propername: false,   // Show proper name (if present)\r\n    propernameType: \"name\", // Field in starnames.json that contains proper name; may vary with culture setting\r\n    propernameStyle: { fill: \"#ddddbb\", font: \"13px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif\", align: \"right\", baseline: \"bottom\" },\r\n    propernameLimit: 1.5,  // Show proper names for stars brighter than propernameLimit\r\n    size: 7,       // Scale size (radius) of star circle in pixels\r\n    exponent: -0.28, // Scale exponent for star size, larger = more linear\r\n    data: \"stars.6.json\" // Data source for stellar data\r\n  },\r\n  dsos: {\r\n    show: true,    // Show Deep Space Objects \r\n    limit: 6,      // Show only DSOs brighter than limit magnitude\r\n    colors: true,  // Show DSOs in symbol colors if true, use style setting below if false\r\n    style: { fill: \"#cccccc\", stroke: \"#cccccc\", width: 2, opacity: 1 }, // Default style for dsos\r\n    names: true,   // Show DSO names\r\n    namesType: \"desig\",  // Type of displayed name: desig, name, or 15 different language codes from dsonames.json\r\n    nameStyle: { fill: \"#cccccc\", font: \"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, serif\", align: \"left\", baseline: \"bottom\" },\r\n    nameLimit: 4,  // Show only names for DSOs brighter than nameLimit\r\n    size: null,    // Optional seperate scale size for DSOs, null = stars.size\r\n    exponent: 1.4, // Scale exponent for DSO size, larger = more non-linear\r\n    data: \"dsos.bright.json\",  // Data source for DSOs\r\n    symbols: {  // DSO symbol styles\r\n      gg: {shape: \"circle\", fill: \"#ff0000\"},                                 // Galaxy cluster\r\n      g:  {shape: \"ellipse\", fill: \"#ff0000\"},                                // Generic galaxy\r\n      s:  {shape: \"ellipse\", fill: \"#ff0000\"},                                // Spiral galaxy\r\n      s0: {shape: \"ellipse\", fill: \"#ff0000\"},                                // Lenticular galaxy\r\n      sd: {shape: \"ellipse\", fill: \"#ff0000\"},                                // Dwarf galaxy\r\n      e:  {shape: \"ellipse\", fill: \"#ff0000\"},                                // Elliptical galaxy\r\n      i:  {shape: \"ellipse\", fill: \"#ff0000\"},                                // Irregular galaxy\r\n      oc: {shape: \"circle\", fill: \"#ff9900\", stroke: \"#ff9900\", width: 2},    // Open cluster\r\n      gc: {shape: \"circle\", fill: \"#ff9900\"},                                 // Globular cluster\r\n      en: {shape: \"square\", fill: \"#ff00cc\"},                                 // Emission nebula\r\n      bn: {shape: \"square\", fill: \"#ff00cc\"},                                 // Generic bright nebula\r\n      sfr:{shape: \"square\", fill: \"#cc00ff\"},                                 // Star forming region\r\n      rn: {shape: \"square\", fill: \"#0000ff\"},                                 // Reflection nebula\r\n      pn: {shape: \"diamond\", fill: \"#00cccc\"},                                // Planetary nebula \r\n      snr:{shape: \"diamond\", fill: \"#ff00cc\"},                                // Supernova remnant\r\n      dn: {shape: \"square\", fill: \"#999999\", stroke: \"#999999\", width: 2},    // Dark nebula \r\n      pos:{shape: \"marker\", fill: \"#cccccc\", stroke: \"#cccccc\", width: 1.5}   // Generic marker\r\n    }\r\n  },\r\n  constellations: {\r\n    show: true,    // Show constellations \r\n    names: true,   // Show constellation names \r\n    namesType: \"desig\",   // What kind of name to show (default 3 letter designations) all options: name, desig, \r\n                         // lat, en, ar, cn, cz, ee, fi, fr, de, gr, il, it, jp, kr, in, ir, ru, es, tr \r\n    nameStyle: { fill:\"#cccc99\", align: \"center\", baseline: \"middle\", opacity:0.8, \r\n                 font: [\"14px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\",  // Different fonts for brighter &\r\n                        \"12px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\",  // darker constellations\r\n                        \"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif\"]},\r\n    lines: true,   // Show constellation lines \r\n    lineStyle: { stroke: \"#cccccc\", width: 1.5, opacity: 0.6 },\r\n    bounds: false,  // Show constellation boundaries \r\n    boundStyle: { stroke: \"#ccff00\", width: 1.0, opacity: 0.8, dash: [4,4] }\r\n  },\r\n  mw: {\r\n    show: true,    // Show Milky Way as filled polygons \r\n    style: { fill: \"#ffffff\", opacity: \"0.15\" } // style for each MW-layer (5 on top of each other)\r\n  },\r\n  lines: {\r\n    graticule: { show: true, stroke: \"#cccccc\", width: 0.6, opacity: 0.8,      // Show graticule lines \r\n\t\t\t// grid values: \"outline\", \"center\", or [lat,...] specific position\r\n      lon: {pos: [], fill: \"#eee\", font: \"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif\"}, \r\n\t\t\t// grid values: \"outline\", \"center\", or [lon,...] specific position\r\n\t\t  lat: {pos: [], fill: \"#eee\", font: \"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif\"}},\r\n    equatorial: { show: true, stroke: \"#aaaaaa\", width: 1.3, opacity: 0.7 },    // Show equatorial plane \r\n    ecliptic: { show: true, stroke: \"#66cc66\", width: 1.3, opacity: 0.7 },      // Show ecliptic plane \r\n    galactic: { show: false, stroke: \"#cc6666\", width: 1.3, opacity: 0.7 },     // Show galactic plane \r\n    supergalactic: { show: false, stroke: \"#cc66cc\", width: 1.3, opacity: 0.7 } // Show supergalactic plane \r\n   //mars: { show: false, stroke:\"#cc0000\", width:1.3, opacity:.7 }\r\n  }, // Background style\r\n  background: { \r\n    fill: \"#000000\", \r\n    opacity: 1, \r\n    stroke: \"#000000\", // Outline\r\n    width: 1.5 \r\n  }, \r\n  horizon: {  //Show horizon marker, if geo-position and date-time is set\r\n    show: false, \r\n    stroke: \"#cccccc\", // Line\r\n    width: 1.0, \r\n    fill: \"#000000\", // Area below horizon\r\n    opacity: 0.4\r\n  },  \r\n  daylight: {  //Show approximate state of sky at selected time\r\n    show: false\r\n  },\r\n  planets: {  //Show planet locations, if date-time is set\r\n    show: false, \r\n    // 3-letter designations of all solar system objects that should be displayed\r\n    which: [\"sol\", \"mer\", \"ven\", \"ter\", \"lun\", \"mar\", \"jup\", \"sat\", \"ura\", \"nep\", \"cer\", \"plu\"],\r\n    // Symbols as unicode codepoints, letter abbreviations and colors to be displayed\r\n    symbols: {\r\n      \"sol\": {symbol: \"\\u2609\", letter:\"Su\", fill: \"#ffff00\", size: 12},\r\n      \"mer\": {symbol: \"\\u263f\", letter:\"Me\", fill: \"#cccccc\"},\r\n      \"ven\": {symbol: \"\\u2640\", letter:\"V\", fill: \"#eeeecc\"},\r\n      \"ter\": {symbol: \"\\u2295\", letter:\"T\", fill: \"#00ccff\"},\r\n      \"lun\": {symbol: \"\\u25cf\", letter:\"L\", fill: \"#ffffff\", size: 12},\r\n      \"mar\": {symbol: \"\\u2642\", letter:\"Ma\", fill: \"#ff6600\"},\r\n      \"cer\": {symbol: \"\\u26b3\", letter:\"C\", fill: \"#cccccc\"},\r\n      \"ves\": {symbol: \"\\u26b6\", letter:\"Ma\", fill: \"#cccccc\"},\r\n      \"jup\": {symbol: \"\\u2643\", letter:\"J\", fill: \"#ffaa33\"},\r\n      \"sat\": {symbol: \"\\u2644\", letter:\"Sa\", fill: \"#ffdd66\"},\r\n      \"ura\": {symbol: \"\\u2645\", letter:\"U\", fill: \"#66ccff\"},\r\n      \"nep\": {symbol: \"\\u2646\", letter:\"N\", fill: \"#6666ff\"},\r\n      \"plu\": {symbol: \"\\u2647\", letter:\"P\", fill: \"#aaaaaa\"},\r\n      \"eri\": {symbol: \"\\u26aa\", letter:\"E\", fill: \"#eeeeee\"}\r\n    },\r\n    // Style options for planetary symbols\r\n    symbolStyle: { fill: \"#cccccc\", opacity:1, font: \"bold 20px 'DejaVu Sans Mono', 'Arial Unicode MS', sans-serif\", align: \"center\", baseline: \"middle\" },\r\n    symbolType: \"symbol\",  // Type of planetary symbol to be displayed: 'symbol', 'letter' or 'disk'\r\n    names: false,  // Show name next to symbol\r\n    // Style options for planetary names\r\n    nameStyle: { fill: \"#cccccc\", font: \"14px 'Lucida Sans Unicode', 'DejaVu Sans', sans-serif\", align: \"right\", baseline: \"top\" },\r\n    namesType: \"en\"  // Language in which the name is displayed, options desig, ar, cn, en, fr, de, gr, il, in, it, jp, lat, ru, es\r\n  },\r\n  set: function(cfg) {  // Override defaults with values of cfg\r\n    var prop, key, config = {}, res = {};\r\n    if (Object.entries(globalConfig).length === 0) Object.assign(config, this);\r\n    else Object.assign(config, globalConfig);\r\n    if (!cfg) return config; \r\n    for (prop in config) {\r\n      if (!has(config, prop)) continue; \r\n      //if (typeof(config[prop]) === 'function'); \r\n      if (!has(cfg, prop) || cfg[prop] === null) { \r\n        res[prop] = config[prop]; \r\n      } else if (config[prop] === null || config[prop].constructor != Object ) {\r\n        res[prop] = cfg[prop];\r\n      } else {\r\n        res[prop] = {};\r\n        for (key in config[prop]) {\r\n          if (has(cfg[prop], key)) {\r\n            res[prop][key] = cfg[prop][key];\r\n          } else {\r\n            res[prop][key] = config[prop][key];\r\n          }            \r\n        }\r\n      }\r\n    }\r\n    res.constellations.nameStyle.font = arrayfy(res.constellations.nameStyle.font);\r\n    res.constellations.nameStyle.opacity = arrayfy(res.constellations.nameStyle.opacity);\r\n    res.constellations.nameStyle.fill = arrayfy(res.constellations.nameStyle.fill);\r\n    res.constellations.lineStyle.width = arrayfy(res.constellations.lineStyle.width);\r\n    res.constellations.lineStyle.opacity = arrayfy(res.constellations.lineStyle.opacity);\r\n    res.constellations.lineStyle.stroke = arrayfy(res.constellations.lineStyle.stroke);\r\n    \r\n    Object.assign(globalConfig, res);\r\n    return res;\r\n  },\r\n  applyDefaults: function(cfg) {\r\n    var res = {};\r\n    Object.assign(res, globalConfig);\r\n    // Nothing works without these\r\n    res.stars.size = res.stars.size || 7;  \r\n    res.stars.exponent = res.stars.exponent || -0.28;\r\n    if (!res.center || res.center.length <= 0) res.center = [0,0,0];\r\n    res.datapath = res.datapath || \"\";\r\n    res.datapath = res.datapath.replace(/([^\\/]$)/, \"$1\\/\");\r\n    if (!res.transform || res.transform === \"\") res.transform = \"equatorial\";\r\n    // If no recognized language/culture settings, assume defaults\r\n    //if (!res.lang || res.lang.search(/^de|es$/) === -1) res.lang = \"name\";\r\n    //Set all poss. names to cfg.lang if not english\r\n    if (!res.culture || res.culture.search(/^cn$/) === -1) res.culture = \"iau\";\r\n\r\n    if (cfg) {\r\n      // Adapt legacy name parameters\r\n      if (has(cfg, \"stars\")) {\r\n        // names -> designation\r\n        if (has(cfg.stars, \"names\")) res.stars.designation = cfg.stars.names;\r\n        if (has(cfg.stars, \"namelimit\")) res.stars.designationLimit = cfg.stars.namelimit;\r\n        if (has(cfg.stars, \"namestyle\")) Object.assign(res.stars.designationStyle, cfg.stars.namestyle);    \r\n        // proper -> propername\r\n        if (has(cfg.stars, \"proper\")) res.stars.propername = cfg.stars.proper;\r\n        if (has(cfg.stars, \"propernamelimit\")) res.stars.propernameLimit = cfg.stars.propernamelimit;\r\n        if (has(cfg.stars, \"propernamestyle\")) Object.assign(res.stars.propernameStyle, cfg.stars.propernamestyle);\r\n      }\r\n\r\n      if (has(cfg, \"dsos\")) {\r\n        // names, desig -> namesType\r\n        //if (has(cfg.dsos, \"names\") && cfg.dsos.names === true) res.dsos.namesType = \"name\";\r\n        if (has(cfg.dsos, \"desig\") && cfg.dsos.desig === true) res.dsos.namesType = \"desig\";\r\n        if (has(cfg.dsos, \"namelimit\")) res.dsos.nameLimit = cfg.dsos.namelimit;\r\n        if (has(cfg.dsos, \"namestyle\")) Object.assign(res.dsos.nameStyle, cfg.dsos.namestyle);    \r\n      }\r\n      \r\n      if (has(cfg, \"constellations\")) {\r\n        // names, desig -> namesType\r\n        if (has(cfg.constellations, \"show\") && cfg.constellations.show === true) res.constellations.names = true;\r\n        //if (has(cfg.constellations, \"names\") && cfg.constellations.names === true) res.constellations.namesType = \"name\";\r\n        if (has(cfg.constellations, \"desig\") && cfg.constellations.desig === true) res.constellations.namesType = \"desig\";\r\n        if (res.constellations.namesType === \"latin\") res.constellations.namesType = \"la\";\r\n        if (res.constellations.namesType === \"iau\") res.constellations.namesType = \"name\";\r\n        if (has(cfg.constellations, \"namestyle\")) Object.assign(res.constellations.nameStyle, cfg.constellations.namestyle);\r\n        if (has(cfg.constellations, \"linestyle\")) Object.assign(res.constellations.lineStyle, cfg.constellations.linestyle);\r\n        if (has(cfg.constellations, \"boundstyle\")) Object.assign(res.constellations.boundStyle, cfg.constellations.boundstyle);\r\n      }\r\n\r\n      if (has(cfg, \"planets\")) {\r\n        if (has(cfg.planets, \"style\")) Object.assign(res.planets.style, cfg.planets.symbolStyle);      \r\n      }\r\n    }\r\n    //Assign default name types if none given\r\n    if (!res.stars.designationType || res.stars.designationType === \"\") res.stars.designationType = \"desig\";\r\n    if (!has(formats.starnames[res.culture].designation, res.stars.designationType)) res.designationType = \"desig\";\r\n    if (!res.stars.propernameType || res.stars.propernameType === \"\") res.stars.propernameType = \"name\";\r\n    if (!has(formats.starnames[res.culture].propername, res.stars.propernameType)) res.propernameType = \"name\";\r\n    if (!res.dsos.namesType || res.dsos.namesType === \"\") res.dsos.namesType = \"desig\";\r\n    if (!res.constellations.namesType || res.constellations.namesType === \"\") res.constellations.namesType = \"desig\";\r\n    if (!has(formats.constellations[res.culture].names, res.constellations.namesType)) res.constellations.namesType = \"name\";\r\n    if (!res.planets.symbolType || res.planets.symbolType === \"\") res.planets.symbolType = \"symbol\";\r\n    if (!res.planets.namesType || res.planets.namesType === \"\") res.planets.namesType = \"desig\";\r\n    if (!has(formats.planets[res.culture].names, res.planets.namesType)) res.planets.namesType = \"desig\";\r\n    //Expand all parameters that can be arrays into arrays, no need to test it later\r\n    res.constellations.nameStyle.font = arrayfy(res.constellations.nameStyle.font);\r\n    res.constellations.nameStyle.opacity = arrayfy(res.constellations.nameStyle.opacity);\r\n    res.constellations.nameStyle.fill = arrayfy(res.constellations.nameStyle.fill);\r\n    res.constellations.lineStyle.width = arrayfy(res.constellations.lineStyle.width);\r\n    res.constellations.lineStyle.opacity = arrayfy(res.constellations.lineStyle.opacity);\r\n    res.constellations.lineStyle.stroke = arrayfy(res.constellations.lineStyle.stroke);\r\n\r\n    Object.assign(globalConfig, res);\r\n    return res; \r\n  }\r\n};\r\n\r\nfunction arrayfy(o) {\r\n  var res;\r\n  if (!isArray(o)) return [o, o, o];  //It saves some work later, OK?\r\n  if (o.length >= 3) return o;\r\n  if (o.length === 1) return [o[0], o[0], o[0]];\r\n  if (o.length === 2) return [o[0], o[1], o[1]];\r\n}\r\n\r\nCelestial.settings = function () { return settings; };\r\n\r\n//b-v color index to rgb color value scale\r\nvar bvcolor = \r\n  d3.scale.quantize().domain([3.347, -0.335]) //main sequence <= 1.7\r\n    .range([ '#ff4700', '#ff4b00', '#ff4f00', '#ff5300', '#ff5600', '#ff5900', '#ff5b00', '#ff5d00', '#ff6000', '#ff6300', '#ff6500', '#ff6700', '#ff6900', '#ff6b00', '#ff6d00', '#ff7000', '#ff7300', '#ff7500', '#ff7800', '#ff7a00', '#ff7c00', '#ff7e00', '#ff8100', '#ff8300', '#ff8506', '#ff870a', '#ff8912', '#ff8b1a', '#ff8e21', '#ff9127', '#ff932c', '#ff9631', '#ff9836', '#ff9a3c', '#ff9d3f', '#ffa148', '#ffa34b', '#ffa54f', '#ffa753', '#ffa957', '#ffab5a', '#ffad5e', '#ffb165', '#ffb269', '#ffb46b', '#ffb872', '#ffb975', '#ffbb78', '#ffbe7e', '#ffc184', '#ffc489', '#ffc78f', '#ffc892', '#ffc994', '#ffcc99', '#ffce9f', '#ffd1a3', '#ffd3a8', '#ffd5ad', '#ffd7b1', '#ffd9b6', '#ffdbba', '#ffddbe', '#ffdfc2', '#ffe1c6', '#ffe3ca', '#ffe4ce', '#ffe8d5', '#ffe9d9', '#ffebdc', '#ffece0', '#ffefe6', '#fff0e9', '#fff2ec', '#fff4f2', '#fff5f5', '#fff6f8', '#fff9fd', '#fef9ff', '#f9f6ff', '#f6f4ff', '#f3f2ff', '#eff0ff', '#ebeeff', '#e9edff', '#e6ebff', '#e3e9ff', '#e0e7ff', '#dee6ff', '#dce5ff', '#d9e3ff', '#d7e2ff', '#d3e0ff', '#c9d9ff', '#bfd3ff', '#b7ceff', '#afc9ff', '#a9c5ff', '#a4c2ff', '#9fbfff', '#9bbcff']);\r\n \r\n/* Default parameters for each supported projection\r\n     arg: constructor argument, if any \r\n     scale: scale parameter so that they all have ~equal width, normalized to 1024 pixels\r\n     ratio: width/height ratio, 2.0 if none\r\n     clip: projection clipped to 90 degrees from center, otherwise to antimeridian\r\n*/\r\nvar projections = {\r\n  \"airy\": {n:\"Airy’s Minimum Error\", arg:Math.PI/2, scale:360, ratio:1.0, clip:true},\r\n  \"aitoff\": {n:\"Aitoff\", arg:null, scale:162},\r\n  \"armadillo\": {n:\"Armadillo\", arg:0, scale:250}, \r\n  \"august\": {n:\"August\", arg:null, scale:94, ratio:1.4},\r\n  \"azimuthalEqualArea\": {n:\"Azimuthal Equal Area\", arg:null, scale:340, ratio:1.0, clip:true},\r\n  \"azimuthalEquidistant\": {n:\"Azimuthal Equidistant\", arg:null, scale:320, ratio:1.0, clip:true},\r\n  \"baker\": {n:\"Baker Dinomic\", arg:null, scale:160, ratio:1.4},\r\n  \"berghaus\": {n:\"Berghaus Star\", arg:0, scale:320, ratio:1.0, clip:true},\r\n  \"boggs\": {n:\"Boggs Eumorphic\", arg:null, scale:170},\r\n  \"bonne\": {n:\"Bonne\", arg:Math.PI/2.5, scale:225, ratio:0.88},\r\n  \"bromley\": {n:\"Bromley\", arg:null, scale:162},\r\n//  \"butterfly\": {n:\"Butterfly\", arg:null, scale:31, ratio:1.1, clip:true},\r\n  \"cassini\": {n:\"Cassini\", arg:null, scale:325, ratio:1.0, clip:true},\r\n  \"collignon\": {n:\"Collignon\", arg:null, scale:100, ratio:2.6},\r\n  \"craig\": {n:\"Craig Retroazimuthal\", arg:0, scale:310, ratio:1.5, clip:true},\r\n  \"craster\": {n:\"Craster Parabolic\", arg:null, scale:160},\r\n  \"cylindricalEqualArea\": {n:\"Cylindrical Equal Area\", arg:Math.PI/6, scale:190, ratio:2.3},\r\n  \"cylindricalStereographic\": {n:\"Cylindrical Stereographic\", arg:Math.PI/4, scale:230, ratio:1.3},\r\n  \"eckert1\": {n:\"Eckert I\", arg:null, scale:175},\r\n  \"eckert2\": {n:\"Eckert II\", arg:null, scale:175},\r\n  \"eckert3\": {n:\"Eckert III\", arg:null, scale:190},\r\n  \"eckert4\": {n:\"Eckert IV\", arg:null, scale:190},\r\n  \"eckert5\": {n:\"Eckert V\", arg:null, scale:182},\r\n  \"eckert6\": {n:\"Eckert VI\", arg:null, scale:182},\r\n  \"eisenlohr\": {n:\"Eisenlohr\", arg:null, scale:102},\r\n  \"equirectangular\": {n:\"Equirectangular\", arg:null, scale:165},\r\n  \"fahey\": {n:\"Fahey\", arg:null, scale:196, ratio:1.4},\r\n  \"mtFlatPolarParabolic\": {n:\"Flat Polar Parabolic\", arg:null, scale:175},\r\n  \"mtFlatPolarQuartic\": {n:\"Flat Polar Quartic\", arg:null, scale:230, ratio:1.65},\r\n  \"mtFlatPolarSinusoidal\": {n:\"Flat Polar Sinusoidal\", arg:null, scale:175, ratio:1.9},\r\n  \"foucaut\": {n:\"Foucaut\", arg:null, scale:142},\r\n  \"ginzburg4\": {n:\"Ginzburg IV\", arg:null, scale:180, ratio:1.7},\r\n  \"ginzburg5\": {n:\"Ginzburg V\", arg:null, scale:196, ratio:1.55},\r\n  \"ginzburg6\": {n:\"Ginzburg VI\", arg:null, scale:190, ratio:1.4},\r\n  \"ginzburg8\": {n:\"Ginzburg VIII\", arg:null, scale:205, ratio:1.3},\r\n  \"ginzburg9\": {n:\"Ginzburg IX\", arg:null, scale:190, ratio:1.4},\r\n  //\"guyou\": {n:\"Guyou\", arg:null, scale:160, ratio:2, clip:true},\r\n  //\"bonne\": {n:\"Heart\", arg:Math.PI/2.5, scale:225, ratio:0.88},\r\n  \"homolosine\": {n:\"Goode Homolosine\", arg:null, scale:160, ratio:2.2},\r\n  \"hammer\": {n:\"Hammer\", arg:2, scale:180},\r\n  \"hatano\": {n:\"Hatano\", arg:null, scale:186},\r\n  \"healpix\": {n:\"HEALPix\", arg:1, scale:320, ratio:1.2},\r\n  \"hill\": {n:\"Hill Eucyclic\", arg:2, scale:190, ratio:1.1},\r\n  \"kavrayskiy7\": {n:\"Kavrayskiy VII\", arg:null, scale:185, ratio:1.75},\r\n  \"lagrange\": {n:\"Lagrange\", arg:Math.PI/4, scale:88, ratio:1.6, clip:false},\r\n  \"larrivee\": {n:\"l'Arrivée\", arg:null, scale:160, ratio:1.25},\r\n  \"laskowski\": {n:\"Laskowski Tri-Optimal\", arg:null, scale:165, ratio:1.7},\r\n  \"loximuthal\": {n:\"Loximuthal\", arg:Math.PI/4, scale:175, ratio:1.8},\r\n  \"mercator\": {n:\"Mercator\", arg:null, scale:160, ratio:1.3},\r\n  \"miller\": {n:\"Miller\", arg:null, scale:160, ratio:1.5},\r\n  \"mollweide\": {n:\"Mollweide\", arg:null, scale:180},\r\n  \"naturalEarth\": {n:\"Natural Earth\", arg:null, scale:185, ratio:1.85},\r\n  \"nellHammer\": {n:\"Nell Hammer\", arg:null, scale:160, ratio:2.6},\r\n  \"orthographic\": {n:\"Orthographic\", arg:null, scale:480, ratio:1.0, clip:true},\r\n  \"patterson\": {n:\"Patterson Cylindrical\", arg:null, scale:160, ratio:1.75},\r\n  \"polyconic\": {n:\"Polyconic\", arg:null, scale:160, ratio:1.3},\r\n  \"quincuncial\": {n:\"Quincuncial\", arg:null, scale:160, ratio:1.3},\r\n  \"rectangularPolyconic\": {n:\"Rectangular Polyconic\", arg:0, scale:160, ratio:1.65},\r\n  \"robinson\": {n:\"Robinson\", arg:null, scale:160},\r\n  \"sinusoidal\": {n:\"Sinusoidal\", arg:null, scale:160, ratio:2},\r\n  \"stereographic\": {n:\"Stereographic\", arg:null, scale:500, ratio:1.0, clip:true},\r\n  \"times\": {n:\"Times\", arg:null, scale:210, ratio:1.4}, \r\n  \"twoPointEquidistant\": {n:\"Two-Point Equidistant\", arg:Math.PI/2, scale:320, ratio:1.15, clip:true},\r\n  \"vanDerGrinten\": {n:\"van Der Grinten\", arg:null, scale:160, ratio:1.0}, \r\n  \"vanDerGrinten2\": {n:\"van Der Grinten II\", arg:null, scale:160, ratio:1.0},\r\n  \"vanDerGrinten3\": {n:\"van Der Grinten III\", arg:null, scale:160, ratio:1.0},\r\n  \"vanDerGrinten4\": {n:\"van Der Grinten IV\", arg:null, scale:160, ratio:1.6},\r\n  \"wagner4\": {n:\"Wagner IV\", arg:null, scale:185},\r\n  \"wagner6\": {n:\"Wagner VI\", arg:null, scale:160},\r\n  \"wagner7\": {n:\"Wagner VII\", arg:null, scale:190, ratio:1.8},\r\n  \"wiechel\": {n:\"Wiechel\", arg:null, scale:360, ratio:1.0, clip:true},\r\n  \"winkel3\": {n:\"Winkel Tripel\", arg:null, scale:196, ratio:1.7}\r\n};\r\n\r\nCelestial.projections = function () { return projections; };\r\n\r\nvar formats = {\r\n  \"starnames\": {\r\n    // \"name\":\"\",\"bayer\":\"\",\"flam\":\"\",\"var\":\"\",\"gl\":\"\",\"hd\":\"\",\"c\":\"\",\"desig\":\"\"\r\n    \"iau\": {\r\n      \"designation\": {\r\n        \"desig\": \"Designation\",     \r\n        \"bayer\": \"Bayer\",\r\n        \"flam\": \"Flamsteed\",\r\n        \"var\": \"Variable\",\r\n        \"gl\": \"Gliese\",\r\n        \"hd\": \"Draper\",\r\n        \"hip\": \"Hipparcos\"},\r\n      \"propername\": {\r\n        \"name\": \"IAU Name\",\r\n        \"ar\": \"Arabic\", \r\n        \"zh\": \"Chinese\",\r\n        \"en\": \"English\",\r\n        \"fi\": \"Finnish\", \r\n        \"fr\": \"French\", \r\n        \"de\": \"German\",\r\n        \"el\": \"Greek\", \r\n        \"he\": \"Hebrew\", \r\n        \"hi\": \"Hindi\", \r\n        \"it\": \"Italian\", \r\n        \"ja\": \"Japanese\", \r\n        \"ko\": \"Korean\", \r\n        \"la\": \"Latin\",\r\n        \"fa\": \"Persian\", \r\n        \"ru\": \"Russian\", \r\n        \"es\": \"Spanish\",\r\n        \"tr\": \"Turkish\"}\r\n    },\r\n    \"cn\": {\r\n      \"propername\": {\r\n        \"name\": \"Proper name\",\r\n        \"en\": \"English\",\r\n        \"pinyin\": \"Pinyin\"},\r\n      \"designation\": { \r\n        \"desig\": \"IAU Designation\"}\r\n    }\r\n  },\r\n  \"constellations\": {\r\n    \"iau\": {\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"name\": \"IAU Name\",\r\n        \"ar\": \"Arabic\", \r\n        \"zh\": \"Chinese\",\r\n        \"cz\": \"Czech\", \r\n        \"en\": \"English\",\r\n        \"ee\": \"Estonian\", \r\n        \"fi\": \"Finnish\", \r\n        \"fr\": \"French\", \r\n        \"de\": \"German\",\r\n        \"el\": \"Greek\", \r\n        \"he\": \"Hebrew\",\r\n        \"hi\": \"Hindi\", \r\n        \"it\": \"Italian\", \r\n        \"ja\": \"Japanese\", \r\n        \"sw\": \"Kiswahili\",\r\n        \"ko\": \"Korean\", \r\n        \"la\": \"Latin\",\r\n        \"fa\": \"Persian\", \r\n        \"ru\": \"Russian\", \r\n        \"es\": \"Spanish\",\r\n        \"tr\": \"Turkish\"}\r\n    },\r\n    \"cn\": {\r\n      \"names\": {\r\n        \"name\": \"Proper name\",\r\n        \"en\": \"English\",\r\n        \"pinyin\": \"Pinyin\"}\r\n    }             \r\n  },\r\n  \"planets\": {\r\n    \"iau\": {\r\n      \"symbol\": {\r\n        \"symbol\": \"\\u263e Symbol\",\r\n        \"letter\": \"\\u216c Letter\",\r\n        \"disk\": \"\\u25cf Disk\"},\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"ar\": \"Arabic\",\r\n        \"zh\": \"Chinese\",\r\n        \"en\": \"English\",\r\n        \"fr\": \"French\",\r\n        \"de\": \"German\",\r\n        \"el\": \"Greek\",\r\n        \"he\": \"Hebrew\",\r\n        \"hi\": \"Hindi\",\r\n        \"it\": \"Italian\",\r\n        \"ja\": \"Japanese\",\r\n        \"ko\": \"Korean\", \r\n        \"la\": \"Latin\",\r\n        \"fa\": \"Persian\", \r\n        \"ru\": \"Russian\",\r\n        \"es\": \"Spanish\"}\r\n    },\r\n    \"cn\": {\r\n      \"symbol\": {\r\n        \"symbol\": \"\\u263e Symbol\",\r\n        \"letter\": \"\\u216c Letter\",\r\n        \"disk\": \"\\u25cf Disk\"},\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"name\": \"Chinese\",\r\n        \"pinyin\": \"Pinyin\",\r\n        \"en\": \"English\"}\r\n    }\r\n  },\r\n  \"dsonames\": {\r\n    \"iau\": {\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"name\": \"English\",\r\n        \"ar\": \"Arabic\", \r\n        \"zh\": \"Chinese\",\r\n        \"fi\": \"Finnish\", \r\n        \"fr\": \"French\", \r\n        \"de\": \"German\",\r\n        \"el\": \"Greek\", \r\n        //\"he\": \"Hebrew\",\r\n        \"hi\": \"Hindi\", \r\n        \"it\": \"Italian\", \r\n        \"ja\": \"Japanese\", \r\n        \"ko\": \"Korean\", \r\n        \"la\": \"Latin\",\r\n        \"fa\": \"Persian\", \r\n        \"ru\": \"Russian\", \r\n        \"es\": \"Spanish\",\r\n        \"tr\": \"Turkish\"}\r\n    },\r\n    \"cn\": {\r\n      \"names\": {\r\n        \"desig\": \"Designation\",\r\n        \"name\": \"Chinese\",\r\n        \"pinyin\": \"Pinyin\",\r\n        \"en\": \"English\"}\r\n    }\r\n  }\r\n};\r\n\r\nvar formats_all = {\r\n  \"iau\": Object.keys(formats.constellations.iau.names).concat(Object.keys(formats.planets.iau.names)).filter( function(value, index, self) { return self.indexOf(value) === index; } ),\r\n  \"cn\":  Object.keys(formats.constellations.cn.names).concat(Object.keys(formats.starnames.cn.propername)).filter( function(value, index, self) { return self.indexOf(value) === index; } )\r\n};\r\n\r\nvar Canvas = {}; \r\n\r\nCanvas.symbol = function () {\r\n  // parameters and default values\r\n  var type = d3.functor(\"circle\"), \r\n      size = d3.functor(64), \r\n      age = d3.functor(Math.PI), //crescent shape 0..2Pi\r\n      color = d3.functor(\"#fff\"),  \r\n      text = d3.functor(\"\"),  \r\n      padding = d3.functor([2,2]),  \r\n      pos;\r\n  \r\n  function canvas_symbol(context) {\r\n    draw_symbol[type()](context);\r\n  }\r\n  \r\n  var draw_symbol = {\r\n    \"circle\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"square\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/1.7;\r\n      ctx.moveTo(pos[0]-r, pos[1]-r);\r\n      ctx.lineTo(pos[0]+r, pos[1]-r);\r\n      ctx.lineTo(pos[0]+r, pos[1]+r);\r\n      ctx.lineTo(pos[0]-r, pos[1]+r);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"diamond\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/1.5;\r\n      ctx.moveTo(pos[0], pos[1]-r);\r\n      ctx.lineTo(pos[0]+r, pos[1]);\r\n      ctx.lineTo(pos[0], pos[1]+r);\r\n      ctx.lineTo(pos[0]-r, pos[1]);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"triangle\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/Math.sqrt(3);\r\n      ctx.moveTo(pos[0], pos[1]-r);\r\n      ctx.lineTo(pos[0]+r, pos[1]+r);\r\n      ctx.lineTo(pos[0]-r, pos[1]+r);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"ellipse\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.save();\r\n      ctx.translate(pos[0], pos[1]);\r\n      ctx.scale(1.6, 0.8); \r\n      ctx.beginPath();\r\n      ctx.arc(0, 0, r, 0, 2 * Math.PI); \r\n      ctx.closePath();\r\n      ctx.restore();      \r\n      return r;\r\n    },\r\n    \"marker\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.moveTo(pos[0], pos[1]-r);\r\n      ctx.lineTo(pos[0], pos[1]+r);\r\n      ctx.moveTo(pos[0]-r, pos[1]);\r\n      ctx.lineTo(pos[0]+r, pos[1]);\r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"cross-circle\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.moveTo(pos[0], pos[1]-s);\r\n      ctx.lineTo(pos[0], pos[1]+s);\r\n      ctx.moveTo(pos[0]-s, pos[1]);\r\n      ctx.lineTo(pos[0]+s, pos[1]);\r\n      ctx.stroke();\r\n      ctx.beginPath();\r\n      ctx.moveTo(pos[0], pos[1]);\r\n      ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);    \r\n      ctx.closePath();\r\n      return r;\r\n    },\r\n    \"stroke-circle\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2;\r\n      ctx.moveTo(pos[0], pos[1]-s);\r\n      ctx.lineTo(pos[0], pos[1]+s);\r\n      ctx.stroke();\r\n      ctx.beginPath();\r\n      ctx.moveTo(pos[0], pos[1]);\r\n      ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);    \r\n      ctx.closePath();\r\n      return r;\r\n    }, \r\n    \"crescent\": function(ctx) {\r\n      var s = Math.sqrt(size()), \r\n          r = s/2,\r\n          ag = age(),\r\n          ph = 0.5 * (1 - Math.cos(ag)),\r\n          e = 1.6 * Math.abs(ph - 0.5) + 0.01,\r\n          dir = ag > Math.PI,\r\n          termdir = Math.abs(ph) > 0.5 ? dir : !dir,\r\n          moonFill = ctx.fillStyle,\r\n          darkFill = ph < 0.157 ? \"#669\" : \"#557\";\r\n      ctx.save();\r\n      ctx.fillStyle = darkFill;\r\n      ctx.beginPath();\r\n      ctx.moveTo(pos[0], pos[1]);\r\n      ctx.arc(pos[0], pos[1], r, 0, 2 * Math.PI);    \r\n      ctx.closePath();\r\n      ctx.fill();\r\n      ctx.fillStyle = moonFill;\r\n      ctx.beginPath();\r\n      ctx.moveTo(pos[0], pos[1]);\r\n      ctx.arc(pos[0], pos[1], r, -Math.PI/2, Math.PI/2, dir); \r\n      ctx.scale(e, 1);\r\n      ctx.arc(pos[0]/e, pos[1], r, Math.PI/2, -Math.PI/2, termdir); \r\n      ctx.closePath();\r\n      ctx.fill();\r\n      ctx.restore();\r\n      \r\n      return r;\r\n    } \r\n  };\r\n\r\n  \r\n  canvas_symbol.type = function(_) {\r\n    if (!arguments.length) return type; \r\n    type = d3.functor(_);\r\n    return canvas_symbol;\r\n  };\r\n  canvas_symbol.size = function(_) {\r\n    if (!arguments.length) return size; \r\n    size = d3.functor(_);\r\n    return canvas_symbol;\r\n  };\r\n  canvas_symbol.age = function(_) {\r\n    if (!arguments.length) return age; \r\n    age = d3.functor(_);\r\n    return canvas_symbol;\r\n  };\r\n  canvas_symbol.text = function(_) {\r\n    if (!arguments.length) return text; \r\n    text = d3.functor(_);\r\n    return canvas_symbol;\r\n  };\r\n  canvas_symbol.position = function(_) {\r\n    if (!arguments.length) return; \r\n    pos = _;\r\n    return canvas_symbol;\r\n  };\r\n\r\n  return canvas_symbol;\r\n};\r\n\r\nCelestial.Canvas = Canvas;\r\n\r\n\r\n/*var color = \"#fff\", angle = 0, align = \"center\", baseline = \"middle\", font = \"10px sans-serif\", padding = [0,0], aPos, sText;\r\n\r\ncanvas.text = function () {\r\n\r\n  function txt(ctx){\r\n    ctx.fillStyle = color;\r\n    ctx.textAlign = align;\r\n    ctx.textBaseline = baseline;\r\n    \r\n    //var pt = projection(d.geometry.coordinates);\r\n    if (angle) {\r\n      canvas.save();     \r\n      canvas.translate(aPos[0], aPos[1]);\r\n      canvas.rotate(angle); \r\n      canvas.fillText(sText, 0, 0);\r\n      canvas.restore();     \r\n    } else\r\n      canvas.fillText(sText, aPos[0], aPos[1]);\r\n  }\r\n  \r\n  txt.angle = function(x) {\r\n    if (!arguments.length) return angle * 180 / Math.PI;\r\n    color = x  * Math.PI / 180;\r\n    return txt;\r\n  };  \r\n  txt.color = function(s) {\r\n    if (!arguments.length) return color;\r\n    color = s;\r\n    return txt;\r\n  };  \r\n  txt.align = function(s) {\r\n    if (!arguments.length) return align;\r\n    align = s;\r\n    return txt;\r\n  };\r\n  txt.baseline = function(s) {\r\n    if (!arguments.length) return baseline;\r\n    baseline = s;\r\n    return txt;\r\n  };\r\n  txt.padding = function(a) {\r\n    if (!arguments.length) return padding;\r\n    padding = a;\r\n    return txt;\r\n  };\r\n  txt.text = function(s) {\r\n    if (!arguments.length) return sText;\r\n    sText = s;\r\n    return txt;\r\n  };\r\n  txt.font = function(s) {\r\n    if (!arguments.length) return font;\r\n    font = s;\r\n    return txt;\r\n  };\r\n  txt.style = function(o) {\r\n    if (!arguments.length) return;\r\n    if (o.fill) color = o.fill;\r\n    if (o.font) font = o.font;\r\n    return txt;\r\n  }; \r\n  \r\n}\r\n\r\n  function ctxPath(d) {\r\n    var pt;\r\n    //d.map( function(axe, i) {\r\n    context.beginPath();\r\n    for (var i = 0; i < d.length; i++) {\r\n      pt = projection(d[i]);\r\n      if (i === 0)\r\n        context.moveTo(pt[0], pt[1]);\r\n      else\r\n        context.lineTo(pt[0], pt[1]);\r\n    }\r\n    context.fill();\r\n  }\r\n  \r\n\r\n  function ctxText(d, ang) {\r\n    var pt = projection(d.geometry.coordinates);\r\n    if (ang) {\r\n      canvas.save();     \r\n      canvas.translate(pt[0], pt[1]);\r\n      canvas.rotate(Math.PI/2); \r\n      canvas.fillText(txt, 0, 0);\r\n      canvas.restore();     \r\n    } else\r\n      canvas.fillText(d.properties.txt, pt[0], pt[1]);\r\n  }\r\n  \r\n\r\n*/\r\nfunction $(id) { return document.querySelector(parentElement + \" #\" + id); }\r\nfunction px(n) { return n + \"px\"; } \r\nfunction Round(x, dg) { return(Math.round(Math.pow(10,dg)*x)/Math.pow(10,dg)); }\r\nfunction sign(x) { return x ? x < 0 ? -1 : 1 : 0; }\r\nfunction pad(n) { return n < 10 ? '0' + n : n; }\r\n\r\n\r\nfunction has(o, key) { return o !== null && hasOwnProperty.call(o, key); }\r\nfunction when(o, key, val) { return o !== null && hasOwnProperty.call(o, key) ? o[key] : val; }\r\nfunction isNumber(n) { return n !== null && !isNaN(parseFloat(n)) && isFinite(n); }\r\nfunction isArray(o) { return o !== null && Object.prototype.toString.call(o) === \"[object Array]\"; }\r\nfunction isObject(o) { var type = typeof o;  return type === 'function' || type === 'object' && !!o; }\r\nfunction isFunction(o) { return typeof o == 'function' || false; }\r\nfunction isValidDate(d) { return d && d instanceof Date && !isNaN(d); }\r\nfunction fileExists(url) {\r\n  var http = new XMLHttpRequest();\r\n  http.open('HEAD', url, false);\r\n  http.send();\r\n  return http.status != 404;\r\n}\r\n\r\nfunction findPos(o) {\r\n  var l = 0, t = 0;\r\n  if (o.offsetParent) {\r\n    do {\r\n      l += o.offsetLeft;\r\n      t += o.offsetTop;\r\n    } while ((o = o.offsetParent) !== null);\r\n  }\r\n  return [l, t];\r\n}\r\n\r\nfunction hasParent(t, id){\r\n  while(t.parentNode){\r\n    if(t.id === id) return true;\r\n    t = t.parentNode;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction attach(node, event, func) {\r\n  if (node.addEventListener) node.addEventListener(event, func, false);\r\n  else node.attachEvent(\"on\" + event, func); \r\n}\r\n\r\nfunction stopPropagation(e) {\r\n  if (typeof e.stopPropagation != \"undefined\") e.stopPropagation();\r\n  else e.cancelBubble = true;\r\n}\r\n\r\nfunction dateDiff(dt1, dt2, type) {\r\n  var diff = dt2.valueOf() - dt1.valueOf(),\r\n      tp = type || \"d\";\r\n  switch (tp) {\r\n    case 'y': case 'yr': diff /= 31556926080; break;\r\n    case 'm': case 'mo': diff /= 2629800000; break;\r\n    case 'd': case 'dy': diff /= 86400000; break;\r\n    case 'h': case 'hr': diff /= 3600000; break;\r\n    case 'n': case 'mn': diff /= 60000; break;\r\n    case 's': case 'sec': diff /= 1000; break;\r\n    case 'ms': break;    \r\n  }\r\n  return Math.floor(diff);\r\n}\r\n\r\nfunction dateParse(s) {\r\n  if (!s) return; \r\n  var t = s.split(\".\");\r\n  if (t.length < 1) return; \r\n  t = t[0].split(\"-\");\r\n  t[0] = t[0].replace(/\\D/g, \"\");\r\n  if (!t[0]) return; \r\n  t[1] = t[1] ? t[1].replace(/\\D/g, \"\") : \"1\";\r\n  t[2] = t[2] ? t[2].replace(/\\D/g, \"\") : \"1\";\r\n  //Fraction -> h:m:s\r\n  return new Date(Date.UTC(t[0], t[1]-1, t[2]));\r\n}\r\n\r\n\r\nfunction interpolateAngle(a1, a2, t) {\r\n  a1 = (a1*deg2rad +τ) % τ;\r\n  a2 = (a2*deg2rad + τ) % τ;\r\n  if (Math.abs(a1 - a2) > Math.PI) {\r\n    if (a1 > a2) a1 = a1 - τ;\r\n    else if (a2 > a1) a2 = a2 - τ;\r\n  }\r\n  return d3.interpolateNumber(a1/deg2rad, a2/deg2rad);\r\n}\r\n\r\nvar Trig = {\r\n  sinh: function (val) { return (Math.pow(Math.E, val)-Math.pow(Math.E, -val))/2; },\r\n  cosh: function (val) { return (Math.pow(Math.E, val)+Math.pow(Math.E, -val))/2; },\r\n  tanh: function (val) { return 2.0 / (1.0 + Math.exp(-2.0 * val)) - 1.0; },\r\n  asinh: function (val) { return Math.log(val + Math.sqrt(val * val + 1)); },\r\n  acosh: function (val) { return Math.log(val + Math.sqrt(val * val - 1)); },\r\n  normalize0: function(val) {  return ((val + Math.PI*3) % (Math.PI*2)) - Math.PI; },\r\n  normalize: function(val) {  return ((val + Math.PI*2) % (Math.PI*2)); },  \r\n  cartesian: function(p) {\r\n    var ϕ = p[0], θ = halfπ - p[1], r = p[2];\r\n    return {\"x\": r * Math.sin(θ) * Math.cos(ϕ), \"y\": r * Math.sin(θ) * Math.sin(ϕ), \"z\": r * Math.cos(θ)};\r\n  },\r\n  spherical: function(p) {\r\n    var r = Math.sqrt(p.x * p.x + p.y * p.y + p.z * p.z),\r\n        θ = Math.atan(p.y / p.x),\r\n        ϕ = Math.acos(p.z / r);\r\n    return  [θ / deg2rad, ϕ / deg2rad, r];\r\n  },\r\n  distance: function(p1, p2) {\r\n    return Math.acos(Math.sin(p1[1])*Math.sin(p2[1]) + Math.cos(p1[1])*Math.cos(p2[1])*Math.cos(p1[0]-p2[0]));\r\n  }\r\n};\r\n\r\nvar epsilon = 1e-6, \r\n    halfPi =  Math.PI / 2, \r\n    quarterPi =  Math.PI / 4, \r\n    tau =  Math.PI * 2;\r\n    \r\nfunction cartesian(spherical) {\r\n  var lambda = spherical[0], phi = spherical[1], cosPhi = Math.cos(phi);\r\n  return [cosPhi * Math.cos(lambda), cosPhi * Math.sin(lambda), Math.sin(phi)];\r\n}\r\n\r\nfunction cartesianCross(a, b) {\r\n  return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\r\n}\r\n\r\nfunction cartesianNormalizeInPlace(d) {\r\n  var l = Math.sqrt(d[0] * d[0] + d[1] * d[1] + d[2] * d[2]);\r\n  d[0] /= l; d[1] /= l; d[2] /= l;\r\n}\r\n\r\nfunction longitude(point) {\r\n  if (Math.abs(point[0]) <= Math.PI)\r\n    return point[0];\r\n  else\r\n    return sign(point[0]) * ((Math.abs(point[0]) +  Math.PI) % tau -  Math.PI);\r\n}\r\n\r\nfunction poligonContains(polygon, point) {\r\n  var lambda = longitude(point),\r\n      phi = point[1],\r\n      sinPhi = Math.sin(phi),\r\n      normal = [Math.sin(lambda), -Math.cos(lambda), 0],\r\n      angle = 0,\r\n      winding = 0,\r\n      sum = 0;\r\n\r\n  if (sinPhi === 1) phi = halfPi + epsilon;\r\n  else if (sinPhi === -1) phi = -halfPi - epsilon;\r\n\r\n  for (var i = 0, n = polygon.length; i < n; ++i) {\r\n    if (!(m = (ring = polygon[i]).length)) continue;\r\n    var ring,\r\n        m,\r\n        point0 = ring[m - 1],\r\n        lambda0 = longitude(point0),\r\n        phi0 = point0[1] / 2 + quarterPi,\r\n        sinPhi0 = Math.sin(phi0),\r\n        cosPhi0 = Math.cos(phi0),\r\n        point1, cosPhi1, sinPhi1, lambda1;\r\n\r\n    for (var j = 0; j < m; ++j, lambda0 = lambda1, sinPhi0 = sinPhi1, cosPhi0 = cosPhi1, point0 = point1) {\r\n      point1 = ring[j];\r\n      lambda1 = longitude(point1);\r\n      var phi1 = point1[1] / 2 + quarterPi;\r\n      sinPhi1 = Math.sin(phi1);\r\n      cosPhi1 = Math.cos(phi1);\r\n      var delta = lambda1 - lambda0,\r\n          sign = delta >= 0 ? 1 : -1,\r\n          absDelta = sign * delta,\r\n          antimeridian = absDelta > Math.PI,\r\n          k = sinPhi0 * sinPhi1;\r\n\r\n      sum += Math.atan2(k * sign * Math.sin(absDelta), cosPhi0 * cosPhi1 + k * Math.cos(absDelta));\r\n      angle += antimeridian ? delta + sign * tau : delta;\r\n\r\n      if ((antimeridian ^ lambda0) >= (lambda ^ lambda1) >= lambda) {\r\n        var arc = cartesianCross(cartesian(point0), cartesian(point1));\r\n        cartesianNormalizeInPlace(arc);\r\n        var intersection = cartesianCross(normal, arc);\r\n        cartesianNormalizeInPlace(intersection);\r\n        var phiArc = (antimeridian ^ delta >= 0 ? -1 : 1) * Math.asin(intersection[2]);\r\n        if (phi > phiArc || phi === phiArc && (arc[0] || arc[1])) {\r\n          winding += antimeridian ^ delta >= 0 ? 1 : -1;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return (angle < -epsilon || angle < epsilon && sum < -epsilon) ^ (winding & 1);\r\n}\r\n\r\n//display settings form in div with id \"celestial-form\"\r\nfunction form(cfg) {\r\n  var config = settings.set(cfg); \r\n\r\n  var prj = Celestial.projections(), leo = Celestial.eulerAngles();\r\n  var div = d3.select(parentElement + \" ~ #celestial-form\");\r\n  //if div doesn't exist, create it\r\n  if (div.size() < 1) {\r\n    //var container = (config.container || \"celestial-map\");\r\n    div = d3.select(parentElement).select(function() { return this.parentNode; }).append(\"div\").attr(\"id\", \"celestial-form\");\r\n  }\r\n  var ctrl = div.append(\"div\").attr(\"class\", \"ctrl\");\r\n  var frm = ctrl.append(\"form\").attr(\"id\", \"params\").attr(\"name\", \"params\").attr(\"method\", \"get\").attr(\"action\" ,\"#\");\r\n  \r\n  //Map parameters    \r\n  var col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"general\");\r\n  \r\n  col.append(\"label\").attr(\"title\", \"Map width in pixel, 0 indicates full width\").attr(\"for\", \"width\").html(\"Width \");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"maxlength\", \"4\").attr(\"max\", \"20000\").attr(\"min\", \"0\").attr(\"title\", \"Map width\").attr(\"id\", \"width\").attr(\"value\", config.width).on(\"change\", resize);\r\n  col.append(\"span\").html(\"px\");\r\n\r\n  col.append(\"label\").attr(\"title\", \"Map projection, (hemi) indicates hemispherical projection\").attr(\"for\", \"projection\").html(\"Projection\");\r\n  var sel = col.append(\"select\").attr(\"id\", \"projection\").on(\"change\", reproject);\r\n  var selected = 0;\r\n  var list = Object.keys(prj).map( function (key, i) { \r\n    var n = prj[key].clip && prj[key].clip === true ? prj[key].n + \" (hemi)\" : prj[key].n; \r\n    if (key === config.projection) selected = i;\r\n    return {o:key, n:n};\r\n  });\r\n  sel.selectAll('option').data(list).enter().append('option')\r\n     .attr(\"value\", function (d) { return d.o; })\r\n     .text(function (d) { return d.n; });\r\n  sel.property(\"selectedIndex\", selected);\r\n  \r\n  selected = 0;\r\n  col.append(\"label\").attr(\"title\", \"Coordinate space in which the map is displayed\").attr(\"for\", \"transform\").html(\"Coordinates\");\r\n  sel = col.append(\"select\").attr(\"id\", \"transform\").on(\"change\", reload);\r\n  list = Object.keys(leo).map(function (key, i) {\r\n    if (key === config.transform) selected = i;    \r\n    return {o:key, n:key.replace(/^([a-z])/, function(s, m) { return m.toUpperCase(); } )}; \r\n  });\r\n  sel.selectAll(\"option\").data(list).enter().append('option')\r\n     .attr(\"value\", function (d) { return d.o; })\r\n     .text(function (d) { return d.n; });\r\n  sel.property(\"selectedIndex\", selected);\r\n\r\n  col.append(\"br\");\r\n  col.append(\"label\").attr(\"title\", \"Center coordinates long/lat in selected coordinate space\").attr(\"for\", \"centerx\").html(\"Center\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centerx\").attr(\"title\", \"Center right ascension/longitude\").attr(\"max\", \"24\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", turn);\r\n  col.append(\"span\").attr(\"id\", \"cxunit\").html(\"h\");\r\n  //addList(\"centerx\", \"ra\");\r\n  \r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centery\").attr(\"title\", \"Center declination/latitude\").attr(\"max\", \"90\").attr(\"min\", \"-90\").attr(\"step\", \"0.1\").on(\"change\", turn);\r\n  col.append(\"span\").html(\"\\u00b0\");\r\n\r\n  col.append(\"label\").attr(\"title\", \"Orientation\").attr(\"for\", \"centerz\").html(\"Orientation\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"centerz\").attr(\"title\", \"Center orientation\").attr(\"max\", \"180\").attr(\"min\", \"-180\").attr(\"step\", \"0.1\").on(\"change\", turn);\r\n  col.append(\"span\").html(\"\\u00b0\");\r\n\r\n  col.append(\"label\").attr(\"for\", \"orientationfixed\").attr(\"class\", \"advanced\").html(\"Fixed\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"orientationfixed\").attr(\"class\", \"advanced\").property(\"checked\", config.orientationfixed).on(\"change\", apply);    \r\n\r\n  col.append(\"label\").attr(\"title\", \"Center and zoom in on this constellation\").attr(\"for\", \"constellation\").html(\"Show\");\r\n  col.append(\"select\").attr(\"id\", \"constellation\").on(\"change\", showConstellation);\r\n  \r\n  setCenter(config.center, config.transform);\r\n\r\n  // Stars \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"stars\");\r\n  \r\n  col.append(\"label\").attr(\"class\", \"header\").attr(\"for\", \"stars-show\").html(\"Stars\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-show\").property(\"checked\", config.stars.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"stars-limit\").html(\"down to magnitude\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-limit\").attr(\"title\", \"Star display limit (magnitude)\").attr(\"value\", config.stars.limit).attr(\"max\", \"6\").attr(\"min\", \"-1\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"stars-colors\").html(\"with spectral colors\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-colors\").property(\"checked\", config.stars.colors).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"stars-color\").html(\"or default color \");\r\n  col.append(\"input\").attr(\"type\", \"color\").attr(\"autocomplete\", \"off\").attr(\"id\", \"stars-style-fill\").attr(\"title\", \"Star color\").property(\"value\", config.stars.style.fill).on(\"change\", apply);\r\n\r\n  col.append(\"br\");\r\n  \r\n  var names = formats.starnames[config.culture] || formats.starnames.iau;\r\n  \r\n  for (var fld in names) {\r\n    if (!has(names, fld)) continue;\r\n    var keys = Object.keys(names[fld]);\r\n    if (keys.length > 1) {\r\n      //Select List\r\n      col.append(\"label\").attr(\"for\", \"stars-\" + fld).html(\"Show\");\r\n      \r\n      selected = 0;\r\n      col.append(\"label\").attr(\"title\", \"Type of star name\").attr(\"id\", \"label-propername\").attr(\"for\", \"stars-\" + fld + \"Type\").html(function () { return fld === \"propername\" ? \"proper names\" : \"\"; });\r\n      sel = col.append(\"select\").attr(\"id\", \"stars-\" + fld + \"Type\").attr(\"class\", function () { return fld === \"propername\" ? \"advanced\" : \"\"; }).on(\"change\", apply);\r\n      list = keys.map(function (key, i) {\r\n        if (key === config.stars[fld + \"Type\"]) selected = i;\r\n        return {o:key, n:names[fld][key]}; \r\n      });\r\n      sel.selectAll(\"option\").data(list).enter().append('option')\r\n         .attr(\"value\", function (d) { return d.o; })\r\n         .text(function (d) { return d.n; });\r\n      sel.property(\"selectedIndex\", selected);\r\n\r\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-\" + fld).property(\"checked\", config.stars[fld]).on(\"change\", apply);\r\n    } else if (keys.length === 1) {\r\n      //Simple field\r\n    col.append(\"label\").attr(\"for\", \"stars-\" + fld).html(\" \" + names[fld][keys[0]]);\r\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"stars-\" + fld).property(\"checked\", config.stars[fld]).on(\"change\", apply);\r\n    }    \r\n    col.append(\"label\").attr(\"for\", \"stars-\" + fld + \"Limit\").html(\"down to mag\");\r\n    col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-\" + fld + \"Limit\").attr(\"title\", \"Star name display limit (magnitude)\").attr(\"value\", config.stars[fld + \"Limit\"]).attr(\"max\", \"6\").attr(\"min\", \"-1\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n  \r\n  }\r\n\r\n  col.append(\"br\");\r\n\r\n  col.append(\"label\").attr(\"for\", \"stars-size\").attr(\"class\", \"advanced\").html(\"Stellar disk size: base\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-size\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed star disk; base\").attr(\"value\", config.stars.size).attr(\"max\", \"100\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n\r\n  col.append(\"label\").attr(\"for\", \"stars-exponent\").attr(\"class\", \"advanced\").html(\" * e ^ (exponent\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"stars-exponent\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed star disk; exponent\").attr(\"value\", config.stars.exponent).attr(\"max\", \"3\").attr(\"min\", \"-1\").attr(\"step\", \"0.01\").on(\"change\", apply);\r\n  col.append(\"span\").attr(\"class\", \"advanced\").text(\" * (magnitude + 2))  [* adaptation]\");\r\n  \r\n  enable($form(\"stars-show\"));\r\n  \r\n  // DSOs \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"dsos\");\r\n  \r\n  col.append(\"label\").attr(\"class\", \"header\").attr(\"title\", \"Deep Space Objects\").attr(\"for\", \"dsos-show\").html(\"DSOs\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-show\").property(\"checked\", config.dsos.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"dsos-limit\").html(\"down to mag\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-limit\").attr(\"title\", \"DSO display limit (magnitude)\").attr(\"value\", config.dsos.limit).attr(\"max\", \"6\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n\r\n\r\n  col.append(\"label\").attr(\"for\", \"dsos-colors\").html(\"with symbol colors\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-colors\").property(\"checked\", config.dsos.colors).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"dsos-color\").html(\"or default color \");\r\n  col.append(\"input\").attr(\"type\", \"color\").attr(\"autocomplete\", \"off\").attr(\"id\", \"dsos-style-fill\").attr(\"title\", \"DSO color\").property(\"value\", config.dsos.style.fill).on(\"change\", apply);\r\n\r\n  col.append(\"br\");\r\n  \r\n  names = formats.dsonames[config.culture] || formats.dsonames.iau;\r\n  \r\n  for (fld in names) {\r\n    if (!has(names, fld)) continue;\r\n    var dsoKeys = Object.keys(names[fld]);\r\n    col.append(\"label\").attr(\"for\", \"dsos-\" + fld).html(\"Show\");\r\n      \r\n    selected = 0;\r\n    col.append(\"label\").attr(\"title\", \"Type of DSO name\").attr(\"for\", \"dsos-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\r\n    sel = col.append(\"select\").attr(\"id\", \"dsos-\" + fld + \"Type\").attr(\"class\", \"advanced\").on(\"change\", apply);\r\n    list = dsoKeys.map(function (key, i) {\r\n      if (key === config.stars[fld + \"Type\"]) selected = i;    \r\n      return {o:key, n:names[fld][key]}; \r\n    });\r\n    sel.selectAll(\"option\").data(list).enter().append('option')\r\n       .attr(\"value\", function (d) { return d.o; })\r\n       .text(function (d) { return d.n; });\r\n    sel.property(\"selectedIndex\", selected);\r\n\r\n    col.append(\"label\").attr(\"for\", \"dsos-\" + fld).html(\"names\");\r\n    col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"dsos-\" + fld).property(\"checked\", config.dsos[fld]).on(\"change\", apply);\r\n  }    \r\n    \r\n  col.append(\"label\").attr(\"for\", \"dsos-nameLimit\").html(\"down to mag\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-nameLimit\").attr(\"title\", \"DSO name display limit (magnitude)\").attr(\"value\", config.dsos.nameLimit).attr(\"max\", \"6\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n  col.append(\"br\");\r\n\r\n  col.append(\"label\").attr(\"for\", \"dsos-size\").attr(\"class\", \"advanced\").html(\"DSO symbol size: (base\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-size\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed symbol: base\").attr(\"value\", config.dsos.size).attr(\"max\", \"100\").attr(\"min\", \"0\").attr(\"step\", \"0.1\").on(\"change\", apply);\r\n\r\n  col.append(\"label\").attr(\"for\", \"dsos-exponent\").attr(\"class\", \"advanced\").html(\" * 2 [* adaptation] - magnitude) ^ exponent\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"dsos-exponent\").attr(\"class\", \"advanced\").attr(\"title\", \"Size of the displayed symbol; exponent\").attr(\"value\", config.dsos.exponent).attr(\"max\", \"3\").attr(\"min\", \"-1\").attr(\"step\", \"0.01\").on(\"change\", apply);\r\n\r\n  enable($form(\"dsos-show\"));\r\n\r\n  // Constellations \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"constellations\");\r\n  col.append(\"label\").attr(\"class\", \"header\").html(\"Constellations\");\r\n  //col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-show\").property(\"checked\", config.constellations.show).on(\"change\", apply);\r\n  \r\n  \r\n  names = formats.constellations[config.culture] || formats.constellations.iau;\r\n  \r\n  for (fld in names) {\r\n    if (!has(names, fld)) continue;\r\n    var nameKeys = Object.keys(names[fld]);\r\n    if (nameKeys.length > 1) {\r\n      //Select List\r\n      col.append(\"label\").attr(\"for\", \"constellations-\" + fld).html(\"Show\");\r\n      \r\n      selected = 0;\r\n      col.append(\"label\").attr(\"title\", \"Language of constellation names\").attr(\"for\", \"constellations-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\r\n      sel = col.append(\"select\").attr(\"id\", \"constellations-\" + fld + \"Type\").attr(\"class\", \"advanced\").on(\"change\", apply);\r\n      list = nameKeys.map(function (key, i) {\r\n        if (key === config.constellations[fld + \"Type\"]) selected = i;    \r\n        return {o:key, n:names[fld][key]}; \r\n      });\r\n      sel.selectAll(\"option\").data(list).enter().append('option')\r\n         .attr(\"value\", function (d) { return d.o; })\r\n         .text(function (d) { return d.n; });\r\n      sel.property(\"selectedIndex\", selected);\r\n\r\n      col.append(\"label\").attr(\"for\", \"constellations-\" + fld).html(\"names\");\r\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-\" + fld).property(\"checked\", config.constellations[fld]).on(\"change\", apply);\r\n    } else if (nameKeys.length === 1) {\r\n      //Simple field\r\n      col.append(\"label\").attr(\"for\", \"constellations-\" + fld).attr(\"class\", \"advanced\").html(\" \" + names[fld][nameKeys[0]]);\r\n      col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-\" + fld).attr(\"class\", \"advanced\").property(\"checked\", config.constellations[fld]).on(\"change\", apply);      \r\n    }      \r\n  }\r\n  col.append(\"label\").attr(\"for\", \"constellations-lines\").html(\" lines\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-lines\").property(\"checked\", config.constellations.lines).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"constellations-bounds\").html(\" boundaries\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"constellations-bounds\").property(\"checked\", config.constellations.bounds).on(\"change\", apply);\r\n\r\n  enable($form(\"constellations-names\"));\r\n\r\n  // graticules & planes \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"lines\");\r\n  col.append(\"label\").attr(\"class\", \"header\").html(\"Lines\");\r\n  \r\n  col.append(\"label\").attr(\"title\", \"Latitude/longitude grid lines\").attr(\"for\", \"lines-graticule\").html(\"Graticule\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-graticule-show\").property(\"checked\", config.lines.graticule.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"lines-equatorial\").html(\"Equator\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-equatorial-show\").property(\"checked\", config.lines.equatorial.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"lines-ecliptic\").html(\"Ecliptic\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-ecliptic-show\").property(\"checked\", config.lines.ecliptic.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"lines-galactic\").html(\"Galactic plane\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-galactic-show\").property(\"checked\", config.lines.galactic.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"lines-supergalactic\").html(\"Supergalactic plane\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"lines-supergalactic-show\").property(\"checked\", config.lines.supergalactic.show).on(\"change\", apply);\r\n\r\n  // Other\r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"other\");\r\n  col.append(\"label\").attr(\"class\", \"header\").html(\"Other\");\r\n  \r\n  col.append(\"label\").attr(\"for\", \"mw-show\").html(\"Milky Way\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"mw-show\").property(\"checked\", config.mw.show).on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"mw-style-fill\").attr(\"class\", \"advanced\").html(\" color\");\r\n  col.append(\"input\").attr(\"type\", \"color\").attr(\"id\", \"mw-style-fill\").attr(\"class\", \"advanced\").attr(\"title\", \"Milky Way color\").attr(\"value\", config.mw.style.fill).on(\"change\", apply);\r\n\r\n  col.append(\"label\").attr(\"for\", \"mw-style-opacity\").attr(\"class\", \"advanced\").html(\" opacity\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"mw-style-opacity\").attr(\"class\", \"advanced\").attr(\"title\", \"Transparency of each Milky Way layer\").attr(\"value\", config.mw.style.opacity).attr(\"max\", \"1\").attr(\"min\", \"0\").attr(\"step\", \"0.01\").on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"for\", \"advanced\").html(\"Advanced options\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"advanced\").property(\"checked\", config.advanced).on(\"change\", apply);\r\n  \r\n  col.append(\"br\");\r\n  \r\n  col.append(\"label\").attr(\"for\", \"background-fill\").html(\"Background color\");\r\n  col.append(\"input\").attr(\"type\", \"color\").attr(\"id\", \"background-fill\").attr(\"title\", \"Background color\").attr(\"value\", config.background.fill).on(\"change\", apply);\r\n\r\n  col.append(\"label\").attr(\"for\", \"background-opacity\").attr(\"class\", \"advanced\").html(\"opacity\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"background-opacity\").attr(\"class\", \"advanced\").attr(\"title\", \"Background opacity\").attr(\"value\", config.background.opacity).attr(\"max\", \"1\").attr(\"min\", \"0\").attr(\"step\", \"0.01\").on(\"change\", apply);\r\n  \r\n  col.append(\"label\").attr(\"title\", \"Star/DSO sizes are increased with higher zoom-levels\").attr(\"for\", \"adaptable\").attr(\"class\", \"advanced\").html(\"Adaptable object sizes\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"adaptable\").attr(\"class\", \"advanced\").property(\"checked\", config.adaptable).on(\"change\", apply);\r\n  \r\n  // General language setting\r\n  var langKeys = formats_all[config.culture];\r\n\r\n  selected = 0;\r\n  col.append(\"label\").attr(\"title\", \"General language setting\").attr(\"for\", \"lang\").html(\"Object names \");\r\n  sel = col.append(\"select\").attr(\"id\", \"lang\").on(\"change\", apply);\r\n  list = langKeys.map(function (key, i) {\r\n    if (key === config.lang) selected = i;    \r\n    return {o:key, n:formats.constellations[config.culture].names[key]}; \r\n  });\r\n  list = [{o:\"---\", n:\"(Select language)\"}].concat(list);\r\n  sel.selectAll(\"option\").data(list).enter().append('option')\r\n     .attr(\"value\", function (d) { return d.o; })\r\n     .text(function (d) { return d.n; });\r\n  sel.property(\"selectedIndex\", selected);\r\n   \r\n  col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"download\");\r\n  col.append(\"label\").attr(\"class\", \"header\").html(\"Download\");\r\n\r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"download-png\").attr(\"value\", \"PNG Image\").on(\"click\", function() {\r\n    var a = d3.select(\"body\").append(\"a\").node(), \r\n        canvas = document.querySelector(parentElement + ' canvas');\r\n    a.download = getFilename(\".png\");\r\n    a.rel = \"noopener\";\r\n    a.href = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream');\r\n    a.click();\r\n    d3.select(a).remove();\r\n  });\r\n\r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"download-svg\").attr(\"value\", \"SVG File\").on(\"click\", function() {\r\n    exportSVG(getFilename(\".svg\")); \r\n    return false;\r\n  });\r\n\r\n  setLimits();\r\n  setUnit(config.transform);\r\n  setVisibility(cfg);\r\n  showAdvanced(config.advanced);\r\n  \r\n  function resize() {\r\n    var src = this,\r\n        w = src.value;\r\n    if (testNumber(src) === false) return; \r\n    config.width = w;\r\n    Celestial.resize({width:w});\r\n  }\r\n  \r\n  function reload() {\r\n    var src = this,\r\n        trans = src.value,\r\n        cx = setUnit(trans, config.transform); \r\n    if (cx !== null) config.center[0] = cx; \r\n    config.transform = trans;\r\n    settings.set(config);\r\n    Celestial.reload(config);\r\n  }  \r\n  \r\n  function reproject() {\r\n    var src = this;\r\n    if (!src) return;\r\n    config.projection = src.value; \r\n    settings.set(config);\r\n    Celestial.reproject(config);\r\n  }\r\n  \r\n  function turn() {\r\n    if (testNumber(this) === false) return;   \r\n    if (getCenter() === false) return;\r\n    Celestial.rotate(config);\r\n  }\r\n\r\n  function getCenter() {\r\n    var cx = $form(\"centerx\"), cy = $form(\"centery\"), cz = $form(\"centerz\"),\r\n        rot = [];\r\n\r\n    if (!cx || !cy) return;\r\n\r\n    if (config.transform !== \"equatorial\") config.center[0] = parseFloat(cx.value); \r\n    else { \r\n      var vx = parseFloat(cx.value);\r\n      config.center[0] = vx > 12 ? vx * 15 - 360 : vx * 15;\r\n    }\r\n    config.center[1] = parseFloat(cy.value); \r\n    \r\n    var vz = parseFloat(cz.value); \r\n    config.center[2] = isNaN(vz) ? 0 : vz;\r\n    \r\n    return cx.value !== \"\" && cy.value !== \"\";\r\n  }\r\n    \r\n  function getFilename(ext) {\r\n    var dateFormat = d3.time.format(\"%Y%m%dT%H%M%S%Z\"),\r\n        filename = \"d3-celestial\",\r\n        dt = Celestial.date();\r\n    if (dt) filename += dateFormat(dt);\r\n    return filename + ext;\r\n  }\r\n    \r\n  function showConstellation() {\r\n    var id = this.value;\r\n    if (!id) return;\r\n    showCon(id);\r\n  }\r\n\r\n  function showCon(id) {\r\n    var z, anims = [],\r\n        config = globalConfig;\r\n    if (id === \"---\") { \r\n      Celestial.constellation = null;\r\n      z = Celestial.zoomBy();\r\n      if (z !== 1) {\r\n        anims.push({param:\"zoom\", value:1/z, duration:0});\r\n      }\r\n      Celestial.animate(anims, false);    \r\n      //Celestial.redraw();\r\n      return;\r\n    }\r\n    if (!isObject(Celestial.constellations) || !has(Celestial.constellations, id)) return;\r\n    \r\n    var con = Celestial.constellations[id];\r\n    //transform according to settings\r\n    var center = transformDeg(con.center, euler[config.transform]);\r\n    config.center = center;\r\n    setCenter(config.center, config.transform);\r\n    //config.lines.graticule.lat.pos = [Round(con.center[0])];\r\n    //config.lines.graticule.lon.pos = [Round(con.center[1])];\r\n    //Celestial.apply(config);\r\n\r\n    //if zoomed, zoom out\r\n    z = Celestial.zoomBy();\r\n    if (z !== 1) anims.push({param:\"zoom\", value:1/z, duration:0});\r\n    //rotate\r\n    anims.push({param:\"center\", value:center, duration:0});\r\n    //and zoom in\r\n    var sc = 1 + (360/con.scale); // > 10 ? 10 : con.scale;\r\n    anims.push({param:\"zoom\", value:sc, duration:0});\r\n    Celestial.constellation = id;\r\n    //Object.assign(globalConfig, config);   \r\n    Celestial.animate(anims, false);    \r\n  }\r\n  \r\n  function apply() {\r\n    var value, src = this;\r\n    //Get current configuration\r\n    Object.assign(config, settings.set());\r\n\r\n    switch (src.type) {\r\n      case \"checkbox\": value = src.checked; enable(src); break;\r\n      case \"number\": if (testNumber(src) === false) return; \r\n                     value = parseFloat(src.value); break;\r\n      case \"color\": if (testColor(src) === false) return; \r\n                    value = src.value; break;\r\n      case \"text\": if (src.id.search(/fill$/) === -1) return;\r\n                   if (testColor(src) === false) return; \r\n                   value = src.value; break;\r\n      case \"select-one\": value = src.value; break;\r\n    }\r\n    if (value === null) return;\r\n    set(src.id, value);\r\n    if (src.id === \"dsos-style-fill\") {\r\n      set(\"dsos-style-stroke\", value);\r\n      set(\"dsos-nameStyle-fill\", value);\r\n    } else if (src.id === \"constellations-namesType\") {\r\n      listConstellations();\r\n    } else if (src.id === \"lang\") {\r\n      setLanguage(value);\r\n    } else if (src.id === \"advanced\") {\r\n      showAdvanced(value);\r\n    }\r\n\r\n    getCenter();\r\n    Object.assign(globalConfig, config);\r\n    Celestial.apply(config);\r\n  }\r\n\r\n  function set(prop, val) {\r\n    var a = prop.split(\"-\");\r\n    switch (a.length) {\r\n      case 1: config[a[0]] = val; break;\r\n      case 2: config[a[0]][a[1]] = val; break;\r\n      case 3: config[a[0]][a[1]][a[2]] = val; break;\r\n      default: return;\r\n    }   \r\n  }\r\n  \r\n  \r\n  function setLanguage(lang) {\r\n    Object.assign(config, globalConfig);\r\n    config.lang = lang;\r\n    var keys = [\"constellations\", \"planets\"]; \r\n    for (var i=0; i < keys.length; i++) {\r\n      if (has(formats[keys[i]][config.culture].names, lang)) config[keys[i]].namesType = lang;\r\n      else if (has(formats[keys[i]][config.culture].names, \"desig\")) config[keys[i]].namesType = \"desig\";\r\n      else config[keys[i]].namesType = \"name\";\r\n    }\r\n    if (has(formats.dsonames[config.culture].names, lang)) config.dsos.namesType = lang;\r\n    else config.dsos.namesType = \"desig\";\r\n    if (has(formats.starnames[config.culture].propername, lang)) config.stars.propernameType = lang;\r\n    else config.stars.propernameType = \"desig\";\r\n    //update cont. list\r\n    Object.assign(globalConfig, config);\r\n    update();\r\n    listConstellations();\r\n    return config;\r\n  }\r\n  \r\n    \r\n  function update() {\r\n    // Update all form fields\r\n    d3.selectAll(parentElement + \" ~ #celestial-form input, \" + parentElement + \" ~  #celestial-form select\").each( function(d, i) {\r\n      if (this === undefined) return;\r\n      var id = this.id;\r\n\r\n      // geopos -> lat, lon\r\n      if (id === \"lat\" || id === \"lon\") {\r\n        if (isArray(config.geopos)) this.value = id === \"lat\" ? config.geopos[0] : config.geopos[1];\r\n      // center -> centerx, centery     \r\n      } else if (id.search(/center/) !== -1) {\r\n        if (isArray(config.center)) {\r\n          switch (id) { \r\n            case \"centerx\": this.value = config.center[0]; break;\r\n            case \"centery\": this.value = config.center[1]; break;\r\n            case \"centerz\": this.value = config.center[2] || 0; break;\r\n          }\r\n        }\r\n      } else if (id === \"datetime\" || id === \"hr\" || id === \"min\" || id === \"sec\" || id === \"tz\") {\r\n        return;//skip, timezone?\r\n      } else if (this.type !== \"button\") {\r\n        var value = get(id);      \r\n        switch (this.type) {\r\n          case \"checkbox\": this.checked = value; enable(id); break;\r\n          case \"number\": if (testNumber(this) === false) break;\r\n                         this.value = parseFloat(get(id)); break;\r\n          case \"color\": if (testColor(this) === false) break; \r\n                        this.value = value; break;\r\n          case \"text\": if (id.search(/fill$/) === -1) break;\r\n                       if (testColor(this) === false) break; \r\n                       this.value = value; break;\r\n          case \"select-one\": this.value = value; break;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  function get(id) {\r\n    var a = id.split(\"-\");\r\n    switch (a.length) {\r\n      case 1: return config[a[0]]; \r\n      case 2: return config[a[0]][a[1]];\r\n      case 3: return config[a[0]][a[1]][a[2]];\r\n      default: return;\r\n    }   \r\n  }\r\n    \r\n  Celestial.updateForm  = update;\r\n  Celestial.showConstellation = showCon;\r\n  Celestial.setLanguage = function(lang) {\r\n    var cfg = settings.set();\r\n    if (formats_all[config.culture].indexOf(lang) !== -1) cfg = setLanguage(lang);\r\n    return cfg;    \r\n  };\r\n}\r\n\r\n\r\n// Dependend fields relations\r\nvar depends = {\r\n  \"stars-show\": [\"stars-limit\", \"stars-colors\", \"stars-style-fill\", \"stars-designation\", \"stars-propername\", \"stars-size\", \"stars-exponent\"],\r\n  \"stars-designation\": [\"stars-designationType\", \"stars-designationLimit\"],\r\n  \"stars-propername\": [\"stars-propernameLimit\", \"stars-propernameType\"],\r\n  \"dsos-show\": [\"dsos-limit\", \"dsos-colors\", \"dsos-style-fill\", \"dsos-names\", \"dsos-size\", \"dsos-exponent\"],\r\n  \"dsos-names\": [\"dsos-namesType\", \"dsos-nameLimit\"],\r\n  \"mw-show\": [\"mw-style-opacity\", \"mw-style-fill\"],\r\n  \"constellations-names\": [\"constellations-namesType\"],\r\n  \"planets-show\": [\"planets-symbolType\", \"planets-names\"],\r\n  \"planets-names\": [\"planets-namesType\"]\r\n};\r\n\r\n// De/activate fields depending on selection of dependencies\r\nfunction enable(source) {\r\n  var fld = source.id, off;\r\n  \r\n  switch (fld) {\r\n    case \"stars-show\": \r\n      off = !$form(fld).checked;\r\n      for (var i=0; i< depends[fld].length; i++) { fldEnable(depends[fld][i], off); }\r\n      /* falls through */\r\n    case \"stars-designation\": \r\n      off = !$form(\"stars-designation\").checked || !$form(\"stars-show\").checked;\r\n      for (i=0; i< depends[\"stars-designation\"].length; i++) { fldEnable(depends[\"stars-designation\"][i], off); }\r\n      /* falls through */\r\n    case \"stars-propername\": \r\n      off = !$form(\"stars-propername\").checked || !$form(\"stars-show\").checked;\r\n      for (i=0; i< depends[\"stars-propername\"].length; i++) { fldEnable(depends[\"stars-propername\"][i], off); }\r\n      break;\r\n    case \"dsos-show\": \r\n      off = !$form(fld).checked;\r\n      for (i=0; i< depends[fld].length; i++) { fldEnable(depends[fld][i], off); }\r\n      /* falls through */\r\n    case \"dsos-names\": \r\n      off = !$form(\"dsos-names\").checked || !$form(\"dsos-show\").checked;      \r\n      for (i=0; i< depends[\"dsos-names\"].length; i++) { fldEnable(depends[\"dsos-names\"][i], off); }\r\n      break;\r\n    case \"planets-show\": \r\n      off = !$form(fld).checked;\r\n      for (i=0; i< depends[fld].length; i++) { fldEnable(depends[fld][i], off); }\r\n      /* falls through */\r\n    case \"planets-names\": \r\n      off = !$form(\"planets-names\").checked || !$form(\"planets-show\").checked;      \r\n      for (i=0; i< depends[\"planets-names\"].length; i++) { fldEnable(depends[\"planets-names\"][i], off); }\r\n      break;\r\n    case \"constellations-names\": \r\n    case \"mw-show\": \r\n      off = !$form(fld).checked;\r\n      for (i=0; i< depends[fld].length; i++) { fldEnable(depends[fld][i], off); }\r\n      break;\r\n  }  \r\n}\r\n\r\n// Enable/disable field d to status off\r\nfunction fldEnable(d, off) {\r\n  var node = $form(d);\r\n  if (!node) return;\r\n  node.disabled = off;\r\n  node.style.color = off ? \"#999\" : \"#000\";  \r\n  node.previousSibling.style.color = off ? \"#999\" : \"#000\";  \r\n  //if (node.previousSibling.previousSibling && node.previousSibling.previousSibling.tagName === \"LABEL\")\r\n  //  node.previousSibling.previousSibling.style.color = off ? \"#999\" : \"#000\";  \r\n}\r\n\r\n// Error notification\r\nfunction popError(nd, err) {\r\n  var p = findPos(nd);\r\n  d3.select(\"#error\").html(err).style( {top:px(p[1] + nd.offsetHeight + 1), left:px(p[0]), opacity:1} );\r\n  nd.focus();\r\n}\r\n\r\n//Check numeric field\r\nfunction testNumber(node) {\r\n  var v, adj = node.id === \"hr\" || node.id === \"min\" || node.id === \"sec\" ? 1 : 0;\r\n  if (node.validity) {\r\n    v = node.validity;\r\n    if (v.typeMismatch || v.badInput) { popError(node, node.title + \": check field value\"); return false; }\r\n    if (v.rangeOverflow || v.rangeUnderflow) { popError(node, node.title + \" must be between \" + (parseInt(node.min) + adj) + \" and \" + (parseInt(node.max) - adj)); return false; }\r\n  } else {\r\n    v = node.value;\r\n    if (!isNumber(v)) { popError(node, node.title + \": check field value\"); return false; }\r\n    v = parseFloat(v);\r\n    if (v < node.min || v > node.max ) { popError(node, node.title + \" must be between \" + (node.min + adj) + \" and \" + (+node.max - adj)); return false; }\r\n  }\r\n  d3.select(\"#error\").style( {top:\"-9999px\", left:\"-9999px\", opacity:0} ); \r\n  return true; \r\n}\r\n\r\n//Check color field\r\nfunction testColor(node) {\r\n  var v;\r\n  if (node.validity) {\r\n    v = node.validity;\r\n    if (v.typeMismatch || v.badInput) { popError(node, node.title + \": check field value\"); return false; }\r\n    if (node.value.search(/^#[0-9A-F]{6}$/i) === -1) { popError(node, node.title + \": not a color value\"); return false; }\r\n  } else {\r\n    v = node.value;\r\n    if (v === \"\") return true;\r\n    if (v.search(/^#[0-9A-F]{6}$/i) === -1) { popError(node, node.title + \": not a color value\"); return false; }\r\n  }\r\n  d3.select(\"#error\").style( {top:\"-9999px\", left:\"-9999px\", opacity:0} );\r\n  return true;\r\n}\r\n\r\nfunction setUnit(trans, old) {\r\n  var cx = $form(\"centerx\");\r\n  if (!cx) return null;\r\n  \r\n  if (old) {\r\n    if (trans === \"equatorial\" && old !== \"equatorial\") {\r\n      cx.value = (cx.value/15).toFixed(1);\r\n      if (cx.value < 0) cx.value += 24;\r\n    } else if (trans !== \"equatorial\" && old === \"equatorial\") {\r\n      cx.value = (cx.value * 15).toFixed(1);\r\n      if (cx.value > 180) cx.value -= 360;\r\n    }\r\n  }\r\n  if (trans === 'equatorial') {\r\n    cx.min = \"0\";\r\n    cx.max = \"24\";\r\n    $form(\"cxunit\").innerHTML = \"h\";\r\n  } else {\r\n    cx.min = \"-180\";\r\n    cx.max = \"180\";\r\n    $form(\"cxunit\").innerHTML = \"\\u00b0\";\r\n  }\r\n  return cx.value;\r\n}\r\n\r\nfunction setCenter(ctr, trans) {\r\n  var cx = $form(\"centerx\"), cy = $form(\"centery\"), cz = $form(\"centerz\");\r\n  if (!cx || !cy) return;\r\n  \r\n  if (ctr === null || ctr.length < 1) ctr = [0,0,0]; \r\n  if (ctr.length <= 2 || ctr[2] === undefined) ctr[2] = 0;\r\n  //config.center = ctr; \r\n  if (trans !== \"equatorial\") cx.value = ctr[0].toFixed(1); \r\n  else cx.value = ctr[0] < 0 ? (ctr[0] / 15 + 24).toFixed(1) : (ctr[0] / 15).toFixed(1); \r\n  \r\n  cy.value = ctr[1].toFixed(1);\r\n  cz.value = ctr[2] !== null ? ctr[2].toFixed(1) : 0;\r\n  settings.set({center: ctr});\r\n}\r\n\r\n// Set max input limits depending on data\r\nfunction setLimits() {\r\n  var t, rx = /\\d+(\\.\\d+)?/g,\r\n      s, d, res = {s:6, d:6},\r\n      config =  Celestial.settings();\r\n\r\n  d = config.dsos.data;\r\n  \r\n  //test dso limit\r\n  t = d.match(rx);\r\n  if (t !== null) {\r\n    res.d = parseFloat(t[t.length-1]);\r\n  }\r\n\r\n  if (res.d !== 6) {\r\n    $form(\"dsos-limit\").max = res.d;\r\n    $form(\"dsos-nameLimit\").max = res.d;\r\n  }\r\n   \r\n   s = config.stars.data;\r\n  \r\n  //test star limit\r\n  t = s.match(rx);\r\n  if (t !== null) {\r\n    res.s = parseFloat(t[t.length-1]);\r\n  }\r\n\r\n  if (res.s != 6) {\r\n    $form(\"stars-limit\").max = res.s;\r\n    $form(\"stars-designationLimit\").max = res.s;\r\n    $form(\"stars-propernameLimit\").max = res.s;\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\n// Options only visible in advanced mode\r\n//\"stars-designationType\", \"stars-propernameType\", \"stars-size\", \"stars-exponent\", \"stars-size\", \"stars-exponent\", //\"constellations-namesType\", \"planets-namesType\", \"planets-symbolType\"\r\nfunction showAdvanced(showit) {\r\n  var vis = showit ? \"inline-block\" : \"none\";\r\n  d3.select(parentElement + \" ~ #celestial-form\").selectAll(\".advanced\").style(\"display\", vis);\r\n  d3.select(parentElement + \" ~ #celestial-form\").selectAll(\"#label-propername\").style(\"display\", showit ? \"none\" : \"inline-block\");\r\n}\r\n\r\n\r\nfunction setVisibility(cfg, which) {\r\n   var vis, fld;\r\n   if (!has(cfg, \"formFields\")) return;\r\n   if (which && has(cfg.formFields, which)) {\r\n     d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + which).style( {\"display\": \"none\"} );\r\n     return;\r\n   }\r\n   // Special case for backward compatibility\r\n   if (cfg.form === false && cfg.location === true) {\r\n     d3.select(parentElement + \" ~ #celestial-form\").style(\"display\", \"inline-block\");\r\n     for (fld in cfg.formFields) {\r\n      if (!has(cfg.formFields, fld)) continue;\r\n       if (fld === \"location\") continue;\r\n       d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + fld).style( {\"display\": \"none\"} );     \r\n     }\r\n     return;\r\n   }\r\n   // hide if not desired\r\n   if (cfg.form === false) d3.select(parentElement + \" ~ #celestial-form\").style(\"display\", \"none\"); \r\n\r\n   for (fld in cfg.formFields) {\r\n     if (!has(cfg.formFields, fld)) continue;\r\n     if (fld === \"location\") continue;\r\n     vis = cfg.formFields[fld] === false ? \"none\" : \"block\";\r\n     d3.select(parentElement + \" ~ #celestial-form\").select(\"#\" + fld).style( {\"display\": vis} );     \r\n   }\r\n   \r\n}\r\n\r\nfunction listConstellations() {\r\n  var sel = d3.select(parentElement + \" ~ #celestial-form\").select(\"#constellation\"),\r\n      list = [], selected = 0, id, name, config = globalConfig;\r\n    \r\n  Celestial.container.selectAll(\".constname\").each( function(d, i) {\r\n    id = d.id;\r\n    if (id === config.constellation) selected = i;\r\n    name = d.properties[config.constellations.namesType];\r\n    if (name !== id) name += \" (\" + id + \")\";\r\n    list.push({o:id, n:name});\r\n  });\r\n  if (list.length < 1 || sel.length < 1) {\r\n    setTimeout(listConstellations, 1000);\r\n    return;\r\n  }\r\n  list = [{o:\"---\", n:\"(Select constellation)\"}].concat(list);\r\n  \r\n  sel.selectAll('option').remove();\r\n  sel.selectAll('option').data(list).enter().append('option')\r\n     .attr(\"value\", function (d) { return d.o; })\r\n     .text(function (d) { return d.n; });\r\n  sel.property(\"selectedIndex\", selected);\r\n  //$form(\"constellation\").firstChild.disabled = true;\r\n\r\n  //Celestial.constellations = list;\r\n}\r\n\r\nfunction $form(id) { return document.querySelector(parentElement + \" ~ #celestial-form\" + \" #\" + id); }\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar geoInfo = null;\r\n\r\nfunction geo(cfg) {\r\n  var dtFormat = d3.time.format(\"%Y-%m-%d %H:%M:%S\"),\r\n      zenith = [0,0],\r\n      geopos = [0,0], \r\n      date = new Date(),\r\n      localZone = -date.getTimezoneOffset(),\r\n      timeZone = localZone,\r\n      config = settings.set(cfg),\r\n      frm = d3.select(parentElement + \" ~ #celestial-form form\").insert(\"div\", \"div#general\").attr(\"id\", \"loc\");\r\n\r\n  var dtpick = new datetimepicker(config, function(date, tz) { \r\n    $form(\"datetime\").value = dateFormat(date, tz); \r\n    timeZone = tz;\r\n    go(); \r\n  });\r\n  \r\n  if (has(config, \"geopos\") && config.geopos !== null && config.geopos.length === 2) geopos = config.geopos;\r\n  var col = frm.append(\"div\").attr(\"class\", \"col\").attr(\"id\", \"location\").style(\"display\", \"none\");\r\n  //Latitude & longitude fields\r\n  col.append(\"label\").attr(\"title\", \"Location coordinates long/lat\").attr(\"for\", \"lat\").html(\"Location\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"lat\").attr(\"title\", \"Latitude\").attr(\"placeholder\", \"Latitude\").attr(\"max\", \"90\").attr(\"min\", \"-90\").attr(\"step\", \"0.0001\").attr(\"value\", geopos[0]).on(\"change\",  function () {\r\n    if (testNumber(this) === true) go(); \r\n  });\r\n  col.append(\"span\").html(\"\\u00b0\");\r\n  col.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"lon\").attr(\"title\", \"Longitude\").attr(\"placeholder\", \"Longitude\").attr(\"max\", \"180\").attr(\"min\", \"-180\").attr(\"step\", \"0.0001\").attr(\"value\", geopos[1]).on(\"change\",  function () { \r\n    if (testNumber(this) === true) go(); \r\n  });\r\n  col.append(\"span\").html(\"\\u00b0\");\r\n  //Here-button if supported\r\n  if (\"geolocation\" in navigator) {\r\n    col.append(\"input\").attr(\"type\", \"button\").attr(\"value\", \"Here\").attr(\"id\", \"here\").on(\"click\", here);\r\n  }\r\n  //Datetime field with dtpicker-button\r\n  col.append(\"label\").attr(\"title\", \"Local date/time\").attr(\"for\", \"datetime\").html(\" Date/time\");\r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"day-left\").attr(\"title\", \"One day back\").on(\"click\", function () {\r\n    date.setDate(date.getDate() - 1); \r\n    $form(\"datetime\").value = dateFormat(date, timeZone); \r\n    go(); \r\n  });\r\n  col.append(\"input\").attr(\"type\", \"text\").attr(\"id\", \"datetime\").attr(\"title\", \"Date and time\").attr(\"value\", dateFormat(date, timeZone))\r\n  .on(\"click\", showpick, true).on(\"input\", function () { \r\n    this.value = dateFormat(date, timeZone); \r\n    if (!dtpick.isVisible()) showpick(); \r\n  });\r\n  col.append(\"div\").attr(\"id\", \"datepick\").on(\"click\", showpick);\r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"id\", \"day-right\").attr(\"title\", \"One day forward\").on(\"click\", function () { \r\n    date.setDate(date.getDate() + 1); \r\n    $form(\"datetime\").value = dateFormat(date, timeZone); \r\n    go(); \r\n  });\r\n  //Now -button sets current time & date of device  \r\n  col.append(\"input\").attr(\"type\", \"button\").attr(\"value\", \"Now\").attr(\"id\", \"now\").on(\"click\", now);\r\n  //Horizon marker\r\n  col.append(\"br\");\r\n  col.append(\"label\").attr(\"title\", \"Show horizon marker\").attr(\"for\", \"horizon-show\").html(\" Horizon marker\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"horizon-show\").property(\"checked\", config.horizon.show).on(\"change\", apply);    \r\n  //Daylight\r\n  col.append(\"label\").attr(\"title\", \"Show daylight\").attr(\"for\", \"daylight-show\").html(\"Daylight sky\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"daylight-show\").property(\"checked\", config.daylight.show).on(\"change\", apply);col.append(\"br\");\r\n    \r\n  //Show planets\r\n  col.append(\"label\").attr(\"title\", \"Show solar system objects\").attr(\"for\", \"planets-show\").html(\" Planets, Sun & Moon\");\r\n  col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"planets-show\").property(\"checked\", config.planets.show).on(\"change\", apply);    \r\n  //Planet names\r\n  var names = formats.planets[config.culture] || formats.planets.iau;\r\n  \r\n  for (var fld in names) {\r\n    if (!has(names, fld)) continue;\r\n    var keys = Object.keys(names[fld]);\r\n    if (keys.length > 1) {\r\n      //Select List\r\n      var txt = (fld === \"symbol\") ? \"as\" : \"with\";\r\n      col.append(\"label\").attr(\"for\", \"planets-\" + fld + \"Type\").html(txt);\r\n      \r\n      var selected = 0;\r\n      col.append(\"label\").attr(\"title\", \"Type of planet name\").attr(\"for\", \"planets-\" + fld + \"Type\").attr(\"class\", \"advanced\").html(\"\");\r\n      var sel = col.append(\"select\").attr(\"id\", \"planets-\" + fld + \"Type\").on(\"change\", apply);\r\n      var list = keys.map(function (key, i) {\r\n        if (key === config.planets[fld + \"Type\"]) selected = i;    \r\n        return {o:key, n:names[fld][key]}; \r\n      });\r\n      sel.selectAll(\"option\").data(list).enter().append('option')\r\n         .attr(\"value\", function (d) { return d.o; })\r\n         .text(function (d) { return d.n; });\r\n      sel.property(\"selectedIndex\", selected);\r\n\r\n      if (fld === \"names\") {\r\n        sel.attr(\"class\", \"advanced\");\r\n        col.append(\"label\").attr(\"for\", \"planets-\" + fld).html(\"names\");\r\n        col.append(\"input\").attr(\"type\", \"checkbox\").attr(\"id\", \"planets-\" + fld).property(\"checked\", config.planets[fld]).on(\"change\", apply);\r\n      }\r\n    } \r\n  }    \r\n \r\n  enable($form(\"planets-show\"));\r\n  showAdvanced(config.advanced);\r\n  \r\n\r\n  d3.select(document).on(\"mousedown\", function () { \r\n    if (!hasParent(d3.event.target, \"celestial-date\") && dtpick.isVisible()) dtpick.hide(); \r\n  });\r\n  \r\n  function now() {\r\n    date.setTime(Date.now());\r\n    $form(\"datetime\").value = dateFormat(date, timeZone);\r\n    go();\r\n  }\r\n\r\n  function here() {\r\n    navigator.geolocation.getCurrentPosition( function(pos) {\r\n      geopos = [Round(pos.coords.latitude, 4), Round(pos.coords.longitude, 4)];\r\n      $form(\"lat\").value = geopos[0];\r\n      $form(\"lon\").value = geopos[1];\r\n      go();\r\n    });  \r\n  }\r\n  \r\n  function showpick() {\r\n    dtpick.show(date, timeZone);\r\n  }\r\n  \r\n  function dateFormat(dt, tz) {\r\n    var tzs;\r\n    if (!tz || tz === \"0\") tzs = \" ±0000\";\r\n    else {\r\n      var h = Math.floor(Math.abs(tz) / 60),\r\n          m = Math.abs(tz) - (h * 60),\r\n          s = tz > 0 ? \" +\" : \" −\";\r\n      tzs = s + pad(h) + pad(m);\r\n    }\r\n    return dtFormat(dt) + tzs;\r\n  }  \r\n  \r\n\r\n  function isValidLocation(loc) {\r\n    //[lat, lon] expected\r\n    if (!loc || !isArray(loc) || loc.length < 2) return false;\r\n    if (!isNumber(loc[0]) || loc[0] < -90 || loc[0] > 90)  return false;\r\n    if (!isNumber(loc[1]) || loc[1] < -180 || loc[1] > 180)  return false;\r\n    return true;\r\n  }\r\n\r\n  function isValidTimezone(tz) {\r\n    if (tz === undefined || tz === null) return false;\r\n    if (!isNumber(tz) && Math.abs(tz) > 840) return false;\r\n    return true;    \r\n  }\r\n  \r\n  function apply() {\r\n    Object.assign(config, settings.set());\r\n    config.horizon.show = !!$form(\"horizon-show\").checked;\r\n    config.daylight.show = !!$form(\"daylight-show\").checked;\r\n    config.planets.show = !!$form(\"planets-show\").checked;    \r\n    config.planets.names = !!$form(\"planets-names\").checked;    \r\n    config.planets.namesType = $form(\"planets-namesType\").value;    \r\n    config.planets.symbolType = $form(\"planets-symbolType\").value;    \r\n    enable($form(\"planets-show\"));\r\n\r\n    Celestial.apply(config);\r\n  }\r\n\r\n  function go() {\r\n    var lon = parseFloat($form(\"lon\").value),\r\n        lat = parseFloat($form(\"lat\").value),\r\n        tz;\r\n    //Get current configuration\r\n    Object.assign(config, settings.set());\r\n\r\n    date = dtFormat.parse($form(\"datetime\").value.slice(0,-6));\r\n\r\n    //Celestial.apply(config);\r\n\r\n    if (!isNaN(lon) && !isNaN(lat)) {\r\n      if (lat !== geopos[0] || lon !== geopos[1]) {\r\n        geopos = [lat, lon];\r\n        setPosition([lat, lon], true);\r\n        return;\r\n      }\r\n      //if (!tz) tz = date.getTimezoneOffset();\r\n      $form(\"datetime\").value = dateFormat(date, timeZone); \r\n\r\n      var dtc = new Date(date.valueOf() - (timeZone - localZone) * 60000);\r\n\r\n      zenith = Celestial.getPoint(horizontal.inverse(dtc, [90, 0], geopos), config.transform);\r\n      zenith[2] = 0;\r\n      if (config.follow === \"zenith\") {\r\n        Celestial.rotate({center:zenith});\r\n      } else {\r\n        Celestial.redraw();\r\n      }\r\n    }\r\n  }\r\n\r\n  \r\n  function setPosition(p, settime) {\r\n    if (!p || !has(config, \"settimezone\") || config.settimezone === false) return;\r\n    var timestamp = Math.floor(date.getTime() / 1000),\r\n        protocol = window && window.location.protocol === \"https:\" ? \"https\" : \"http\",\r\n        url = protocol + \"://api.timezonedb.com/v2.1/get-time-zone?key=\" + config.timezoneid + \"&format=json&by=position\" + \r\n              \"&lat=\" + p[0] + \"&lng=\" + p[1] + \"&time=\" + timestamp;\r\n       // oldZone = timeZone;\r\n\r\n    d3.json(url, function(error, json) { \r\n      if (error) return console.warn(error);\r\n      if (json.status === \"FAILED\") {\r\n        // Location at sea inferred from longitude\r\n        timeZone = Math.round(p[1] / 15) * 60;\r\n        geoInfo = {\r\n          gmtOffset: timeZone * 60,\r\n          message: \"Sea locatation inferred\",\r\n          timestamp: timestamp\r\n        };\r\n      } else {\r\n        timeZone = json.gmtOffset / 60;\r\n        geoInfo = json;\r\n      }\r\n      //if (settime) {\r\n        //date.setTime(timestamp * 1000); // - (timeZone - oldZone) * 60000);\r\n        //console.log(date.toUTCString());\r\n      //}\r\n      $form(\"datetime\").value = dateFormat(date, timeZone);\r\n      go();\r\n    }); \r\n  }\r\n\r\n  Celestial.dateFormat = dateFormat;\r\n  \r\n  Celestial.date = function (dt, tz) { \r\n    if (!dt) return date;  \r\n    if (isValidTimezone(tz)) timeZone = tz;\r\n    Object.assign(config, settings.set());\r\n    if (dtpick.isVisible()) dtpick.hide();\r\n    date.setTime(dt.valueOf());\r\n    $form(\"datetime\").value = dateFormat(dt, timeZone); \r\n    go();\r\n  };\r\n  Celestial.timezone = function (tz) { \r\n    if (!tz) return timeZone;  \r\n    if (isValidTimezone(tz)) timeZone = tz;\r\n    Object.assign(config, settings.set());\r\n    if (dtpick.isVisible()) dtpick.hide();\r\n    $form(\"datetime\").value = dateFormat(date, timeZone); \r\n    go();\r\n  };\r\n  Celestial.position = function () { return geopos; };\r\n  Celestial.location = function (loc, tz) {\r\n    if (!loc || loc.length < 2) return geopos;\r\n    if (isValidLocation(loc)) {\r\n      geopos = loc.slice();\r\n      $form(\"lat\").value = geopos[0];\r\n      $form(\"lon\").value = geopos[1];\r\n      if (isValidTimezone(tz)) timeZone = tz;\r\n      else setPosition(geopos, true);\r\n    }\r\n  };\r\n  //{\"date\":dt, \"location\":loc, \"timezone\":tz}\r\n  Celestial.skyview = function (cfg) {\r\n    if (!cfg) return {\"date\": date, \"location\": geopos, \"timezone\": timeZone};\r\n    var valid = false;\r\n    if (dtpick.isVisible()) dtpick.hide();\r\n    if (has(cfg, \"timezone\") && isValidTimezone(cfg.timezone)) {\r\n      timeZone = cfg.timezone;\r\n      valid = true;\r\n    }\r\n    if (has(cfg, \"date\") && isValidDate(cfg.date)) {\r\n      date.setTime(cfg.date.valueOf());\r\n      $form(\"datetime\").value = dateFormat(cfg.date, timeZone); \r\n      valid = true;\r\n    }\r\n    if (has(cfg, \"location\") && isValidLocation(cfg.location)) {\r\n      geopos = cfg.location.slice();\r\n      $form(\"lat\").value = geopos[0];\r\n      $form(\"lon\").value = geopos[1];\r\n      if (!has(cfg, \"timezone\")) { \r\n        setPosition(geopos, !has(cfg, \"date\"));\r\n        return;\r\n      }\r\n    }\r\n    //Celestial.updateForm();\r\n    if (valid === false) return {\"date\": date, \"location\": geopos, \"timezone\": timeZone};\r\n    if (config.follow === \"zenith\") go();\r\n    else Celestial.redraw();\r\n  };  \r\n  Celestial.dtLoc = Celestial.skyview;\r\n  Celestial.zenith = function () { return zenith; };\r\n  Celestial.nadir = function () {\r\n    var b = -zenith[1],\r\n        l = zenith[0] + 180;\r\n    if (l > 180) l -= 360;    \r\n    return [l, b-0.001]; \r\n  };\r\n\r\n  if (has(config, \"formFields\") && (config.location === true || config.formFields.location === true)) {\r\n    d3.select(parentElement + \" ~ #celestial-form\").select(\"#location\").style( {\"display\": \"inline-block\"} );\r\n  }\r\n  //only if appropriate\r\n  if (isValidLocation(geopos) && (config.location === true || config.formFields.location === true) && config.follow === \"zenith\")\r\n    setTimeout(go, 1000); \r\n \r\n}\r\n﻿\r\nvar gmdat = {\r\n  \"sol\": 0.0002959122082855911025,  // AU^3/d^2\r\n  \"mer\": 164468599544771, //km^3/d^2\r\n  \"ven\": 2425056445892137,\r\n  \"ter\": 2975536307796296,\r\n  \"lun\": 36599199229256,\r\n  \"mar\": 319711652803400,\r\n  \"cer\": 467549107200,\r\n  \"ves\": 129071530155,\r\n  \"jup\": 945905718740635000,\r\n  \"sat\": 283224952705891000,\r\n  \"ura\": 43256077238632300,\r\n  \"nep\": 51034401552155700,\r\n  \"plu\": 7327611364884,\r\n  \"eri\": 8271175680000\r\n},\r\n\r\n\r\nsymbols = {\r\n  \"sol\":\"\\u2609\", \"mer\":\"\\u263f\", \"ven\":\"\\u2640\", \"ter\":\"\\u2295\", \"lun\":\"\\u25cf\", \"mar\":\"\\u2642\", \"cer\":\"\\u26b3\", \r\n  \"ves\":\"\\u26b6\", \"jup\":\"\\u2643\", \"sat\":\"\\u2644\", \"ura\":\"\\u2645\", \"nep\":\"\\u2646\", \"plu\":\"\\u2647\", \"eri\":\"\\u26aa\"\r\n}, \r\n\r\nε = 23.43928 * deg2rad,\r\nsinε = Math.sin(ε),\r\ncosε = Math.cos(ε),\r\nkelements = [\"a\",\"e\",\"i\",\"w\",\"M\",\"L\",\"W\",\"N\",\"n\",\"ep\",\"ref\",\"lecl\",\"becl\",\"Tilt\"];\r\n/*\r\n    ep = epoch (iso-date)\r\n    N = longitude of the ascending node (deg) Ω\r\n    i = inclination to the refrence plane, default:ecliptic (deg) \r\n    w = argument of periapsis (deg)  ω\r\n    a = semi-major axis, or mean distance from parent body (AU,km)\r\n    e = eccentricity (0=circle, 0-1=ellipse, 1=parabola, >1=hyperbola ) (-)\r\n    M = mean anomaly (0 at periapsis; increases uniformly with time) (deg)\r\n    n = mean daily motion = 360/P (deg/day)\r\n    \r\n    W = N + w  = longitude of periapsis ϖ\r\n    L = M + W  = mean longitude\r\n    q = a*(1-e) = periapsis distance\r\n    Q = a*(1+e) = apoapsis distance\r\n    P = 2π * sqrt(a^3/GM) = orbital period (years)\r\n    T = Epoch_of_M - (M(deg)/360_deg) / P  = time of periapsis\r\n    v = true anomaly (angle between position and periapsis) ν\r\n    E = eccentric anomaly\r\n    \r\n    Mandatory: a, e, i, N, w|W, M|L, dM|n\r\n    \r\n*/\r\n\r\nvar Kepler = function () {\r\n  var gm = gmdat.sol, \r\n      parentBody = \"sol\", \r\n      elem = {}, dat = {},\r\n      id, name, symbol;\r\n\r\n\r\n  function kepler(date) {\r\n    dates(date);\r\n    if (id === \"sol\") {\r\n      dat.ephemeris.x = 0;\r\n      dat.ephemeris.y = 0;\r\n      dat.ephemeris.z = 0;\r\n      dat.ephemeris.mag = -6;\r\n      return kepler;\r\n    }\r\n    coordinates();\r\n    return kepler;\r\n  }\r\n\r\n  var dates = function(date) {\r\n    var dt, de = dat.ephemeris = {};\r\n    if (date) {\r\n      if (date instanceof Date) { dt = new Date(date.valueOf()); }\r\n      else { dt = dateParse(date); }\r\n    }\r\n    if (!dt) { dt = new Date(); }\r\n    de.jd = JD(dt);\r\n      \r\n    dt = dateParse(elem.ep);\r\n    if (!dt) dt = dateParse(\"2000-01-01\");\r\n    de.jd0 = JD(dt);\r\n    de.d = de.jd - de.jd0;\r\n    de.cy = de.d / 36525;\r\n  };\r\n\r\n  var coordinates = function() {\r\n    var key, de = dat.ephemeris;\r\n    if (id === \"lun\") {\r\n      de = moon_elements(de);\r\n      if (!de) return;\r\n    } else {\r\n      for (var i=0; i<kelements.length; i++) {\r\n        key = kelements[i];\r\n        if (!has(elem, key)) continue; \r\n        if (has(elem, \"d\"+key)) {\r\n          de[key] = elem[key] + elem[\"d\"+key] * de.cy;\r\n        } else if (has(elem, key)) {\r\n          de[key] = elem[key];\r\n        }\r\n      }\r\n      if (has(de, \"M\") && !has(de, \"dM\") && has(de, \"n\")) {\r\n        de.M += (de.n * de.d);\r\n      }\r\n    }\r\n    derive();\r\n    trueAnomaly();\r\n    cartesian();    \r\n  };\r\n\r\n  kepler.cartesian = function() {\r\n    return dat;    \r\n  };\r\n\r\n  kepler.spherical = function() {\r\n    spherical();\r\n    return dat;    \r\n  };\r\n\r\n  kepler.equatorial = function(pos) {\r\n    equatorial(pos);\r\n    return dat;    \r\n  };\r\n\r\n  kepler.transpose = function() {\r\n    transpose(dat);\r\n    return dat;    \r\n  };\r\n  \r\n  kepler.elements = function(_) {\r\n    var key;\r\n    \r\n    if (!arguments.length || arguments[0] === undefined) return kepler;\r\n    \r\n    for (var i=0; i<kelements.length; i++) {\r\n      key = kelements[i];\r\n      if (!has(_, key)) continue; \r\n      elem[key] = _[key];\r\n      \r\n      if (key === \"a\" || key === \"e\") elem[key] *= 1.0; \r\n      else if (key !== \"ref\" && key !== \"ep\") elem[key] *= deg2rad;\r\n\r\n      if (has(_, \"d\" + key)) {\r\n        key = \"d\" + key;\r\n        elem[key] = _[key];\r\n        if (key === \"da\" || key === \"de\") elem[key] *= 1.0; \r\n        else elem[key] *= deg2rad;\r\n      } \r\n    }\r\n    return kepler;\r\n  };\r\n\r\n  kepler.params = function(_) {\r\n    if (!arguments.length) return kepler; \r\n    for (var par in _) {\r\n      if (!has(_, par)) continue;\r\n      if (_[par] === \"elements\") continue;\r\n      dat[par] = _[par];\r\n    }\r\n    return kepler;\r\n  };\r\n  \r\n\r\n  kepler.parentBody = function(_) {\r\n    if (!arguments.length) return parentBody; \r\n    parentBody = _;\r\n    gm = gmdat[parentBody];\r\n    return kepler;\r\n  };\r\n\r\n  kepler.id = function(_) {\r\n    if (!arguments.length) return id; \r\n    id = _;\r\n    symbol = symbols[_];\r\n    return kepler;\r\n  };\r\n\r\n  kepler.Name = function(_) {\r\n    if (!arguments.length) return name; \r\n    name = _;\r\n    return kepler;\r\n  };\r\n\r\n  kepler.symbol = function(_) {\r\n    if (!arguments.length) return symbol; \r\n    symbol = symbols[_];\r\n    return kepler;\r\n  };\r\n\r\n  \r\n  function near_parabolic(E, e) {\r\n    var anom2 = e > 1.0 ? E*E : -E*E,\r\n        term = e * anom2 * E / 6.0,\r\n        rval = (1.0 - e) * E - term,\r\n        n = 4;\r\n\r\n    while(Math.abs(term) > 1e-15) {\r\n      term *= anom2 / (n * (n + 1));\r\n      rval -= term;\r\n      n += 2;\r\n    }\r\n    return(rval);\r\n  }\r\n\r\n  function anomaly() {\r\n    var de = dat.ephemeris,\r\n        curr, err, trial, tmod,\r\n        e = de.e, M = de.M,\r\n        thresh = 1e-8,\r\n        offset = 0.0, \r\n        delta_curr = 1.9, \r\n        is_negative = false, \r\n        n_iter = 0;\r\n\r\n    if (!M) return(0.0); \r\n\r\n    if (e < 1.0) {\r\n      if (M < -Math.PI || M > Math.PI) {\r\n        tmod = Trig.normalize0(M);\r\n        offset = M - tmod;\r\n        M = tmod;\r\n      }\r\n\r\n      if (e < 0.9) {   \r\n        curr = Math.atan2(Math.sin(M), Math.cos(M) - e);\r\n        do {\r\n          err = (curr - e * Math.sin(curr) - M) / (1.0 - e * Math.cos(curr));\r\n          curr -= err;\r\n        } while (Math.abs(err) > thresh);\r\n        return curr; // + offset;\r\n      }\r\n    }\r\n\r\n    if ( M < 0.0) {\r\n      M = -M;\r\n      is_negative = true;\r\n    }\r\n\r\n    curr = M;\r\n    thresh = thresh * Math.abs(1.0 - e);\r\n               /* Due to roundoff error,  there's no way we can hope to */\r\n               /* get below a certain minimum threshhold anyway:        */\r\n    if ( thresh < 1e-15) { thresh = 1e-15; }\r\n    if ( (e > 0.8 && M < Math.PI / 3.0) || e > 1.0) {   /* up to 60 degrees */\r\n      trial = M / Math.abs( 1.0 - e);\r\n\r\n      if (trial * trial > 6.0 * Math.abs(1.0 - e)) {  /* cubic term is dominant */\r\n        if (M < Math.PI) {\r\n          trial = Math.pow(6.0 * M, 1/3);\r\n        } else {       /* hyperbolic w/ 5th & higher-order terms predominant */\r\n          trial = Trig.asinh( M / e);\r\n        }\r\n      }\r\n      curr = trial;\r\n    }\r\n    if (e > 1.0 && M > 4.0) {   /* hyperbolic, large-mean-anomaly case */\r\n      curr = Math.log(M);\r\n    }\r\n    if (e < 1.0) {\r\n      while(Math.abs(delta_curr) > thresh) {\r\n        if ( n_iter++ > 8) {\r\n          err = near_parabolic(curr, e) - M;\r\n        } else {\r\n          err = curr - e * Math.sin(curr) - M;\r\n        }\r\n        delta_curr = -err / (1.0 - e * Math.cos(curr));\r\n        curr += delta_curr;\r\n      }\r\n    } else {\r\n      while (Math.abs(delta_curr) > thresh) {\r\n        if (n_iter++ > 7) {\r\n          err = -near_parabolic(curr, e) - M;\r\n        } else {\r\n          err = e * Trig.sinh(curr) - curr - M;\r\n        }\r\n        delta_curr = -err / (e * Trig.cosh(curr) - 1.0);\r\n        curr += delta_curr;\r\n      }\r\n    }\r\n    return( is_negative ? offset - curr : offset + curr);\r\n  }\r\n\r\n  function trueAnomaly() {\r\n    var x, y, r0, g, t, de = dat.ephemeris;\r\n\r\n    if (de.e === 1.0) {   /* parabolic */\r\n      t = de.jd0 - de.T;\r\n      g = de.w0 * t * 0.5;\r\n\r\n      y = Math.pow(g + Math.sqrt(g * g + 1.0), 1/3);\r\n      de.v = 2.0 * Math.atan(y - 1.0 / y);\r\n    } else {          /* got the mean anomaly;  compute eccentric,  then true */\r\n      de.E = anomaly();\r\n      if (de.e > 1.0) {    /* hyperbolic case */\r\n        x = (de.e - Trig.cosh(de.E));\r\n        y = Trig.sinh(de.E);\r\n      } else {          /* elliptical case */\r\n        x = (Math.cos(de.E) - de.e);\r\n        y =  Math.sin(de.E);\r\n      }\r\n      y *= Math.sqrt(Math.abs(1.0 - de.e * de.e));\r\n      de.v = Math.atan2(y, x);\r\n    }\r\n\r\n    r0 = de.q * (1.0 + de.e);\r\n    de.r = r0 / (1.0 + de.e * Math.cos(de.v));\r\n  }\r\n\r\n  function derive() {\r\n    var de = dat.ephemeris;\r\n    if (!de.hasOwnProperty(\"w\")) {\r\n      de.w = de.W - de.N;\r\n    }\r\n    if (!de.hasOwnProperty(\"M\")) {\r\n      de.M = de.L - de.W;\r\n    }\r\n    if (de.e < 1.0) { de.M = Trig.normalize0(de.M); }\r\n    //de.P = Math.pow(Math.abs(de.a), 1.5);\r\n    de.P = τ * Math.sqrt(Math.pow(de.a, 3) / gm) / 365.25;\r\n    de.T = de.jd0 - (de.M / halfπ) / de.P;\r\n\r\n    if (de.e !== 1.0) {   /* for non-parabolic orbits: */\r\n     de.q = de.a * (1.0 - de.e);\r\n     de.t0 = de.a * Math.sqrt(Math.abs(de.a) / gm);\r\n    } else {\r\n     de.w0 = (3.0 / Math.sqrt(2)) / (de.q * Math.sqrt(de.q / gm));\r\n     de.a = 0.0;\r\n     de.t0 = 0.0;\r\n    }\r\n    de.am = Math.sqrt(gm * de.q * (1.0 + de.e));\r\n  }\r\n\r\n  function transpose() {\r\n    var de = dat.ephemeris;\r\n    if (!de.ref || de.ref === \"ecl\") {\r\n      de.tx = de.x;\r\n      de.ty = de.y;\r\n      de.tz = de.z;\r\n      return;\r\n    }\r\n    var a0 = de.lecl,// - Math.PI/2,\r\n        a1 = Math.PI/2 - de.becl,\r\n        angles = [0, a1, -a0];\r\n    transform(de, angles);\r\n    var tp =  Trig.cartesian([de.tl, de.tb, de.r]);\r\n    de.tx = tp.x;\r\n    de.ty = tp.y;\r\n    de.tz = tp.z;\r\n  }\r\n\r\n  function equatorial(pos) {\r\n    var de = dat.ephemeris, pe = pos.ephemeris;\r\n    ε = (23.439292 - 0.0130042 * de.cy - 1.667e-7 * de.cy * de.cy + 5.028e-7 * de.cy * de.cy * de.cy) * deg2rad;\r\n    sinε = Math.sin(ε);\r\n    cosε = Math.cos(ε);\r\n    var o = (id === \"lun\") ? {x:0, y:0, z:0} : {x:pe.x, y:pe.y, z:pe.z};\r\n    de.xeq = de.x - o.x;\r\n    de.yeq = (de.y - o.y) * cosε - (de.z - o.z) * sinε;\r\n    de.zeq = (de.y - o.y) * sinε + (de.z - o.z) * cosε;\r\n\r\n    de.ra = Trig.normalize(Math.atan2(de.yeq, de.xeq));\r\n    de.dec = Math.atan2(de.zeq, Math.sqrt(de.xeq*de.xeq + de.yeq*de.yeq));\r\n    if (id === \"lun\") de = moon_corr(de, pe);\r\n    de.pos = [de.ra / deg2rad, de.dec / deg2rad];\r\n    de.rt = Math.sqrt(de.xeq*de.xeq + de.yeq*de.yeq + de.zeq*de.zeq);\r\n    if (id !== \"sol\") de.mag = magnitude();\r\n  }\r\n\r\n  function magnitude() {\r\n    var de = dat.ephemeris,\r\n        rs = de.r, rt = de.rt,\r\n        a = Math.acos((rs*rs + rt*rt - 1) / (2 * rs * rt)),\r\n        q = 0.666 *((1-a/Math.PI) * Math.cos(a) + 1 / Math.PI * Math.sin(a)),\r\n        m = dat.H * 1 + 5 * Math.log(rs*rt) * Math.LOG10E - 2.5 * Math.log(q) * Math.LOG10E;\r\n        \r\n    return m;\r\n  }\r\n\r\n  function cartesian() {\r\n    var de = dat.ephemeris,\r\n        u = de.v + de.w;\r\n    de.x = de.r * (Math.cos(de.N) * Math.cos(u) - Math.sin(de.N) * Math.sin(u) * Math.cos(de.i));\r\n    de.y = de.r * (Math.sin(de.N) * Math.cos(u) + Math.cos(de.N) * Math.sin(u) * Math.cos(de.i));\r\n    de.z = de.r * (Math.sin(u) * Math.sin(de.i));\r\n    return dat;\r\n  }\r\n\r\n  function spherical() {\r\n    var de = dat.ephemeris,\r\n        lon = Math.atan2(de.y, de.x),\r\n        lat = Math.atan2(de.z, Math.sqrt(de.x*de.x + de.y*de.y));\r\n    de.l = Trig.normalize(lon);\r\n    de.b = lat;\r\n    return dat; \r\n  }\r\n\r\n  function transform(angles) {\r\n    \r\n  }\r\n\r\n  function polar2cart(pos) {\r\n    var rclat = Math.cos(pos.lat) * pos.r;\r\n    pos.x = rclat * Math.cos(pos.lon);\r\n    pos.y = rclat * Math.sin(pos.lon);\r\n    pos.z = pos.r * Math.sin(pos.lat);\r\n    return pos;\r\n  }\r\n\r\n  \r\n  function JD(dt) {  \r\n    var yr = dt.getUTCFullYear(),\r\n        mo = dt.getUTCMonth() + 1,\r\n        dy = dt.getUTCDate(),\r\n        frac = (dt.getUTCHours() - 12 + dt.getUTCMinutes()/60.0 + dt.getUTCSeconds()/3600.0) / 24, \r\n        IYMIN = -4799;        /* Earliest year allowed (4800BC) */\r\n\r\n    if (yr < IYMIN) return -1; \r\n    var a = Math.floor((14 - mo) / 12),\r\n        y = yr + 4800 - a,\r\n        m = mo + (12 * a) - 3;\r\n    var jdn = dy + Math.floor((153 * m + 2)/5) + (365 * y) + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;\r\n    return jdn + frac;   \r\n  }\r\n\r\n  function mst(lon) {\r\n    var l = lon || 0;  // lon=0 -> gmst\r\n    return (18.697374558 + 24.06570982441908 * dat.ephemeris.d) * 15 + l;\r\n  }\r\n  \r\n    \r\n  function observer(pos) {\r\n    var flat = 298.257223563,    // WGS84 flattening of earth\r\n        re = 6378.137,           // GRS80/WGS84 semi major axis of earth ellipsoid\r\n        h = pos.h || 0,\r\n        cart = {},\r\n        gmst = mst();\r\n    \r\n    var cosl = Math.cos(pos.lat),\r\n        sinl = Math.sin(pos.lat),\r\n        fl = 1.0 - 1.0 / flat;\r\n    var fl2 = fl * fl;\r\n    \r\n    var u = 1.0 / Math.sqrt (cosl * cosl + fl2 * sinl * sinl),\r\n        a = re * u + h,\r\n        b = re * fl2 * u + h,\r\n        r = Math.sqrt (a * a * cosl * cosl + b * b * sinl * sinl); // geocentric distance from earth center\r\n\r\n    cart.lat = Math.acos (a * cosl / r); \r\n    cart.lon = pos.lon; \r\n    cart.r = h;\r\n    \r\n    if (pos.lat < 0.0) cart.lat *= -1; \r\n\r\n    polar2cart(cart); \r\n\r\n    // rotate around earth's polar axis to align coordinate system from Greenwich to vernal equinox\r\n    var angle = gmst * deg2rad; // sideral time gmst given in hours. Convert to radians\r\n\r\n    cart.x = cart.x * Math.cos(angle) - cart.y * Math.sin(angle);\r\n    cart.y = cart.x * Math.sin(angle) + cart.y * Math.cos(angle);\r\n    return(cart);\r\n  }\r\n\r\n  function moon_elements(dat) {\r\n    if ((typeof Moon !== \"undefined\")) return Moon.elements(dat);\r\n  }\r\n  \r\n  function moon_corr(dat, pos) {\r\n    spherical();\r\n    if ((typeof Moon !== \"undefined\")) return Moon.corr(dat, pos);\r\n  }\r\n\r\n  return kepler;  \r\n};﻿\r\nvar Moon = {\r\n  elements: function(dat) {\r\n    var t = (dat.jd - 2451545) / 36525,\r\n        t2 = t * t,\r\n        t3 = t * t2,\r\n        t4 = t * t3,\r\n        t5 = t * t4,\r\n        t2e4 = t2 * 1e-4,\r\n        t3e6 = t3 * 1e-6,\r\n        t4e8 = t4 * 1e-8;\r\n\r\n    // semimajor axis\r\n    var sa = 3400.4 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        - 635.6 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        - 235.6 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 218.1 * Math.cos(deg2rad * (238.1713 +  854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6  - 1.769 * t4e8)) \r\n        + 181.0 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        - 39.9 * Math.cos(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        - 38.4 * Math.cos(deg2rad * (233.2295 + 926533.2733 * t - 34.136 * t2e4 \r\n        + 3.705 * t3e6 - 1.769 * t4e8)) \r\n        + 33.8 * Math.cos(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 \r\n        - 7.020 * t3e6 + 3.259 * t4e8)) \r\n        + 28.8 * Math.cos(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 \r\n        + 7.328 * t3e6 - 3.538 * t4e8)) \r\n        + 12.6 * Math.cos(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 \r\n        + 17.971 * t3e6 - 8.566 * t4e8)) \r\n        + 11.4 * Math.cos(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 \r\n        - 0.567 * t3e6 + 0.232 * t4e8)) \r\n        - 11.1 * Math.cos(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 \r\n        - 14.307 * t3e6 + 6.797 * t4e8)) \r\n        - 10.2 * Math.cos(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 \r\n        + 28.695 * t3e6 - 13.594 * t4e8)) \r\n        + 9.7 * Math.cos(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 \r\n        + 32.359 * t3e6 - 15.363 * t4e8)) \r\n        + 9.6 * Math.cos(deg2rad * (240.6422 + 818536.1225 * t - 29.529 * t2e4 \r\n        + 3.582 * t3e6 - 1.769 * t4e8)) \r\n        + 8.0 * Math.cos(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 \r\n        + 1.832 * t3e6 - 0.884 * t4e8)) \r\n        - 6.2 * Math.cos(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 \r\n        + 14.388 * t3e6 - 6.797 * t4e8)) \r\n        + 6.0 * Math.cos(deg2rad * (173.5506 + 1335801.3346 * t - 48.901 * t2e4 \r\n        + 5.496 * t3e6 - 2.653 * t4e8)) \r\n        + 3.7 * Math.cos(deg2rad * (113.8717 + 1745069.3958 * t - 63.665 * t2e4 \r\n        + 7.287 * t3e6 - 3.538 * t4e8)) \r\n        + 3.6 * Math.cos(deg2rad * (338.9083 + 1267870.5281 * t - 153.636 * t2e4 \r\n        - 7.061 * t3e6 + 3.259 * t4e8)) \r\n        + 3.2 * Math.cos(deg2rad * (246.3642 + 2258267.3137 * t + 24.769 * t2e4 \r\n        + 21.675 * t3e6 - 10.335 * t4e8)) \r\n        - 3.0 * Math.cos(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 \r\n        + 18.052 * t3e6 - 8.566 * t4e8)) \r\n        + 2.3 * Math.cos(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 \r\n        - 10.643 * t3e6 + 5.028 * t4e8)) \r\n        - 2.2 * Math.cos(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        - 2.0 * Math.cos(deg2rad * (38.5872 + 858602.4669 * t - 138.871 * t2e4 \r\n        - 8.852 * t3e6 + 4.144 * t4e8)) \r\n        - 1.8 * Math.cos(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 \r\n        - 10.765 * t3e6 + 5.028 * t4e8)) \r\n        - 1.7 * Math.cos(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 \r\n        - 21.367 * t3e6 + 10.057 * t4e8)) \r\n        + 1.6 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 1.4 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        + 1.3 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8));\r\n\r\n    var sapp = - 0.55 * Math.cos(deg2rad * (238.2 + 854535.2 * t)) \r\n        + 0.10 * Math.cos(deg2rad * (103.2 + 377336.3 * t)) \r\n        + 0.10 * Math.cos(deg2rad * (233.2 + 926533.3 * t));\r\n\r\n    var sma = 383397.6 + sa + sapp * t;\r\n\r\n    // orbital eccentricity\r\n\r\n    var se = 0.014217 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        + 0.008551 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        - 0.001383 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 0.001353 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        - 0.001146 * Math.cos(deg2rad * (66.5106 + 349471.8432 * t - 335.112 * t2e4 \r\n        - 35.715 * t3e6 + 16.854 * t4e8)) \r\n        - 0.000915 * Math.cos(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 \r\n        - 21.367 * t3e6 + 10.057 * t4e8)) \r\n        + 0.000869 * Math.cos(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        - 0.000628 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6  - 1.769 * t4e8)) \r\n        - 0.000393 * Math.cos(deg2rad * (291.5472 - 127727.0245 * t - 425.082 * t2e4 \r\n        - 50.062 * t3e6 + 23.651 * t4e8)) \r\n        + 0.000284 * Math.cos(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 \r\n        - 25.072 * t3e6 + 11.826 * t4e8)) \r\n        - 0.000278 * Math.cos(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 \r\n        - 12.516 * t3e6 + 5.913 * t4e8)) \r\n        - 0.000240 * Math.cos(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 \r\n        + 28.695 * t3e6 - 13.594 * t4e8)) \r\n        + 0.000230 * Math.cos(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 \r\n        + 7.328 * t3e6  - 3.538 * t4e8)) \r\n        + 0.000229 * Math.cos(deg2rad * (167.2476 + 762807.1986 * t - 457.683 * t2e4 \r\n        - 46.398 * t3e6 + 21.882 * t4e8)) \r\n        - 0.000202 * Math.cos(deg2rad * ( 83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        + 0.000190 * Math.cos(deg2rad * (190.8102 - 541062.3799 * t - 302.511 * t2e4 \r\n        - 39.379 * t3e6 + 18.623 * t4e8)) \r\n        + 0.000177 * Math.cos(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        + 0.000153 * Math.cos(deg2rad * (32.2842 + 285608.3309 * t - 547.653 * t2e4 \r\n        - 60.746 * t3e6 + 28.679 * t4e8)) \r\n        - 0.000137 * Math.cos(deg2rad * (44.8902 + 1431596.6029 * t + 269.911 * t2e4 \r\n        + 43.043 * t3e6 - 20.392 * t4e8)) \r\n        + 0.000122 * Math.cos(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 \r\n        + 32.359 * t3e6 - 15.363 * t4e8)) \r\n        + 0.000116 * Math.cos(deg2rad * (302.2110 + 1240006.0662 * t - 367.713 * t2e4 \r\n        - 32.051 * t3e6 + 15.085 * t4e8)) \r\n        - 0.000111 * Math.cos(deg2rad * (203.9449 + 790671.6605 * t - 243.606 * t2e4 \r\n        - 21.408 * t3e6 + 10.057 * t4e8)) \r\n        - 0.000108 * Math.cos(deg2rad * (68.9815 + 313472.7929 * t - 333.576 * t2e4 \r\n        - 35.756 * t3e6 + 16.854 * t4e8)) \r\n        + 0.000096 * Math.cos(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 \r\n        - 7.020 * t3e6 + 3.259 * t4e8)) \r\n        - 0.000090 * Math.cos(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 \r\n        - 10.643 * t3e6 + 5.028 * t4e8)) \r\n        + 0.000090 * Math.cos(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 \r\n        + 17.971 * t3e6 - 8.566 * t4e8)) \r\n        + 0.000056 * Math.cos(deg2rad * (55.8468 - 1018261.2475 * t - 392.482 * t2e4 \r\n        - 53.726 * t3e6 + 25.420 * t4e8)) \r\n        - 0.000056 * Math.cos(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        + 0.000052 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        - 0.000050 * Math.cos(deg2rad * (133.0212 + 698943.6863 * t - 670.224 * t2e4 \r\n        - 71.429 * t3e6 + 33.708 * t4e8)) \r\n        - 0.000049 * Math.cos(deg2rad * (267.9846 + 1176142.5540 * t - 580.254 * t2e4 \r\n        - 57.082 * t3e6 + 26.911 * t4e8)) \r\n        - 0.000049 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 0.000045 * Math.cos(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 \r\n        + 4.231 * t3e6 - 2.001 * t4e8)) \r\n        + 0.000044 * Math.cos(deg2rad * (257.3208 - 191590.5367 * t - 637.623 * t2e4 \r\n        - 75.093 * t3e6 + 35.477 * t4e8)) \r\n        + 0.000042 * Math.cos(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 \r\n        - 10.765 * t3e6 + 5.028 * t4e8)) \r\n        + 0.000042 * Math.cos(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 \r\n        - 12.475 * t3e6 + 5.913 * t4e8)) \r\n        + 0.000040 * Math.cos(deg2rad * (246.3642 + 2258267.3137 * t + 24.769 * t2e4 \r\n        + 21.675 * t3e6 - 10.335 * t4e8)) \r\n        - 0.000040 * Math.cos(deg2rad * (156.5838 - 604925.8921 * t - 515.053 * t2e4 \r\n        - 64.410 * t3e6 + 30.448 * t4e8)) \r\n        + 0.000036 * Math.cos(deg2rad * (169.7185 + 726808.1483 * t - 456.147 * t2e4 \r\n        - 46.439 * t3e6 + 21.882 * t4e8)) \r\n        + 0.000029 * Math.cos(deg2rad * (113.8717 + 1745069.3958 * t - 63.665 * t2e4 \r\n        + 7.287 * t3e6 - 3.538 * t4e8)) \r\n        - 0.000029 * Math.cos(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 \r\n        + 1.832 * t3e6 - 0.884 * t4e8)) \r\n        - 0.000028 * Math.cos(deg2rad * (294.0181 - 163726.0747 * t - 423.546 * t2e4 \r\n        - 50.103 * t3e6 + 23.651 * t4e8)) \r\n        + 0.000027 * Math.cos(deg2rad * (263.6238 + 381403.5993 * t - 228.841 * t2e4 \r\n        - 23.199 * t3e6 + 10.941 * t4e8)) \r\n        - 0.000026 * Math.cos(deg2rad * (358.0578 + 221744.8187 * t - 760.194 * t2e4 \r\n        - 85.777 * t3e6 + 40.505 * t4e8)) \r\n        - 0.000026 * Math.cos(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 \r\n        + 18.052 * t3e6 - 8.566 * t4e8));\r\n\r\n    var sedp = -0.0022 * Math.cos(deg2rad * (103.2 + 377336.3 * t));\r\n\r\n    var ecc = 0.055544 + se + 1e-3 * t * sedp;\r\n\r\n    // sine of half the inclination\r\n\r\n    var sg = 0.0011776 * Math.cos(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 \r\n        + 4.231 * t3e6 - 2.001 * t4e8)) \r\n        - 0.0000971 * Math.cos(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        + 0.0000908 * Math.cos(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 \r\n        - 0.567 * t3e6 + 0.232 * t4e8)) \r\n        + 0.0000623 * Math.cos(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        + 0.0000483 * Math.cos(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 \r\n        + 4.190 * t3e6 - 2.001 * t4e8)) \r\n        + 0.0000348 * Math.cos(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        - 0.0000316 * Math.cos(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        - 0.0000253 * Math.cos(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 \r\n        + 4.272 * t3e6 - 2.001 * t4e8)) \r\n        - 0.0000141 * Math.cos(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 \r\n        - 10.116 * t3e6 + 4.797 * t4e8)) \r\n        + 0.0000127 * Math.cos(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        + 0.0000117 * Math.cos(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 0.0000078 * Math.cos(deg2rad * (98.3124 - 151739.6240 * t + 70.916 * t2e4 \r\n        + 8.462 * t3e6 - 4.001 * t4e8)) \r\n        - 0.0000063 * Math.cos(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        + 0.0000063 * Math.cos(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 0.0000036 * Math.cos(deg2rad * (321.5076 + 1443602.9027 * t + 21.912 * t2e4 \r\n        + 13.780 * t3e6 - 6.566 * t4e8)) \r\n        - 0.0000035 * Math.cos(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        + 0.0000024 * Math.cos(deg2rad * (149.8932 + 337465.5434 * t - 87.113 * t2e4 \r\n        - 6.453 * t3e6 + 3.028 * t4e8)) \r\n        + 0.0000024 * Math.cos(deg2rad * (170.9849 - 930404.9848 * t + 66.523 * t2e4 \r\n        + 0.608 * t3e6 - 0.232 * t4e8));\r\n\r\n    var sgp = - 0.0203 * Math.cos(deg2rad * (125.0 - 1934.1 * t)) \r\n        + 0.0034 * Math.cos(deg2rad * (220.2 - 1935.5 * t));\r\n\r\n    var gamma = 0.0449858 + sg + 1e-3 * sgp;\r\n\r\n    // longitude of perigee\r\n\r\n    var sp = - 15.448 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8))\r\n        - 9.642 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        - 2.721 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 2.607 * Math.sin(deg2rad * (66.5106 + 349471.8432 * t - 335.112 * t2e4 \r\n        - 35.715 * t3e6 + 16.854 * t4e8)) \r\n        + 2.085 * Math.sin(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 \r\n        - 21.367 * t3e6 + 10.057 * t4e8)) \r\n        + 1.477 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        + 0.968 * Math.sin(deg2rad * (291.5472 - 127727.0245 * t - 425.082 * t2e4 \r\n        - 50.062 * t3e6 + 23.651 * t4e8)) \r\n        - 0.949 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        - 0.703 * Math.sin(deg2rad * (167.2476 + 762807.1986 * t - 457.683 * t2e4 \r\n        - 46.398 * t3e6 + 21.882 * t4e8)) \r\n        - 0.660 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        - 0.577 * Math.sin(deg2rad * (190.8102 - 541062.3799 * t - 302.511 * t2e4 \r\n        - 39.379 * t3e6 + 18.623 * t4e8)) \r\n        - 0.524 * Math.sin(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 \r\n        + 28.695 * t3e6 - 13.594 * t4e8)) \r\n        - 0.482 * Math.sin(deg2rad * (32.2842 + 285608.3309 * t - 547.653 * t2e4 \r\n        - 60.746 * t3e6 + 28.679 * t4e8)) \r\n        + 0.452 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        - 0.381 * Math.sin(deg2rad * (302.2110 + 1240006.0662 * t - 367.713 * t2e4 \r\n        - 32.051 * t3e6 + 15.085 * t4e8)) \r\n        - 0.342 * Math.sin(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 \r\n        - 25.072 * t3e6 + 11.826 * t4e8)) \r\n        - 0.312 * Math.sin(deg2rad * (44.8902 + 1431596.6029 * t + 269.911 * t2e4 \r\n        + 43.043 * t3e6 - 20.392 * t4e8)) \r\n        + 0.282 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 \r\n        - 12.516 * t3e6 + 5.913 * t4e8)) \r\n        + 0.255 * Math.sin(deg2rad * (203.9449 + 790671.6605 * t - 243.606 * t2e4 \r\n        - 21.408 * t3e6 + 10.057 * t4e8)) \r\n        + 0.252 * Math.sin(deg2rad * (68.9815 + 313472.7929 * t - 333.576 * t2e4 \r\n        - 35.756 * t3e6 + 16.854 * t4e8)) \r\n        - 0.211 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        + 0.193 * Math.sin(deg2rad * (267.9846 + 1176142.5540 * t - 580.254 * t2e4 \r\n        - 57.082 * t3e6 + 26.911 * t4e8)) \r\n        + 0.191 * Math.sin(deg2rad * (133.0212 + 698943.6863 * t - 670.224 * t2e4 \r\n        - 71.429 * t3e6 + 33.708 * t4e8)) \r\n        - 0.184 * Math.sin(deg2rad * (55.8468 - 1018261.2475 * t - 392.482 * t2e4 \r\n        - 53.726 * t3e6 + 25.420 * t4e8)) \r\n        + 0.182 * Math.sin(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 \r\n        + 32.359 * t3e6 - 15.363 * t4e8)) \r\n        - 0.158 * Math.sin(deg2rad * (257.3208 - 191590.5367 * t - 637.623 * t2e4 \r\n        - 75.093 * t3e6 + 35.477 * t4e8)) \r\n        + 0.148 * Math.sin(deg2rad * (156.5838 - 604925.8921 * t - 515.053 * t2e4 \r\n        - 64.410 * t3e6 + 30.448 * t4e8)) \r\n        - 0.111 * Math.sin(deg2rad * (169.7185 + 726808.1483 * t - 456.147 * t2e4 \r\n        - 46.439 * t3e6 + 21.882 * t4e8)) \r\n        + 0.101 * Math.sin(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 \r\n        + 17.971 * t3e6 - 8.566 * t4e8)) \r\n        + 0.100 * Math.sin(deg2rad * (358.0578 + 221744.8187 * t - 760.194 * t2e4 \r\n        - 85.777 * t3e6 + 40.505 * t4e8)) \r\n        + 0.087 * Math.sin(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 \r\n        - 10.643 * t3e6 + 5.028 * t4e8)) \r\n        + 0.080 * Math.sin(deg2rad * (42.9480 + 1653341.4216 * t - 490.283 * t2e4 \r\n        - 42.734 * t3e6 + 20.113 * t4e8)) \r\n        + 0.080 * Math.sin(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 \r\n        - 14.307 * t3e6 + 6.797 * t4e8)) \r\n        + 0.077 * Math.sin(deg2rad * (294.0181 - 163726.0747 * t - 423.546 * t2e4 \r\n        - 50.103 * t3e6 + 23.651 * t4e8)) \r\n        - 0.073 * Math.sin(deg2rad * (280.8834 - 1495460.1151 * t - 482.452 * t2e4 \r\n        - 68.074 * t3e6 + 32.217 * t4e8)) \r\n        - 0.071 * Math.sin(deg2rad * (304.6819 + 1204007.0159 * t - 366.177 * t2e4 \r\n        - 32.092 * t3e6 + 15.085 * t4e8)) \r\n        - 0.069 * Math.sin(deg2rad * (233.7582 + 1112279.0417 * t - 792.795 * t2e4 \r\n        - 82.113 * t3e6 + 38.736 * t4e8)) \r\n        - 0.067 * Math.sin(deg2rad * (34.7551 + 249609.2807 * t - 546.117 * t2e4 \r\n        - 60.787 * t3e6 + 28.679 * t4e8)) \r\n        - 0.067 * Math.sin(deg2rad * (263.6238 + 381403.5993 * t - 228.841 * t2e4 \r\n        - 23.199 * t3e6 + 10.941 * t4e8)) \r\n        + 0.055 * Math.sin(deg2rad * (21.6203 - 1082124.7597 * t - 605.023 * t2e4 \r\n        - 78.757 * t3e6 + 37.246 * t4e8)) \r\n        + 0.055 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 -7.029 * t4e8)) \r\n        - 0.054 * Math.sin(deg2rad * (8.7216 + 1589477.9094 * t - 702.824 * t2e4 \r\n        - 67.766 * t3e6 + 31.939 * t4e8)) \r\n        - 0.052 * Math.sin(deg2rad * (179.8536 + 1908795.4705 * t + 359.881 * t2e4 \r\n        + 57.390 * t3e6 - 27.189 * t4e8)) \r\n        - 0.050 * Math.sin(deg2rad * (98.7948 + 635080.1741 * t - 882.765 * t2e4 \r\n        - 96.461 * t3e6 + 45.533 * t4e8)) \r\n        - 0.049 * Math.sin(deg2rad * (128.6604 - 95795.2683 * t - 318.812 * t2e4 \r\n        - 37.547 * t3e6 + 17.738 * t4e8)) \r\n        - 0.047 * Math.sin(deg2rad * (17.3544 + 425341.6552 * t - 370.570 * t2e4 \r\n        - 39.946 * t3e6 + 18.854 * t4e8)) \r\n        - 0.044 * Math.sin(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 \r\n        - 12.475 * t3e6 + 5.913 * t4e8)) \r\n        - 0.043 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        + 0.042 * Math.sin(deg2rad * (270.4555 + 1140143.5037 * t - 578.718 * t2e4 \r\n        - 57.123 * t3e6 + 26.911 * t4e8)) \r\n        - 0.042 * Math.sin(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 \r\n        + 14.388 * t3e6 - 6.797 * t4e8)) \r\n        - 0.041 * Math.sin(deg2rad * (122.3573 - 668789.4043 * t - 727.594 * t2e4 \r\n        - 89.441 * t3e6 + 42.274 * t4e8)) \r\n        - 0.040 * Math.sin(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 \r\n        - 10.765 * t3e6 + 5.028 * t4e8)) \r\n        + 0.038 * Math.sin(deg2rad * (135.4921 + 662944.6361 * t - 668.688 * t2e4 \r\n        - 71.470 * t3e6 + 33.708 * t4e8)) \r\n        - 0.037 * Math.sin(deg2rad * (242.3910 - 51857.2124 * t - 460.540 * t2e4 \r\n        - 54.293 * t3e6 + 25.652 * t4e8)) \r\n        + 0.036 * Math.sin(deg2rad * (336.4374 +  1303869.5784 * t - 155.171 * t2e4 \r\n        - 7.020 * t3e6 + 3.259 * t4e8)) \r\n        + 0.035 * Math.sin(deg2rad * (223.0943 - 255454.0489 * t - 850.164 * t2e4 \r\n        - 100.124 * t3e6 + 47.302 * t4e8)) \r\n        - 0.034 * Math.sin(deg2rad * (193.2811 - 577061.4302 * t - 300.976 * t2e4 \r\n        - 39.419 * t3e6 + 18.623 * t4e8)) \r\n        + 0.031 * Math.sin(deg2rad * (87.6023 - 918398.6850 * t - 181.476 * t2e4 \r\n        - 28.654 * t3e6 + 13.594 * t4e8));\r\n\r\n    var spp = 2.4 * Math.sin(deg2rad * (103.2 + 377336.3 * t));\r\n\r\n    var lp = 83.353 + 4069.0137 * t - 103.238 * t2e4 \r\n        - 12.492 * t3e6 + 5.263 * t4e8 + sp + 1e-3 * t * spp;\r\n\r\n    // longitude of the ascending node\r\n\r\n    var sr = - 1.4979 * Math.sin(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 \r\n        + 4.231 * t3e6 - 2.001 * t4e8)) \r\n        - 0.1500 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        - 0.1226 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        + 0.1176 * Math.sin(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 \r\n        - 0.567 * t3e6 + 0.232 * t4e8)) \r\n        - 0.0801 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        - 0.0616 * Math.sin(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 \r\n        + 4.190 * t3e6 - 2.001 * t4e8)) \r\n        + 0.0490 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        + 0.0409 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        + 0.0327 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        + 0.0324 * Math.sin(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 \r\n        + 4.272 * t3e6 - 2.001 * t4e8)) \r\n        + 0.0196 * Math.sin(deg2rad * (98.3124 - 151739.6240 * t + 70.916 * t2e4 \r\n        + 8.462 * t3e6 - 4.001 * t4e8)) \r\n        + 0.0180 * Math.sin(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 \r\n        - 10.116 * t3e6 + 4.797 * t4e8)) \r\n        + 0.0150 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        - 0.0150 * Math.sin(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 0.0078 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        - 0.0045 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        + 0.0044 * Math.sin(deg2rad * (321.5076 + 1443602.9027 * t + 21.912 * t2e4 \r\n        + 13.780 * t3e6 - 6.566 * t4e8)) \r\n        - 0.0042 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 \r\n        - 12.516 * t3e6 + 5.913 * t4e8)) \r\n        - 0.0031 * Math.sin(deg2rad * (170.9849 - 930404.9848 * t + 66.523 * t2e4 \r\n        + 0.608 * t3e6 - 0.232 * t4e8)) \r\n        + 0.0031 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        + 0.0029 * Math.sin(deg2rad * (222.6120 - 1042273.8471 * t + 103.516 * t2e4 \r\n        + 4.798 * t3e6 - 2.232 * t4e8)) \r\n        + 0.0028 * Math.sin(deg2rad * (184.0733 + 1002403.0853 * t - 69.594 * t2e4 \r\n        - 0.526 * t3e6 + 0.232 * t4e8));\r\n\r\n    var srp = 25.9 * Math.sin(deg2rad * (125.0 - 1934.1 * t)) \r\n        - 4.3 * Math.sin(deg2rad * (220.2 - 1935.5 * t));\r\n\r\n    var srpp = 0.38 * Math.sin(deg2rad * (357.5 + 35999.1 * t));\r\n\r\n    var raan = 125.0446 - 1934.13618 * t + 20.762 * t2e4 \r\n        + 2.139 * t3e6 - 1.650 * t4e8 + sr \r\n        + 1e-3 * (srp + srpp * t);\r\n\r\n    // mean longitude\r\n\r\n    var sl = - 0.92581 * Math.sin(deg2rad * (235.7004 + 890534.2230 * t - 32.601 * t2e4 \r\n        + 3.664 * t3e6 - 1.769 * t4e8)) \r\n        + 0.33262 * Math.sin(deg2rad * (100.7370 + 413335.3554 * t - 122.571 * t2e4 \r\n        - 10.684 * t3e6 + 5.028 * t4e8)) \r\n        - 0.18402 * Math.sin(deg2rad * (357.5291 + 35999.0503 * t - 1.536 * t2e4 \r\n        + 0.041 * t3e6 + 0.000 * t4e8)) \r\n        + 0.11007 * Math.sin(deg2rad * (134.9634 + 477198.8676 * t + 89.970 * t2e4 \r\n        + 14.348 * t3e6 - 6.797 * t4e8)) \r\n        - 0.06055 * Math.sin(deg2rad * (238.1713 + 854535.1727 * t - 31.065 * t2e4 \r\n        + 3.623 * t3e6 - 1.769 * t4e8)) \r\n        + 0.04741 * Math.sin(deg2rad * (325.7736 - 63863.5122 * t - 212.541 * t2e4 \r\n        - 25.031 * t3e6 + 11.826 * t4e8)) \r\n        - 0.03086 * Math.sin(deg2rad * (10.6638 + 1367733.0907 * t + 57.370 * t2e4 \r\n        + 18.011 * t3e6 - 8.566 * t4e8)) \r\n        + 0.02184 * Math.sin(deg2rad * (103.2079 + 377336.3051 * t - 121.035 * t2e4 \r\n        - 10.724 * t3e6 + 5.028 * t4e8)) \r\n        + 0.01645 * Math.sin(deg2rad * (49.1562 - 75869.8120 * t + 35.458 * t2e4 \r\n        + 4.231 * t3e6 - 2.001 * t4e8)) \r\n        + 0.01022 * Math.sin(deg2rad * (233.2295 + 926533.2733 * t - 34.136 * t2e4 \r\n        + 3.705 * t3e6 - 1.769 * t4e8)) \r\n        - 0.00756 * Math.sin(deg2rad * (336.4374 + 1303869.5784 * t - 155.171 * t2e4 \r\n        - 7.020 * t3e6 + 3.259 * t4e8)) \r\n        - 0.00530 * Math.sin(deg2rad * (222.5657 - 441199.8173 * t - 91.506 * t2e4 \r\n        - 14.307 * t3e6 + 6.797 * t4e8)) \r\n        - 0.00496 * Math.sin(deg2rad * (162.8868 - 31931.7561 * t - 106.271 * t2e4 \r\n        - 12.516 * t3e6 + 5.913 * t4e8)) \r\n        - 0.00472 * Math.sin(deg2rad * (297.8502 + 445267.1115 * t - 16.300 * t2e4 \r\n        + 1.832 * t3e6 - 0.884 * t4e8)) \r\n        - 0.00271 * Math.sin(deg2rad * (240.6422 + 818536.1225 * t - 29.529 * t2e4 \r\n        + 3.582 * t3e6 - 1.769 * t4e8)) \r\n        + 0.00264 * Math.sin(deg2rad * (132.4925 + 513197.9179 * t + 88.434 * t2e4 \r\n        + 14.388 * t3e6 - 6.797 * t4e8)) \r\n        - 0.00254 * Math.sin(deg2rad * (186.5442 + 966404.0351 * t - 68.058 * t2e4 \r\n        - 0.567 * t3e6 + 0.232 * t4e8)) \r\n        + 0.00234 * Math.sin(deg2rad * (269.9268 + 954397.7353 * t + 179.941 * t2e4 \r\n        + 28.695 * t3e6 - 13.594 * t4e8)) \r\n        - 0.00220 * Math.sin(deg2rad * (13.1347 + 1331734.0404 * t + 58.906 * t2e4 \r\n        + 17.971 * t3e6 - 8.566 * t4e8)) \r\n        - 0.00202 * Math.sin(deg2rad * (355.0582 + 71998.1006 * t - 3.072 * t2e4 \r\n        + 0.082 * t3e6 + 0.000 * t4e8)) \r\n        + 0.00167 * Math.sin(deg2rad * (328.2445 - 99862.5625 * t - 211.005 * t2e4 \r\n        - 25.072 * t3e6 + 11.826 * t4e8)) \r\n        - 0.00143 * Math.sin(deg2rad * (173.5506 + 1335801.3346 * t - 48.901 * t2e4 \r\n        + 5.496 * t3e6 - 2.653 * t4e8)) \r\n        - 0.00121 * Math.sin(deg2rad * (98.2661 + 449334.4057 * t - 124.107 * t2e4 \r\n        - 10.643 * t3e6 + 5.028 * t4e8)) \r\n        - 0.00116 * Math.sin(deg2rad * (145.6272 + 1844931.9583 * t + 147.340 * t2e4 \r\n        + 32.359 * t3e6 - 15.363 * t4e8)) \r\n        + 0.00102 * Math.sin(deg2rad * (105.6788 + 341337.2548 * t - 119.499 * t2e4 \r\n        - 10.765 * t3e6 + 5.028 * t4e8)) \r\n        - 0.00090 * Math.sin(deg2rad * (184.1196 + 401329.0556 * t + 125.428 * t2e4 \r\n        + 18.579 * t3e6 - 8.798 * t4e8)) \r\n        - 0.00086 * Math.sin(deg2rad * (338.9083 + 1267870.5281 * t - 153.636 * t2e4 \r\n        - 7.061 * t3e6 + 3.259 * t4e8)) \r\n        - 0.00078 * Math.sin(deg2rad * (111.4008 + 1781068.4461 * t - 65.201 * t2e4 \r\n        + 7.328 * t3e6 - 3.538 * t4e8)) \r\n        + 0.00069 * Math.sin(deg2rad * (323.3027 - 27864.4619 * t - 214.077 * t2e4 \r\n        - 24.990 * t3e6 + 11.826 * t4e8)) \r\n        + 0.00066 * Math.sin(deg2rad * (51.6271 - 111868.8623 * t + 36.994 * t2e4 \r\n        + 4.190 * t3e6 - 2.001 * t4e8)) \r\n        + 0.00065 * Math.sin(deg2rad * (38.5872 + 858602.4669 * t - 138.871 * t2e4 \r\n        - 8.852 * t3e6 + 4.144 * t4e8)) \r\n        - 0.00060 * Math.sin(deg2rad * (83.3826 - 12006.2998 * t + 247.999 * t2e4 \r\n        + 29.262 * t3e6 - 13.826 * t4e8)) \r\n        + 0.00054 * Math.sin(deg2rad * (201.4740 + 826670.7108 * t - 245.142 * t2e4 \r\n        - 21.367 * t3e6 + 10.057 * t4e8)) \r\n        - 0.00052 * Math.sin(deg2rad * (308.4192 - 489205.1674 * t + 158.029 * t2e4 \r\n        + 14.915 * t3e6 - 7.029 * t4e8)) \r\n        + 0.00048 * Math.sin(deg2rad * (8.1929 + 1403732.1410 * t + 55.834 * t2e4 \r\n        + 18.052 * t3e6 - 8.566 * t4e8)) \r\n        - 0.00041 * Math.sin(deg2rad * (46.6853 - 39870.7617 * t + 33.922 * t2e4 \r\n        + 4.272 * t3e6 - 2.001 * t4e8)) \r\n        - 0.00033 * Math.sin(deg2rad * (274.1928 - 553068.6797 * t - 54.513 * t2e4 \r\n        - 10.116 * t3e6 + 4.797 * t4e8)) \r\n        + 0.00030 * Math.sin(deg2rad * (160.4159 + 4067.2942 * t - 107.806 * t2e4 \r\n        - 12.475 * t3e6 + 5.913 * t4e8));\r\n\r\n    var slp = 3.96 * Math.sin(deg2rad * (119.7 + 131.8 * t)) \r\n        + 1.96 * Math.sin(deg2rad * (125.0 - 1934.1 * t));\r\n\r\n    var slpp = 0.463 * Math.sin(deg2rad * (357.5 + 35999.1 * t)) \r\n        + 0.152 * Math.sin(deg2rad * (238.2 + 854535.2 * t)) \r\n        - 0.071 * Math.sin(deg2rad * (27.8 + 131.8 * t)) \r\n        - 0.055 * Math.sin(deg2rad * (103.2 + 377336.3 * t)) \r\n        - 0.026 * Math.sin(deg2rad * (233.2 + 926533.3 * t));\r\n\r\n    var slppp = 14 * Math.sin(deg2rad * (357.5 + 35999.1 * t)) \r\n        + 5 * Math.sin(deg2rad * (238.2 + 854535.2 * t));\r\n\r\n    var lambda = 218.31665 + 481267.88134 * t - 13.268 * t2e4 \r\n        + 1.856 * t3e6 - 1.534 * t4e8 + sl \r\n        + 1e-3 * (slp + slpp * t + slppp * t2e4);\r\n\r\n     dat.a = sma;\r\n     dat.e = ecc;\r\n     dat.i = 2.0 * Math.asin(gamma);\r\n     dat.w = Trig.normalize(deg2rad * (lp - raan));\r\n     dat.N = Trig.normalize(deg2rad * raan);\r\n     dat.M = Trig.normalize(deg2rad * (lambda - lp));\r\n     return dat;\r\n  },\r\n  corr: function(dat, sol) {\r\n    var M = Trig.normalize(sol.M + Math.PI),\r\n        w = Trig.normalize(sol.w + Math.PI),\r\n        L = dat.M + dat.w,     // Argument of latitude \r\n        E = L + dat.N - M - w; // Mean elongation\r\n    \r\n    var lon = \r\n      -0.022234 * Math.sin(dat.M - 2*E) +  // Evection\r\n       0.011494 * Math.sin(2*E) +          // Variation\r\n      -0.003246 * Math.sin(M) +        // Yearly Equation\r\n      -0.001029 * Math.sin(2*dat.M - 2*E) +\r\n      -9.94838e-4 * Math.sin(dat.M - 2*E + M) +\r\n       9.25025e-4 * Math.sin(dat.M + 2*E) +\r\n       8.02851e-4 * Math.sin(2*E - M) +\r\n       7.15585e-4 * Math.sin(dat.M - M) +\r\n      -6.10865e-4 * Math.sin(E) + \r\n      -5.41052e-4 * Math.sin(dat.M + M) +\r\n      -2.61799e-4 * Math.sin(2*L - 2*E) +\r\n       1.91986e-4 * Math.sin(dat.M - 4*E);\r\n    dat.ra += lon;\r\n    var lat =\r\n      -0.003019 * Math.sin(L - 2*E) +\r\n      -9.59931e-4 * Math.sin(dat.M - L - 2*E) +\r\n      -8.02851e-4 * Math.sin(dat.M + L - 2*E) +\r\n       5.75958e-4 * Math.sin(L + 2*E) +\r\n       2.96706e-4 * Math.sin(2*dat.M + L);  \r\n    dat.dec += lat;\r\n  \r\n    dat.age = Trig.normalize(dat.l - sol.l + Math.PI);   \r\n    dat.phase = 0.5 * (1 - Math.cos(dat.age));\r\n\r\n    return dat;\r\n  }\r\n\r\n};\r\nfunction exportSVG(fname) {\r\n  var doc = d3.select(\"body\").append(\"div\").attr(\"id\", \"d3-celestial-svg\").attr(\"style\", \"display: none\"),\r\n      svg = d3.select(\"#d3-celestial-svg\").append(\"svg\"), //.attr(\"style\", \"display: none\"),\r\n      m = Celestial.metrics(),\r\n      cfg = settings.set(),\r\n      path = cfg.datapath,\r\n      proj = projections[cfg.projection],\r\n      rotation = getAngles(cfg.center),\r\n      center = [-rotation[0], -rotation[1]],\r\n      scale0 = proj.scale * m.width/1024,\r\n      projection = Celestial.projection(cfg.projection).rotate(rotation).translate([m.width/2, m.height/2]).scale([m.scale]),\r\n      adapt = cfg.adaptable ? Math.sqrt(m.scale/scale0) : 1,\r\n      culture = (cfg.culture !== \"\" && cfg.culture !== \"iau\") ? cfg.culture : \"\",\r\n      circle, id;\r\n\r\n  svg.selectAll(\"*\").remove();\r\n\r\n  var defs = svg.append(\"defs\");\r\n\r\n  if (proj.clip) {\r\n    projection.clipAngle(90);\r\n  }\r\n  circle = d3.geo.circle().angle([179.95]).origin(center);\r\n\r\n  svg.attr(\"width\", m.width).attr(\"height\", m.height);\r\n  // .attr(\"viewBox\", \" 0 0 \" + (m.width) + \" \" + (m.height));\r\n\r\n  var groupNames = ['background', 'milkyWay', 'milkyWayBg', 'gridLines', 'constBoundaries', \r\n                    'planesequatorial', 'planesecliptic', 'planesgalactic', 'planessupergalactic',\r\n                    'constLines', 'mapBorder','stars', 'dsos', 'planets', 'gridvaluesLon', 'gridvaluesLat', \r\n                    'constNames', 'starDesignations', 'starNames', 'dsoNames', 'planetNames', 'horizon', 'daylight'],\r\n                groups = {}, styles = {};\r\n\r\n  for (var i=0; i<groupNames.length; i++) {\r\n     // inkscape:groupmode=\"layer\", inkscape:label=\"Ebene 1\" \r\n    groups[groupNames[i]] = svg.append('g').attr({\"id\": groupNames[i], \":inkscape:groupmode\": \"layer\", \":inkscape:label\": groupNames[i]});\r\n    styles[groupNames[i]] = {};\r\n  }\r\n\r\n  var graticule = d3.geo.graticule().minorStep([15,10]);\r\n  \r\n  var map = d3.geo.path().projection(projection);\r\n\r\n  var q = d3.queue(2);\r\n  \r\n  groups.background.append(\"path\").datum(circle).attr(\"class\", \"background\").attr(\"d\", map); \r\n  styles.background.fill = cfg.background.fill;\r\n\r\n  if (cfg.lines.graticule.show) {\r\n    if (cfg.transform === \"equatorial\") {\r\n      groups.gridLines.append(\"path\").datum(graticule)\r\n       .attr(\"class\", \"gridLines\")\r\n       .attr(\"d\", map);\r\n      styles.gridLines = svgStyle(cfg.lines.graticule);\r\n    } else {\r\n      Celestial.graticule(groups.gridLines, map, cfg.transform);\r\n      styles.gridLines = svgStyle(cfg.lines.graticule);\r\n    }\r\n    if (has(cfg.lines.graticule, \"lon\") && cfg.lines.graticule.lon.pos.length > 0) {\r\n      var jlon = {type: \"FeatureCollection\", features: getGridValues(\"lon\", cfg.lines.graticule.lon.pos)};      \r\n      groups.gridvaluesLon.selectAll(\".gridvalues_lon\")\r\n        .data(jlon.features)\r\n        .enter().append(\"text\")\r\n        .attr(\"transform\", function(d, i) { return point(d.geometry.coordinates); })\r\n        .text( function(d) { return d.properties.value; } )\r\n        .attr({dy: \".5em\", dx: \"-.75em\", class: \"gridvaluesLon\"});\r\n      styles.gridvaluesLon = svgTextStyle(cfg.lines.graticule.lon); \r\n    }\r\n    if (has(cfg.lines.graticule, \"lat\") && cfg.lines.graticule.lat.pos.length > 0) {\r\n      var jlat = {type: \"FeatureCollection\", features: getGridValues(\"lat\", cfg.lines.graticule.lat.pos)};\r\n      groups.gridvaluesLat.selectAll(\".gridvalues_lat\")\r\n        .data(jlat.features)\r\n        .enter().append(\"text\")\r\n        .attr(\"transform\", function(d, i) { return point(d.geometry.coordinates); })\r\n        .text( function(d) { return d.properties.value; } )\r\n        .attr({dy: \"-.5em\", dx: \"-.75em\", class: \"gridvaluesLat\"});\r\n       styles.gridvaluesLat = svgTextStyle(cfg.lines.graticule.lat); \r\n    }\r\n  }\r\n\r\n  //Celestial planes\r\n  for (var key in cfg.lines) {\r\n    if (has(cfg.lines, key) && key != \"graticule\" && cfg.lines[key].show !== false) { \r\n      id = \"planes\" + key;\r\n      groups[id].append(\"path\")\r\n         .datum(d3.geo.circle().angle([90]).origin(poles[key]) )\r\n         .attr(\"class\", id)\r\n         .attr(\"d\", map);\r\n      styles[id] = svgStyle(cfg.lines[key]);\r\n    }\r\n  }\r\n\r\n  //Milky way outline\r\n  if (cfg.mw.show) {\r\n    q.defer(function(callback) { \r\n      d3.json(path + \"mw.json\", function(error, json) {\r\n        if (error) callback(error);\r\n        var mw = getData(json, cfg.transform);\r\n        var mw_back = getMwbackground(mw);\r\n        \r\n        groups.milkyWay.selectAll(\".mway\")\r\n         .data(mw.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", \"milkyWay\")\r\n         .attr(\"d\", map);\r\n        styles.milkyWay = svgStyle(cfg.mw.style);\r\n        \r\n        if (!has(cfg.background, \"opacity\") || cfg.background.opacity > 0.95) {\r\n          groups.milkyWayBg.selectAll(\".mwaybg\")\r\n           .data(mw_back.features)\r\n           .enter().append(\"path\")\r\n           .attr(\"class\", \"milkyWayBg\")\r\n           .attr(\"d\", map);\r\n          styles.milkyWayBg = {\"fill\": cfg.background.fill, \r\n                   \"fill-opacity\": cfg.background.opacity };\r\n        }\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  //Constellation boundaries\r\n  if (cfg.constellations.bounds) { \r\n    q.defer(function(callback) { \r\n      d3.json(path + filename(\"constellations\", \"borders\"), function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var conb = getData(json, cfg.transform);\r\n        if (Celestial.constellation) {\r\n          var re = new RegExp(\"\\\\b\" + Celestial.constellation + \"\\\\b\");\r\n        }\r\n\r\n        groups.constBoundaries.selectAll(\".bounds\")\r\n         .data(conb.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", function(d) { return (Celestial.constellation && d.ids.search(re) !== -1) ? \"constBoundariesSel\" : \"constBoundaries\"; }) \r\n         .attr(\"d\", map);\r\n\r\n        styles.constBoundaries = svgStyle(cfg.constellations.boundStyle);\r\n        styles.constBoundariesSel = {\"fill\": \"none\",\r\n            \"stroke\": cfg.constellations.boundStyle.stroke, \r\n            \"stroke-width\": cfg.constellations.boundStyle.width * 1.5,\r\n            \"stroke-opacity\": 1,\r\n            \"stroke-dasharray\": \"none\"};\r\n        \r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  //Constellation lines\r\n  if (cfg.constellations.lines) { \r\n    q.defer(function(callback) { \r\n      d3.json(path + filename(\"constellations\", \"lines\"), function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var conl = getData(json, cfg.transform);\r\n        groups.constLines.selectAll(\".lines\")\r\n         .data(conl.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"class\", function(d) { return \"constLines\" + d.properties.rank; })\r\n         .attr(\"d\", map);\r\n\r\n        var dasharray = has(cfg.constellations.lineStyle, \"dash\") ? cfg.constellations.lineStyle.dash.join(\" \") : \"none\";\r\n         \r\n        styles.constLines1 = {\"fill\": \"none\", \"stroke\": cfg.constellations.lineStyle.stroke[0],\r\n                              \"stroke-width\": cfg.constellations.lineStyle.width[0],\r\n                              \"stroke-opacity\": cfg.constellations.lineStyle.opacity[0],\r\n                              \"stroke-dasharray\": dasharray};\r\n        styles.constLines2 = {\"fill\": \"none\", \"stroke\": cfg.constellations.lineStyle.stroke[1],\r\n                              \"stroke-width\": cfg.constellations.lineStyle.width[1],\r\n                              \"stroke-opacity\": cfg.constellations.lineStyle.opacity[1],\r\n                              \"stroke-dasharray\": dasharray};\r\n        styles.constLines3 = {\"fill\": \"none\", \"stroke\": cfg.constellations.lineStyle.stroke[2],\r\n                              \"stroke-width\": cfg.constellations.lineStyle.width[2],\r\n                              \"stroke-opacity\": cfg.constellations.lineStyle.opacity[2],\r\n                              \"stroke-dasharray\": dasharray};\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  // Map border\r\n  q.defer(function(callback) {\r\n    var rot = projection.rotate();\r\n    projection.rotate([0,0,0]);\r\n    groups.mapBorder.append(\"path\")\r\n     .datum(graticule.outline)\r\n     .attr(\"class\", \"mapBorder\")\r\n     .attr(\"d\", map);\r\n     \r\n    styles.mapBorder = {\"fill\": \"none\", \"stroke\": cfg.background.stroke, \"stroke-width\": cfg.background.width, \"stroke-opacity\": 1, \"stroke-dasharray\": \"none\" };\r\n\r\n    projection.rotate(rot);\r\n    callback(null);\r\n  });  \r\n  \r\n  //Constellation names or designation\r\n  if (cfg.constellations.names) { \r\n    q.defer(function(callback) { \r\n      d3.json(path + filename(\"constellations\"), function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var conn = getData(json, cfg.transform);\r\n        groups.constNames.selectAll(\".constnames\")\r\n         .data(conn.features.filter( function(d) {\r\n            return clip(d.geometry.coordinates) === 1; \r\n          }))\r\n         .enter().append(\"text\")\r\n         .attr(\"class\", function(d) { return \"constNames\" + d.properties.rank; })\r\n         .attr(\"transform\", function(d, i) { return point(d.geometry.coordinates); })\r\n         .text( function(d) { return constName(d); } ); \r\n \r\n        styles.constNames1 = {\"fill\": cfg.constellations.nameStyle.fill[0],\r\n                              \"fill-opacity\": cfg.constellations.nameStyle.opacity[0],\r\n                              \"font\": cfg.constellations.nameStyle.font[0],\r\n                              \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)};\r\n        styles.constNames2 = {\"fill\": cfg.constellations.nameStyle.fill[1],\r\n                              \"fill-opacity\": cfg.constellations.nameStyle.opacity[1],\r\n                              \"font\": cfg.constellations.nameStyle.font[1],\r\n                              \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)};\r\n        styles.constNames3 = {\"fill\": cfg.constellations.nameStyle.fill[2],\r\n                              \"fill-opacity\": cfg.constellations.nameStyle.opacity[2],\r\n                              \"font\": cfg.constellations.nameStyle.font[2],\r\n                              \"text-anchor\": svgAlign(cfg.constellations.nameStyle.align)};\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n  \r\n  //Stars\r\n  if (cfg.stars.show) { \r\n    q.defer(function(callback) { \r\n      d3.json(path +  cfg.stars.data, function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var cons = getData(json, cfg.transform);\r\n        \r\n        groups.stars.selectAll(\".stars\")\r\n          .data(cons.features.filter( function(d) {\r\n            return d.properties.mag <= cfg.stars.limit; \r\n          }))\r\n          .enter().append(\"path\")\r\n          .attr(\"class\", function(d) { return \"stars\" + starColor(d.properties.bv); })\r\n          .attr(\"d\", map.pointRadius( function(d) {\r\n            return d.properties ? starSize(d.properties.mag) : 1;\r\n          }));\r\n\r\n        styles.stars = svgStyle(cfg.stars.style);\r\n        var range = bvcolor.domain();\r\n        for (i=Round(range[1],1); i<=Round(range[0],1); i+=0.1) {\r\n          styles[\"stars\" + Math.round(i*10).toString()] = {\"fill\": bvcolor(i)};\r\n        }\r\n          \r\n        if (cfg.stars.designation) { \r\n          groups.starDesignations.selectAll(\".stardesigs\")\r\n            .data(cons.features.filter( function(d) {\r\n              return d.properties.mag <= cfg.stars.designationLimit*adapt && clip(d.geometry.coordinates) === 1; \r\n            }))\r\n            .enter().append(\"text\")\r\n            .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n            .text( function(d) { return starDesignation(d.id); })\r\n            .attr({dy: \".85em\", dx: \".35em\", class: \"starDesignations\"});\r\n          styles.starDesignations = svgTextStyle(cfg.stars.designationStyle);\r\n        }\r\n        if (cfg.stars.propername) { \r\n          groups.starNames.selectAll(\".starnames\")\r\n            .data(cons.features.filter( function(d) {\r\n              return d.properties.mag <= cfg.stars.propernameLimit*adapt && clip(d.geometry.coordinates) === 1; \r\n            }))\r\n            .enter().append(\"text\")\r\n            .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n            .text( function(d) { return starPropername(d.id); })\r\n            .attr({dy: \"-.5em\", dx: \"-.35em\", class: \"starNames\"});\r\n\r\n          styles.starNames = svgTextStyle(cfg.stars.propernameStyle);\r\n        }\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  //Deep space objects\r\n  if (cfg.dsos.show) { \r\n    q.defer(function(callback) { \r\n      d3.json(path +  cfg.dsos.data, function(error, json) {\r\n        if (error) callback(error);\r\n\r\n        var cond = getData(json, cfg.transform);\r\n        \r\n        groups.dsos.selectAll(\".dsos\")\r\n          .data(cond.features.filter( function(d) {\r\n            return clip(d.geometry.coordinates) === 1 && \r\n                   (d.properties.mag === 999 && Math.sqrt(parseInt(d.properties.dim)) > cfg.dsos.limit*adapt ||\r\n                   d.properties.mag !== 999 && d.properties.mag <= cfg.dsos.limit); \r\n          }))\r\n          .enter().append(\"path\")\r\n          .attr(\"class\", function(d) { return \"dsos\" + d.properties.type; })\r\n          .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n          .attr(\"d\", function(d) { return dsoSymbol(d.properties); });\r\n\r\n        styles.dsos = svgStyle(cfg.dsos.style);\r\n\r\n        for (key in cfg.dsos.symbols) {\r\n          if (!has(cfg.dsos.symbols, key)) continue;\r\n          id = \"dsos\" + key;\r\n          styles[id] = { \"fill-opacity\": cfg.dsos.style.opacity, \"stroke-opacity\": cfg.dsos.style.opacity };\r\n          if (has(cfg.dsos.symbols[key], \"stroke\")) {\r\n            styles[id].fill = \"none\"; \r\n            styles[id].stroke = cfg.dsos.colors ? cfg.dsos.symbols[key].stroke : cfg.dsos.style.stroke;\r\n            styles[id][\"stroke-width\"] = cfg.dsos.colors ? cfg.dsos.symbols[key].width : cfg.dsos.style.width;\r\n          } else {\r\n            styles[id].stroke = \"none\"; \r\n            styles[id].fill = cfg.dsos.colors ? cfg.dsos.symbols[key].fill : cfg.dsos.style.fill;\r\n          }\r\n        }\r\n        \r\n      \r\n        if (cfg.dsos.names) { \r\n          groups.dsoNames.selectAll(\".dsonames\")\r\n            .data(cond.features.filter( function(d) {\r\n              return clip(d.geometry.coordinates) === 1 && \r\n                   (d.properties.mag == 999 && Math.sqrt(parseInt(d.properties.dim)) > cfg.dsos.nameLimit ||\r\n                     d.properties.mag != 999 && d.properties.mag <= cfg.dsos.nameLimit); \r\n            }))\r\n            .enter().append(\"text\")\r\n            .attr(\"class\", function(d) { return \"dsoNames \" + d.properties.type; })\r\n            .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n            .text( function(d) { return dsoName(d); })\r\n            .attr({dy: \"-.5em\", dx: \".35em\"});\r\n               \r\n          styles.dsoNames = {\"fill-opacity\": cfg.dsos.style.opacity,\r\n                    \"font\": cfg.dsos.nameStyle.font,\r\n                    \"text-anchor\": svgAlign(cfg.dsos.nameStyle.align)};\r\n          \r\n          for (key in cfg.dsos.symbols) {\r\n            if (!has(cfg.dsos.symbols, key)) continue;\r\n            styles[key] = {\"fill\": cfg.dsos.colors ? cfg.dsos.symbols[key].fill : cfg.dsos.style.fill };\r\n          }\r\n        }\r\n        callback(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  //Planets\r\n  if ((cfg.location || cfg.formFields.location) && cfg.planets.show && Celestial.origin) {\r\n    q.defer(function(callback) {\r\n      var dt = Celestial.date(),\r\n          o = Celestial.origin(dt).spherical(),\r\n          jp = {type: \"FeatureCollection\", features: []},\r\n          jlun = {type: \"FeatureCollection\", features: []};\r\n      Celestial.container.selectAll(\".planet\").each(function(d) {\r\n        var id = d.id(), r = 12,\r\n            p = d(dt).equatorial(o);\r\n            \r\n        p.ephemeris.pos = transformDeg(p.ephemeris.pos, euler[cfg.transform]);  //transform; \r\n        if (clip(p.ephemeris.pos) === 1) {\r\n          if (id === \"lun\")\r\n            jlun.features.push(createEntry(p));\r\n          else\r\n            jp.features.push(createEntry(p));\r\n        }\r\n      });\r\n      if (cfg.planets.symbolType === \"disk\") {\r\n        groups.planets.selectAll(\".planets\")\r\n         .data(jp.features)\r\n         .enter().append(\"path\")\r\n         .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n         .attr(\"d\", function(d) { \r\n           var r = (has(cfg.planets.symbols[d.id], \"size\")) ? (cfg.planets.symbols[d.id].size - 1) * adapt : null;\r\n           return planetSymbol(d.properties, r); \r\n         })\r\n         .attr(\"class\", function(d) { return \"planets \" + d.id; });\r\n      } else {\r\n        groups.planets.selectAll(\".planets\")\r\n         .data(jp.features)\r\n         .enter().append(\"text\")\r\n         .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n         .text( function(d) { return d.properties.symbol; })\r\n         .attr(\"class\", function(d) { return \"planets \" + d.id; })\r\n         .attr({dy: \".35em\"});\r\n      }\r\n      // Special case for Moon crescent\r\n      if (jlun.features.length > 0) {\r\n        if (cfg.planets.symbolType === \"letter\") {\r\n          groups.planets.selectAll(\".moon\")\r\n           .data(jlun.features)\r\n           .enter().append(\"text\")\r\n           .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n           .text( function(d) { return d.properties.symbol; })\r\n           .attr(\"class\", function(d) { return \"planets \" + d.id; })\r\n           .attr({dy: \".35em\"});\r\n        } else {\r\n          var rl = has(cfg.planets.symbols.lun, \"size\") ? (cfg.planets.symbols.lun.size - 1) * adapt : 11 * adapt; \r\n          groups.planets.selectAll(\".dmoon\")\r\n           .data(jlun.features)\r\n           .enter().append(\"path\")\r\n           .attr(\"class\", \"darkluna\" )\r\n           .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n           .attr(\"d\", function(d) { return d3.svg.symbol().type(\"circle\").size(rl*rl)(); });\r\n          groups.planets.selectAll(\".moon\")\r\n           .data(jlun.features)\r\n           .enter().append(\"path\")\r\n           .attr(\"class\", function(d) { return \"planets \" + d.id; })\r\n           .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n           .attr(\"d\", function(d) { return moonSymbol(d.properties, rl); });\r\n        }\r\n      } \r\n      \r\n      styles.planets = svgTextStyle(cfg.planets.symbolStyle);\r\n      styles.planets.font = planetFont(cfg.planets.symbolStyle.font);\r\n      styles.darkluna = {\"fill\": \"#557\"};\r\n      for (key in cfg.planets.symbols) {\r\n         if (!has(cfg.planets.symbols, key)) continue;\r\n         styles[key] = {\"fill\": cfg.planets.symbols[key].fill};\r\n      }\r\n        \r\n      //Planet names\r\n      if (cfg.planets.names) {\r\n        groups.planetNames.selectAll(\".planetnames\")\r\n         .data(jp.features)\r\n         .enter().append(\"text\")\r\n         .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n         .text( function(d) { return d.properties.name; })\r\n         .attr({dy: \".85em\", dx: \"-.35em\"})\r\n         .attr(\"class\", function(d) { return \"planetNames \" + d.id; });\r\n        if (jlun.features.length > 0) {\r\n          groups.planetNames.selectAll(\".moonname\")\r\n           .data(jlun.features)\r\n           .enter().append(\"text\")\r\n           .attr(\"transform\", function(d) { return point(d.geometry.coordinates); })\r\n           .text( function(d) { return d.properties.name; })\r\n           .attr({dy: \".85em\", dx: \"-.35em\"})\r\n           .attr(\"class\", function(d) { return \"planetNames \" + d.id; });\r\n        }\r\n      }\r\n      styles.planetNames = svgTextStyle(cfg.planets.nameStyle);\r\n      \r\n      callback(null);\r\n    });  \r\n  }\r\n  \r\n  if ((cfg.location || cfg.formFields.location) && cfg.daylight.show && proj.clip) {\r\n    q.defer(function(callback) {\r\n      var sol = getPlanet(\"sol\");\r\n      if (sol) {\r\n        var up = Celestial.zenith(),\r\n            solpos = sol.ephemeris.pos,\r\n            dist = d3.geo.distance(up, solpos),\r\n            pt = projection(solpos),\r\n            daylight = d3.geo.circle().angle([179.95]).origin(solpos);\r\n\r\n        groups.daylight.append(\"path\").datum(daylight)\r\n         .attr(\"class\", \"daylight\")\r\n         .attr(\"d\", map);\r\n       \r\n        styles.daylight = svgSkyStyle(dist, pt);  \r\n\r\n        if (clip(solpos) === 1 && dist < halfπ) {\r\n          groups.daylight.append(\"circle\")\r\n           .attr(\"cx\", pt[0])\r\n           .attr(\"cy\", pt[1])\r\n           .attr(\"r\", 5)\r\n           .style(\"fill\", \"#fff\");\r\n        }\r\n      }\r\n      callback(null);\r\n    });  \r\n  }\r\n\r\n  if ((cfg.location || cfg.formFields.location) && cfg.horizon.show && !proj.clip) {\r\n    q.defer(function(callback) {\r\n      var horizon = d3.geo.circle().angle([90]).origin(Celestial.nadir());\r\n     \r\n      groups.horizon.append(\"path\").datum(horizon)\r\n       .attr(\"class\", \"horizon\")\r\n       .attr(\"d\", map);\r\n      styles.horizon =  svgStyle(cfg.horizon);  \r\n      callback(null);\r\n    });\r\n  }\r\n  \r\n  if (Celestial.data.length > 0) { \r\n    Celestial.data.forEach( function(d) {\r\n      if (has(d, \"save\")) {\r\n       q.defer(function(callback) { \r\n         d.save(); \r\n        callback(null);\r\n       });\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Helper functions\r\n  \r\n  function clip(coords) {\r\n    return proj.clip && d3.geo.distance(center, coords) > halfπ ? 0 : 1;\r\n  }\r\n\r\n  function point(coords) {\r\n    return \"translate(\" + projection(coords) + \")\";\r\n  }\r\n    \r\n  function filename(what, sub, ext) {\r\n    var cult = (has(formats[what], culture)) ? \".\" + culture : \"\";\r\n    ext = ext ? \".\" + ext : \".json\";\r\n    sub = sub ? \".\" + sub : \"\";\r\n    return what + sub + cult + ext;\r\n  }\r\n\r\n  function svgStyle(s) {\r\n    var res = {};\r\n    res.fill = s.fill || \"none\";\r\n    res[\"fill-opacity\"] = s.opacity !== null ? s.opacity : 1;  \r\n    res.stroke = s.stroke || \"none\";\r\n    res[\"stroke-width\"] = s.width !== null ? s.width : 0;\r\n    res[\"stroke-opacity\"] = s.opacity !== null ? s.opacity : 1;  \r\n    if (has(s, \"dash\")) res[\"stroke-dasharray\"] = s.dash.join(\" \");\r\n    else res[\"stroke-dasharray\"] = \"none\";\r\n    res.font = s.font || null;\r\n    return res;\r\n  }\r\n\r\n  function svgTextStyle(s) {\r\n    var res = {};\r\n    res.stroke = \"none\";\r\n    res.fill = s.fill || \"none\";\r\n    res[\"fill-opacity\"] = s.opacity !== null ? s.opacity : 1;  \r\n    //res.textBaseline = s.baseline || \"bottom\";\r\n    res[\"text-anchor\"] = svgAlign(s.align);\r\n    res.font = s.font || null;\r\n    return res;\r\n  }\r\n\r\n  function svgStyleA(rank, s) {\r\n    var res = {};\r\n    rank = rank || 1;\r\n    res.fill = isArray(s.fill) ? s.fill[rank-1] : null;\r\n    res[\"fill-opacity\"] = isArray(s.opacity) ? s.opacity[rank-1] : 1;  \r\n    res.stroke = isArray(s.stroke) ? s.stroke[rank-1] : null;\r\n    res[\"stroke-width\"] = isArray(s.width) ? s.width[rank-1] : null;\r\n    res[\"stroke-opacity\"] = isArray(s.opacity) ? s.opacity[rank-1] : 1;  \r\n    res[\"text-anchor\"] = svgAlign(s.align);\r\n    res.font = isArray(s.font) ? s.font[rank-1] : null;\r\n    //res.textBaseline = s.baseline || \"bottom\";\r\n    return res;\r\n  }\r\n\r\n  function svgSkyStyle(dist, pt) {\r\n    var factor, color1, color2, color3,\r\n        upper = 1.36, \r\n        lower = 1.885;\r\n    \r\n    if (dist > lower) return {fill: \"transparent\"};\r\n    \r\n    if (dist <= upper) { \r\n      color1 = \"#daf1fa\";\r\n      color2 = \"#93d7f0\"; \r\n      color3 = \"#57c0e8\"; \r\n      factor = -(upper-dist) / 10; \r\n    } else {\r\n      factor = (dist - upper) / (lower - upper);\r\n      color1 = d3.interpolateLab(\"#daf1fa\", \"#e8c866\")(factor);\r\n      color2 = d3.interpolateLab(\"#93c7d0\", \"#ff854a\")(factor);\r\n      color3 = d3.interpolateLab(\"#57b0c8\", \"#6caae2\")(factor);\r\n    }\r\n\r\n    var gradient = groups.daylight.append(\"radialGradient\")\r\n     .attr(\"cx\", pt[0])\r\n     .attr(\"cy\", pt[1])\r\n     .attr(\"fr\", \"0\")\r\n     .attr(\"r\", \"300\")\r\n     .attr(\"id\", \"skygradient\")\r\n     .attr(\"gradientUnits\", \"userSpaceOnUse\");\r\n\r\n    gradient.append(\"stop\").attr(\"offset\", \"0\").attr(\"stop-color\", color1);\r\n    gradient.append(\"stop\").attr(\"offset\", 0.2+0.4*factor).attr(\"stop-color\", color2);\r\n    gradient.append(\"stop\").attr(\"offset\", \"1\").attr(\"stop-color\", color3);\r\n\r\n    return {\"fill\": \"url(#skygradient)\", \"fill-opacity\": skyTransparency(factor, 1.4)};\r\n  }\r\n\r\n  function skyTransparency(t, a) {\r\n    return 0.9 * (1 - ((Math.pow(Math.E, t*a) - 1) / (Math.pow(Math.E, a) - 1)));\r\n  }\r\n  \r\n\r\n\r\n  function svgAlign(s) {\r\n    if (!s) return \"start\";\r\n    if (s === \"center\") return \"middle\"; \r\n    if (s === \"right\") return \"end\";\r\n    return \"start\";\r\n  }\r\n\r\n  function dsoSymbol(p) {\r\n    var size = dsoSize(p.mag, p.dim) || 9,\r\n        type = dsoShape(p.type);\r\n    if (d3.svg.symbolTypes.indexOf(type) !== -1) {\r\n      return d3.svg.symbol().type(type).size(size)();\r\n    } else {\r\n      return d3.svg.customSymbol().type(type).size(size)();\r\n    }\r\n  }\r\n\r\n  function dsoShape(type) {\r\n    if (!type || !has(cfg.dsos.symbols, type)) return \"circle\"; \r\n    else return cfg.dsos.symbols[type].shape; \r\n  }\r\n\r\n  function dsoSize(mag, dim) {\r\n    if (!mag || mag === 999) return Math.pow(parseInt(dim) * cfg.dsos.size * adapt / 7, 0.5); \r\n    return Math.pow(2 * cfg.dsos.size * adapt - mag, cfg.dsos.exponent);\r\n  }\r\n \r\n  function dsoName(d) {\r\n    //return p[cfg.dsos.namesType]; \r\n    var lang = cfg.dsos.namesType, id = d.id;\r\n    if (lang === \"desig\" || !has(dsonames, id)) return d.properties.desig;\r\n    return has(dsonames[id], lang) ? dsonames[id][lang] : d.properties.desig; \r\n  }\r\n\r\n  function dsoColor(p) {\r\n    if (cfg.dsos.colors === true) return svgStyle(cfg.dsos.symbols[p.type]);\r\n    return svgStyle(cfg.dsos.style);\r\n  }\r\n \r\n  function starDesignation(id) {\r\n    if (!has(starnames, id)) return \"\";\r\n    return starnames[id][cfg.stars.designationType]; \r\n  }\r\n\r\n  function starPropername(id) {\r\n    var lang = cfg.stars.propernameType;\r\n    if (!has(starnames, id)) return \"\";\r\n    return has(starnames[id], lang) ? starnames[id][lang] : starnames[id].name; \r\n  }\r\n\r\n  function starSize(mag) {\r\n    if (mag === null) return 0.1; \r\n    var d = cfg.stars.size * adapt * Math.exp(cfg.stars.exponent * (mag + 2));\r\n    return Math.max(d, 0.1);\r\n  }\r\n  \r\n  function starColor(bv) {\r\n    if (!cfg.stars.colors || isNaN(bv)) return \"\"; \r\n    return Math.round(bv*10).toString();\r\n  }\r\n  \r\n  function constName(d) { \r\n    return d.properties[cfg.constellations.namesType]; \r\n  }\r\n\r\n  function moonSymbol(p, r) { \r\n    var size = r ? r*r : 121;\r\n    return d3.svg.customSymbol().type(\"crescent\").size(size).ratio(p.age)();\r\n  }\r\n\r\n  function planetSymbol(p, r) { \r\n    var size = r ? r*r : planetSize(p.mag);\r\n    return d3.svg.symbol().type(\"circle\").size(size)();\r\n  }\r\n\r\n  function planetFont(s) {\r\n    var size = s.replace(/(^\\D*)(\\d+)(\\D.+$)/i,'$2');\r\n    size = Math.round(adapt * size);\r\n    return s.replace(/(^\\D*)(\\d+)(\\D.+$)/i,'$1' + size + '$3');\r\n  }\r\n\r\n  function planetSize(m) {\r\n    var mag = m || 2; \r\n    var r = 4 * adapt * Math.exp(-0.05 * (mag+2));\r\n    return Math.max(r, 2);\r\n  }\r\n\r\n  function createEntry(o) {\r\n    var res = {type: \"Feature\", \"id\":o.id, properties: {}, geometry:{}};\r\n    res.properties.name = o[cfg.planets.namesType];\r\n    if (cfg.planets.symbolType === \"symbol\" || cfg.planets.symbolType === \"letter\")\r\n      res.properties.symbol = cfg.planets.symbols[res.id][cfg.planets.symbolType];\r\n    res.properties.mag = o.ephemeris.mag || 10;\r\n    if (res.id === \"lun\") {\r\n      res.properties.age = o.ephemeris.age;\r\n      res.properties.phase = o.ephemeris.phase;\r\n    }\r\n    res.geometry.type = \"Point\";\r\n    res.geometry.coordinates = o.ephemeris.pos;\r\n    return res;\r\n  }\r\n\r\n  function createStyles() {\r\n    var res = \"\";\r\n    for (var key in styles) {\r\n      if (!has(styles, key)) continue;\r\n      res += \" .\" + key + stringifyStyle(styles[key]);\r\n    }\r\n    return \"/*\\u003c![CDATA[*/\\n\" + res + \"\\n/*]]\\u003e*/\";\r\n  }\r\n\r\n  function stringifyStyle(s) {\r\n    var res = \" {\";\r\n    for (var key in s) {\r\n      if (!has(s, key)) continue;\r\n      res += key + \":\" + s[key] + \"; \";\r\n    }\r\n    return res + \"} \";\r\n  }\r\n\r\n  q.await(function(error) {\r\n    if (error) throw error;\r\n    var svg = d3.select(\"#d3-celestial-svg svg\")\r\n      .attr(\"title\", \"D3-Celestial\")\r\n      .attr(\"version\", 1.1)\r\n      .attr(\"encoding\", \"UTF-8\")\r\n      .attr(\"xmlns\", \"http://www.w3.org/2000/svg\")\r\n      .attr(\"xmlns:xlink\", \"http://www.w3.org/1999/xlink\")\r\n      .attr(\"xmlns:sodipodi\", \"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\")\r\n      .attr(\"xmlns:inkscape\", \"http://www.inkscape.org/namespaces/inkscape\")\r\n      .attr(\"viewBox\", \" 0 0 \" + (m.width) + \" \" + (m.height));\r\n\r\n    defs.append(\"style\")\r\n     .attr(\"type\", \"text\\/css\")\r\n     .text(createStyles());\r\n    /*defs.append(\":sodipodi:namedview\")\r\n     .attr(\":inkscape:window-width\", m.width+200)\r\n     .attr(\":inkscape:window-height\", m.height)\r\n     .attr(\":inkscape:window-maximized\", \"1\");*/\r\n    if (fname) {\r\n      var blob = new Blob([svg.node().outerHTML], {type:\"image/svg+xml;charset=utf-8\"});\r\n    \r\n      var a = d3.select(\"body\").append(\"a\").node(); \r\n      a.download = fname || \"d3-celestial.svg\";\r\n      a.rel = \"noopener\";\r\n      a.href = URL.createObjectURL(blob);\r\n      a.click();\r\n      d3.select(a).remove();\r\n    } else if (exportCallback !== null) {\r\n      exportCallback(svg.node().outerHTML);\r\n    }\r\n    d3.select(\"#d3-celestial-svg\").remove();\r\n  });\r\n\r\n}\r\n\r\nvar customSvgSymbols = d3.map({\r\n  'ellipse': function(size, ratio) {\r\n    var s = Math.sqrt(size), \r\n        rx = s*0.666, ry = s/3;\r\n    return 'M' + (-rx) + ',' + (-ry) +\r\n    ' m' + (-rx) + ',0' +\r\n    ' a' + rx + ',' + ry + ' 0 1,0' + (rx * 2) + ',0' +\r\n    ' a' + rx + ',' + ry + ' 0 1,0' + (-(rx * 2)) + ',0';\r\n  },\r\n  'marker': function(size, ratio) {\r\n    var s =  size > 48 ? size / 4 : 12,\r\n        r = s/2, l = r-3;\r\n    return 'M ' + (-r) + ' 0 h ' + l + \r\n           ' M 0 ' + (-r) + ' v ' + l + \r\n           ' M ' + r + ' 0 h ' + (-l) +  \r\n           ' M 0 ' + r + ' v ' + (-l);\r\n  },\r\n  'cross-circle': function(size, ratio) {\r\n    var s = Math.sqrt(size), \r\n        r = s/2;\r\n    return 'M' + (-r) + ',' + (-r) +\r\n    ' m' + (-r) + ',0' +\r\n    ' a' + r + ',' + r + ' 0 1,0' + (r * 2) + ',0' +\r\n    ' a' + r + ',' + r + ' 0 1,0' + (-(r * 2)) + ',0' +\r\n    ' M' + (-r) + ' 0 h ' + (s) + \r\n    ' M 0 ' + (-r) + ' v ' + (s);\r\n        \r\n  },\r\n  'stroke-circle': function(size, ratio) {\r\n    var s = Math.sqrt(size), \r\n        r = s/2;\r\n    return 'M' + (-r) + ',' + (-r) +\r\n    ' m' + (-r) + ',0' +\r\n    ' a' + r + ',' + r + ' 0 1,0' + (r * 2) + ',0' +\r\n    ' a' + r + ',' + r + ' 0 1,0' + (-(r * 2)) + ',0' +\r\n    ' M' + (-s-2) + ',' + (-s-2) + ' l' + (s+4) + ',' + (s+4);\r\n\r\n  }, \r\n  \"crescent\": function(size, ratio) {\r\n    var s = Math.sqrt(size), \r\n        r = s/2,\r\n        ph = 0.5 * (1 - Math.cos(ratio)),\r\n        e = 1.6 * Math.abs(ph - 0.5) + 0.01,\r\n        dir = ratio > Math.PI ? 0 : 1,\r\n        termdir = Math.abs(ph) > 0.5 ? dir : Math.abs(dir-1); \r\n    return 'M ' + (-1) + ',' + (-1) +\r\n    ' m 1,' + (-r+1) + \r\n    ' a' + r + ',' + r + ' 0 1 ' + dir + ' 0,' + (r * 2) +\r\n    ' a' + (r*e) + ',' + r + ' 0 1 ' + termdir + ' 0,' + (-(r * 2)) + 'z';\r\n  } \r\n});\r\n\r\nd3.svg.customSymbol = function() {\r\n  var type, size = 64, ratio = d3.functor(1);\r\n  \r\n  function symbol(d,i) {\r\n    return customSvgSymbols.get(type.call(this,d,i))(size.call(this,d,i), ratio.call(this,d,i));\r\n  }\r\n  symbol.type = function(_) {\r\n    if (!arguments.length) return type; \r\n    type = d3.functor(_);\r\n    return symbol;\r\n  };\r\n  symbol.size = function(_) {\r\n    if (!arguments.length) return size; \r\n    size = d3.functor(_);\r\n    return symbol;\r\n  };\r\n  symbol.ratio = function(_) {\r\n    if (!arguments.length) return ratio; \r\n    ratio = d3.functor(_);\r\n    return symbol;\r\n  };\r\n  return symbol;\r\n};\r\n\r\nvar exportCallback = null;\r\n\r\nCelestial.exportSVG = function(callback) {\r\n  if (!callback) return;\r\n  exportCallback = callback;\r\n  exportSVG();\r\n};\r\nvar datetimepicker = function(cfg, callback) {\r\n  var date = new Date(), \r\n      tzFormat = d3.time.format(\"%Z\"),\r\n      tz = [{\"−12:00\":-720}, {\"−11:00\":-660}, {\"−10:00\":-600}, {\"−09:30\":-570}, {\"−09:00\":-540}, {\"−08:00\":-480}, {\"−07:00\":-420}, {\"−06:00\":-360}, {\"−05:00\":-300}, {\"−04:30\":-270}, {\"−04:00\":-240}, {\"−03:30\":-210}, {\"−03:00\":-180}, {\"−02:30\":-150}, {\"−02:00\":-120}, {\"−01:00\":-60}, {\"±00:00\":0}, {\"+01:00\":60}, {\"+02:00\":120}, {\"+03:00\":180}, {\"+03:30\":210}, {\"+04:00\":240}, {\"+04:30\":270}, {\"+05:00\":300}, {\"+05:30\":330}, {\"+05:45\":345}, {\"+06:00\":360}, {\"+06:30\":390}, {\"+07:00\":420}, {\"+08:00\":480}, {\"+08:30\":510}, {\"+08:45\":525}, {\"+09:00\":540}, {\"+09:30\":570}, {\"+10:00\":600}, {\"+10:30\":630}, {\"+11:00\":660}, {\"+12:00\":720}, {\"+12:45\":765}, {\"+13:00\":780}, {\"+14:00\":840}],\r\n      months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\r\n      days = [\"Su\", \"M\", \"Tu\", \"W\", \"Th\", \"F\", \"Sa\"],\r\n      years = getYears(date),\r\n      dateFormat = d3.time.format(\"%Y-%m-%d\"),\r\n      dtrange = cfg.daterange || [];\r\n    \r\n  var picker = d3.select(parentElement + \" ~ #celestial-form\").append(\"div\").attr(\"id\", \"celestial-date\");\r\n  nav(\"left\");\r\n  monSel();\r\n  yrSel();\r\n  nav(\"right\");\r\n  \r\n  var cal = picker.append(\"div\").attr(\"id\", \"cal\");\r\n\r\n  daySel();\r\n  \r\n  timeSel();\r\n  tzSel();\r\n  \r\n  function daySel() {\r\n    var mo = $form(\"mon\").value, yr = $form(\"yr\").value,\r\n        curdt = new Date(yr, mo, 1),\r\n        cal = d3.select(parentElement + \" ~ #celestial-form\").select(\"#cal\"),\r\n        today = new Date();\r\n    yr = parseInt(yr);   \r\n    mo = parseInt(mo);   \r\n    curdt.setDate(curdt.getDate() - curdt.getDay());\r\n    var nd = cal.node();\r\n    while (nd.firstChild) nd.removeChild(nd.firstChild);\r\n    \r\n    for (var i=0; i<7; i++) {\r\n      cal.append(\"div\").classed({\"date\": true, \"weekday\": true}).html(days[i]);\r\n    }\r\n    for (i=0; i<42; i++) {\r\n      var curmon = curdt.getMonth(), curday = curdt.getDay(), curid = dateFormat(curdt);\r\n      cal.append(\"div\").classed({\r\n        \"date\": true, \r\n        \"grey\": curmon !== mo,\r\n        \"weekend\": curmon === mo && (curday === 0 || curday === 6),\r\n        \"today\": dateDiff(curdt, today) === 0,\r\n        \"selected\": dateDiff(curdt, date) === 0\r\n      }).attr(\"id\", curid)\r\n      .on(\"click\", pick)\r\n      .html(curdt.getDate().toString());\r\n      \r\n      curdt.setDate(curdt.getDate()+1);\r\n    }\r\n  }\r\n\r\n  function yrSel() {     \r\n    picker.append(\"select\").attr(\"title\", \"Year\").attr(\"id\", \"yr\").on(\"change\", daySel);   \r\n    \r\n    fillYrSel();\r\n  }\r\n\r\n  function fillYrSel() { \r\n    var sel = d3.select(parentElement + \" ~ #celestial-form\").select(\"select#yr\"),\r\n        year = date.getFullYear(),\r\n        selected = 0,\r\n        years = getYears(date);\r\n        \r\n    sel.selectAll(\"*\").remove();    \r\n    sel.selectAll('option').data(years).enter().append('option')\r\n       .text(function (d, i) { \r\n         if (d === year) selected = i; \r\n         return d.toString(); \r\n       });\r\n    sel.property(\"selectedIndex\", selected);\r\n  }\r\n  \r\n  function monSel() { \r\n    var sel = picker.append(\"select\").attr(\"title\", \"Month\").attr(\"id\", \"mon\").on(\"change\", daySel),\r\n        selected = 0,\r\n        month = date.getMonth();\r\n    \r\n    sel.selectAll('option').data(months).enter().append('option')\r\n       .attr(\"value\", function (d, i) { \r\n         if (i === month) selected = i; \r\n         return i; \r\n       })\r\n       .text(function (d) { return d; });\r\n    sel.property(\"selectedIndex\", selected);\r\n  }\r\n  \r\n  function nav(dir) {\r\n    var lnk = picker.append(\"div\").attr(\"id\", dir).on(\"click\", function () {\r\n      var mon = $form(\"mon\"), yr = $form(\"yr\");\r\n      \r\n      if (dir === \"left\") {\r\n        if (mon.selectedIndex === 0) {\r\n          mon.selectedIndex = 11;\r\n          yr.selectedIndex--;\r\n        } else mon.selectedIndex--;\r\n      } else {\r\n        if (mon.selectedIndex === 11) {\r\n          mon.selectedIndex = 0;\r\n          yr.selectedIndex++;\r\n        } else mon.selectedIndex++;\r\n      }\r\n      daySel();\r\n    });\r\n  }\r\n\r\n  function timeSel() { \r\n    picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"hr\").attr(\"title\", \"Hours\").attr(\"max\", \"24\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getHours()).on(\"change\", function () { if (testNumber(this) === true) pick(); });\r\n\r\n    picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"min\").attr(\"title\", \"Minutes\").attr(\"max\", \"60\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getMinutes()).on(\"change\", function () { if (testNumber(this) === true) pick(); });\r\n    \r\n    picker.append(\"input\").attr(\"type\", \"number\").attr(\"id\", \"sec\").attr(\"title\", \"Seconds\").attr(\"max\", \"60\").attr(\"min\", \"-1\").attr(\"step\", \"1\").attr(\"value\", date.getSeconds()).on(\"change\", function () { if (testNumber(this) === true) pick(); });\r\n  }\r\n  \r\n  function tzSel() { \r\n    var sel = picker.append(\"select\").attr(\"title\", \"Time zone offset from UTC\").attr(\"id\", \"tz\").on(\"change\", pick),\r\n        selected = 15,\r\n        tzOffset = -date.getTimezoneOffset();\r\n    sel.selectAll('option').data(tz).enter().append('option')\r\n       .attr(\"value\", function (d, i) { \r\n         var k = Object.keys(d)[0];\r\n         if (d[k] === tzOffset) selected = i; \r\n         return d[k]; \r\n       })\r\n       .text(function (d) { return Object.keys(d)[0]; });\r\n    sel.property(\"selectedIndex\", selected);\r\n  }\r\n  \r\n  function getYears(dt) {\r\n    var r = getDateRange(dt.getFullYear()), res = [];\r\n    for (var i = r[0]; i <= r[1]; i++) res.push(i);\r\n    return res;\r\n  }  \r\n  \r\n  function getDateRange(yr) {\r\n    if (!dtrange || dtrange.length < 1) return [yr - 10, yr + 10];\r\n    \r\n    if (dtrange.length === 1 && isNumber(dtrange[0])) {\r\n      if (dtrange[0] >= 100) return [dtrange[0] - 10, dtrange[0] + 10];\r\n      else return [yr - dtrange[0], yr + dtrange[0]];\r\n    }\r\n    if (dtrange.length === 2 && isNumber(dtrange[0])&& isNumber(dtrange[1])) {\r\n      if (dtrange[1] >= 100) return [dtrange[0], dtrange[1]];\r\n      else return [dtrange[0] - dtrange[1], dtrange[0] + dtrange[1]];\r\n    }      \r\n    return [yr - 10, yr + 10];\r\n  }\r\n\r\n  function select(id, val) {\r\n    var sel = $form(id);\r\n    for (var i=0; i<sel.childNodes.length; i++) {\r\n      if (sel.childNodes[i].value == val) {\r\n        sel.selectedIndex = i;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  \r\n  function set(dt) {\r\n     if (dt) date.setTime(dt.valueOf());\r\n     \r\n     select(\"yr\", date.getFullYear());\r\n     select(\"mon\", date.getMonth());\r\n     daySel();\r\n     $form(\"hr\").value = date.getHours();\r\n     $form(\"min\").value = date.getMinutes();\r\n     $form(\"sec\").value = date.getSeconds();\r\n  } \r\n  \r\n  this.show = function(dt, tz) {\r\n    var nd = $form(\"celestial-date\"),\r\n        src = $form(\"datepick\"),\r\n        left = src.offsetLeft + src.offsetWidth - nd.offsetWidth,\r\n        top = src.offsetTop - nd.offsetHeight - 1;\r\n  \r\n    if (nd.offsetTop === -9999) {\r\n      date.setTime(dt.valueOf());\r\n      select(\"tz\", tz);\r\n      set();\r\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#celestial-date\").style({\"top\": px(top), \"left\": px(left), \"opacity\": 1});  \r\n      d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\", true);\r\n    } else {\r\n      vanish();\r\n    }\r\n  };\r\n  \r\n  this.isVisible = function () {\r\n    if (!document.getElementById(\"datepick\")) return false;\r\n    return d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\") === true;\r\n  };\r\n\r\n  this.hide = function () {\r\n    vanish();\r\n  };\r\n  \r\n  function vanish() {\r\n    d3.select(parentElement + \" ~ #celestial-form\").select(\"#celestial-date\").style(\"opacity\", 0);\r\n    d3.select(\"#error\").style( {top:\"-9999px\", left:\"-9999px\", opacity:0} ); \r\n    d3.select(parentElement + \" ~ #celestial-form\").select(\"#datepick\").classed(\"active\", false);\r\n    setTimeout(function () { $form(\"celestial-date\").style.top = px(-9999); }, 600);    \r\n  }\r\n  \r\n  function pick() {\r\n    var h = $form(\"hr\").value, m = $form(\"min\").value,\r\n        s = $form(\"sec\").value, tz = $form(\"tz\").value;\r\n        \r\n    if (this.id && this.id.search(/^\\d/) !== -1) {\r\n      date = dateFormat.parse(this.id); \r\n    }\r\n    fillYrSel();\r\n    \r\n    date.setHours(h, m, s);\r\n    set();\r\n    \r\n    callback(date, tz);\r\n  } \r\n  \r\n  \r\n};// Copyright 2014, Jason Davies, http://www.jasondavies.com\r\n// See LICENSE.txt for details.\r\n(function() {\r\n\r\nvar radians = Math.PI / 180,\r\n    degrees = 180 / Math.PI;\r\n\r\n// TODO make incremental rotate optional\r\n\r\nd3.geo.zoom = function() {\r\n  var projection,\r\n      duration;\r\n\r\n  var zoomPoint,\r\n      zooming = 0,\r\n      event = d3_eventDispatch(zoom, \"zoomstart\", \"zoom\", \"zoomend\"),\r\n      zoom = d3.behavior.zoom()\r\n        .on(\"zoomstart\", function() {\r\n          var mouse0 = d3.mouse(this),\r\n              rotate = quaternionFromEuler(projection.rotate()),\r\n              point = position(projection, mouse0);\r\n          if (point) zoomPoint = point;\r\n\r\n          zoomOn.call(zoom, \"zoom\", function() {\r\n                projection.scale(view.k = d3.event.scale);\r\n                var mouse1 = d3.mouse(this),\r\n                    between = rotateBetween(zoomPoint, position(projection, mouse1));\r\n                projection.rotate(view.r = eulerFromQuaternion(rotate = between\r\n                    ? multiply(rotate, between)\r\n                    : multiply(bank(projection, mouse0, mouse1), rotate)));\r\n                mouse0 = mouse1;\r\n                zoomed(event.of(this, arguments));\r\n              });\r\n          zoomstarted(event.of(this, arguments));\r\n        })\r\n        .on(\"zoomend\", function() {\r\n          zoomOn.call(zoom, \"zoom\", null);\r\n          zoomended(event.of(this, arguments));\r\n        }),\r\n      zoomOn = zoom.on,\r\n      view = {r: [0, 0, 0], k: 1};\r\n\r\n  zoom.rotateTo = function(location) {\r\n    var between = rotateBetween(cartesian(location), cartesian([-view.r[0], -view.r[1]]));\r\n    return eulerFromQuaternion(multiply(quaternionFromEuler(view.r), between));\r\n  };\r\n\r\n  zoom.projection = function(_) {\r\n    if (!arguments.length) return projection;\r\n    projection = _;\r\n    view = {r: projection.rotate(), k: projection.scale()};\r\n    return zoom.scale(view.k);\r\n  };\r\n\r\n  zoom.duration = function(_) {\r\n    return arguments.length ? (duration = _, zoom) : duration;\r\n  };\r\n\r\n  zoom.event = function(g) {\r\n    g.each(function() {\r\n      var g = d3.select(this),\r\n          dispatch = event.of(this, arguments),\r\n          view1 = view,\r\n          transition = d3.transition(g);\r\n     \r\n      if (transition !== g) {\r\n        transition\r\n            .each(\"start.zoom\", function() {\r\n              if (this.__chart__) { // pre-transition state\r\n                view = this.__chart__;\r\n                if (!view.hasOwnProperty(\"r\")) view.r = projection.rotate();\r\n              } \r\n              projection.rotate(view.r).scale(view.k);\r\n              zoomstarted(dispatch);\r\n            })\r\n            .tween(\"zoom:zoom\", function() {\r\n              var width = zoom.size()[0],\r\n                  i = interpolateBetween(quaternionFromEuler(view.r), quaternionFromEuler(view1.r)),\r\n                  d = d3.geo.distance(view.r, view1.r),\r\n                  smooth = d3.interpolateZoom([0, 0, width / view.k], [d, 0, width / view1.k]);\r\n              if (duration) transition.duration(duration(smooth.duration * .001)); // see https://github.com/mbostock/d3/pull/2045\r\n              return function(t) {\r\n                var uw = smooth(t);\r\n                this.__chart__ = view = {r: eulerFromQuaternion(i(uw[0] / d)), k: width / uw[2]};\r\n                projection.rotate(view.r).scale(view.k);\r\n                zoom.scale(view.k);\r\n                zoomed(dispatch);\r\n              };\r\n            })\r\n            .each(\"end.zoom\", function() {\r\n              zoomended(dispatch);\r\n            });\r\n        try { // see https://github.com/mbostock/d3/pull/1983\r\n          transition\r\n              .each(\"interrupt.zoom\", function() {\r\n                zoomended(dispatch);\r\n              });\r\n        } catch (e) { console.log(e); }\r\n      } else {\r\n        this.__chart__ = view;\r\n        zoomstarted(dispatch);\r\n        zoomed(dispatch);\r\n        zoomended(dispatch);\r\n      }\r\n    });\r\n  };\r\n\r\n  function zoomstarted(dispatch) {\r\n    if (!zooming++) dispatch({type: \"zoomstart\"});\r\n  }\r\n\r\n  function zoomed(dispatch) {\r\n    dispatch({type: \"zoom\"});\r\n  }\r\n\r\n  function zoomended(dispatch) {\r\n    if (!--zooming) dispatch({type: \"zoomend\"});\r\n  }\r\n\r\n  return d3.rebind(zoom, event, \"on\");\r\n};\r\n\r\nfunction bank(projection, p0, p1) {\r\n  var t = projection.translate(),\r\n      angle = Math.atan2(p0[1] - t[1], p0[0] - t[0]) - Math.atan2(p1[1] - t[1], p1[0] - t[0]);\r\n  return [Math.cos(angle / 2), 0, 0, Math.sin(angle / 2)];\r\n}\r\n\r\nfunction position(projection, point) {\r\n  var spherical = projection.invert(point);\r\n  return spherical && isFinite(spherical[0]) && isFinite(spherical[1]) && cartesian(spherical);\r\n}\r\n\r\nfunction quaternionFromEuler(euler) {\r\n  var λ = .5 * euler[0] * radians,\r\n      φ = .5 * euler[1] * radians,\r\n      γ = .5 * euler[2] * radians,\r\n      sinλ = Math.sin(λ), cosλ = Math.cos(λ),\r\n      sinφ = Math.sin(φ), cosφ = Math.cos(φ),\r\n      sinγ = Math.sin(γ), cosγ = Math.cos(γ);\r\n  return [\r\n    cosλ * cosφ * cosγ + sinλ * sinφ * sinγ,\r\n    sinλ * cosφ * cosγ - cosλ * sinφ * sinγ,\r\n    cosλ * sinφ * cosγ + sinλ * cosφ * sinγ,\r\n    cosλ * cosφ * sinγ - sinλ * sinφ * cosγ\r\n  ];\r\n}\r\n\r\nfunction multiply(a, b) {\r\n  var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],\r\n      b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];\r\n  return [\r\n    a0 * b0 - a1 * b1 - a2 * b2 - a3 * b3,\r\n    a0 * b1 + a1 * b0 + a2 * b3 - a3 * b2,\r\n    a0 * b2 - a1 * b3 + a2 * b0 + a3 * b1,\r\n    a0 * b3 + a1 * b2 - a2 * b1 + a3 * b0\r\n  ];\r\n}\r\n\r\nfunction rotateBetween(a, b) {\r\n  if (!a || !b) return;\r\n  var axis = cross(a, b),\r\n      norm = Math.sqrt(dot(axis, axis)),\r\n      halfγ = .5 * Math.acos(Math.max(-1, Math.min(1, dot(a, b)))),\r\n      k = Math.sin(halfγ) / norm;\r\n  return norm && [Math.cos(halfγ), axis[2] * k, -axis[1] * k, axis[0] * k];\r\n}\r\n\r\n// Interpolate between two quaternions (slerp).\r\nfunction interpolateBetween(a, b) {\r\n  var d = Math.max(-1, Math.min(1, dot(a, b))),\r\n      s = d < 0 ? -1 : 1,\r\n      θ = Math.acos(s * d),\r\n      sinθ = Math.sin(θ);\r\n  return sinθ ? function(t) {\r\n    var A = s * Math.sin((1 - t) * θ) / sinθ,\r\n        B = Math.sin(t * θ) / sinθ;\r\n    return [\r\n      a[0] * A + b[0] * B,\r\n      a[1] * A + b[1] * B,\r\n      a[2] * A + b[2] * B,\r\n      a[3] * A + b[3] * B\r\n    ];\r\n  } : function() { return a; };\r\n}\r\n\r\nfunction eulerFromQuaternion(q) {\r\n  return [\r\n    Math.atan2(2 * (q[0] * q[1] + q[2] * q[3]), 1 - 2 * (q[1] * q[1] + q[2] * q[2])) * degrees,\r\n    Math.asin(Math.max(-1, Math.min(1, 2 * (q[0] * q[2] - q[3] * q[1])))) * degrees,\r\n    Math.atan2(2 * (q[0] * q[3] + q[1] * q[2]), 1 - 2 * (q[2] * q[2] + q[3] * q[3])) * degrees\r\n  ];\r\n}\r\n\r\nfunction cartesian(spherical) {\r\n  var λ = spherical[0] * radians,\r\n      φ = spherical[1] * radians,\r\n      cosφ = Math.cos(φ);\r\n  return [\r\n    cosφ * Math.cos(λ),\r\n    cosφ * Math.sin(λ),\r\n    Math.sin(φ)\r\n  ];\r\n}\r\n\r\nfunction dot(a, b) {\r\n  for (var i = 0, n = a.length, s = 0; i < n; ++i) s += a[i] * b[i];\r\n  return s;\r\n}\r\n\r\nfunction cross(a, b) {\r\n  return [\r\n    a[1] * b[2] - a[2] * b[1],\r\n    a[2] * b[0] - a[0] * b[2],\r\n    a[0] * b[1] - a[1] * b[0]\r\n  ];\r\n}\r\n\r\n// Like d3.dispatch, but for custom events abstracting native UI events. These\r\n// events have a target component (such as a brush), a target element (such as\r\n// the svg:g element containing the brush) and the standard arguments `d` (the\r\n// target element's data) and `i` (the selection index of the target element).\r\nfunction d3_eventDispatch(target) {\r\n  var i = 0,\r\n      n = arguments.length,\r\n      argumentz = [];\r\n\r\n  while (++i < n) argumentz.push(arguments[i]);\r\n\r\n  var dispatch = d3.dispatch.apply(null, argumentz);\r\n\r\n  // Creates a dispatch context for the specified `thiz` (typically, the target\r\n  // DOM element that received the source event) and `argumentz` (typically, the\r\n  // data `d` and index `i` of the target element). The returned function can be\r\n  // used to dispatch an event to any registered listeners; the function takes a\r\n  // single argument as input, being the event to dispatch. The event must have\r\n  // a \"type\" attribute which corresponds to a type registered in the\r\n  // constructor. This context will automatically populate the \"sourceEvent\" and\r\n  // \"target\" attributes of the event, as well as setting the `d3.event` global\r\n  // for the duration of the notification.\r\n  dispatch.of = function(thiz, argumentz) {\r\n    return function(e1) {\r\n      try {\r\n        var e0 =\r\n        e1.sourceEvent = d3.event;\r\n        e1.target = target;\r\n        d3.event = e1;\r\n        dispatch[e1.type].apply(thiz, argumentz);\r\n      } finally {\r\n        d3.event = e0;\r\n      }\r\n    };\r\n  };\r\n\r\n  return dispatch;\r\n}\r\n\r\n})();\r\n// https://d3js.org/d3-queue/ Version 3.0.7. Copyright 2017 Mike Bostock.\r\n(function (global, factory) {\r\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\r\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\r\n\t(factory((global.d3 = global.d3 || {})));\r\n}(this, (function (exports) { 'use strict';\r\n\r\nvar slice = [].slice;\r\n\r\nvar noabort = {};\r\n\r\nfunction Queue(size) {\r\n  this._size = size;\r\n  this._call =\r\n  this._error = null;\r\n  this._tasks = [];\r\n  this._data = [];\r\n  this._waiting =\r\n  this._active =\r\n  this._ended =\r\n  this._start = 0; // inside a synchronous task callback?\r\n}\r\n\r\nQueue.prototype = queue.prototype = {\r\n  constructor: Queue,\r\n  defer: function(callback) {\r\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\r\n    if (this._call) throw new Error(\"defer after await\");\r\n    if (this._error != null) return this;\r\n    var t = slice.call(arguments, 1);\r\n    t.push(callback);\r\n    ++this._waiting, this._tasks.push(t);\r\n    poke(this);\r\n    return this;\r\n  },\r\n  abort: function() {\r\n    if (this._error == null) abort(this, new Error(\"abort\"));\r\n    return this;\r\n  },\r\n  await: function(callback) {\r\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\r\n    if (this._call) throw new Error(\"multiple await\");\r\n    this._call = function(error, results) { callback.apply(null, [error].concat(results)); };\r\n    maybeNotify(this);\r\n    return this;\r\n  },\r\n  awaitAll: function(callback) {\r\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\r\n    if (this._call) throw new Error(\"multiple await\");\r\n    this._call = callback;\r\n    maybeNotify(this);\r\n    return this;\r\n  }\r\n};\r\n\r\nfunction poke(q) {\r\n  if (!q._start) {\r\n    try { start(q); } // let the current task complete\r\n    catch (e) {\r\n      if (q._tasks[q._ended + q._active - 1]) abort(q, e); // task errored synchronously\r\n      else if (!q._data) throw e; // await callback errored synchronously\r\n    }\r\n  }\r\n}\r\n\r\nfunction start(q) {\r\n  while (q._start = q._waiting && q._active < q._size) {\r\n    var i = q._ended + q._active,\r\n        t = q._tasks[i],\r\n        j = t.length - 1,\r\n        c = t[j];\r\n    t[j] = end(q, i);\r\n    --q._waiting, ++q._active;\r\n    t = c.apply(null, t);\r\n    if (!q._tasks[i]) continue; // task finished synchronously\r\n    q._tasks[i] = t || noabort;\r\n  }\r\n}\r\n\r\nfunction end(q, i) {\r\n  return function(e, r) {\r\n    if (!q._tasks[i]) return; // ignore multiple callbacks\r\n    --q._active, ++q._ended;\r\n    q._tasks[i] = null;\r\n    if (q._error != null) return; // ignore secondary errors\r\n    if (e != null) {\r\n      abort(q, e);\r\n    } else {\r\n      q._data[i] = r;\r\n      if (q._waiting) poke(q);\r\n      else maybeNotify(q);\r\n    }\r\n  };\r\n}\r\n\r\nfunction abort(q, e) {\r\n  var i = q._tasks.length, t;\r\n  q._error = e; // ignore active callbacks\r\n  q._data = undefined; // allow gc\r\n  q._waiting = NaN; // prevent starting\r\n\r\n  while (--i >= 0) {\r\n    if (t = q._tasks[i]) {\r\n      q._tasks[i] = null;\r\n      if (t.abort) {\r\n        try { t.abort(); }\r\n        catch (e) { /* ignore */ }\r\n      }\r\n    }\r\n  }\r\n\r\n  q._active = NaN; // allow notification\r\n  maybeNotify(q);\r\n}\r\n\r\nfunction maybeNotify(q) {\r\n  if (!q._active && q._call) {\r\n    var d = q._data;\r\n    q._data = undefined; // allow gc\r\n    q._call(q._error, d);\r\n  }\r\n}\r\n\r\nfunction queue(concurrency) {\r\n  if (concurrency == null) concurrency = Infinity;\r\n  else if (!((concurrency = +concurrency) >= 1)) throw new Error(\"invalid concurrency\");\r\n  return new Queue(concurrency);\r\n}\r\n\r\nexports.queue = queue;\r\nd3.queue = queue;\r\n\r\nObject.defineProperty(exports, '__esModule', { value: true });\r\n\r\n})));\r\nthis.Celestial = Celestial;\n})();\n;!function() {\r\n  var d3 = {\r\n    version: \"3.5.17\"\r\n  };\r\n  var d3_arraySlice = [].slice, d3_array = function(list) {\r\n    return d3_arraySlice.call(list);\r\n  };\r\n  var d3_document = this.document;\r\n  function d3_documentElement(node) {\r\n    return node && (node.ownerDocument || node.document || node).documentElement;\r\n  }\r\n  function d3_window(node) {\r\n    return node && (node.ownerDocument && node.ownerDocument.defaultView || node.document && node || node.defaultView);\r\n  }\r\n  if (d3_document) {\r\n    try {\r\n      d3_array(d3_document.documentElement.childNodes)[0].nodeType;\r\n    } catch (e) {\r\n      d3_array = function(list) {\r\n        var i = list.length, array = new Array(i);\r\n        while (i--) array[i] = list[i];\r\n        return array;\r\n      };\r\n    }\r\n  }\r\n  if (!Date.now) Date.now = function() {\r\n    return +new Date();\r\n  };\r\n  if (d3_document) {\r\n    try {\r\n      d3_document.createElement(\"DIV\").style.setProperty(\"opacity\", 0, \"\");\r\n    } catch (error) {\r\n      var d3_element_prototype = this.Element.prototype, d3_element_setAttribute = d3_element_prototype.setAttribute, d3_element_setAttributeNS = d3_element_prototype.setAttributeNS, d3_style_prototype = this.CSSStyleDeclaration.prototype, d3_style_setProperty = d3_style_prototype.setProperty;\r\n      d3_element_prototype.setAttribute = function(name, value) {\r\n        d3_element_setAttribute.call(this, name, value + \"\");\r\n      };\r\n      d3_element_prototype.setAttributeNS = function(space, local, value) {\r\n        d3_element_setAttributeNS.call(this, space, local, value + \"\");\r\n      };\r\n      d3_style_prototype.setProperty = function(name, value, priority) {\r\n        d3_style_setProperty.call(this, name, value + \"\", priority);\r\n      };\r\n    }\r\n  }\r\n  d3.ascending = d3_ascending;\r\n  function d3_ascending(a, b) {\r\n    return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\r\n  }\r\n  d3.descending = function(a, b) {\r\n    return b < a ? -1 : b > a ? 1 : b >= a ? 0 : NaN;\r\n  };\r\n  d3.min = function(array, f) {\r\n    var i = -1, n = array.length, a, b;\r\n    if (arguments.length === 1) {\r\n      while (++i < n) if ((b = array[i]) != null && b >= b) {\r\n        a = b;\r\n        break;\r\n      }\r\n      while (++i < n) if ((b = array[i]) != null && a > b) a = b;\r\n    } else {\r\n      while (++i < n) if ((b = f.call(array, array[i], i)) != null && b >= b) {\r\n        a = b;\r\n        break;\r\n      }\r\n      while (++i < n) if ((b = f.call(array, array[i], i)) != null && a > b) a = b;\r\n    }\r\n    return a;\r\n  };\r\n  d3.max = function(array, f) {\r\n    var i = -1, n = array.length, a, b;\r\n    if (arguments.length === 1) {\r\n      while (++i < n) if ((b = array[i]) != null && b >= b) {\r\n        a = b;\r\n        break;\r\n      }\r\n      while (++i < n) if ((b = array[i]) != null && b > a) a = b;\r\n    } else {\r\n      while (++i < n) if ((b = f.call(array, array[i], i)) != null && b >= b) {\r\n        a = b;\r\n        break;\r\n      }\r\n      while (++i < n) if ((b = f.call(array, array[i], i)) != null && b > a) a = b;\r\n    }\r\n    return a;\r\n  };\r\n  d3.extent = function(array, f) {\r\n    var i = -1, n = array.length, a, b, c;\r\n    if (arguments.length === 1) {\r\n      while (++i < n) if ((b = array[i]) != null && b >= b) {\r\n        a = c = b;\r\n        break;\r\n      }\r\n      while (++i < n) if ((b = array[i]) != null) {\r\n        if (a > b) a = b;\r\n        if (c < b) c = b;\r\n      }\r\n    } else {\r\n      while (++i < n) if ((b = f.call(array, array[i], i)) != null && b >= b) {\r\n        a = c = b;\r\n        break;\r\n      }\r\n      while (++i < n) if ((b = f.call(array, array[i], i)) != null) {\r\n        if (a > b) a = b;\r\n        if (c < b) c = b;\r\n      }\r\n    }\r\n    return [ a, c ];\r\n  };\r\n  function d3_number(x) {\r\n    return x === null ? NaN : +x;\r\n  }\r\n  function d3_numeric(x) {\r\n    return !isNaN(x);\r\n  }\r\n  d3.sum = function(array, f) {\r\n    var s = 0, n = array.length, a, i = -1;\r\n    if (arguments.length === 1) {\r\n      while (++i < n) if (d3_numeric(a = +array[i])) s += a;\r\n    } else {\r\n      while (++i < n) if (d3_numeric(a = +f.call(array, array[i], i))) s += a;\r\n    }\r\n    return s;\r\n  };\r\n  d3.mean = function(array, f) {\r\n    var s = 0, n = array.length, a, i = -1, j = n;\r\n    if (arguments.length === 1) {\r\n      while (++i < n) if (d3_numeric(a = d3_number(array[i]))) s += a; else --j;\r\n    } else {\r\n      while (++i < n) if (d3_numeric(a = d3_number(f.call(array, array[i], i)))) s += a; else --j;\r\n    }\r\n    if (j) return s / j;\r\n  };\r\n  d3.quantile = function(values, p) {\r\n    var H = (values.length - 1) * p + 1, h = Math.floor(H), v = +values[h - 1], e = H - h;\r\n    return e ? v + e * (values[h] - v) : v;\r\n  };\r\n  d3.median = function(array, f) {\r\n    var numbers = [], n = array.length, a, i = -1;\r\n    if (arguments.length === 1) {\r\n      while (++i < n) if (d3_numeric(a = d3_number(array[i]))) numbers.push(a);\r\n    } else {\r\n      while (++i < n) if (d3_numeric(a = d3_number(f.call(array, array[i], i)))) numbers.push(a);\r\n    }\r\n    if (numbers.length) return d3.quantile(numbers.sort(d3_ascending), .5);\r\n  };\r\n  d3.variance = function(array, f) {\r\n    var n = array.length, m = 0, a, d, s = 0, i = -1, j = 0;\r\n    if (arguments.length === 1) {\r\n      while (++i < n) {\r\n        if (d3_numeric(a = d3_number(array[i]))) {\r\n          d = a - m;\r\n          m += d / ++j;\r\n          s += d * (a - m);\r\n        }\r\n      }\r\n    } else {\r\n      while (++i < n) {\r\n        if (d3_numeric(a = d3_number(f.call(array, array[i], i)))) {\r\n          d = a - m;\r\n          m += d / ++j;\r\n          s += d * (a - m);\r\n        }\r\n      }\r\n    }\r\n    if (j > 1) return s / (j - 1);\r\n  };\r\n  d3.deviation = function() {\r\n    var v = d3.variance.apply(this, arguments);\r\n    return v ? Math.sqrt(v) : v;\r\n  };\r\n  function d3_bisector(compare) {\r\n    return {\r\n      left: function(a, x, lo, hi) {\r\n        if (arguments.length < 3) lo = 0;\r\n        if (arguments.length < 4) hi = a.length;\r\n        while (lo < hi) {\r\n          var mid = lo + hi >>> 1;\r\n          if (compare(a[mid], x) < 0) lo = mid + 1; else hi = mid;\r\n        }\r\n        return lo;\r\n      },\r\n      right: function(a, x, lo, hi) {\r\n        if (arguments.length < 3) lo = 0;\r\n        if (arguments.length < 4) hi = a.length;\r\n        while (lo < hi) {\r\n          var mid = lo + hi >>> 1;\r\n          if (compare(a[mid], x) > 0) hi = mid; else lo = mid + 1;\r\n        }\r\n        return lo;\r\n      }\r\n    };\r\n  }\r\n  var d3_bisect = d3_bisector(d3_ascending);\r\n  d3.bisectLeft = d3_bisect.left;\r\n  d3.bisect = d3.bisectRight = d3_bisect.right;\r\n  d3.bisector = function(f) {\r\n    return d3_bisector(f.length === 1 ? function(d, x) {\r\n      return d3_ascending(f(d), x);\r\n    } : f);\r\n  };\r\n  d3.shuffle = function(array, i0, i1) {\r\n    if ((m = arguments.length) < 3) {\r\n      i1 = array.length;\r\n      if (m < 2) i0 = 0;\r\n    }\r\n    var m = i1 - i0, t, i;\r\n    while (m) {\r\n      i = Math.random() * m-- | 0;\r\n      t = array[m + i0], array[m + i0] = array[i + i0], array[i + i0] = t;\r\n    }\r\n    return array;\r\n  };\r\n  d3.permute = function(array, indexes) {\r\n    var i = indexes.length, permutes = new Array(i);\r\n    while (i--) permutes[i] = array[indexes[i]];\r\n    return permutes;\r\n  };\r\n  d3.pairs = function(array) {\r\n    var i = 0, n = array.length - 1, p0, p1 = array[0], pairs = new Array(n < 0 ? 0 : n);\r\n    while (i < n) pairs[i] = [ p0 = p1, p1 = array[++i] ];\r\n    return pairs;\r\n  };\r\n  d3.transpose = function(matrix) {\r\n    if (!(n = matrix.length)) return [];\r\n    for (var i = -1, m = d3.min(matrix, d3_transposeLength), transpose = new Array(m); ++i < m; ) {\r\n      for (var j = -1, n, row = transpose[i] = new Array(n); ++j < n; ) {\r\n        row[j] = matrix[j][i];\r\n      }\r\n    }\r\n    return transpose;\r\n  };\r\n  function d3_transposeLength(d) {\r\n    return d.length;\r\n  }\r\n  d3.zip = function() {\r\n    return d3.transpose(arguments);\r\n  };\r\n  d3.keys = function(map) {\r\n    var keys = [];\r\n    for (var key in map) keys.push(key);\r\n    return keys;\r\n  };\r\n  d3.values = function(map) {\r\n    var values = [];\r\n    for (var key in map) values.push(map[key]);\r\n    return values;\r\n  };\r\n  d3.entries = function(map) {\r\n    var entries = [];\r\n    for (var key in map) entries.push({\r\n      key: key,\r\n      value: map[key]\r\n    });\r\n    return entries;\r\n  };\r\n  d3.merge = function(arrays) {\r\n    var n = arrays.length, m, i = -1, j = 0, merged, array;\r\n    while (++i < n) j += arrays[i].length;\r\n    merged = new Array(j);\r\n    while (--n >= 0) {\r\n      array = arrays[n];\r\n      m = array.length;\r\n      while (--m >= 0) {\r\n        merged[--j] = array[m];\r\n      }\r\n    }\r\n    return merged;\r\n  };\r\n  var abs = Math.abs;\r\n  d3.range = function(start, stop, step) {\r\n    if (arguments.length < 3) {\r\n      step = 1;\r\n      if (arguments.length < 2) {\r\n        stop = start;\r\n        start = 0;\r\n      }\r\n    }\r\n    if ((stop - start) / step === Infinity) throw new Error(\"infinite range\");\r\n    var range = [], k = d3_range_integerScale(abs(step)), i = -1, j;\r\n    start *= k, stop *= k, step *= k;\r\n    if (step < 0) while ((j = start + step * ++i) > stop) range.push(j / k); else while ((j = start + step * ++i) < stop) range.push(j / k);\r\n    return range;\r\n  };\r\n  function d3_range_integerScale(x) {\r\n    var k = 1;\r\n    while (x * k % 1) k *= 10;\r\n    return k;\r\n  }\r\n  function d3_class(ctor, properties) {\r\n    for (var key in properties) {\r\n      Object.defineProperty(ctor.prototype, key, {\r\n        value: properties[key],\r\n        enumerable: false\r\n      });\r\n    }\r\n  }\r\n  d3.map = function(object, f) {\r\n    var map = new d3_Map();\r\n    if (object instanceof d3_Map) {\r\n      object.forEach(function(key, value) {\r\n        map.set(key, value);\r\n      });\r\n    } else if (Array.isArray(object)) {\r\n      var i = -1, n = object.length, o;\r\n      if (arguments.length === 1) while (++i < n) map.set(i, object[i]); else while (++i < n) map.set(f.call(object, o = object[i], i), o);\r\n    } else {\r\n      for (var key in object) map.set(key, object[key]);\r\n    }\r\n    return map;\r\n  };\r\n  function d3_Map() {\r\n    this._ = Object.create(null);\r\n  }\r\n  var d3_map_proto = \"__proto__\", d3_map_zero = \"\\x00\";\r\n  d3_class(d3_Map, {\r\n    has: d3_map_has,\r\n    get: function(key) {\r\n      return this._[d3_map_escape(key)];\r\n    },\r\n    set: function(key, value) {\r\n      return this._[d3_map_escape(key)] = value;\r\n    },\r\n    remove: d3_map_remove,\r\n    keys: d3_map_keys,\r\n    values: function() {\r\n      var values = [];\r\n      for (var key in this._) values.push(this._[key]);\r\n      return values;\r\n    },\r\n    entries: function() {\r\n      var entries = [];\r\n      for (var key in this._) entries.push({\r\n        key: d3_map_unescape(key),\r\n        value: this._[key]\r\n      });\r\n      return entries;\r\n    },\r\n    size: d3_map_size,\r\n    empty: d3_map_empty,\r\n    forEach: function(f) {\r\n      for (var key in this._) f.call(this, d3_map_unescape(key), this._[key]);\r\n    }\r\n  });\r\n  function d3_map_escape(key) {\r\n    return (key += \"\") === d3_map_proto || key[0] === d3_map_zero ? d3_map_zero + key : key;\r\n  }\r\n  function d3_map_unescape(key) {\r\n    return (key += \"\")[0] === d3_map_zero ? key.slice(1) : key;\r\n  }\r\n  function d3_map_has(key) {\r\n    return d3_map_escape(key) in this._;\r\n  }\r\n  function d3_map_remove(key) {\r\n    return (key = d3_map_escape(key)) in this._ && delete this._[key];\r\n  }\r\n  function d3_map_keys() {\r\n    var keys = [];\r\n    for (var key in this._) keys.push(d3_map_unescape(key));\r\n    return keys;\r\n  }\r\n  function d3_map_size() {\r\n    var size = 0;\r\n    for (var key in this._) ++size;\r\n    return size;\r\n  }\r\n  function d3_map_empty() {\r\n    for (var key in this._) return false;\r\n    return true;\r\n  }\r\n  d3.nest = function() {\r\n    var nest = {}, keys = [], sortKeys = [], sortValues, rollup;\r\n    function map(mapType, array, depth) {\r\n      if (depth >= keys.length) return rollup ? rollup.call(nest, array) : sortValues ? array.sort(sortValues) : array;\r\n      var i = -1, n = array.length, key = keys[depth++], keyValue, object, setter, valuesByKey = new d3_Map(), values;\r\n      while (++i < n) {\r\n        if (values = valuesByKey.get(keyValue = key(object = array[i]))) {\r\n          values.push(object);\r\n        } else {\r\n          valuesByKey.set(keyValue, [ object ]);\r\n        }\r\n      }\r\n      if (mapType) {\r\n        object = mapType();\r\n        setter = function(keyValue, values) {\r\n          object.set(keyValue, map(mapType, values, depth));\r\n        };\r\n      } else {\r\n        object = {};\r\n        setter = function(keyValue, values) {\r\n          object[keyValue] = map(mapType, values, depth);\r\n        };\r\n      }\r\n      valuesByKey.forEach(setter);\r\n      return object;\r\n    }\r\n    function entries(map, depth) {\r\n      if (depth >= keys.length) return map;\r\n      var array = [], sortKey = sortKeys[depth++];\r\n      map.forEach(function(key, keyMap) {\r\n        array.push({\r\n          key: key,\r\n          values: entries(keyMap, depth)\r\n        });\r\n      });\r\n      return sortKey ? array.sort(function(a, b) {\r\n        return sortKey(a.key, b.key);\r\n      }) : array;\r\n    }\r\n    nest.map = function(array, mapType) {\r\n      return map(mapType, array, 0);\r\n    };\r\n    nest.entries = function(array) {\r\n      return entries(map(d3.map, array, 0), 0);\r\n    };\r\n    nest.key = function(d) {\r\n      keys.push(d);\r\n      return nest;\r\n    };\r\n    nest.sortKeys = function(order) {\r\n      sortKeys[keys.length - 1] = order;\r\n      return nest;\r\n    };\r\n    nest.sortValues = function(order) {\r\n      sortValues = order;\r\n      return nest;\r\n    };\r\n    nest.rollup = function(f) {\r\n      rollup = f;\r\n      return nest;\r\n    };\r\n    return nest;\r\n  };\r\n  d3.set = function(array) {\r\n    var set = new d3_Set();\r\n    if (array) for (var i = 0, n = array.length; i < n; ++i) set.add(array[i]);\r\n    return set;\r\n  };\r\n  function d3_Set() {\r\n    this._ = Object.create(null);\r\n  }\r\n  d3_class(d3_Set, {\r\n    has: d3_map_has,\r\n    add: function(key) {\r\n      this._[d3_map_escape(key += \"\")] = true;\r\n      return key;\r\n    },\r\n    remove: d3_map_remove,\r\n    values: d3_map_keys,\r\n    size: d3_map_size,\r\n    empty: d3_map_empty,\r\n    forEach: function(f) {\r\n      for (var key in this._) f.call(this, d3_map_unescape(key));\r\n    }\r\n  });\r\n  d3.behavior = {};\r\n  function d3_identity(d) {\r\n    return d;\r\n  }\r\n  d3.rebind = function(target, source) {\r\n    var i = 1, n = arguments.length, method;\r\n    while (++i < n) target[method = arguments[i]] = d3_rebind(target, source, source[method]);\r\n    return target;\r\n  };\r\n  function d3_rebind(target, source, method) {\r\n    return function() {\r\n      var value = method.apply(source, arguments);\r\n      return value === source ? target : value;\r\n    };\r\n  }\r\n  function d3_vendorSymbol(object, name) {\r\n    if (name in object) return name;\r\n    name = name.charAt(0).toUpperCase() + name.slice(1);\r\n    for (var i = 0, n = d3_vendorPrefixes.length; i < n; ++i) {\r\n      var prefixName = d3_vendorPrefixes[i] + name;\r\n      if (prefixName in object) return prefixName;\r\n    }\r\n  }\r\n  var d3_vendorPrefixes = [ \"webkit\", \"ms\", \"moz\", \"Moz\", \"o\", \"O\" ];\r\n  function d3_noop() {}\r\n  d3.dispatch = function() {\r\n    var dispatch = new d3_dispatch(), i = -1, n = arguments.length;\r\n    while (++i < n) dispatch[arguments[i]] = d3_dispatch_event(dispatch);\r\n    return dispatch;\r\n  };\r\n  function d3_dispatch() {}\r\n  d3_dispatch.prototype.on = function(type, listener) {\r\n    var i = type.indexOf(\".\"), name = \"\";\r\n    if (i >= 0) {\r\n      name = type.slice(i + 1);\r\n      type = type.slice(0, i);\r\n    }\r\n    if (type) return arguments.length < 2 ? this[type].on(name) : this[type].on(name, listener);\r\n    if (arguments.length === 2) {\r\n      if (listener == null) for (type in this) {\r\n        if (this.hasOwnProperty(type)) this[type].on(name, null);\r\n      }\r\n      return this;\r\n    }\r\n  };\r\n  function d3_dispatch_event(dispatch) {\r\n    var listeners = [], listenerByName = new d3_Map();\r\n    function event() {\r\n      var z = listeners, i = -1, n = z.length, l;\r\n      while (++i < n) if (l = z[i].on) l.apply(this, arguments);\r\n      return dispatch;\r\n    }\r\n    event.on = function(name, listener) {\r\n      var l = listenerByName.get(name), i;\r\n      if (arguments.length < 2) return l && l.on;\r\n      if (l) {\r\n        l.on = null;\r\n        listeners = listeners.slice(0, i = listeners.indexOf(l)).concat(listeners.slice(i + 1));\r\n        listenerByName.remove(name);\r\n      }\r\n      if (listener) listeners.push(listenerByName.set(name, {\r\n        on: listener\r\n      }));\r\n      return dispatch;\r\n    };\r\n    return event;\r\n  }\r\n  d3.event = null;\r\n  function d3_eventPreventDefault() {\r\n    d3.event.preventDefault();\r\n  }\r\n  function d3_eventSource() {\r\n    var e = d3.event, s;\r\n    while (s = e.sourceEvent) e = s;\r\n    return e;\r\n  }\r\n  function d3_eventDispatch(target) {\r\n    var dispatch = new d3_dispatch(), i = 0, n = arguments.length;\r\n    while (++i < n) dispatch[arguments[i]] = d3_dispatch_event(dispatch);\r\n    dispatch.of = function(thiz, argumentz) {\r\n      return function(e1) {\r\n        try {\r\n          var e0 = e1.sourceEvent = d3.event;\r\n          e1.target = target;\r\n          d3.event = e1;\r\n          dispatch[e1.type].apply(thiz, argumentz);\r\n        } finally {\r\n          d3.event = e0;\r\n        }\r\n      };\r\n    };\r\n    return dispatch;\r\n  }\r\n  d3.requote = function(s) {\r\n    return s.replace(d3_requote_re, \"\\\\$&\");\r\n  };\r\n  var d3_requote_re = /[\\\\\\^\\$\\*\\+\\?\\|\\[\\]\\(\\)\\.\\{\\}]/g;\r\n  var d3_subclass = {}.__proto__ ? function(object, prototype) {\r\n    object.__proto__ = prototype;\r\n  } : function(object, prototype) {\r\n    for (var property in prototype) object[property] = prototype[property];\r\n  };\r\n  function d3_selection(groups) {\r\n    d3_subclass(groups, d3_selectionPrototype);\r\n    return groups;\r\n  }\r\n  var d3_select = function(s, n) {\r\n    return n.querySelector(s);\r\n  }, d3_selectAll = function(s, n) {\r\n    return n.querySelectorAll(s);\r\n  }, d3_selectMatches = function(n, s) {\r\n    var d3_selectMatcher = n.matches || n[d3_vendorSymbol(n, \"matchesSelector\")];\r\n    d3_selectMatches = function(n, s) {\r\n      return d3_selectMatcher.call(n, s);\r\n    };\r\n    return d3_selectMatches(n, s);\r\n  };\r\n  if (typeof Sizzle === \"function\") {\r\n    d3_select = function(s, n) {\r\n      return Sizzle(s, n)[0] || null;\r\n    };\r\n    d3_selectAll = Sizzle;\r\n    d3_selectMatches = Sizzle.matchesSelector;\r\n  }\r\n  d3.selection = function() {\r\n    return d3.select(d3_document.documentElement);\r\n  };\r\n  var d3_selectionPrototype = d3.selection.prototype = [];\r\n  d3_selectionPrototype.select = function(selector) {\r\n    var subgroups = [], subgroup, subnode, group, node;\r\n    selector = d3_selection_selector(selector);\r\n    for (var j = -1, m = this.length; ++j < m; ) {\r\n      subgroups.push(subgroup = []);\r\n      subgroup.parentNode = (group = this[j]).parentNode;\r\n      for (var i = -1, n = group.length; ++i < n; ) {\r\n        if (node = group[i]) {\r\n          subgroup.push(subnode = selector.call(node, node.__data__, i, j));\r\n          if (subnode && \"__data__\" in node) subnode.__data__ = node.__data__;\r\n        } else {\r\n          subgroup.push(null);\r\n        }\r\n      }\r\n    }\r\n    return d3_selection(subgroups);\r\n  };\r\n  function d3_selection_selector(selector) {\r\n    return typeof selector === \"function\" ? selector : function() {\r\n      return d3_select(selector, this);\r\n    };\r\n  }\r\n  d3_selectionPrototype.selectAll = function(selector) {\r\n    var subgroups = [], subgroup, node;\r\n    selector = d3_selection_selectorAll(selector);\r\n    for (var j = -1, m = this.length; ++j < m; ) {\r\n      for (var group = this[j], i = -1, n = group.length; ++i < n; ) {\r\n        if (node = group[i]) {\r\n          subgroups.push(subgroup = d3_array(selector.call(node, node.__data__, i, j)));\r\n          subgroup.parentNode = node;\r\n        }\r\n      }\r\n    }\r\n    return d3_selection(subgroups);\r\n  };\r\n  function d3_selection_selectorAll(selector) {\r\n    return typeof selector === \"function\" ? selector : function() {\r\n      return d3_selectAll(selector, this);\r\n    };\r\n  }\r\n  var d3_nsXhtml = \"http://www.w3.org/1999/xhtml\";\r\n  var d3_nsPrefix = {\r\n    svg: \"http://www.w3.org/2000/svg\",\r\n    xhtml: d3_nsXhtml,\r\n    xlink: \"http://www.w3.org/1999/xlink\",\r\n    xml: \"http://www.w3.org/XML/1998/namespace\",\r\n    xmlns: \"http://www.w3.org/2000/xmlns/\"\r\n  };\r\n  d3.ns = {\r\n    prefix: d3_nsPrefix,\r\n    qualify: function(name) {\r\n      var i = name.indexOf(\":\"), prefix = name;\r\n      if (i >= 0 && (prefix = name.slice(0, i)) !== \"xmlns\") name = name.slice(i + 1);\r\n      return d3_nsPrefix.hasOwnProperty(prefix) ? {\r\n        space: d3_nsPrefix[prefix],\r\n        local: name\r\n      } : name;\r\n    }\r\n  };\r\n  d3_selectionPrototype.attr = function(name, value) {\r\n    if (arguments.length < 2) {\r\n      if (typeof name === \"string\") {\r\n        var node = this.node();\r\n        name = d3.ns.qualify(name);\r\n        return name.local ? node.getAttributeNS(name.space, name.local) : node.getAttribute(name);\r\n      }\r\n      for (value in name) this.each(d3_selection_attr(value, name[value]));\r\n      return this;\r\n    }\r\n    return this.each(d3_selection_attr(name, value));\r\n  };\r\n  function d3_selection_attr(name, value) {\r\n    name = d3.ns.qualify(name);\r\n    function attrNull() {\r\n      this.removeAttribute(name);\r\n    }\r\n    function attrNullNS() {\r\n      this.removeAttributeNS(name.space, name.local);\r\n    }\r\n    function attrConstant() {\r\n      this.setAttribute(name, value);\r\n    }\r\n    function attrConstantNS() {\r\n      this.setAttributeNS(name.space, name.local, value);\r\n    }\r\n    function attrFunction() {\r\n      var x = value.apply(this, arguments);\r\n      if (x == null) this.removeAttribute(name); else this.setAttribute(name, x);\r\n    }\r\n    function attrFunctionNS() {\r\n      var x = value.apply(this, arguments);\r\n      if (x == null) this.removeAttributeNS(name.space, name.local); else this.setAttributeNS(name.space, name.local, x);\r\n    }\r\n    return value == null ? name.local ? attrNullNS : attrNull : typeof value === \"function\" ? name.local ? attrFunctionNS : attrFunction : name.local ? attrConstantNS : attrConstant;\r\n  }\r\n  function d3_collapse(s) {\r\n    return s.trim().replace(/\\s+/g, \" \");\r\n  }\r\n  d3_selectionPrototype.classed = function(name, value) {\r\n    if (arguments.length < 2) {\r\n      if (typeof name === \"string\") {\r\n        var node = this.node(), n = (name = d3_selection_classes(name)).length, i = -1;\r\n        if (value = node.classList) {\r\n          while (++i < n) if (!value.contains(name[i])) return false;\r\n        } else {\r\n          value = node.getAttribute(\"class\");\r\n          while (++i < n) if (!d3_selection_classedRe(name[i]).test(value)) return false;\r\n        }\r\n        return true;\r\n      }\r\n      for (value in name) this.each(d3_selection_classed(value, name[value]));\r\n      return this;\r\n    }\r\n    return this.each(d3_selection_classed(name, value));\r\n  };\r\n  function d3_selection_classedRe(name) {\r\n    return new RegExp(\"(?:^|\\\\s+)\" + d3.requote(name) + \"(?:\\\\s+|$)\", \"g\");\r\n  }\r\n  function d3_selection_classes(name) {\r\n    return (name + \"\").trim().split(/^|\\s+/);\r\n  }\r\n  function d3_selection_classed(name, value) {\r\n    name = d3_selection_classes(name).map(d3_selection_classedName);\r\n    var n = name.length;\r\n    function classedConstant() {\r\n      var i = -1;\r\n      while (++i < n) name[i](this, value);\r\n    }\r\n    function classedFunction() {\r\n      var i = -1, x = value.apply(this, arguments);\r\n      while (++i < n) name[i](this, x);\r\n    }\r\n    return typeof value === \"function\" ? classedFunction : classedConstant;\r\n  }\r\n  function d3_selection_classedName(name) {\r\n    var re = d3_selection_classedRe(name);\r\n    return function(node, value) {\r\n      if (c = node.classList) return value ? c.add(name) : c.remove(name);\r\n      var c = node.getAttribute(\"class\") || \"\";\r\n      if (value) {\r\n        re.lastIndex = 0;\r\n        if (!re.test(c)) node.setAttribute(\"class\", d3_collapse(c + \" \" + name));\r\n      } else {\r\n        node.setAttribute(\"class\", d3_collapse(c.replace(re, \" \")));\r\n      }\r\n    };\r\n  }\r\n  d3_selectionPrototype.style = function(name, value, priority) {\r\n    var n = arguments.length;\r\n    if (n < 3) {\r\n      if (typeof name !== \"string\") {\r\n        if (n < 2) value = \"\";\r\n        for (priority in name) this.each(d3_selection_style(priority, name[priority], value));\r\n        return this;\r\n      }\r\n      if (n < 2) {\r\n        var node = this.node();\r\n        return d3_window(node).getComputedStyle(node, null).getPropertyValue(name);\r\n      }\r\n      priority = \"\";\r\n    }\r\n    return this.each(d3_selection_style(name, value, priority));\r\n  };\r\n  function d3_selection_style(name, value, priority) {\r\n    function styleNull() {\r\n      this.style.removeProperty(name);\r\n    }\r\n    function styleConstant() {\r\n      this.style.setProperty(name, value, priority);\r\n    }\r\n    function styleFunction() {\r\n      var x = value.apply(this, arguments);\r\n      if (x == null) this.style.removeProperty(name); else this.style.setProperty(name, x, priority);\r\n    }\r\n    return value == null ? styleNull : typeof value === \"function\" ? styleFunction : styleConstant;\r\n  }\r\n  d3_selectionPrototype.property = function(name, value) {\r\n    if (arguments.length < 2) {\r\n      if (typeof name === \"string\") return this.node()[name];\r\n      for (value in name) this.each(d3_selection_property(value, name[value]));\r\n      return this;\r\n    }\r\n    return this.each(d3_selection_property(name, value));\r\n  };\r\n  function d3_selection_property(name, value) {\r\n    function propertyNull() {\r\n      delete this[name];\r\n    }\r\n    function propertyConstant() {\r\n      this[name] = value;\r\n    }\r\n    function propertyFunction() {\r\n      var x = value.apply(this, arguments);\r\n      if (x == null) delete this[name]; else this[name] = x;\r\n    }\r\n    return value == null ? propertyNull : typeof value === \"function\" ? propertyFunction : propertyConstant;\r\n  }\r\n  d3_selectionPrototype.text = function(value) {\r\n    return arguments.length ? this.each(typeof value === \"function\" ? function() {\r\n      var v = value.apply(this, arguments);\r\n      this.textContent = v == null ? \"\" : v;\r\n    } : value == null ? function() {\r\n      this.textContent = \"\";\r\n    } : function() {\r\n      this.textContent = value;\r\n    }) : this.node().textContent;\r\n  };\r\n  d3_selectionPrototype.html = function(value) {\r\n    return arguments.length ? this.each(typeof value === \"function\" ? function() {\r\n      var v = value.apply(this, arguments);\r\n      this.innerHTML = v == null ? \"\" : v;\r\n    } : value == null ? function() {\r\n      this.innerHTML = \"\";\r\n    } : function() {\r\n      this.innerHTML = value;\r\n    }) : this.node().innerHTML;\r\n  };\r\n  d3_selectionPrototype.append = function(name) {\r\n    name = d3_selection_creator(name);\r\n    return this.select(function() {\r\n      return this.appendChild(name.apply(this, arguments));\r\n    });\r\n  };\r\n  function d3_selection_creator(name) {\r\n    function create() {\r\n      var document = this.ownerDocument, namespace = this.namespaceURI;\r\n      return namespace === d3_nsXhtml && document.documentElement.namespaceURI === d3_nsXhtml ? document.createElement(name) : document.createElementNS(namespace, name);\r\n    }\r\n    function createNS() {\r\n      return this.ownerDocument.createElementNS(name.space, name.local);\r\n    }\r\n    return typeof name === \"function\" ? name : (name = d3.ns.qualify(name)).local ? createNS : create;\r\n  }\r\n  d3_selectionPrototype.insert = function(name, before) {\r\n    name = d3_selection_creator(name);\r\n    before = d3_selection_selector(before);\r\n    return this.select(function() {\r\n      return this.insertBefore(name.apply(this, arguments), before.apply(this, arguments) || null);\r\n    });\r\n  };\r\n  d3_selectionPrototype.remove = function() {\r\n    return this.each(d3_selectionRemove);\r\n  };\r\n  function d3_selectionRemove() {\r\n    var parent = this.parentNode;\r\n    if (parent) parent.removeChild(this);\r\n  }\r\n  d3_selectionPrototype.data = function(value, key) {\r\n    var i = -1, n = this.length, group, node;\r\n    if (!arguments.length) {\r\n      value = new Array(n = (group = this[0]).length);\r\n      while (++i < n) {\r\n        if (node = group[i]) {\r\n          value[i] = node.__data__;\r\n        }\r\n      }\r\n      return value;\r\n    }\r\n    function bind(group, groupData) {\r\n      var i, n = group.length, m = groupData.length, n0 = Math.min(n, m), updateNodes = new Array(m), enterNodes = new Array(m), exitNodes = new Array(n), node, nodeData;\r\n      if (key) {\r\n        var nodeByKeyValue = new d3_Map(), keyValues = new Array(n), keyValue;\r\n        for (i = -1; ++i < n; ) {\r\n          if (node = group[i]) {\r\n            if (nodeByKeyValue.has(keyValue = key.call(node, node.__data__, i))) {\r\n              exitNodes[i] = node;\r\n            } else {\r\n              nodeByKeyValue.set(keyValue, node);\r\n            }\r\n            keyValues[i] = keyValue;\r\n          }\r\n        }\r\n        for (i = -1; ++i < m; ) {\r\n          if (!(node = nodeByKeyValue.get(keyValue = key.call(groupData, nodeData = groupData[i], i)))) {\r\n            enterNodes[i] = d3_selection_dataNode(nodeData);\r\n          } else if (node !== true) {\r\n            updateNodes[i] = node;\r\n            node.__data__ = nodeData;\r\n          }\r\n          nodeByKeyValue.set(keyValue, true);\r\n        }\r\n        for (i = -1; ++i < n; ) {\r\n          if (i in keyValues && nodeByKeyValue.get(keyValues[i]) !== true) {\r\n            exitNodes[i] = group[i];\r\n          }\r\n        }\r\n      } else {\r\n        for (i = -1; ++i < n0; ) {\r\n          node = group[i];\r\n          nodeData = groupData[i];\r\n          if (node) {\r\n            node.__data__ = nodeData;\r\n            updateNodes[i] = node;\r\n          } else {\r\n            enterNodes[i] = d3_selection_dataNode(nodeData);\r\n          }\r\n        }\r\n        for (;i < m; ++i) {\r\n          enterNodes[i] = d3_selection_dataNode(groupData[i]);\r\n        }\r\n        for (;i < n; ++i) {\r\n          exitNodes[i] = group[i];\r\n        }\r\n      }\r\n      enterNodes.update = updateNodes;\r\n      enterNodes.parentNode = updateNodes.parentNode = exitNodes.parentNode = group.parentNode;\r\n      enter.push(enterNodes);\r\n      update.push(updateNodes);\r\n      exit.push(exitNodes);\r\n    }\r\n    var enter = d3_selection_enter([]), update = d3_selection([]), exit = d3_selection([]);\r\n    if (typeof value === \"function\") {\r\n      while (++i < n) {\r\n        bind(group = this[i], value.call(group, group.parentNode.__data__, i));\r\n      }\r\n    } else {\r\n      while (++i < n) {\r\n        bind(group = this[i], value);\r\n      }\r\n    }\r\n    update.enter = function() {\r\n      return enter;\r\n    };\r\n    update.exit = function() {\r\n      return exit;\r\n    };\r\n    return update;\r\n  };\r\n  function d3_selection_dataNode(data) {\r\n    return {\r\n      __data__: data\r\n    };\r\n  }\r\n  d3_selectionPrototype.datum = function(value) {\r\n    return arguments.length ? this.property(\"__data__\", value) : this.property(\"__data__\");\r\n  };\r\n  d3_selectionPrototype.filter = function(filter) {\r\n    var subgroups = [], subgroup, group, node;\r\n    if (typeof filter !== \"function\") filter = d3_selection_filter(filter);\r\n    for (var j = 0, m = this.length; j < m; j++) {\r\n      subgroups.push(subgroup = []);\r\n      subgroup.parentNode = (group = this[j]).parentNode;\r\n      for (var i = 0, n = group.length; i < n; i++) {\r\n        if ((node = group[i]) && filter.call(node, node.__data__, i, j)) {\r\n          subgroup.push(node);\r\n        }\r\n      }\r\n    }\r\n    return d3_selection(subgroups);\r\n  };\r\n  function d3_selection_filter(selector) {\r\n    return function() {\r\n      return d3_selectMatches(this, selector);\r\n    };\r\n  }\r\n  d3_selectionPrototype.order = function() {\r\n    for (var j = -1, m = this.length; ++j < m; ) {\r\n      for (var group = this[j], i = group.length - 1, next = group[i], node; --i >= 0; ) {\r\n        if (node = group[i]) {\r\n          if (next && next !== node.nextSibling) next.parentNode.insertBefore(node, next);\r\n          next = node;\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n  d3_selectionPrototype.sort = function(comparator) {\r\n    comparator = d3_selection_sortComparator.apply(this, arguments);\r\n    for (var j = -1, m = this.length; ++j < m; ) this[j].sort(comparator);\r\n    return this.order();\r\n  };\r\n  function d3_selection_sortComparator(comparator) {\r\n    if (!arguments.length) comparator = d3_ascending;\r\n    return function(a, b) {\r\n      return a && b ? comparator(a.__data__, b.__data__) : !a - !b;\r\n    };\r\n  }\r\n  d3_selectionPrototype.each = function(callback) {\r\n    return d3_selection_each(this, function(node, i, j) {\r\n      callback.call(node, node.__data__, i, j);\r\n    });\r\n  };\r\n  function d3_selection_each(groups, callback) {\r\n    for (var j = 0, m = groups.length; j < m; j++) {\r\n      for (var group = groups[j], i = 0, n = group.length, node; i < n; i++) {\r\n        if (node = group[i]) callback(node, i, j);\r\n      }\r\n    }\r\n    return groups;\r\n  }\r\n  d3_selectionPrototype.call = function(callback) {\r\n    var args = d3_array(arguments);\r\n    callback.apply(args[0] = this, args);\r\n    return this;\r\n  };\r\n  d3_selectionPrototype.empty = function() {\r\n    return !this.node();\r\n  };\r\n  d3_selectionPrototype.node = function() {\r\n    for (var j = 0, m = this.length; j < m; j++) {\r\n      for (var group = this[j], i = 0, n = group.length; i < n; i++) {\r\n        var node = group[i];\r\n        if (node) return node;\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n  d3_selectionPrototype.size = function() {\r\n    var n = 0;\r\n    d3_selection_each(this, function() {\r\n      ++n;\r\n    });\r\n    return n;\r\n  };\r\n  function d3_selection_enter(selection) {\r\n    d3_subclass(selection, d3_selection_enterPrototype);\r\n    return selection;\r\n  }\r\n  var d3_selection_enterPrototype = [];\r\n  d3.selection.enter = d3_selection_enter;\r\n  d3.selection.enter.prototype = d3_selection_enterPrototype;\r\n  d3_selection_enterPrototype.append = d3_selectionPrototype.append;\r\n  d3_selection_enterPrototype.empty = d3_selectionPrototype.empty;\r\n  d3_selection_enterPrototype.node = d3_selectionPrototype.node;\r\n  d3_selection_enterPrototype.call = d3_selectionPrototype.call;\r\n  d3_selection_enterPrototype.size = d3_selectionPrototype.size;\r\n  d3_selection_enterPrototype.select = function(selector) {\r\n    var subgroups = [], subgroup, subnode, upgroup, group, node;\r\n    for (var j = -1, m = this.length; ++j < m; ) {\r\n      upgroup = (group = this[j]).update;\r\n      subgroups.push(subgroup = []);\r\n      subgroup.parentNode = group.parentNode;\r\n      for (var i = -1, n = group.length; ++i < n; ) {\r\n        if (node = group[i]) {\r\n          subgroup.push(upgroup[i] = subnode = selector.call(group.parentNode, node.__data__, i, j));\r\n          subnode.__data__ = node.__data__;\r\n        } else {\r\n          subgroup.push(null);\r\n        }\r\n      }\r\n    }\r\n    return d3_selection(subgroups);\r\n  };\r\n  d3_selection_enterPrototype.insert = function(name, before) {\r\n    if (arguments.length < 2) before = d3_selection_enterInsertBefore(this);\r\n    return d3_selectionPrototype.insert.call(this, name, before);\r\n  };\r\n  function d3_selection_enterInsertBefore(enter) {\r\n    var i0, j0;\r\n    return function(d, i, j) {\r\n      var group = enter[j].update, n = group.length, node;\r\n      if (j != j0) j0 = j, i0 = 0;\r\n      if (i >= i0) i0 = i + 1;\r\n      while (!(node = group[i0]) && ++i0 < n) ;\r\n      return node;\r\n    };\r\n  }\r\n  d3.select = function(node) {\r\n    var group;\r\n    if (typeof node === \"string\") {\r\n      group = [ d3_select(node, d3_document) ];\r\n      group.parentNode = d3_document.documentElement;\r\n    } else {\r\n      group = [ node ];\r\n      group.parentNode = d3_documentElement(node);\r\n    }\r\n    return d3_selection([ group ]);\r\n  };\r\n  d3.selectAll = function(nodes) {\r\n    var group;\r\n    if (typeof nodes === \"string\") {\r\n      group = d3_array(d3_selectAll(nodes, d3_document));\r\n      group.parentNode = d3_document.documentElement;\r\n    } else {\r\n      group = d3_array(nodes);\r\n      group.parentNode = null;\r\n    }\r\n    return d3_selection([ group ]);\r\n  };\r\n  d3_selectionPrototype.on = function(type, listener, capture) {\r\n    var n = arguments.length;\r\n    if (n < 3) {\r\n      if (typeof type !== \"string\") {\r\n        if (n < 2) listener = false;\r\n        for (capture in type) this.each(d3_selection_on(capture, type[capture], listener));\r\n        return this;\r\n      }\r\n      if (n < 2) return (n = this.node()[\"__on\" + type]) && n._;\r\n      capture = false;\r\n    }\r\n    return this.each(d3_selection_on(type, listener, capture));\r\n  };\r\n  function d3_selection_on(type, listener, capture) {\r\n    var name = \"__on\" + type, i = type.indexOf(\".\"), wrap = d3_selection_onListener;\r\n    if (i > 0) type = type.slice(0, i);\r\n    var filter = d3_selection_onFilters.get(type);\r\n    if (filter) type = filter, wrap = d3_selection_onFilter;\r\n    function onRemove() {\r\n      var l = this[name];\r\n      if (l) {\r\n        this.removeEventListener(type, l, l.$);\r\n        delete this[name];\r\n      }\r\n    }\r\n    function onAdd() {\r\n      var l = wrap(listener, d3_array(arguments));\r\n      onRemove.call(this);\r\n      this.addEventListener(type, this[name] = l, l.$ = capture);\r\n      l._ = listener;\r\n    }\r\n    function removeAll() {\r\n      var re = new RegExp(\"^__on([^.]+)\" + d3.requote(type) + \"$\"), match;\r\n      for (var name in this) {\r\n        if (match = name.match(re)) {\r\n          var l = this[name];\r\n          this.removeEventListener(match[1], l, l.$);\r\n          delete this[name];\r\n        }\r\n      }\r\n    }\r\n    return i ? listener ? onAdd : onRemove : listener ? d3_noop : removeAll;\r\n  }\r\n  var d3_selection_onFilters = d3.map({\r\n    mouseenter: \"mouseover\",\r\n    mouseleave: \"mouseout\"\r\n  });\r\n  if (d3_document) {\r\n    d3_selection_onFilters.forEach(function(k) {\r\n      if (\"on\" + k in d3_document) d3_selection_onFilters.remove(k);\r\n    });\r\n  }\r\n  function d3_selection_onListener(listener, argumentz) {\r\n    return function(e) {\r\n      var o = d3.event;\r\n      d3.event = e;\r\n      argumentz[0] = this.__data__;\r\n      try {\r\n        listener.apply(this, argumentz);\r\n      } finally {\r\n        d3.event = o;\r\n      }\r\n    };\r\n  }\r\n  function d3_selection_onFilter(listener, argumentz) {\r\n    var l = d3_selection_onListener(listener, argumentz);\r\n    return function(e) {\r\n      var target = this, related = e.relatedTarget;\r\n      if (!related || related !== target && !(related.compareDocumentPosition(target) & 8)) {\r\n        l.call(target, e);\r\n      }\r\n    };\r\n  }\r\n  var d3_event_dragSelect, d3_event_dragId = 0;\r\n  function d3_event_dragSuppress(node) {\r\n    var name = \".dragsuppress-\" + ++d3_event_dragId, click = \"click\" + name, w = d3.select(d3_window(node)).on(\"touchmove\" + name, d3_eventPreventDefault).on(\"dragstart\" + name, d3_eventPreventDefault).on(\"selectstart\" + name, d3_eventPreventDefault);\r\n    if (d3_event_dragSelect == null) {\r\n      d3_event_dragSelect = \"onselectstart\" in node ? false : d3_vendorSymbol(node.style, \"userSelect\");\r\n    }\r\n    if (d3_event_dragSelect) {\r\n      var style = d3_documentElement(node).style, select = style[d3_event_dragSelect];\r\n      style[d3_event_dragSelect] = \"none\";\r\n    }\r\n    return function(suppressClick) {\r\n      w.on(name, null);\r\n      if (d3_event_dragSelect) style[d3_event_dragSelect] = select;\r\n      if (suppressClick) {\r\n        var off = function() {\r\n          w.on(click, null);\r\n        };\r\n        w.on(click, function() {\r\n          d3_eventPreventDefault();\r\n          off();\r\n        }, true);\r\n        setTimeout(off, 0);\r\n      }\r\n    };\r\n  }\r\n  d3.mouse = function(container) {\r\n    return d3_mousePoint(container, d3_eventSource());\r\n  };\r\n  var d3_mouse_bug44083 = this.navigator && /WebKit/.test(this.navigator.userAgent) ? -1 : 0;\r\n  function d3_mousePoint(container, e) {\r\n    if (e.changedTouches) e = e.changedTouches[0];\r\n    var svg = container.ownerSVGElement || container;\r\n    if (svg.createSVGPoint) {\r\n      var point = svg.createSVGPoint();\r\n      if (d3_mouse_bug44083 < 0) {\r\n        var window = d3_window(container);\r\n        if (window.scrollX || window.scrollY) {\r\n          svg = d3.select(\"body\").append(\"svg\").style({\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            margin: 0,\r\n            padding: 0,\r\n            border: \"none\"\r\n          }, \"important\");\r\n          var ctm = svg[0][0].getScreenCTM();\r\n          d3_mouse_bug44083 = !(ctm.f || ctm.e);\r\n          svg.remove();\r\n        }\r\n      }\r\n      if (d3_mouse_bug44083) point.x = e.pageX, point.y = e.pageY; else point.x = e.clientX, \r\n      point.y = e.clientY;\r\n      point = point.matrixTransform(container.getScreenCTM().inverse());\r\n      return [ point.x, point.y ];\r\n    }\r\n    var rect = container.getBoundingClientRect();\r\n    return [ e.clientX - rect.left - container.clientLeft, e.clientY - rect.top - container.clientTop ];\r\n  }\r\n  d3.touch = function(container, touches, identifier) {\r\n    if (arguments.length < 3) identifier = touches, touches = d3_eventSource().changedTouches;\r\n    if (touches) for (var i = 0, n = touches.length, touch; i < n; ++i) {\r\n      if ((touch = touches[i]).identifier === identifier) {\r\n        return d3_mousePoint(container, touch);\r\n      }\r\n    }\r\n  };\r\n  d3.behavior.drag = function() {\r\n    var event = d3_eventDispatch(drag, \"drag\", \"dragstart\", \"dragend\"), origin = null, mousedown = dragstart(d3_noop, d3.mouse, d3_window, \"mousemove\", \"mouseup\"), touchstart = dragstart(d3_behavior_dragTouchId, d3.touch, d3_identity, \"touchmove\", \"touchend\");\r\n    function drag() {\r\n      this.on(\"mousedown.drag\", mousedown).on(\"touchstart.drag\", touchstart);\r\n    }\r\n    function dragstart(id, position, subject, move, end) {\r\n      return function() {\r\n        var that = this, target = d3.event.target.correspondingElement || d3.event.target, parent = that.parentNode, dispatch = event.of(that, arguments), dragged = 0, dragId = id(), dragName = \".drag\" + (dragId == null ? \"\" : \"-\" + dragId), dragOffset, dragSubject = d3.select(subject(target)).on(move + dragName, moved).on(end + dragName, ended), dragRestore = d3_event_dragSuppress(target), position0 = position(parent, dragId);\r\n        if (origin) {\r\n          dragOffset = origin.apply(that, arguments);\r\n          dragOffset = [ dragOffset.x - position0[0], dragOffset.y - position0[1] ];\r\n        } else {\r\n          dragOffset = [ 0, 0 ];\r\n        }\r\n        dispatch({\r\n          type: \"dragstart\"\r\n        });\r\n        function moved() {\r\n          var position1 = position(parent, dragId), dx, dy;\r\n          if (!position1) return;\r\n          dx = position1[0] - position0[0];\r\n          dy = position1[1] - position0[1];\r\n          dragged |= dx | dy;\r\n          position0 = position1;\r\n          dispatch({\r\n            type: \"drag\",\r\n            x: position1[0] + dragOffset[0],\r\n            y: position1[1] + dragOffset[1],\r\n            dx: dx,\r\n            dy: dy\r\n          });\r\n        }\r\n        function ended() {\r\n          if (!position(parent, dragId)) return;\r\n          dragSubject.on(move + dragName, null).on(end + dragName, null);\r\n          dragRestore(dragged);\r\n          dispatch({\r\n            type: \"dragend\"\r\n          });\r\n        }\r\n      };\r\n    }\r\n    drag.origin = function(x) {\r\n      if (!arguments.length) return origin;\r\n      origin = x;\r\n      return drag;\r\n    };\r\n    return d3.rebind(drag, event, \"on\");\r\n  };\r\n  function d3_behavior_dragTouchId() {\r\n    return d3.event.changedTouches[0].identifier;\r\n  }\r\n  d3.touches = function(container, touches) {\r\n    if (arguments.length < 2) touches = d3_eventSource().touches;\r\n    return touches ? d3_array(touches).map(function(touch) {\r\n      var point = d3_mousePoint(container, touch);\r\n      point.identifier = touch.identifier;\r\n      return point;\r\n    }) : [];\r\n  };\r\n  var ε = 1e-6, ε2 = ε * ε, π = Math.PI, τ = 2 * π, τε = τ - ε, halfπ = π / 2, d3_radians = π / 180, d3_degrees = 180 / π;\r\n  function d3_sgn(x) {\r\n    return x > 0 ? 1 : x < 0 ? -1 : 0;\r\n  }\r\n  function d3_cross2d(a, b, c) {\r\n    return (b[0] - a[0]) * (c[1] - a[1]) - (b[1] - a[1]) * (c[0] - a[0]);\r\n  }\r\n  function d3_acos(x) {\r\n    return x > 1 ? 0 : x < -1 ? π : Math.acos(x);\r\n  }\r\n  function d3_asin(x) {\r\n    return x > 1 ? halfπ : x < -1 ? -halfπ : Math.asin(x);\r\n  }\r\n  function d3_sinh(x) {\r\n    return ((x = Math.exp(x)) - 1 / x) / 2;\r\n  }\r\n  function d3_cosh(x) {\r\n    return ((x = Math.exp(x)) + 1 / x) / 2;\r\n  }\r\n  function d3_tanh(x) {\r\n    return ((x = Math.exp(2 * x)) - 1) / (x + 1);\r\n  }\r\n  function d3_haversin(x) {\r\n    return (x = Math.sin(x / 2)) * x;\r\n  }\r\n  var ρ = Math.SQRT2, ρ2 = 2, ρ4 = 4;\r\n  d3.interpolateZoom = function(p0, p1) {\r\n    var ux0 = p0[0], uy0 = p0[1], w0 = p0[2], ux1 = p1[0], uy1 = p1[1], w1 = p1[2], dx = ux1 - ux0, dy = uy1 - uy0, d2 = dx * dx + dy * dy, i, S;\r\n    if (d2 < ε2) {\r\n      S = Math.log(w1 / w0) / ρ;\r\n      i = function(t) {\r\n        return [ ux0 + t * dx, uy0 + t * dy, w0 * Math.exp(ρ * t * S) ];\r\n      };\r\n    } else {\r\n      var d1 = Math.sqrt(d2), b0 = (w1 * w1 - w0 * w0 + ρ4 * d2) / (2 * w0 * ρ2 * d1), b1 = (w1 * w1 - w0 * w0 - ρ4 * d2) / (2 * w1 * ρ2 * d1), r0 = Math.log(Math.sqrt(b0 * b0 + 1) - b0), r1 = Math.log(Math.sqrt(b1 * b1 + 1) - b1);\r\n      S = (r1 - r0) / ρ;\r\n      i = function(t) {\r\n        var s = t * S, coshr0 = d3_cosh(r0), u = w0 / (ρ2 * d1) * (coshr0 * d3_tanh(ρ * s + r0) - d3_sinh(r0));\r\n        return [ ux0 + u * dx, uy0 + u * dy, w0 * coshr0 / d3_cosh(ρ * s + r0) ];\r\n      };\r\n    }\r\n    i.duration = S * 1e3;\r\n    return i;\r\n  };\r\n  d3.behavior.zoom = function() {\r\n    var view = {\r\n      x: 0,\r\n      y: 0,\r\n      k: 1\r\n    }, translate0, center0, center, size = [ 960, 500 ], scaleExtent = d3_behavior_zoomInfinity, duration = 250, zooming = 0, mousedown = \"mousedown.zoom\", mousemove = \"mousemove.zoom\", mouseup = \"mouseup.zoom\", mousewheelTimer, touchstart = \"touchstart.zoom\", touchtime, event = d3_eventDispatch(zoom, \"zoomstart\", \"zoom\", \"zoomend\"), x0, x1, y0, y1;\r\n    if (!d3_behavior_zoomWheel) {\r\n      d3_behavior_zoomWheel = \"onwheel\" in d3_document ? (d3_behavior_zoomDelta = function() {\r\n        return -d3.event.deltaY * (d3.event.deltaMode ? 120 : 1);\r\n      }, \"wheel\") : \"onmousewheel\" in d3_document ? (d3_behavior_zoomDelta = function() {\r\n        return d3.event.wheelDelta;\r\n      }, \"mousewheel\") : (d3_behavior_zoomDelta = function() {\r\n        return -d3.event.detail;\r\n      }, \"MozMousePixelScroll\");\r\n    }\r\n    function zoom(g) {\r\n      g.on(mousedown, mousedowned).on(d3_behavior_zoomWheel + \".zoom\", mousewheeled).on(\"dblclick.zoom\", dblclicked).on(touchstart, touchstarted);\r\n    }\r\n    zoom.event = function(g) {\r\n      g.each(function() {\r\n        var dispatch = event.of(this, arguments), view1 = view;\r\n        if (d3_transitionInheritId) {\r\n          d3.select(this).transition().each(\"start.zoom\", function() {\r\n            view = this.__chart__ || {\r\n              x: 0,\r\n              y: 0,\r\n              k: 1\r\n            };\r\n            zoomstarted(dispatch);\r\n          }).tween(\"zoom:zoom\", function() {\r\n            var dx = size[0], dy = size[1], cx = center0 ? center0[0] : dx / 2, cy = center0 ? center0[1] : dy / 2, i = d3.interpolateZoom([ (cx - view.x) / view.k, (cy - view.y) / view.k, dx / view.k ], [ (cx - view1.x) / view1.k, (cy - view1.y) / view1.k, dx / view1.k ]);\r\n            return function(t) {\r\n              var l = i(t), k = dx / l[2];\r\n              this.__chart__ = view = {\r\n                x: cx - l[0] * k,\r\n                y: cy - l[1] * k,\r\n                k: k\r\n              };\r\n              zoomed(dispatch);\r\n            };\r\n          }).each(\"interrupt.zoom\", function() {\r\n            zoomended(dispatch);\r\n          }).each(\"end.zoom\", function() {\r\n            zoomended(dispatch);\r\n          });\r\n        } else {\r\n          this.__chart__ = view;\r\n          zoomstarted(dispatch);\r\n          zoomed(dispatch);\r\n          zoomended(dispatch);\r\n        }\r\n      });\r\n    };\r\n    zoom.translate = function(_) {\r\n      if (!arguments.length) return [ view.x, view.y ];\r\n      view = {\r\n        x: +_[0],\r\n        y: +_[1],\r\n        k: view.k\r\n      };\r\n      rescale();\r\n      return zoom;\r\n    };\r\n    zoom.scale = function(_) {\r\n      if (!arguments.length) return view.k;\r\n      view = {\r\n        x: view.x,\r\n        y: view.y,\r\n        k: null\r\n      };\r\n      scaleTo(+_);\r\n      rescale();\r\n      return zoom;\r\n    };\r\n    zoom.scaleExtent = function(_) {\r\n      if (!arguments.length) return scaleExtent;\r\n      scaleExtent = _ == null ? d3_behavior_zoomInfinity : [ +_[0], +_[1] ];\r\n      return zoom;\r\n    };\r\n    zoom.center = function(_) {\r\n      if (!arguments.length) return center;\r\n      center = _ && [ +_[0], +_[1] ];\r\n      return zoom;\r\n    };\r\n    zoom.size = function(_) {\r\n      if (!arguments.length) return size;\r\n      size = _ && [ +_[0], +_[1] ];\r\n      return zoom;\r\n    };\r\n    zoom.duration = function(_) {\r\n      if (!arguments.length) return duration;\r\n      duration = +_;\r\n      return zoom;\r\n    };\r\n    zoom.x = function(z) {\r\n      if (!arguments.length) return x1;\r\n      x1 = z;\r\n      x0 = z.copy();\r\n      view = {\r\n        x: 0,\r\n        y: 0,\r\n        k: 1\r\n      };\r\n      return zoom;\r\n    };\r\n    zoom.y = function(z) {\r\n      if (!arguments.length) return y1;\r\n      y1 = z;\r\n      y0 = z.copy();\r\n      view = {\r\n        x: 0,\r\n        y: 0,\r\n        k: 1\r\n      };\r\n      return zoom;\r\n    };\r\n    function location(p) {\r\n      return [ (p[0] - view.x) / view.k, (p[1] - view.y) / view.k ];\r\n    }\r\n    function point(l) {\r\n      return [ l[0] * view.k + view.x, l[1] * view.k + view.y ];\r\n    }\r\n    function scaleTo(s) {\r\n      view.k = Math.max(scaleExtent[0], Math.min(scaleExtent[1], s));\r\n    }\r\n    function translateTo(p, l) {\r\n      l = point(l);\r\n      view.x += p[0] - l[0];\r\n      view.y += p[1] - l[1];\r\n    }\r\n    function zoomTo(that, p, l, k) {\r\n      that.__chart__ = {\r\n        x: view.x,\r\n        y: view.y,\r\n        k: view.k\r\n      };\r\n      scaleTo(Math.pow(2, k));\r\n      translateTo(center0 = p, l);\r\n      that = d3.select(that);\r\n      if (duration > 0) that = that.transition().duration(duration);\r\n      that.call(zoom.event);\r\n    }\r\n    function rescale() {\r\n      if (x1) x1.domain(x0.range().map(function(x) {\r\n        return (x - view.x) / view.k;\r\n      }).map(x0.invert));\r\n      if (y1) y1.domain(y0.range().map(function(y) {\r\n        return (y - view.y) / view.k;\r\n      }).map(y0.invert));\r\n    }\r\n    function zoomstarted(dispatch) {\r\n      if (!zooming++) dispatch({\r\n        type: \"zoomstart\"\r\n      });\r\n    }\r\n    function zoomed(dispatch) {\r\n      rescale();\r\n      dispatch({\r\n        type: \"zoom\",\r\n        scale: view.k,\r\n        translate: [ view.x, view.y ]\r\n      });\r\n    }\r\n    function zoomended(dispatch) {\r\n      if (!--zooming) dispatch({\r\n        type: \"zoomend\"\r\n      }), center0 = null;\r\n    }\r\n    function mousedowned() {\r\n      var that = this, dispatch = event.of(that, arguments), dragged = 0, subject = d3.select(d3_window(that)).on(mousemove, moved).on(mouseup, ended), location0 = location(d3.mouse(that)), dragRestore = d3_event_dragSuppress(that);\r\n      d3_selection_interrupt.call(that);\r\n      zoomstarted(dispatch);\r\n      function moved() {\r\n        dragged = 1;\r\n        translateTo(d3.mouse(that), location0);\r\n        zoomed(dispatch);\r\n      }\r\n      function ended() {\r\n        subject.on(mousemove, null).on(mouseup, null);\r\n        dragRestore(dragged);\r\n        zoomended(dispatch);\r\n      }\r\n    }\r\n    function touchstarted() {\r\n      var that = this, dispatch = event.of(that, arguments), locations0 = {}, distance0 = 0, scale0, zoomName = \".zoom-\" + d3.event.changedTouches[0].identifier, touchmove = \"touchmove\" + zoomName, touchend = \"touchend\" + zoomName, targets = [], subject = d3.select(that), dragRestore = d3_event_dragSuppress(that);\r\n      started();\r\n      zoomstarted(dispatch);\r\n      subject.on(mousedown, null).on(touchstart, started);\r\n      function relocate() {\r\n        var touches = d3.touches(that);\r\n        scale0 = view.k;\r\n        touches.forEach(function(t) {\r\n          if (t.identifier in locations0) locations0[t.identifier] = location(t);\r\n        });\r\n        return touches;\r\n      }\r\n      function started() {\r\n        var target = d3.event.target;\r\n        d3.select(target).on(touchmove, moved).on(touchend, ended);\r\n        targets.push(target);\r\n        var changed = d3.event.changedTouches;\r\n        for (var i = 0, n = changed.length; i < n; ++i) {\r\n          locations0[changed[i].identifier] = null;\r\n        }\r\n        var touches = relocate(), now = Date.now();\r\n        if (touches.length === 1) {\r\n          if (now - touchtime < 500) {\r\n            var p = touches[0];\r\n            zoomTo(that, p, locations0[p.identifier], Math.floor(Math.log(view.k) / Math.LN2) + 1);\r\n            d3_eventPreventDefault();\r\n          }\r\n          touchtime = now;\r\n        } else if (touches.length > 1) {\r\n          var p = touches[0], q = touches[1], dx = p[0] - q[0], dy = p[1] - q[1];\r\n          distance0 = dx * dx + dy * dy;\r\n        }\r\n      }\r\n      function moved() {\r\n        var touches = d3.touches(that), p0, l0, p1, l1;\r\n        d3_selection_interrupt.call(that);\r\n        for (var i = 0, n = touches.length; i < n; ++i, l1 = null) {\r\n          p1 = touches[i];\r\n          if (l1 = locations0[p1.identifier]) {\r\n            if (l0) break;\r\n            p0 = p1, l0 = l1;\r\n          }\r\n        }\r\n        if (l1) {\r\n          var distance1 = (distance1 = p1[0] - p0[0]) * distance1 + (distance1 = p1[1] - p0[1]) * distance1, scale1 = distance0 && Math.sqrt(distance1 / distance0);\r\n          p0 = [ (p0[0] + p1[0]) / 2, (p0[1] + p1[1]) / 2 ];\r\n          l0 = [ (l0[0] + l1[0]) / 2, (l0[1] + l1[1]) / 2 ];\r\n          scaleTo(scale1 * scale0);\r\n        }\r\n        touchtime = null;\r\n        translateTo(p0, l0);\r\n        zoomed(dispatch);\r\n      }\r\n      function ended() {\r\n        if (d3.event.touches.length) {\r\n          var changed = d3.event.changedTouches;\r\n          for (var i = 0, n = changed.length; i < n; ++i) {\r\n            delete locations0[changed[i].identifier];\r\n          }\r\n          for (var identifier in locations0) {\r\n            return void relocate();\r\n          }\r\n        }\r\n        d3.selectAll(targets).on(zoomName, null);\r\n        subject.on(mousedown, mousedowned).on(touchstart, touchstarted);\r\n        dragRestore();\r\n        zoomended(dispatch);\r\n      }\r\n    }\r\n    function mousewheeled() {\r\n      var dispatch = event.of(this, arguments);\r\n      if (mousewheelTimer) clearTimeout(mousewheelTimer); else d3_selection_interrupt.call(this), \r\n      translate0 = location(center0 = center || d3.mouse(this)), zoomstarted(dispatch);\r\n      mousewheelTimer = setTimeout(function() {\r\n        mousewheelTimer = null;\r\n        zoomended(dispatch);\r\n      }, 50);\r\n      d3_eventPreventDefault();\r\n      scaleTo(Math.pow(2, d3_behavior_zoomDelta() * .002) * view.k);\r\n      translateTo(center0, translate0);\r\n      zoomed(dispatch);\r\n    }\r\n    function dblclicked() {\r\n      return;\r\n      var p = d3.mouse(this), k = Math.log(view.k) / Math.LN2;\r\n      zoomTo(this, p, location(p), d3.event.shiftKey ? Math.ceil(k) - 1 : Math.floor(k) + 1);\r\n    }\r\n    return d3.rebind(zoom, event, \"on\");\r\n  };\r\n  var d3_behavior_zoomInfinity = [ 0, Infinity ], d3_behavior_zoomDelta, d3_behavior_zoomWheel;\r\n  d3.color = d3_color;\r\n  function d3_color() {}\r\n  d3_color.prototype.toString = function() {\r\n    return this.rgb() + \"\";\r\n  };\r\n  d3.hsl = d3_hsl;\r\n  function d3_hsl(h, s, l) {\r\n    return this instanceof d3_hsl ? void (this.h = +h, this.s = +s, this.l = +l) : arguments.length < 2 ? h instanceof d3_hsl ? new d3_hsl(h.h, h.s, h.l) : d3_rgb_parse(\"\" + h, d3_rgb_hsl, d3_hsl) : new d3_hsl(h, s, l);\r\n  }\r\n  var d3_hslPrototype = d3_hsl.prototype = new d3_color();\r\n  d3_hslPrototype.brighter = function(k) {\r\n    k = Math.pow(.7, arguments.length ? k : 1);\r\n    return new d3_hsl(this.h, this.s, this.l / k);\r\n  };\r\n  d3_hslPrototype.darker = function(k) {\r\n    k = Math.pow(.7, arguments.length ? k : 1);\r\n    return new d3_hsl(this.h, this.s, k * this.l);\r\n  };\r\n  d3_hslPrototype.rgb = function() {\r\n    return d3_hsl_rgb(this.h, this.s, this.l);\r\n  };\r\n  function d3_hsl_rgb(h, s, l) {\r\n    var m1, m2;\r\n    h = isNaN(h) ? 0 : (h %= 360) < 0 ? h + 360 : h;\r\n    s = isNaN(s) ? 0 : s < 0 ? 0 : s > 1 ? 1 : s;\r\n    l = l < 0 ? 0 : l > 1 ? 1 : l;\r\n    m2 = l <= .5 ? l * (1 + s) : l + s - l * s;\r\n    m1 = 2 * l - m2;\r\n    function v(h) {\r\n      if (h > 360) h -= 360; else if (h < 0) h += 360;\r\n      if (h < 60) return m1 + (m2 - m1) * h / 60;\r\n      if (h < 180) return m2;\r\n      if (h < 240) return m1 + (m2 - m1) * (240 - h) / 60;\r\n      return m1;\r\n    }\r\n    function vv(h) {\r\n      return Math.round(v(h) * 255);\r\n    }\r\n    return new d3_rgb(vv(h + 120), vv(h), vv(h - 120));\r\n  }\r\n  d3.hcl = d3_hcl;\r\n  function d3_hcl(h, c, l) {\r\n    return this instanceof d3_hcl ? void (this.h = +h, this.c = +c, this.l = +l) : arguments.length < 2 ? h instanceof d3_hcl ? new d3_hcl(h.h, h.c, h.l) : h instanceof d3_lab ? d3_lab_hcl(h.l, h.a, h.b) : d3_lab_hcl((h = d3_rgb_lab((h = d3.rgb(h)).r, h.g, h.b)).l, h.a, h.b) : new d3_hcl(h, c, l);\r\n  }\r\n  var d3_hclPrototype = d3_hcl.prototype = new d3_color();\r\n  d3_hclPrototype.brighter = function(k) {\r\n    return new d3_hcl(this.h, this.c, Math.min(100, this.l + d3_lab_K * (arguments.length ? k : 1)));\r\n  };\r\n  d3_hclPrototype.darker = function(k) {\r\n    return new d3_hcl(this.h, this.c, Math.max(0, this.l - d3_lab_K * (arguments.length ? k : 1)));\r\n  };\r\n  d3_hclPrototype.rgb = function() {\r\n    return d3_hcl_lab(this.h, this.c, this.l).rgb();\r\n  };\r\n  function d3_hcl_lab(h, c, l) {\r\n    if (isNaN(h)) h = 0;\r\n    if (isNaN(c)) c = 0;\r\n    return new d3_lab(l, Math.cos(h *= d3_radians) * c, Math.sin(h) * c);\r\n  }\r\n  d3.lab = d3_lab;\r\n  function d3_lab(l, a, b) {\r\n    return this instanceof d3_lab ? void (this.l = +l, this.a = +a, this.b = +b) : arguments.length < 2 ? l instanceof d3_lab ? new d3_lab(l.l, l.a, l.b) : l instanceof d3_hcl ? d3_hcl_lab(l.h, l.c, l.l) : d3_rgb_lab((l = d3_rgb(l)).r, l.g, l.b) : new d3_lab(l, a, b);\r\n  }\r\n  var d3_lab_K = 18;\r\n  var d3_lab_X = .95047, d3_lab_Y = 1, d3_lab_Z = 1.08883;\r\n  var d3_labPrototype = d3_lab.prototype = new d3_color();\r\n  d3_labPrototype.brighter = function(k) {\r\n    return new d3_lab(Math.min(100, this.l + d3_lab_K * (arguments.length ? k : 1)), this.a, this.b);\r\n  };\r\n  d3_labPrototype.darker = function(k) {\r\n    return new d3_lab(Math.max(0, this.l - d3_lab_K * (arguments.length ? k : 1)), this.a, this.b);\r\n  };\r\n  d3_labPrototype.rgb = function() {\r\n    return d3_lab_rgb(this.l, this.a, this.b);\r\n  };\r\n  function d3_lab_rgb(l, a, b) {\r\n    var y = (l + 16) / 116, x = y + a / 500, z = y - b / 200;\r\n    x = d3_lab_xyz(x) * d3_lab_X;\r\n    y = d3_lab_xyz(y) * d3_lab_Y;\r\n    z = d3_lab_xyz(z) * d3_lab_Z;\r\n    return new d3_rgb(d3_xyz_rgb(3.2404542 * x - 1.5371385 * y - .4985314 * z), d3_xyz_rgb(-.969266 * x + 1.8760108 * y + .041556 * z), d3_xyz_rgb(.0556434 * x - .2040259 * y + 1.0572252 * z));\r\n  }\r\n  function d3_lab_hcl(l, a, b) {\r\n    return l > 0 ? new d3_hcl(Math.atan2(b, a) * d3_degrees, Math.sqrt(a * a + b * b), l) : new d3_hcl(NaN, NaN, l);\r\n  }\r\n  function d3_lab_xyz(x) {\r\n    return x > .206893034 ? x * x * x : (x - 4 / 29) / 7.787037;\r\n  }\r\n  function d3_xyz_lab(x) {\r\n    return x > .008856 ? Math.pow(x, 1 / 3) : 7.787037 * x + 4 / 29;\r\n  }\r\n  function d3_xyz_rgb(r) {\r\n    return Math.round(255 * (r <= .00304 ? 12.92 * r : 1.055 * Math.pow(r, 1 / 2.4) - .055));\r\n  }\r\n  d3.rgb = d3_rgb;\r\n  function d3_rgb(r, g, b) {\r\n    return this instanceof d3_rgb ? void (this.r = ~~r, this.g = ~~g, this.b = ~~b) : arguments.length < 2 ? r instanceof d3_rgb ? new d3_rgb(r.r, r.g, r.b) : d3_rgb_parse(\"\" + r, d3_rgb, d3_hsl_rgb) : new d3_rgb(r, g, b);\r\n  }\r\n  function d3_rgbNumber(value) {\r\n    return new d3_rgb(value >> 16, value >> 8 & 255, value & 255);\r\n  }\r\n  function d3_rgbString(value) {\r\n    return d3_rgbNumber(value) + \"\";\r\n  }\r\n  var d3_rgbPrototype = d3_rgb.prototype = new d3_color();\r\n  d3_rgbPrototype.brighter = function(k) {\r\n    k = Math.pow(.7, arguments.length ? k : 1);\r\n    var r = this.r, g = this.g, b = this.b, i = 30;\r\n    if (!r && !g && !b) return new d3_rgb(i, i, i);\r\n    if (r && r < i) r = i;\r\n    if (g && g < i) g = i;\r\n    if (b && b < i) b = i;\r\n    return new d3_rgb(Math.min(255, r / k), Math.min(255, g / k), Math.min(255, b / k));\r\n  };\r\n  d3_rgbPrototype.darker = function(k) {\r\n    k = Math.pow(.7, arguments.length ? k : 1);\r\n    return new d3_rgb(k * this.r, k * this.g, k * this.b);\r\n  };\r\n  d3_rgbPrototype.hsl = function() {\r\n    return d3_rgb_hsl(this.r, this.g, this.b);\r\n  };\r\n  d3_rgbPrototype.toString = function() {\r\n    return \"#\" + d3_rgb_hex(this.r) + d3_rgb_hex(this.g) + d3_rgb_hex(this.b);\r\n  };\r\n  function d3_rgb_hex(v) {\r\n    return v < 16 ? \"0\" + Math.max(0, v).toString(16) : Math.min(255, v).toString(16);\r\n  }\r\n  function d3_rgb_parse(format, rgb, hsl) {\r\n    var r = 0, g = 0, b = 0, m1, m2, color;\r\n    m1 = /([a-z]+)\\((.*)\\)/.exec(format = format.toLowerCase());\r\n    if (m1) {\r\n      m2 = m1[2].split(\",\");\r\n      switch (m1[1]) {\r\n       case \"hsl\":\r\n        {\r\n          return hsl(parseFloat(m2[0]), parseFloat(m2[1]) / 100, parseFloat(m2[2]) / 100);\r\n        }\r\n\r\n       case \"rgb\":\r\n        {\r\n          return rgb(d3_rgb_parseNumber(m2[0]), d3_rgb_parseNumber(m2[1]), d3_rgb_parseNumber(m2[2]));\r\n        }\r\n      }\r\n    }\r\n    if (color = d3_rgb_names.get(format)) {\r\n      return rgb(color.r, color.g, color.b);\r\n    }\r\n    if (format != null && format.charAt(0) === \"#\" && !isNaN(color = parseInt(format.slice(1), 16))) {\r\n      if (format.length === 4) {\r\n        r = (color & 3840) >> 4;\r\n        r = r >> 4 | r;\r\n        g = color & 240;\r\n        g = g >> 4 | g;\r\n        b = color & 15;\r\n        b = b << 4 | b;\r\n      } else if (format.length === 7) {\r\n        r = (color & 16711680) >> 16;\r\n        g = (color & 65280) >> 8;\r\n        b = color & 255;\r\n      }\r\n    }\r\n    return rgb(r, g, b);\r\n  }\r\n  function d3_rgb_hsl(r, g, b) {\r\n    var min = Math.min(r /= 255, g /= 255, b /= 255), max = Math.max(r, g, b), d = max - min, h, s, l = (max + min) / 2;\r\n    if (d) {\r\n      s = l < .5 ? d / (max + min) : d / (2 - max - min);\r\n      if (r == max) h = (g - b) / d + (g < b ? 6 : 0); else if (g == max) h = (b - r) / d + 2; else h = (r - g) / d + 4;\r\n      h *= 60;\r\n    } else {\r\n      h = NaN;\r\n      s = l > 0 && l < 1 ? 0 : h;\r\n    }\r\n    return new d3_hsl(h, s, l);\r\n  }\r\n  function d3_rgb_lab(r, g, b) {\r\n    r = d3_rgb_xyz(r);\r\n    g = d3_rgb_xyz(g);\r\n    b = d3_rgb_xyz(b);\r\n    var x = d3_xyz_lab((.4124564 * r + .3575761 * g + .1804375 * b) / d3_lab_X), y = d3_xyz_lab((.2126729 * r + .7151522 * g + .072175 * b) / d3_lab_Y), z = d3_xyz_lab((.0193339 * r + .119192 * g + .9503041 * b) / d3_lab_Z);\r\n    return d3_lab(116 * y - 16, 500 * (x - y), 200 * (y - z));\r\n  }\r\n  function d3_rgb_xyz(r) {\r\n    return (r /= 255) <= .04045 ? r / 12.92 : Math.pow((r + .055) / 1.055, 2.4);\r\n  }\r\n  function d3_rgb_parseNumber(c) {\r\n    var f = parseFloat(c);\r\n    return c.charAt(c.length - 1) === \"%\" ? Math.round(f * 2.55) : f;\r\n  }\r\n  var d3_rgb_names = d3.map({\r\n    aliceblue: 15792383,\r\n    antiquewhite: 16444375,\r\n    aqua: 65535,\r\n    aquamarine: 8388564,\r\n    azure: 15794175,\r\n    beige: 16119260,\r\n    bisque: 16770244,\r\n    black: 0,\r\n    blanchedalmond: 16772045,\r\n    blue: 255,\r\n    blueviolet: 9055202,\r\n    brown: 10824234,\r\n    burlywood: 14596231,\r\n    cadetblue: 6266528,\r\n    chartreuse: 8388352,\r\n    chocolate: 13789470,\r\n    coral: 16744272,\r\n    cornflowerblue: 6591981,\r\n    cornsilk: 16775388,\r\n    crimson: 14423100,\r\n    cyan: 65535,\r\n    darkblue: 139,\r\n    darkcyan: 35723,\r\n    darkgoldenrod: 12092939,\r\n    darkgray: 11119017,\r\n    darkgreen: 25600,\r\n    darkgrey: 11119017,\r\n    darkkhaki: 12433259,\r\n    darkmagenta: 9109643,\r\n    darkolivegreen: 5597999,\r\n    darkorange: 16747520,\r\n    darkorchid: 10040012,\r\n    darkred: 9109504,\r\n    darksalmon: 15308410,\r\n    darkseagreen: 9419919,\r\n    darkslateblue: 4734347,\r\n    darkslategray: 3100495,\r\n    darkslategrey: 3100495,\r\n    darkturquoise: 52945,\r\n    darkviolet: 9699539,\r\n    deeppink: 16716947,\r\n    deepskyblue: 49151,\r\n    dimgray: 6908265,\r\n    dimgrey: 6908265,\r\n    dodgerblue: 2003199,\r\n    firebrick: 11674146,\r\n    floralwhite: 16775920,\r\n    forestgreen: 2263842,\r\n    fuchsia: 16711935,\r\n    gainsboro: 14474460,\r\n    ghostwhite: 16316671,\r\n    gold: 16766720,\r\n    goldenrod: 14329120,\r\n    gray: 8421504,\r\n    green: 32768,\r\n    greenyellow: 11403055,\r\n    grey: 8421504,\r\n    honeydew: 15794160,\r\n    hotpink: 16738740,\r\n    indianred: 13458524,\r\n    indigo: 4915330,\r\n    ivory: 16777200,\r\n    khaki: 15787660,\r\n    lavender: 15132410,\r\n    lavenderblush: 16773365,\r\n    lawngreen: 8190976,\r\n    lemonchiffon: 16775885,\r\n    lightblue: 11393254,\r\n    lightcoral: 15761536,\r\n    lightcyan: 14745599,\r\n    lightgoldenrodyellow: 16448210,\r\n    lightgray: 13882323,\r\n    lightgreen: 9498256,\r\n    lightgrey: 13882323,\r\n    lightpink: 16758465,\r\n    lightsalmon: 16752762,\r\n    lightseagreen: 2142890,\r\n    lightskyblue: 8900346,\r\n    lightslategray: 7833753,\r\n    lightslategrey: 7833753,\r\n    lightsteelblue: 11584734,\r\n    lightyellow: 16777184,\r\n    lime: 65280,\r\n    limegreen: 3329330,\r\n    linen: 16445670,\r\n    magenta: 16711935,\r\n    maroon: 8388608,\r\n    mediumaquamarine: 6737322,\r\n    mediumblue: 205,\r\n    mediumorchid: 12211667,\r\n    mediumpurple: 9662683,\r\n    mediumseagreen: 3978097,\r\n    mediumslateblue: 8087790,\r\n    mediumspringgreen: 64154,\r\n    mediumturquoise: 4772300,\r\n    mediumvioletred: 13047173,\r\n    midnightblue: 1644912,\r\n    mintcream: 16121850,\r\n    mistyrose: 16770273,\r\n    moccasin: 16770229,\r\n    navajowhite: 16768685,\r\n    navy: 128,\r\n    oldlace: 16643558,\r\n    olive: 8421376,\r\n    olivedrab: 7048739,\r\n    orange: 16753920,\r\n    orangered: 16729344,\r\n    orchid: 14315734,\r\n    palegoldenrod: 15657130,\r\n    palegreen: 10025880,\r\n    paleturquoise: 11529966,\r\n    palevioletred: 14381203,\r\n    papayawhip: 16773077,\r\n    peachpuff: 16767673,\r\n    peru: 13468991,\r\n    pink: 16761035,\r\n    plum: 14524637,\r\n    powderblue: 11591910,\r\n    purple: 8388736,\r\n    rebeccapurple: 6697881,\r\n    red: 16711680,\r\n    rosybrown: 12357519,\r\n    royalblue: 4286945,\r\n    saddlebrown: 9127187,\r\n    salmon: 16416882,\r\n    sandybrown: 16032864,\r\n    seagreen: 3050327,\r\n    seashell: 16774638,\r\n    sienna: 10506797,\r\n    silver: 12632256,\r\n    skyblue: 8900331,\r\n    slateblue: 6970061,\r\n    slategray: 7372944,\r\n    slategrey: 7372944,\r\n    snow: 16775930,\r\n    springgreen: 65407,\r\n    steelblue: 4620980,\r\n    tan: 13808780,\r\n    teal: 32896,\r\n    thistle: 14204888,\r\n    tomato: 16737095,\r\n    turquoise: 4251856,\r\n    violet: 15631086,\r\n    wheat: 16113331,\r\n    white: 16777215,\r\n    whitesmoke: 16119285,\r\n    yellow: 16776960,\r\n    yellowgreen: 10145074\r\n  });\r\n  d3_rgb_names.forEach(function(key, value) {\r\n    d3_rgb_names.set(key, d3_rgbNumber(value));\r\n  });\r\n  function d3_functor(v) {\r\n    return typeof v === \"function\" ? v : function() {\r\n      return v;\r\n    };\r\n  }\r\n  d3.functor = d3_functor;\r\n  d3.xhr = d3_xhrType(d3_identity);\r\n  function d3_xhrType(response) {\r\n    return function(url, mimeType, callback) {\r\n      if (arguments.length === 2 && typeof mimeType === \"function\") callback = mimeType, \r\n      mimeType = null;\r\n      return d3_xhr(url, mimeType, response, callback);\r\n    };\r\n  }\r\n  function d3_xhr(url, mimeType, response, callback) {\r\n    var xhr = {}, dispatch = d3.dispatch(\"beforesend\", \"progress\", \"load\", \"error\"), headers = {}, request = new XMLHttpRequest(), responseType = null;\r\n    if (this.XDomainRequest && !(\"withCredentials\" in request) && /^(http(s)?:)?\\/\\//.test(url)) request = new XDomainRequest();\r\n    \"onload\" in request ? request.onload = request.onerror = respond : request.onreadystatechange = function() {\r\n      request.readyState > 3 && respond();\r\n    };\r\n    function respond() {\r\n      var status = request.status, result;\r\n      if (!status && d3_xhrHasResponse(request) || status >= 200 && status < 300 || status === 304) {\r\n        try {\r\n          result = response.call(xhr, request);\r\n        } catch (e) {\r\n          dispatch.error.call(xhr, e);\r\n          return;\r\n        }\r\n        dispatch.load.call(xhr, result);\r\n      } else {\r\n        dispatch.error.call(xhr, request);\r\n      }\r\n    }\r\n    request.onprogress = function(event) {\r\n      var o = d3.event;\r\n      d3.event = event;\r\n      try {\r\n        dispatch.progress.call(xhr, request);\r\n      } finally {\r\n        d3.event = o;\r\n      }\r\n    };\r\n    xhr.header = function(name, value) {\r\n      name = (name + \"\").toLowerCase();\r\n      if (arguments.length < 2) return headers[name];\r\n      if (value == null) delete headers[name]; else headers[name] = value + \"\";\r\n      return xhr;\r\n    };\r\n    xhr.mimeType = function(value) {\r\n      if (!arguments.length) return mimeType;\r\n      mimeType = value == null ? null : value + \"\";\r\n      return xhr;\r\n    };\r\n    xhr.responseType = function(value) {\r\n      if (!arguments.length) return responseType;\r\n      responseType = value;\r\n      return xhr;\r\n    };\r\n    xhr.response = function(value) {\r\n      response = value;\r\n      return xhr;\r\n    };\r\n    [ \"get\", \"post\" ].forEach(function(method) {\r\n      xhr[method] = function() {\r\n        return xhr.send.apply(xhr, [ method ].concat(d3_array(arguments)));\r\n      };\r\n    });\r\n    xhr.send = function(method, data, callback) {\r\n      if (arguments.length === 2 && typeof data === \"function\") callback = data, data = null;\r\n      request.open(method, url, true);\r\n      if (mimeType != null && !(\"accept\" in headers)) headers[\"accept\"] = mimeType + \",*/*\";\r\n      if (request.setRequestHeader) for (var name in headers) request.setRequestHeader(name, headers[name]);\r\n      if (mimeType != null && request.overrideMimeType) request.overrideMimeType(mimeType);\r\n      if (responseType != null) request.responseType = responseType;\r\n      if (callback != null) xhr.on(\"error\", callback).on(\"load\", function(request) {\r\n        callback(null, request);\r\n      });\r\n      dispatch.beforesend.call(xhr, request);\r\n      request.send(data == null ? null : data);\r\n      return xhr;\r\n    };\r\n    xhr.abort = function() {\r\n      request.abort();\r\n      return xhr;\r\n    };\r\n    d3.rebind(xhr, dispatch, \"on\");\r\n    return callback == null ? xhr : xhr.get(d3_xhr_fixCallback(callback));\r\n  }\r\n  function d3_xhr_fixCallback(callback) {\r\n    return callback.length === 1 ? function(error, request) {\r\n      callback(error == null ? request : null);\r\n    } : callback;\r\n  }\r\n  function d3_xhrHasResponse(request) {\r\n    var type = request.responseType;\r\n    return type && type !== \"text\" ? request.response : request.responseText;\r\n  }\r\n  d3.dsv = function(delimiter, mimeType) {\r\n    var reFormat = new RegExp('[\"' + delimiter + \"\\n]\"), delimiterCode = delimiter.charCodeAt(0);\r\n    function dsv(url, row, callback) {\r\n      if (arguments.length < 3) callback = row, row = null;\r\n      var xhr = d3_xhr(url, mimeType, row == null ? response : typedResponse(row), callback);\r\n      xhr.row = function(_) {\r\n        return arguments.length ? xhr.response((row = _) == null ? response : typedResponse(_)) : row;\r\n      };\r\n      return xhr;\r\n    }\r\n    function response(request) {\r\n      return dsv.parse(request.responseText);\r\n    }\r\n    function typedResponse(f) {\r\n      return function(request) {\r\n        return dsv.parse(request.responseText, f);\r\n      };\r\n    }\r\n    dsv.parse = function(text, f) {\r\n      var o;\r\n      return dsv.parseRows(text, function(row, i) {\r\n        if (o) return o(row, i - 1);\r\n        var a = new Function(\"d\", \"return {\" + row.map(function(name, i) {\r\n          return JSON.stringify(name) + \": d[\" + i + \"]\";\r\n        }).join(\",\") + \"}\");\r\n        o = f ? function(row, i) {\r\n          return f(a(row), i);\r\n        } : a;\r\n      });\r\n    };\r\n    dsv.parseRows = function(text, f) {\r\n      var EOL = {}, EOF = {}, rows = [], N = text.length, I = 0, n = 0, t, eol;\r\n      function token() {\r\n        if (I >= N) return EOF;\r\n        if (eol) return eol = false, EOL;\r\n        var j = I;\r\n        if (text.charCodeAt(j) === 34) {\r\n          var i = j;\r\n          while (i++ < N) {\r\n            if (text.charCodeAt(i) === 34) {\r\n              if (text.charCodeAt(i + 1) !== 34) break;\r\n              ++i;\r\n            }\r\n          }\r\n          I = i + 2;\r\n          var c = text.charCodeAt(i + 1);\r\n          if (c === 13) {\r\n            eol = true;\r\n            if (text.charCodeAt(i + 2) === 10) ++I;\r\n          } else if (c === 10) {\r\n            eol = true;\r\n          }\r\n          return text.slice(j + 1, i).replace(/\"\"/g, '\"');\r\n        }\r\n        while (I < N) {\r\n          var c = text.charCodeAt(I++), k = 1;\r\n          if (c === 10) eol = true; else if (c === 13) {\r\n            eol = true;\r\n            if (text.charCodeAt(I) === 10) ++I, ++k;\r\n          } else if (c !== delimiterCode) continue;\r\n          return text.slice(j, I - k);\r\n        }\r\n        return text.slice(j);\r\n      }\r\n      while ((t = token()) !== EOF) {\r\n        var a = [];\r\n        while (t !== EOL && t !== EOF) {\r\n          a.push(t);\r\n          t = token();\r\n        }\r\n        if (f && (a = f(a, n++)) == null) continue;\r\n        rows.push(a);\r\n      }\r\n      return rows;\r\n    };\r\n    dsv.format = function(rows) {\r\n      if (Array.isArray(rows[0])) return dsv.formatRows(rows);\r\n      var fieldSet = new d3_Set(), fields = [];\r\n      rows.forEach(function(row) {\r\n        for (var field in row) {\r\n          if (!fieldSet.has(field)) {\r\n            fields.push(fieldSet.add(field));\r\n          }\r\n        }\r\n      });\r\n      return [ fields.map(formatValue).join(delimiter) ].concat(rows.map(function(row) {\r\n        return fields.map(function(field) {\r\n          return formatValue(row[field]);\r\n        }).join(delimiter);\r\n      })).join(\"\\n\");\r\n    };\r\n    dsv.formatRows = function(rows) {\r\n      return rows.map(formatRow).join(\"\\n\");\r\n    };\r\n    function formatRow(row) {\r\n      return row.map(formatValue).join(delimiter);\r\n    }\r\n    function formatValue(text) {\r\n      return reFormat.test(text) ? '\"' + text.replace(/\\\"/g, '\"\"') + '\"' : text;\r\n    }\r\n    return dsv;\r\n  };\r\n  d3.csv = d3.dsv(\",\", \"text/csv\");\r\n  d3.tsv = d3.dsv(\"\t\", \"text/tab-separated-values\");\r\n  var d3_timer_queueHead, d3_timer_queueTail, d3_timer_interval, d3_timer_timeout, d3_timer_frame = this[d3_vendorSymbol(this, \"requestAnimationFrame\")] || function(callback) {\r\n    setTimeout(callback, 17);\r\n  };\r\n  d3.timer = function() {\r\n    d3_timer.apply(this, arguments);\r\n  };\r\n  function d3_timer(callback, delay, then) {\r\n    var n = arguments.length;\r\n    if (n < 2) delay = 0;\r\n    if (n < 3) then = Date.now();\r\n    var time = then + delay, timer = {\r\n      c: callback,\r\n      t: time,\r\n      n: null\r\n    };\r\n    if (d3_timer_queueTail) d3_timer_queueTail.n = timer; else d3_timer_queueHead = timer;\r\n    d3_timer_queueTail = timer;\r\n    if (!d3_timer_interval) {\r\n      d3_timer_timeout = clearTimeout(d3_timer_timeout);\r\n      d3_timer_interval = 1;\r\n      d3_timer_frame(d3_timer_step);\r\n    }\r\n    return timer;\r\n  }\r\n  function d3_timer_step() {\r\n    var now = d3_timer_mark(), delay = d3_timer_sweep() - now;\r\n    if (delay > 24) {\r\n      if (isFinite(delay)) {\r\n        clearTimeout(d3_timer_timeout);\r\n        d3_timer_timeout = setTimeout(d3_timer_step, delay);\r\n      }\r\n      d3_timer_interval = 0;\r\n    } else {\r\n      d3_timer_interval = 1;\r\n      d3_timer_frame(d3_timer_step);\r\n    }\r\n  }\r\n  d3.timer.flush = function() {\r\n    d3_timer_mark();\r\n    d3_timer_sweep();\r\n  };\r\n  function d3_timer_mark() {\r\n    var now = Date.now(), timer = d3_timer_queueHead;\r\n    while (timer) {\r\n      if (now >= timer.t && timer.c(now - timer.t)) timer.c = null;\r\n      timer = timer.n;\r\n    }\r\n    return now;\r\n  }\r\n  function d3_timer_sweep() {\r\n    var t0, t1 = d3_timer_queueHead, time = Infinity;\r\n    while (t1) {\r\n      if (t1.c) {\r\n        if (t1.t < time) time = t1.t;\r\n        t1 = (t0 = t1).n;\r\n      } else {\r\n        t1 = t0 ? t0.n = t1.n : d3_timer_queueHead = t1.n;\r\n      }\r\n    }\r\n    d3_timer_queueTail = t0;\r\n    return time;\r\n  }\r\n  function d3_format_precision(x, p) {\r\n    return p - (x ? Math.ceil(Math.log(x) / Math.LN10) : 1);\r\n  }\r\n  d3.round = function(x, n) {\r\n    return n ? Math.round(x * (n = Math.pow(10, n))) / n : Math.round(x);\r\n  };\r\n  var d3_formatPrefixes = [ \"y\", \"z\", \"a\", \"f\", \"p\", \"n\", \"µ\", \"m\", \"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\", \"Z\", \"Y\" ].map(d3_formatPrefix);\r\n  d3.formatPrefix = function(value, precision) {\r\n    var i = 0;\r\n    if (value = +value) {\r\n      if (value < 0) value *= -1;\r\n      if (precision) value = d3.round(value, d3_format_precision(value, precision));\r\n      i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);\r\n      i = Math.max(-24, Math.min(24, Math.floor((i - 1) / 3) * 3));\r\n    }\r\n    return d3_formatPrefixes[8 + i / 3];\r\n  };\r\n  function d3_formatPrefix(d, i) {\r\n    var k = Math.pow(10, abs(8 - i) * 3);\r\n    return {\r\n      scale: i > 8 ? function(d) {\r\n        return d / k;\r\n      } : function(d) {\r\n        return d * k;\r\n      },\r\n      symbol: d\r\n    };\r\n  }\r\n  function d3_locale_numberFormat(locale) {\r\n    var locale_decimal = locale.decimal, locale_thousands = locale.thousands, locale_grouping = locale.grouping, locale_currency = locale.currency, formatGroup = locale_grouping && locale_thousands ? function(value, width) {\r\n      var i = value.length, t = [], j = 0, g = locale_grouping[0], length = 0;\r\n      while (i > 0 && g > 0) {\r\n        if (length + g + 1 > width) g = Math.max(1, width - length);\r\n        t.push(value.substring(i -= g, i + g));\r\n        if ((length += g + 1) > width) break;\r\n        g = locale_grouping[j = (j + 1) % locale_grouping.length];\r\n      }\r\n      return t.reverse().join(locale_thousands);\r\n    } : d3_identity;\r\n    return function(specifier) {\r\n      var match = d3_format_re.exec(specifier), fill = match[1] || \" \", align = match[2] || \">\", sign = match[3] || \"-\", symbol = match[4] || \"\", zfill = match[5], width = +match[6], comma = match[7], precision = match[8], type = match[9], scale = 1, prefix = \"\", suffix = \"\", integer = false, exponent = true;\r\n      if (precision) precision = +precision.substring(1);\r\n      if (zfill || fill === \"0\" && align === \"=\") {\r\n        zfill = fill = \"0\";\r\n        align = \"=\";\r\n      }\r\n      switch (type) {\r\n       case \"n\":\r\n        comma = true;\r\n        type = \"g\";\r\n        break;\r\n\r\n       case \"%\":\r\n        scale = 100;\r\n        suffix = \"%\";\r\n        type = \"f\";\r\n        break;\r\n\r\n       case \"p\":\r\n        scale = 100;\r\n        suffix = \"%\";\r\n        type = \"r\";\r\n        break;\r\n\r\n       case \"b\":\r\n       case \"o\":\r\n       case \"x\":\r\n       case \"X\":\r\n        if (symbol === \"#\") prefix = \"0\" + type.toLowerCase();\r\n\r\n       case \"c\":\r\n        exponent = false;\r\n\r\n       case \"d\":\r\n        integer = true;\r\n        precision = 0;\r\n        break;\r\n\r\n       case \"s\":\r\n        scale = -1;\r\n        type = \"r\";\r\n        break;\r\n      }\r\n      if (symbol === \"$\") prefix = locale_currency[0], suffix = locale_currency[1];\r\n      if (type == \"r\" && !precision) type = \"g\";\r\n      if (precision != null) {\r\n        if (type == \"g\") precision = Math.max(1, Math.min(21, precision)); else if (type == \"e\" || type == \"f\") precision = Math.max(0, Math.min(20, precision));\r\n      }\r\n      type = d3_format_types.get(type) || d3_format_typeDefault;\r\n      var zcomma = zfill && comma;\r\n      return function(value) {\r\n        var fullSuffix = suffix;\r\n        if (integer && value % 1) return \"\";\r\n        var negative = value < 0 || value === 0 && 1 / value < 0 ? (value = -value, \"-\") : sign === \"-\" ? \"\" : sign;\r\n        if (scale < 0) {\r\n          var unit = d3.formatPrefix(value, precision);\r\n          value = unit.scale(value);\r\n          fullSuffix = unit.symbol + suffix;\r\n        } else {\r\n          value *= scale;\r\n        }\r\n        value = type(value, precision);\r\n        var i = value.lastIndexOf(\".\"), before, after;\r\n        if (i < 0) {\r\n          var j = exponent ? value.lastIndexOf(\"e\") : -1;\r\n          if (j < 0) before = value, after = \"\"; else before = value.substring(0, j), after = value.substring(j);\r\n        } else {\r\n          before = value.substring(0, i);\r\n          after = locale_decimal + value.substring(i + 1);\r\n        }\r\n        if (!zfill && comma) before = formatGroup(before, Infinity);\r\n        var length = prefix.length + before.length + after.length + (zcomma ? 0 : negative.length), padding = length < width ? new Array(length = width - length + 1).join(fill) : \"\";\r\n        if (zcomma) before = formatGroup(padding + before, padding.length ? width - after.length : Infinity);\r\n        negative += prefix;\r\n        value = before + after;\r\n        return (align === \"<\" ? negative + value + padding : align === \">\" ? padding + negative + value : align === \"^\" ? padding.substring(0, length >>= 1) + negative + value + padding.substring(length) : negative + (zcomma ? value : padding + value)) + fullSuffix;\r\n      };\r\n    };\r\n  }\r\n  var d3_format_re = /(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i;\r\n  var d3_format_types = d3.map({\r\n    b: function(x) {\r\n      return x.toString(2);\r\n    },\r\n    c: function(x) {\r\n      return String.fromCharCode(x);\r\n    },\r\n    o: function(x) {\r\n      return x.toString(8);\r\n    },\r\n    x: function(x) {\r\n      return x.toString(16);\r\n    },\r\n    X: function(x) {\r\n      return x.toString(16).toUpperCase();\r\n    },\r\n    g: function(x, p) {\r\n      return x.toPrecision(p);\r\n    },\r\n    e: function(x, p) {\r\n      return x.toExponential(p);\r\n    },\r\n    f: function(x, p) {\r\n      return x.toFixed(p);\r\n    },\r\n    r: function(x, p) {\r\n      return (x = d3.round(x, d3_format_precision(x, p))).toFixed(Math.max(0, Math.min(20, d3_format_precision(x * (1 + 1e-15), p))));\r\n    }\r\n  });\r\n  function d3_format_typeDefault(x) {\r\n    return x + \"\";\r\n  }\r\n  var d3_time = d3.time = {}, d3_date = Date;\r\n  function d3_date_utc() {\r\n    this._ = new Date(arguments.length > 1 ? Date.UTC.apply(this, arguments) : arguments[0]);\r\n  }\r\n  d3_date_utc.prototype = {\r\n    getDate: function() {\r\n      return this._.getUTCDate();\r\n    },\r\n    getDay: function() {\r\n      return this._.getUTCDay();\r\n    },\r\n    getFullYear: function() {\r\n      return this._.getUTCFullYear();\r\n    },\r\n    getHours: function() {\r\n      return this._.getUTCHours();\r\n    },\r\n    getMilliseconds: function() {\r\n      return this._.getUTCMilliseconds();\r\n    },\r\n    getMinutes: function() {\r\n      return this._.getUTCMinutes();\r\n    },\r\n    getMonth: function() {\r\n      return this._.getUTCMonth();\r\n    },\r\n    getSeconds: function() {\r\n      return this._.getUTCSeconds();\r\n    },\r\n    getTime: function() {\r\n      return this._.getTime();\r\n    },\r\n    getTimezoneOffset: function() {\r\n      return 0;\r\n    },\r\n    valueOf: function() {\r\n      return this._.valueOf();\r\n    },\r\n    setDate: function() {\r\n      d3_time_prototype.setUTCDate.apply(this._, arguments);\r\n    },\r\n    setDay: function() {\r\n      d3_time_prototype.setUTCDay.apply(this._, arguments);\r\n    },\r\n    setFullYear: function() {\r\n      d3_time_prototype.setUTCFullYear.apply(this._, arguments);\r\n    },\r\n    setHours: function() {\r\n      d3_time_prototype.setUTCHours.apply(this._, arguments);\r\n    },\r\n    setMilliseconds: function() {\r\n      d3_time_prototype.setUTCMilliseconds.apply(this._, arguments);\r\n    },\r\n    setMinutes: function() {\r\n      d3_time_prototype.setUTCMinutes.apply(this._, arguments);\r\n    },\r\n    setMonth: function() {\r\n      d3_time_prototype.setUTCMonth.apply(this._, arguments);\r\n    },\r\n    setSeconds: function() {\r\n      d3_time_prototype.setUTCSeconds.apply(this._, arguments);\r\n    },\r\n    setTime: function() {\r\n      d3_time_prototype.setTime.apply(this._, arguments);\r\n    }\r\n  };\r\n  var d3_time_prototype = Date.prototype;\r\n  function d3_time_interval(local, step, number) {\r\n    function round(date) {\r\n      var d0 = local(date), d1 = offset(d0, 1);\r\n      return date - d0 < d1 - date ? d0 : d1;\r\n    }\r\n    function ceil(date) {\r\n      step(date = local(new d3_date(date - 1)), 1);\r\n      return date;\r\n    }\r\n    function offset(date, k) {\r\n      step(date = new d3_date(+date), k);\r\n      return date;\r\n    }\r\n    function range(t0, t1, dt) {\r\n      var time = ceil(t0), times = [];\r\n      if (dt > 1) {\r\n        while (time < t1) {\r\n          if (!(number(time) % dt)) times.push(new Date(+time));\r\n          step(time, 1);\r\n        }\r\n      } else {\r\n        while (time < t1) times.push(new Date(+time)), step(time, 1);\r\n      }\r\n      return times;\r\n    }\r\n    function range_utc(t0, t1, dt) {\r\n      try {\r\n        d3_date = d3_date_utc;\r\n        var utc = new d3_date_utc();\r\n        utc._ = t0;\r\n        return range(utc, t1, dt);\r\n      } finally {\r\n        d3_date = Date;\r\n      }\r\n    }\r\n    local.floor = local;\r\n    local.round = round;\r\n    local.ceil = ceil;\r\n    local.offset = offset;\r\n    local.range = range;\r\n    var utc = local.utc = d3_time_interval_utc(local);\r\n    utc.floor = utc;\r\n    utc.round = d3_time_interval_utc(round);\r\n    utc.ceil = d3_time_interval_utc(ceil);\r\n    utc.offset = d3_time_interval_utc(offset);\r\n    utc.range = range_utc;\r\n    return local;\r\n  }\r\n  function d3_time_interval_utc(method) {\r\n    return function(date, k) {\r\n      try {\r\n        d3_date = d3_date_utc;\r\n        var utc = new d3_date_utc();\r\n        utc._ = date;\r\n        return method(utc, k)._;\r\n      } finally {\r\n        d3_date = Date;\r\n      }\r\n    };\r\n  }\r\n  d3_time.year = d3_time_interval(function(date) {\r\n    date = d3_time.day(date);\r\n    date.setMonth(0, 1);\r\n    return date;\r\n  }, function(date, offset) {\r\n    date.setFullYear(date.getFullYear() + offset);\r\n  }, function(date) {\r\n    return date.getFullYear();\r\n  });\r\n  d3_time.years = d3_time.year.range;\r\n  d3_time.years.utc = d3_time.year.utc.range;\r\n  d3_time.day = d3_time_interval(function(date) {\r\n    var day = new d3_date(2e3, 0);\r\n    day.setFullYear(date.getFullYear(), date.getMonth(), date.getDate());\r\n    return day;\r\n  }, function(date, offset) {\r\n    date.setDate(date.getDate() + offset);\r\n  }, function(date) {\r\n    return date.getDate() - 1;\r\n  });\r\n  d3_time.days = d3_time.day.range;\r\n  d3_time.days.utc = d3_time.day.utc.range;\r\n  d3_time.dayOfYear = function(date) {\r\n    var year = d3_time.year(date);\r\n    return Math.floor((date - year - (date.getTimezoneOffset() - year.getTimezoneOffset()) * 6e4) / 864e5);\r\n  };\r\n  [ \"sunday\", \"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\" ].forEach(function(day, i) {\r\n    i = 7 - i;\r\n    var interval = d3_time[day] = d3_time_interval(function(date) {\r\n      (date = d3_time.day(date)).setDate(date.getDate() - (date.getDay() + i) % 7);\r\n      return date;\r\n    }, function(date, offset) {\r\n      date.setDate(date.getDate() + Math.floor(offset) * 7);\r\n    }, function(date) {\r\n      var day = d3_time.year(date).getDay();\r\n      return Math.floor((d3_time.dayOfYear(date) + (day + i) % 7) / 7) - (day !== i);\r\n    });\r\n    d3_time[day + \"s\"] = interval.range;\r\n    d3_time[day + \"s\"].utc = interval.utc.range;\r\n    d3_time[day + \"OfYear\"] = function(date) {\r\n      var day = d3_time.year(date).getDay();\r\n      return Math.floor((d3_time.dayOfYear(date) + (day + i) % 7) / 7);\r\n    };\r\n  });\r\n  d3_time.week = d3_time.sunday;\r\n  d3_time.weeks = d3_time.sunday.range;\r\n  d3_time.weeks.utc = d3_time.sunday.utc.range;\r\n  d3_time.weekOfYear = d3_time.sundayOfYear;\r\n  function d3_locale_timeFormat(locale) {\r\n    var locale_dateTime = locale.dateTime, locale_date = locale.date, locale_time = locale.time, locale_periods = locale.periods, locale_days = locale.days, locale_shortDays = locale.shortDays, locale_months = locale.months, locale_shortMonths = locale.shortMonths;\r\n    function d3_time_format(template) {\r\n      var n = template.length;\r\n      function format(date) {\r\n        var string = [], i = -1, j = 0, c, p, f;\r\n        while (++i < n) {\r\n          if (template.charCodeAt(i) === 37) {\r\n            string.push(template.slice(j, i));\r\n            if ((p = d3_time_formatPads[c = template.charAt(++i)]) != null) c = template.charAt(++i);\r\n            if (f = d3_time_formats[c]) c = f(date, p == null ? c === \"e\" ? \" \" : \"0\" : p);\r\n            string.push(c);\r\n            j = i + 1;\r\n          }\r\n        }\r\n        string.push(template.slice(j, i));\r\n        return string.join(\"\");\r\n      }\r\n      format.parse = function(string) {\r\n        var d = {\r\n          y: 1900,\r\n          m: 0,\r\n          d: 1,\r\n          H: 0,\r\n          M: 0,\r\n          S: 0,\r\n          L: 0,\r\n          Z: null\r\n        }, i = d3_time_parse(d, template, string, 0);\r\n        if (i != string.length) return null;\r\n        if (\"p\" in d) d.H = d.H % 12 + d.p * 12;\r\n        var localZ = d.Z != null && d3_date !== d3_date_utc, date = new (localZ ? d3_date_utc : d3_date)();\r\n        if (\"j\" in d) date.setFullYear(d.y, 0, d.j); else if (\"W\" in d || \"U\" in d) {\r\n          if (!(\"w\" in d)) d.w = \"W\" in d ? 1 : 0;\r\n          date.setFullYear(d.y, 0, 1);\r\n          date.setFullYear(d.y, 0, \"W\" in d ? (d.w + 6) % 7 + d.W * 7 - (date.getDay() + 5) % 7 : d.w + d.U * 7 - (date.getDay() + 6) % 7);\r\n        } else date.setFullYear(d.y, d.m, d.d);\r\n        date.setHours(d.H + (d.Z / 100 | 0), d.M + d.Z % 100, d.S, d.L);\r\n        return localZ ? date._ : date;\r\n      };\r\n      format.toString = function() {\r\n        return template;\r\n      };\r\n      return format;\r\n    }\r\n    function d3_time_parse(date, template, string, j) {\r\n      var c, p, t, i = 0, n = template.length, m = string.length;\r\n      while (i < n) {\r\n        if (j >= m) return -1;\r\n        c = template.charCodeAt(i++);\r\n        if (c === 37) {\r\n          t = template.charAt(i++);\r\n          p = d3_time_parsers[t in d3_time_formatPads ? template.charAt(i++) : t];\r\n          if (!p || (j = p(date, string, j)) < 0) return -1;\r\n        } else if (c != string.charCodeAt(j++)) {\r\n          return -1;\r\n        }\r\n      }\r\n      return j;\r\n    }\r\n    d3_time_format.utc = function(template) {\r\n      var local = d3_time_format(template);\r\n      function format(date) {\r\n        try {\r\n          d3_date = d3_date_utc;\r\n          var utc = new d3_date();\r\n          utc._ = date;\r\n          return local(utc);\r\n        } finally {\r\n          d3_date = Date;\r\n        }\r\n      }\r\n      format.parse = function(string) {\r\n        try {\r\n          d3_date = d3_date_utc;\r\n          var date = local.parse(string);\r\n          return date && date._;\r\n        } finally {\r\n          d3_date = Date;\r\n        }\r\n      };\r\n      format.toString = local.toString;\r\n      return format;\r\n    };\r\n    d3_time_format.multi = d3_time_format.utc.multi = d3_time_formatMulti;\r\n    var d3_time_periodLookup = d3.map(), d3_time_dayRe = d3_time_formatRe(locale_days), d3_time_dayLookup = d3_time_formatLookup(locale_days), d3_time_dayAbbrevRe = d3_time_formatRe(locale_shortDays), d3_time_dayAbbrevLookup = d3_time_formatLookup(locale_shortDays), d3_time_monthRe = d3_time_formatRe(locale_months), d3_time_monthLookup = d3_time_formatLookup(locale_months), d3_time_monthAbbrevRe = d3_time_formatRe(locale_shortMonths), d3_time_monthAbbrevLookup = d3_time_formatLookup(locale_shortMonths);\r\n    locale_periods.forEach(function(p, i) {\r\n      d3_time_periodLookup.set(p.toLowerCase(), i);\r\n    });\r\n    var d3_time_formats = {\r\n      a: function(d) {\r\n        return locale_shortDays[d.getDay()];\r\n      },\r\n      A: function(d) {\r\n        return locale_days[d.getDay()];\r\n      },\r\n      b: function(d) {\r\n        return locale_shortMonths[d.getMonth()];\r\n      },\r\n      B: function(d) {\r\n        return locale_months[d.getMonth()];\r\n      },\r\n      c: d3_time_format(locale_dateTime),\r\n      d: function(d, p) {\r\n        return d3_time_formatPad(d.getDate(), p, 2);\r\n      },\r\n      e: function(d, p) {\r\n        return d3_time_formatPad(d.getDate(), p, 2);\r\n      },\r\n      H: function(d, p) {\r\n        return d3_time_formatPad(d.getHours(), p, 2);\r\n      },\r\n      I: function(d, p) {\r\n        return d3_time_formatPad(d.getHours() % 12 || 12, p, 2);\r\n      },\r\n      j: function(d, p) {\r\n        return d3_time_formatPad(1 + d3_time.dayOfYear(d), p, 3);\r\n      },\r\n      L: function(d, p) {\r\n        return d3_time_formatPad(d.getMilliseconds(), p, 3);\r\n      },\r\n      m: function(d, p) {\r\n        return d3_time_formatPad(d.getMonth() + 1, p, 2);\r\n      },\r\n      M: function(d, p) {\r\n        return d3_time_formatPad(d.getMinutes(), p, 2);\r\n      },\r\n      p: function(d) {\r\n        return locale_periods[+(d.getHours() >= 12)];\r\n      },\r\n      S: function(d, p) {\r\n        return d3_time_formatPad(d.getSeconds(), p, 2);\r\n      },\r\n      U: function(d, p) {\r\n        return d3_time_formatPad(d3_time.sundayOfYear(d), p, 2);\r\n      },\r\n      w: function(d) {\r\n        return d.getDay();\r\n      },\r\n      W: function(d, p) {\r\n        return d3_time_formatPad(d3_time.mondayOfYear(d), p, 2);\r\n      },\r\n      x: d3_time_format(locale_date),\r\n      X: d3_time_format(locale_time),\r\n      y: function(d, p) {\r\n        return d3_time_formatPad(d.getFullYear() % 100, p, 2);\r\n      },\r\n      Y: function(d, p) {\r\n        return d3_time_formatPad(d.getFullYear() % 1e4, p, 4);\r\n      },\r\n      Z: d3_time_zone,\r\n      \"%\": function() {\r\n        return \"%\";\r\n      }\r\n    };\r\n    var d3_time_parsers = {\r\n      a: d3_time_parseWeekdayAbbrev,\r\n      A: d3_time_parseWeekday,\r\n      b: d3_time_parseMonthAbbrev,\r\n      B: d3_time_parseMonth,\r\n      c: d3_time_parseLocaleFull,\r\n      d: d3_time_parseDay,\r\n      e: d3_time_parseDay,\r\n      H: d3_time_parseHour24,\r\n      I: d3_time_parseHour24,\r\n      j: d3_time_parseDayOfYear,\r\n      L: d3_time_parseMilliseconds,\r\n      m: d3_time_parseMonthNumber,\r\n      M: d3_time_parseMinutes,\r\n      p: d3_time_parseAmPm,\r\n      S: d3_time_parseSeconds,\r\n      U: d3_time_parseWeekNumberSunday,\r\n      w: d3_time_parseWeekdayNumber,\r\n      W: d3_time_parseWeekNumberMonday,\r\n      x: d3_time_parseLocaleDate,\r\n      X: d3_time_parseLocaleTime,\r\n      y: d3_time_parseYear,\r\n      Y: d3_time_parseFullYear,\r\n      Z: d3_time_parseZone,\r\n      \"%\": d3_time_parseLiteralPercent\r\n    };\r\n    function d3_time_parseWeekdayAbbrev(date, string, i) {\r\n      d3_time_dayAbbrevRe.lastIndex = 0;\r\n      var n = d3_time_dayAbbrevRe.exec(string.slice(i));\r\n      return n ? (date.w = d3_time_dayAbbrevLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\r\n    }\r\n    function d3_time_parseWeekday(date, string, i) {\r\n      d3_time_dayRe.lastIndex = 0;\r\n      var n = d3_time_dayRe.exec(string.slice(i));\r\n      return n ? (date.w = d3_time_dayLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\r\n    }\r\n    function d3_time_parseMonthAbbrev(date, string, i) {\r\n      d3_time_monthAbbrevRe.lastIndex = 0;\r\n      var n = d3_time_monthAbbrevRe.exec(string.slice(i));\r\n      return n ? (date.m = d3_time_monthAbbrevLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\r\n    }\r\n    function d3_time_parseMonth(date, string, i) {\r\n      d3_time_monthRe.lastIndex = 0;\r\n      var n = d3_time_monthRe.exec(string.slice(i));\r\n      return n ? (date.m = d3_time_monthLookup.get(n[0].toLowerCase()), i + n[0].length) : -1;\r\n    }\r\n    function d3_time_parseLocaleFull(date, string, i) {\r\n      return d3_time_parse(date, d3_time_formats.c.toString(), string, i);\r\n    }\r\n    function d3_time_parseLocaleDate(date, string, i) {\r\n      return d3_time_parse(date, d3_time_formats.x.toString(), string, i);\r\n    }\r\n    function d3_time_parseLocaleTime(date, string, i) {\r\n      return d3_time_parse(date, d3_time_formats.X.toString(), string, i);\r\n    }\r\n    function d3_time_parseAmPm(date, string, i) {\r\n      var n = d3_time_periodLookup.get(string.slice(i, i += 2).toLowerCase());\r\n      return n == null ? -1 : (date.p = n, i);\r\n    }\r\n    return d3_time_format;\r\n  }\r\n  var d3_time_formatPads = {\r\n    \"-\": \"\",\r\n    _: \" \",\r\n    \"0\": \"0\"\r\n  }, d3_time_numberRe = /^\\s*\\d+/, d3_time_percentRe = /^%/;\r\n  function d3_time_formatPad(value, fill, width) {\r\n    var sign = value < 0 ? \"-\" : \"\", string = (sign ? -value : value) + \"\", length = string.length;\r\n    return sign + (length < width ? new Array(width - length + 1).join(fill) + string : string);\r\n  }\r\n  function d3_time_formatRe(names) {\r\n    return new RegExp(\"^(?:\" + names.map(d3.requote).join(\"|\") + \")\", \"i\");\r\n  }\r\n  function d3_time_formatLookup(names) {\r\n    var map = new d3_Map(), i = -1, n = names.length;\r\n    while (++i < n) map.set(names[i].toLowerCase(), i);\r\n    return map;\r\n  }\r\n  function d3_time_parseWeekdayNumber(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 1));\r\n    return n ? (date.w = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseWeekNumberSunday(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i));\r\n    return n ? (date.U = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseWeekNumberMonday(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i));\r\n    return n ? (date.W = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseFullYear(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 4));\r\n    return n ? (date.y = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseYear(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 2));\r\n    return n ? (date.y = d3_time_expandYear(+n[0]), i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseZone(date, string, i) {\r\n    return /^[+-]\\d{4}$/.test(string = string.slice(i, i + 5)) ? (date.Z = -string, \r\n    i + 5) : -1;\r\n  }\r\n  function d3_time_expandYear(d) {\r\n    return d + (d > 68 ? 1900 : 2e3);\r\n  }\r\n  function d3_time_parseMonthNumber(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 2));\r\n    return n ? (date.m = n[0] - 1, i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseDay(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 2));\r\n    return n ? (date.d = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseDayOfYear(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 3));\r\n    return n ? (date.j = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseHour24(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 2));\r\n    return n ? (date.H = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseMinutes(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 2));\r\n    return n ? (date.M = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseSeconds(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 2));\r\n    return n ? (date.S = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_parseMilliseconds(date, string, i) {\r\n    d3_time_numberRe.lastIndex = 0;\r\n    var n = d3_time_numberRe.exec(string.slice(i, i + 3));\r\n    return n ? (date.L = +n[0], i + n[0].length) : -1;\r\n  }\r\n  function d3_time_zone(d) {\r\n    var z = d.getTimezoneOffset(), zs = z > 0 ? \"-\" : \"+\", zh = abs(z) / 60 | 0, zm = abs(z) % 60;\r\n    return zs + d3_time_formatPad(zh, \"0\", 2) + d3_time_formatPad(zm, \"0\", 2);\r\n  }\r\n  function d3_time_parseLiteralPercent(date, string, i) {\r\n    d3_time_percentRe.lastIndex = 0;\r\n    var n = d3_time_percentRe.exec(string.slice(i, i + 1));\r\n    return n ? i + n[0].length : -1;\r\n  }\r\n  function d3_time_formatMulti(formats) {\r\n    var n = formats.length, i = -1;\r\n    while (++i < n) formats[i][0] = this(formats[i][0]);\r\n    return function(date) {\r\n      var i = 0, f = formats[i];\r\n      while (!f[1](date)) f = formats[++i];\r\n      return f[0](date);\r\n    };\r\n  }\r\n  d3.locale = function(locale) {\r\n    return {\r\n      numberFormat: d3_locale_numberFormat(locale),\r\n      timeFormat: d3_locale_timeFormat(locale)\r\n    };\r\n  };\r\n  var d3_locale_enUS = d3.locale({\r\n    decimal: \".\",\r\n    thousands: \",\",\r\n    grouping: [ 3 ],\r\n    currency: [ \"$\", \"\" ],\r\n    dateTime: \"%a %b %e %X %Y\",\r\n    date: \"%m/%d/%Y\",\r\n    time: \"%H:%M:%S\",\r\n    periods: [ \"AM\", \"PM\" ],\r\n    days: [ \"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\" ],\r\n    shortDays: [ \"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\" ],\r\n    months: [ \"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\" ],\r\n    shortMonths: [ \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\" ]\r\n  });\r\n  d3.format = d3_locale_enUS.numberFormat;\r\n  d3.geo = {};\r\n  function d3_adder() {}\r\n  d3_adder.prototype = {\r\n    s: 0,\r\n    t: 0,\r\n    add: function(y) {\r\n      d3_adderSum(y, this.t, d3_adderTemp);\r\n      d3_adderSum(d3_adderTemp.s, this.s, this);\r\n      if (this.s) this.t += d3_adderTemp.t; else this.s = d3_adderTemp.t;\r\n    },\r\n    reset: function() {\r\n      this.s = this.t = 0;\r\n    },\r\n    valueOf: function() {\r\n      return this.s;\r\n    }\r\n  };\r\n  var d3_adderTemp = new d3_adder();\r\n  function d3_adderSum(a, b, o) {\r\n    var x = o.s = a + b, bv = x - a, av = x - bv;\r\n    o.t = a - av + (b - bv);\r\n  }\r\n  d3.geo.stream = function(object, listener) {\r\n    if (object && d3_geo_streamObjectType.hasOwnProperty(object.type)) {\r\n      d3_geo_streamObjectType[object.type](object, listener);\r\n    } else {\r\n      d3_geo_streamGeometry(object, listener);\r\n    }\r\n  };\r\n  function d3_geo_streamGeometry(geometry, listener) {\r\n    if (geometry && d3_geo_streamGeometryType.hasOwnProperty(geometry.type)) {\r\n      d3_geo_streamGeometryType[geometry.type](geometry, listener);\r\n    }\r\n  }\r\n  var d3_geo_streamObjectType = {\r\n    Feature: function(feature, listener) {\r\n      d3_geo_streamGeometry(feature.geometry, listener);\r\n    },\r\n    FeatureCollection: function(object, listener) {\r\n      var features = object.features, i = -1, n = features.length;\r\n      while (++i < n) d3_geo_streamGeometry(features[i].geometry, listener);\r\n    }\r\n  };\r\n  var d3_geo_streamGeometryType = {\r\n    Sphere: function(object, listener) {\r\n      listener.sphere();\r\n    },\r\n    Point: function(object, listener) {\r\n      object = object.coordinates;\r\n      listener.point(object[0], object[1], object[2]);\r\n    },\r\n    MultiPoint: function(object, listener) {\r\n      var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n      while (++i < n) object = coordinates[i], listener.point(object[0], object[1], object[2]);\r\n    },\r\n    LineString: function(object, listener) {\r\n      d3_geo_streamLine(object.coordinates, listener, 0);\r\n    },\r\n    MultiLineString: function(object, listener) {\r\n      var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n      while (++i < n) d3_geo_streamLine(coordinates[i], listener, 0);\r\n    },\r\n    Polygon: function(object, listener) {\r\n      d3_geo_streamPolygon(object.coordinates, listener);\r\n    },\r\n    MultiPolygon: function(object, listener) {\r\n      var coordinates = object.coordinates, i = -1, n = coordinates.length;\r\n      while (++i < n) d3_geo_streamPolygon(coordinates[i], listener);\r\n    },\r\n    GeometryCollection: function(object, listener) {\r\n      var geometries = object.geometries, i = -1, n = geometries.length;\r\n      while (++i < n) d3_geo_streamGeometry(geometries[i], listener);\r\n    }\r\n  };\r\n  function d3_geo_streamLine(coordinates, listener, closed) {\r\n    var i = -1, n = coordinates.length - closed, coordinate;\r\n    listener.lineStart();\r\n    while (++i < n) coordinate = coordinates[i], listener.point(coordinate[0], coordinate[1], coordinate[2]);\r\n    listener.lineEnd();\r\n  }\r\n  function d3_geo_streamPolygon(coordinates, listener) {\r\n    var i = -1, n = coordinates.length;\r\n    listener.polygonStart();\r\n    while (++i < n) d3_geo_streamLine(coordinates[i], listener, 1);\r\n    listener.polygonEnd();\r\n  }\r\n  d3.geo.area = function(object) {\r\n    d3_geo_areaSum = 0;\r\n    d3.geo.stream(object, d3_geo_area);\r\n    return d3_geo_areaSum;\r\n  };\r\n  var d3_geo_areaSum, d3_geo_areaRingSum = new d3_adder();\r\n  var d3_geo_area = {\r\n    sphere: function() {\r\n      d3_geo_areaSum += 4 * π;\r\n    },\r\n    point: d3_noop,\r\n    lineStart: d3_noop,\r\n    lineEnd: d3_noop,\r\n    polygonStart: function() {\r\n      d3_geo_areaRingSum.reset();\r\n      d3_geo_area.lineStart = d3_geo_areaRingStart;\r\n    },\r\n    polygonEnd: function() {\r\n      var area = 2 * d3_geo_areaRingSum;\r\n      d3_geo_areaSum += area < 0 ? 4 * π + area : area;\r\n      d3_geo_area.lineStart = d3_geo_area.lineEnd = d3_geo_area.point = d3_noop;\r\n    }\r\n  };\r\n  function d3_geo_areaRingStart() {\r\n    var λ00, φ00, λ0, cosφ0, sinφ0;\r\n    d3_geo_area.point = function(λ, φ) {\r\n      d3_geo_area.point = nextPoint;\r\n      λ0 = (λ00 = λ) * d3_radians, cosφ0 = Math.cos(φ = (φ00 = φ) * d3_radians / 2 + π / 4), \r\n      sinφ0 = Math.sin(φ);\r\n    };\r\n    function nextPoint(λ, φ) {\r\n      λ *= d3_radians;\r\n      φ = φ * d3_radians / 2 + π / 4;\r\n      var dλ = λ - λ0, sdλ = dλ >= 0 ? 1 : -1, adλ = sdλ * dλ, cosφ = Math.cos(φ), sinφ = Math.sin(φ), k = sinφ0 * sinφ, u = cosφ0 * cosφ + k * Math.cos(adλ), v = k * sdλ * Math.sin(adλ);\r\n      d3_geo_areaRingSum.add(Math.atan2(v, u));\r\n      λ0 = λ, cosφ0 = cosφ, sinφ0 = sinφ;\r\n    }\r\n    d3_geo_area.lineEnd = function() {\r\n      nextPoint(λ00, φ00);\r\n    };\r\n  }\r\n  function d3_geo_cartesian(spherical) {\r\n    var λ = spherical[0], φ = spherical[1], cosφ = Math.cos(φ);\r\n    return [ cosφ * Math.cos(λ), cosφ * Math.sin(λ), Math.sin(φ) ];\r\n  }\r\n  function d3_geo_cartesianDot(a, b) {\r\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n  }\r\n  function d3_geo_cartesianCross(a, b) {\r\n    return [ a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0] ];\r\n  }\r\n  function d3_geo_cartesianAdd(a, b) {\r\n    a[0] += b[0];\r\n    a[1] += b[1];\r\n    a[2] += b[2];\r\n  }\r\n  function d3_geo_cartesianScale(vector, k) {\r\n    return [ vector[0] * k, vector[1] * k, vector[2] * k ];\r\n  }\r\n  function d3_geo_cartesianNormalize(d) {\r\n    var l = Math.sqrt(d[0] * d[0] + d[1] * d[1] + d[2] * d[2]);\r\n    d[0] /= l;\r\n    d[1] /= l;\r\n    d[2] /= l;\r\n  }\r\n  function d3_geo_spherical(cartesian) {\r\n    return [ Math.atan2(cartesian[1], cartesian[0]), d3_asin(cartesian[2]) ];\r\n  }\r\n  function d3_geo_sphericalEqual(a, b) {\r\n    return abs(a[0] - b[0]) < ε && abs(a[1] - b[1]) < ε;\r\n  }\r\n  d3.geo.bounds = function() {\r\n    var λ0, φ0, λ1, φ1, λ_, λ__, φ__, p0, dλSum, ranges, range;\r\n    var bound = {\r\n      point: point,\r\n      lineStart: lineStart,\r\n      lineEnd: lineEnd,\r\n      polygonStart: function() {\r\n        bound.point = ringPoint;\r\n        bound.lineStart = ringStart;\r\n        bound.lineEnd = ringEnd;\r\n        dλSum = 0;\r\n        d3_geo_area.polygonStart();\r\n      },\r\n      polygonEnd: function() {\r\n        d3_geo_area.polygonEnd();\r\n        bound.point = point;\r\n        bound.lineStart = lineStart;\r\n        bound.lineEnd = lineEnd;\r\n        if (d3_geo_areaRingSum < 0) λ0 = -(λ1 = 180), φ0 = -(φ1 = 90); else if (dλSum > ε) φ1 = 90; else if (dλSum < -ε) φ0 = -90;\r\n        range[0] = λ0, range[1] = λ1;\r\n      }\r\n    };\r\n    function point(λ, φ) {\r\n      ranges.push(range = [ λ0 = λ, λ1 = λ ]);\r\n      if (φ < φ0) φ0 = φ;\r\n      if (φ > φ1) φ1 = φ;\r\n    }\r\n    function linePoint(λ, φ) {\r\n      var p = d3_geo_cartesian([ λ * d3_radians, φ * d3_radians ]);\r\n      if (p0) {\r\n        var normal = d3_geo_cartesianCross(p0, p), equatorial = [ normal[1], -normal[0], 0 ], inflection = d3_geo_cartesianCross(equatorial, normal);\r\n        d3_geo_cartesianNormalize(inflection);\r\n        inflection = d3_geo_spherical(inflection);\r\n        var dλ = λ - λ_, s = dλ > 0 ? 1 : -1, λi = inflection[0] * d3_degrees * s, antimeridian = abs(dλ) > 180;\r\n        if (antimeridian ^ (s * λ_ < λi && λi < s * λ)) {\r\n          var φi = inflection[1] * d3_degrees;\r\n          if (φi > φ1) φ1 = φi;\r\n        } else if (λi = (λi + 360) % 360 - 180, antimeridian ^ (s * λ_ < λi && λi < s * λ)) {\r\n          var φi = -inflection[1] * d3_degrees;\r\n          if (φi < φ0) φ0 = φi;\r\n        } else {\r\n          if (φ < φ0) φ0 = φ;\r\n          if (φ > φ1) φ1 = φ;\r\n        }\r\n        if (antimeridian) {\r\n          if (λ < λ_) {\r\n            if (angle(λ0, λ) > angle(λ0, λ1)) λ1 = λ;\r\n          } else {\r\n            if (angle(λ, λ1) > angle(λ0, λ1)) λ0 = λ;\r\n          }\r\n        } else {\r\n          if (λ1 >= λ0) {\r\n            if (λ < λ0) λ0 = λ;\r\n            if (λ > λ1) λ1 = λ;\r\n          } else {\r\n            if (λ > λ_) {\r\n              if (angle(λ0, λ) > angle(λ0, λ1)) λ1 = λ;\r\n            } else {\r\n              if (angle(λ, λ1) > angle(λ0, λ1)) λ0 = λ;\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        point(λ, φ);\r\n      }\r\n      p0 = p, λ_ = λ;\r\n    }\r\n    function lineStart() {\r\n      bound.point = linePoint;\r\n    }\r\n    function lineEnd() {\r\n      range[0] = λ0, range[1] = λ1;\r\n      bound.point = point;\r\n      p0 = null;\r\n    }\r\n    function ringPoint(λ, φ) {\r\n      if (p0) {\r\n        var dλ = λ - λ_;\r\n        dλSum += abs(dλ) > 180 ? dλ + (dλ > 0 ? 360 : -360) : dλ;\r\n      } else λ__ = λ, φ__ = φ;\r\n      d3_geo_area.point(λ, φ);\r\n      linePoint(λ, φ);\r\n    }\r\n    function ringStart() {\r\n      d3_geo_area.lineStart();\r\n    }\r\n    function ringEnd() {\r\n      ringPoint(λ__, φ__);\r\n      d3_geo_area.lineEnd();\r\n      if (abs(dλSum) > ε) λ0 = -(λ1 = 180);\r\n      range[0] = λ0, range[1] = λ1;\r\n      p0 = null;\r\n    }\r\n    function angle(λ0, λ1) {\r\n      return (λ1 -= λ0) < 0 ? λ1 + 360 : λ1;\r\n    }\r\n    function compareRanges(a, b) {\r\n      return a[0] - b[0];\r\n    }\r\n    function withinRange(x, range) {\r\n      return range[0] <= range[1] ? range[0] <= x && x <= range[1] : x < range[0] || range[1] < x;\r\n    }\r\n    return function(feature) {\r\n      φ1 = λ1 = -(λ0 = φ0 = Infinity);\r\n      ranges = [];\r\n      d3.geo.stream(feature, bound);\r\n      var n = ranges.length;\r\n      if (n) {\r\n        ranges.sort(compareRanges);\r\n        for (var i = 1, a = ranges[0], b, merged = [ a ]; i < n; ++i) {\r\n          b = ranges[i];\r\n          if (withinRange(b[0], a) || withinRange(b[1], a)) {\r\n            if (angle(a[0], b[1]) > angle(a[0], a[1])) a[1] = b[1];\r\n            if (angle(b[0], a[1]) > angle(a[0], a[1])) a[0] = b[0];\r\n          } else {\r\n            merged.push(a = b);\r\n          }\r\n        }\r\n        var best = -Infinity, dλ;\r\n        for (var n = merged.length - 1, i = 0, a = merged[n], b; i <= n; a = b, ++i) {\r\n          b = merged[i];\r\n          if ((dλ = angle(a[1], b[0])) > best) best = dλ, λ0 = b[0], λ1 = a[1];\r\n        }\r\n      }\r\n      ranges = range = null;\r\n      return λ0 === Infinity || φ0 === Infinity ? [ [ NaN, NaN ], [ NaN, NaN ] ] : [ [ λ0, φ0 ], [ λ1, φ1 ] ];\r\n    };\r\n  }();\r\n  d3.geo.centroid = function(object) {\r\n    d3_geo_centroidW0 = d3_geo_centroidW1 = d3_geo_centroidX0 = d3_geo_centroidY0 = d3_geo_centroidZ0 = d3_geo_centroidX1 = d3_geo_centroidY1 = d3_geo_centroidZ1 = d3_geo_centroidX2 = d3_geo_centroidY2 = d3_geo_centroidZ2 = 0;\r\n    d3.geo.stream(object, d3_geo_centroid);\r\n    var x = d3_geo_centroidX2, y = d3_geo_centroidY2, z = d3_geo_centroidZ2, m = x * x + y * y + z * z;\r\n    if (m < ε2) {\r\n      x = d3_geo_centroidX1, y = d3_geo_centroidY1, z = d3_geo_centroidZ1;\r\n      if (d3_geo_centroidW1 < ε) x = d3_geo_centroidX0, y = d3_geo_centroidY0, z = d3_geo_centroidZ0;\r\n      m = x * x + y * y + z * z;\r\n      if (m < ε2) return [ NaN, NaN ];\r\n    }\r\n    return [ Math.atan2(y, x) * d3_degrees, d3_asin(z / Math.sqrt(m)) * d3_degrees ];\r\n  };\r\n  var d3_geo_centroidW0, d3_geo_centroidW1, d3_geo_centroidX0, d3_geo_centroidY0, d3_geo_centroidZ0, d3_geo_centroidX1, d3_geo_centroidY1, d3_geo_centroidZ1, d3_geo_centroidX2, d3_geo_centroidY2, d3_geo_centroidZ2;\r\n  var d3_geo_centroid = {\r\n    sphere: d3_noop,\r\n    point: d3_geo_centroidPoint,\r\n    lineStart: d3_geo_centroidLineStart,\r\n    lineEnd: d3_geo_centroidLineEnd,\r\n    polygonStart: function() {\r\n      d3_geo_centroid.lineStart = d3_geo_centroidRingStart;\r\n    },\r\n    polygonEnd: function() {\r\n      d3_geo_centroid.lineStart = d3_geo_centroidLineStart;\r\n    }\r\n  };\r\n  function d3_geo_centroidPoint(λ, φ) {\r\n    λ *= d3_radians;\r\n    var cosφ = Math.cos(φ *= d3_radians);\r\n    d3_geo_centroidPointXYZ(cosφ * Math.cos(λ), cosφ * Math.sin(λ), Math.sin(φ));\r\n  }\r\n  function d3_geo_centroidPointXYZ(x, y, z) {\r\n    ++d3_geo_centroidW0;\r\n    d3_geo_centroidX0 += (x - d3_geo_centroidX0) / d3_geo_centroidW0;\r\n    d3_geo_centroidY0 += (y - d3_geo_centroidY0) / d3_geo_centroidW0;\r\n    d3_geo_centroidZ0 += (z - d3_geo_centroidZ0) / d3_geo_centroidW0;\r\n  }\r\n  function d3_geo_centroidLineStart() {\r\n    var x0, y0, z0;\r\n    d3_geo_centroid.point = function(λ, φ) {\r\n      λ *= d3_radians;\r\n      var cosφ = Math.cos(φ *= d3_radians);\r\n      x0 = cosφ * Math.cos(λ);\r\n      y0 = cosφ * Math.sin(λ);\r\n      z0 = Math.sin(φ);\r\n      d3_geo_centroid.point = nextPoint;\r\n      d3_geo_centroidPointXYZ(x0, y0, z0);\r\n    };\r\n    function nextPoint(λ, φ) {\r\n      λ *= d3_radians;\r\n      var cosφ = Math.cos(φ *= d3_radians), x = cosφ * Math.cos(λ), y = cosφ * Math.sin(λ), z = Math.sin(φ), w = Math.atan2(Math.sqrt((w = y0 * z - z0 * y) * w + (w = z0 * x - x0 * z) * w + (w = x0 * y - y0 * x) * w), x0 * x + y0 * y + z0 * z);\r\n      d3_geo_centroidW1 += w;\r\n      d3_geo_centroidX1 += w * (x0 + (x0 = x));\r\n      d3_geo_centroidY1 += w * (y0 + (y0 = y));\r\n      d3_geo_centroidZ1 += w * (z0 + (z0 = z));\r\n      d3_geo_centroidPointXYZ(x0, y0, z0);\r\n    }\r\n  }\r\n  function d3_geo_centroidLineEnd() {\r\n    d3_geo_centroid.point = d3_geo_centroidPoint;\r\n  }\r\n  function d3_geo_centroidRingStart() {\r\n    var λ00, φ00, x0, y0, z0;\r\n    d3_geo_centroid.point = function(λ, φ) {\r\n      λ00 = λ, φ00 = φ;\r\n      d3_geo_centroid.point = nextPoint;\r\n      λ *= d3_radians;\r\n      var cosφ = Math.cos(φ *= d3_radians);\r\n      x0 = cosφ * Math.cos(λ);\r\n      y0 = cosφ * Math.sin(λ);\r\n      z0 = Math.sin(φ);\r\n      d3_geo_centroidPointXYZ(x0, y0, z0);\r\n    };\r\n    d3_geo_centroid.lineEnd = function() {\r\n      nextPoint(λ00, φ00);\r\n      d3_geo_centroid.lineEnd = d3_geo_centroidLineEnd;\r\n      d3_geo_centroid.point = d3_geo_centroidPoint;\r\n    };\r\n    function nextPoint(λ, φ) {\r\n      λ *= d3_radians;\r\n      var cosφ = Math.cos(φ *= d3_radians), x = cosφ * Math.cos(λ), y = cosφ * Math.sin(λ), z = Math.sin(φ), cx = y0 * z - z0 * y, cy = z0 * x - x0 * z, cz = x0 * y - y0 * x, m = Math.sqrt(cx * cx + cy * cy + cz * cz), u = x0 * x + y0 * y + z0 * z, v = m && -d3_acos(u) / m, w = Math.atan2(m, u);\r\n      d3_geo_centroidX2 += v * cx;\r\n      d3_geo_centroidY2 += v * cy;\r\n      d3_geo_centroidZ2 += v * cz;\r\n      d3_geo_centroidW1 += w;\r\n      d3_geo_centroidX1 += w * (x0 + (x0 = x));\r\n      d3_geo_centroidY1 += w * (y0 + (y0 = y));\r\n      d3_geo_centroidZ1 += w * (z0 + (z0 = z));\r\n      d3_geo_centroidPointXYZ(x0, y0, z0);\r\n    }\r\n  }\r\n  function d3_geo_compose(a, b) {\r\n    function compose(x, y) {\r\n      return x = a(x, y), b(x[0], x[1]);\r\n    }\r\n    if (a.invert && b.invert) compose.invert = function(x, y) {\r\n      return x = b.invert(x, y), x && a.invert(x[0], x[1]);\r\n    };\r\n    return compose;\r\n  }\r\n  function d3_true() {\r\n    return true;\r\n  }\r\n  function d3_geo_clipPolygon(segments, compare, clipStartInside, interpolate, listener) {\r\n    var subject = [], clip = [];\r\n    segments.forEach(function(segment) {\r\n      if ((n = segment.length - 1) <= 0) return;\r\n      var n, p0 = segment[0], p1 = segment[n];\r\n      if (d3_geo_sphericalEqual(p0, p1)) {\r\n        listener.lineStart();\r\n        for (var i = 0; i < n; ++i) listener.point((p0 = segment[i])[0], p0[1]);\r\n        listener.lineEnd();\r\n        return;\r\n      }\r\n      var a = new d3_geo_clipPolygonIntersection(p0, segment, null, true), b = new d3_geo_clipPolygonIntersection(p0, null, a, false);\r\n      a.o = b;\r\n      subject.push(a);\r\n      clip.push(b);\r\n      a = new d3_geo_clipPolygonIntersection(p1, segment, null, false);\r\n      b = new d3_geo_clipPolygonIntersection(p1, null, a, true);\r\n      a.o = b;\r\n      subject.push(a);\r\n      clip.push(b);\r\n    });\r\n    clip.sort(compare);\r\n    d3_geo_clipPolygonLinkCircular(subject);\r\n    d3_geo_clipPolygonLinkCircular(clip);\r\n    if (!subject.length) return;\r\n    for (var i = 0, entry = clipStartInside, n = clip.length; i < n; ++i) {\r\n      clip[i].e = entry = !entry;\r\n    }\r\n    var start = subject[0], points, point;\r\n    while (1) {\r\n      var current = start, isSubject = true;\r\n      while (current.v) if ((current = current.n) === start) return;\r\n      points = current.z;\r\n      listener.lineStart();\r\n      do {\r\n        current.v = current.o.v = true;\r\n        if (current.e) {\r\n          if (isSubject) {\r\n            for (var i = 0, n = points.length; i < n; ++i) listener.point((point = points[i])[0], point[1]);\r\n          } else {\r\n            interpolate(current.x, current.n.x, 1, listener);\r\n          }\r\n          current = current.n;\r\n        } else {\r\n          if (isSubject) {\r\n            points = current.p.z;\r\n            for (var i = points.length - 1; i >= 0; --i) listener.point((point = points[i])[0], point[1]);\r\n          } else {\r\n            interpolate(current.x, current.p.x, -1, listener);\r\n          }\r\n          current = current.p;\r\n        }\r\n        current = current.o;\r\n        points = current.z;\r\n        isSubject = !isSubject;\r\n      } while (!current.v);\r\n      listener.lineEnd();\r\n    }\r\n  }\r\n  function d3_geo_clipPolygonLinkCircular(array) {\r\n    if (!(n = array.length)) return;\r\n    var n, i = 0, a = array[0], b;\r\n    while (++i < n) {\r\n      a.n = b = array[i];\r\n      b.p = a;\r\n      a = b;\r\n    }\r\n    a.n = b = array[0];\r\n    b.p = a;\r\n  }\r\n  function d3_geo_clipPolygonIntersection(point, points, other, entry) {\r\n    this.x = point;\r\n    this.z = points;\r\n    this.o = other;\r\n    this.e = entry;\r\n    this.v = false;\r\n    this.n = this.p = null;\r\n  }\r\n  function d3_geo_clip(pointVisible, clipLine, interpolate, clipStart) {\r\n    return function(rotate, listener) {\r\n      var line = clipLine(listener), rotatedClipStart = rotate.invert(clipStart[0], clipStart[1]);\r\n      var clip = {\r\n        point: point,\r\n        lineStart: lineStart,\r\n        lineEnd: lineEnd,\r\n        polygonStart: function() {\r\n          clip.point = pointRing;\r\n          clip.lineStart = ringStart;\r\n          clip.lineEnd = ringEnd;\r\n          segments = [];\r\n          polygon = [];\r\n        },\r\n        polygonEnd: function() {\r\n          clip.point = point;\r\n          clip.lineStart = lineStart;\r\n          clip.lineEnd = lineEnd;\r\n          segments = d3.merge(segments);\r\n          var clipStartInside = d3_geo_pointInPolygon(rotatedClipStart, polygon);\r\n          if (segments.length) {\r\n            if (!polygonStarted) listener.polygonStart(), polygonStarted = true;\r\n            d3_geo_clipPolygon(segments, d3_geo_clipSort, clipStartInside, interpolate, listener);\r\n          } else if (clipStartInside) {\r\n            if (!polygonStarted) listener.polygonStart(), polygonStarted = true;\r\n            listener.lineStart();\r\n            interpolate(null, null, 1, listener);\r\n            listener.lineEnd();\r\n          }\r\n          if (polygonStarted) listener.polygonEnd(), polygonStarted = false;\r\n          segments = polygon = null;\r\n        },\r\n        sphere: function() {\r\n          listener.polygonStart();\r\n          listener.lineStart();\r\n          interpolate(null, null, 1, listener);\r\n          listener.lineEnd();\r\n          listener.polygonEnd();\r\n        }\r\n      };\r\n      function point(λ, φ) {\r\n        var point = rotate(λ, φ);\r\n        if (pointVisible(λ = point[0], φ = point[1])) listener.point(λ, φ);\r\n      }\r\n      function pointLine(λ, φ) {\r\n        var point = rotate(λ, φ);\r\n        line.point(point[0], point[1]);\r\n      }\r\n      function lineStart() {\r\n        clip.point = pointLine;\r\n        line.lineStart();\r\n      }\r\n      function lineEnd() {\r\n        clip.point = point;\r\n        line.lineEnd();\r\n      }\r\n      var segments;\r\n      var buffer = d3_geo_clipBufferListener(), ringListener = clipLine(buffer), polygonStarted = false, polygon, ring;\r\n      function pointRing(λ, φ) {\r\n        ring.push([ λ, φ ]);\r\n        var point = rotate(λ, φ);\r\n        ringListener.point(point[0], point[1]);\r\n      }\r\n      function ringStart() {\r\n        ringListener.lineStart();\r\n        ring = [];\r\n      }\r\n      function ringEnd() {\r\n        pointRing(ring[0][0], ring[0][1]);\r\n        ringListener.lineEnd();\r\n        var clean = ringListener.clean(), ringSegments = buffer.buffer(), segment, n = ringSegments.length;\r\n        ring.pop();\r\n        polygon.push(ring);\r\n        ring = null;\r\n        if (!n) return;\r\n        if (clean & 1) {\r\n          segment = ringSegments[0];\r\n          var n = segment.length - 1, i = -1, point;\r\n          if (n > 0) {\r\n            if (!polygonStarted) listener.polygonStart(), polygonStarted = true;\r\n            listener.lineStart();\r\n            while (++i < n) listener.point((point = segment[i])[0], point[1]);\r\n            listener.lineEnd();\r\n          }\r\n          return;\r\n        }\r\n        if (n > 1 && clean & 2) ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));\r\n        segments.push(ringSegments.filter(d3_geo_clipSegmentLength1));\r\n      }\r\n      return clip;\r\n    };\r\n  }\r\n  function d3_geo_clipSegmentLength1(segment) {\r\n    return segment.length > 1;\r\n  }\r\n  function d3_geo_clipBufferListener() {\r\n    var lines = [], line;\r\n    return {\r\n      lineStart: function() {\r\n        lines.push(line = []);\r\n      },\r\n      point: function(λ, φ) {\r\n        line.push([ λ, φ ]);\r\n      },\r\n      lineEnd: d3_noop,\r\n      buffer: function() {\r\n        var buffer = lines;\r\n        lines = [];\r\n        line = null;\r\n        return buffer;\r\n      },\r\n      rejoin: function() {\r\n        if (lines.length > 1) lines.push(lines.pop().concat(lines.shift()));\r\n      }\r\n    };\r\n  }\r\n  function d3_geo_clipSort(a, b) {\r\n    return ((a = a.x)[0] < 0 ? a[1] - halfπ - ε : halfπ - a[1]) - ((b = b.x)[0] < 0 ? b[1] - halfπ - ε : halfπ - b[1]);\r\n  }\r\n  var d3_geo_clipAntimeridian = d3_geo_clip(d3_true, d3_geo_clipAntimeridianLine, d3_geo_clipAntimeridianInterpolate, [ -π, -π / 2 ]);\r\n  function d3_geo_clipAntimeridianLine(listener) {\r\n    var λ0 = NaN, φ0 = NaN, sλ0 = NaN, clean;\r\n    return {\r\n      lineStart: function() {\r\n        listener.lineStart();\r\n        clean = 1;\r\n      },\r\n      point: function(λ1, φ1) {\r\n        var sλ1 = λ1 > 0 ? π : -π, dλ = abs(λ1 - λ0);\r\n        if (abs(dλ - π) < ε) {\r\n          listener.point(λ0, φ0 = (φ0 + φ1) / 2 > 0 ? halfπ : -halfπ);\r\n          listener.point(sλ0, φ0);\r\n          listener.lineEnd();\r\n          listener.lineStart();\r\n          listener.point(sλ1, φ0);\r\n          listener.point(λ1, φ0);\r\n          clean = 0;\r\n        } else if (sλ0 !== sλ1 && dλ >= π) {\r\n          if (abs(λ0 - sλ0) < ε) λ0 -= sλ0 * ε;\r\n          if (abs(λ1 - sλ1) < ε) λ1 -= sλ1 * ε;\r\n          φ0 = d3_geo_clipAntimeridianIntersect(λ0, φ0, λ1, φ1);\r\n          listener.point(sλ0, φ0);\r\n          listener.lineEnd();\r\n          listener.lineStart();\r\n          listener.point(sλ1, φ0);\r\n          clean = 0;\r\n        }\r\n        listener.point(λ0 = λ1, φ0 = φ1);\r\n        sλ0 = sλ1;\r\n      },\r\n      lineEnd: function() {\r\n        listener.lineEnd();\r\n        λ0 = φ0 = NaN;\r\n      },\r\n      clean: function() {\r\n        return 2 - clean;\r\n      }\r\n    };\r\n  }\r\n  function d3_geo_clipAntimeridianIntersect(λ0, φ0, λ1, φ1) {\r\n    var cosφ0, cosφ1, sinλ0_λ1 = Math.sin(λ0 - λ1);\r\n    return abs(sinλ0_λ1) > ε ? Math.atan((Math.sin(φ0) * (cosφ1 = Math.cos(φ1)) * Math.sin(λ1) - Math.sin(φ1) * (cosφ0 = Math.cos(φ0)) * Math.sin(λ0)) / (cosφ0 * cosφ1 * sinλ0_λ1)) : (φ0 + φ1) / 2;\r\n  }\r\n  function d3_geo_clipAntimeridianInterpolate(from, to, direction, listener) {\r\n    var φ;\r\n    if (from == null) {\r\n      φ = direction * halfπ;\r\n      listener.point(-π, φ);\r\n      listener.point(0, φ);\r\n      listener.point(π, φ);\r\n      listener.point(π, 0);\r\n      listener.point(π, -φ);\r\n      listener.point(0, -φ);\r\n      listener.point(-π, -φ);\r\n      listener.point(-π, 0);\r\n      listener.point(-π, φ);\r\n    } else if (abs(from[0] - to[0]) > ε) {\r\n      var s = from[0] < to[0] ? π : -π;\r\n      φ = direction * s / 2;\r\n      listener.point(-s, φ);\r\n      listener.point(0, φ);\r\n      listener.point(s, φ);\r\n    } else {\r\n      listener.point(to[0], to[1]);\r\n    }\r\n  }\r\n  function d3_geo_pointInPolygon(point, polygon) {\r\n    var meridian = point[0], parallel = point[1], meridianNormal = [ Math.sin(meridian), -Math.cos(meridian), 0 ], polarAngle = 0, winding = 0;\r\n    d3_geo_areaRingSum.reset();\r\n    for (var i = 0, n = polygon.length; i < n; ++i) {\r\n      var ring = polygon[i], m = ring.length;\r\n      if (!m) continue;\r\n      var point0 = ring[0], λ0 = point0[0], φ0 = point0[1] / 2 + π / 4, sinφ0 = Math.sin(φ0), cosφ0 = Math.cos(φ0), j = 1;\r\n      while (true) {\r\n        if (j === m) j = 0;\r\n        point = ring[j];\r\n        var λ = point[0], φ = point[1] / 2 + π / 4, sinφ = Math.sin(φ), cosφ = Math.cos(φ), dλ = λ - λ0, sdλ = dλ >= 0 ? 1 : -1, adλ = sdλ * dλ, antimeridian = adλ > π, k = sinφ0 * sinφ;\r\n        d3_geo_areaRingSum.add(Math.atan2(k * sdλ * Math.sin(adλ), cosφ0 * cosφ + k * Math.cos(adλ)));\r\n        polarAngle += antimeridian ? dλ + sdλ * τ : dλ;\r\n        if (antimeridian ^ λ0 >= meridian ^ λ >= meridian) {\r\n          var arc = d3_geo_cartesianCross(d3_geo_cartesian(point0), d3_geo_cartesian(point));\r\n          d3_geo_cartesianNormalize(arc);\r\n          var intersection = d3_geo_cartesianCross(meridianNormal, arc);\r\n          d3_geo_cartesianNormalize(intersection);\r\n          var φarc = (antimeridian ^ dλ >= 0 ? -1 : 1) * d3_asin(intersection[2]);\r\n          if (parallel > φarc || parallel === φarc && (arc[0] || arc[1])) {\r\n            winding += antimeridian ^ dλ >= 0 ? 1 : -1;\r\n          }\r\n        }\r\n        if (!j++) break;\r\n        λ0 = λ, sinφ0 = sinφ, cosφ0 = cosφ, point0 = point;\r\n      }\r\n    }\r\n    return (polarAngle < -ε || polarAngle < ε && d3_geo_areaRingSum < -ε) ^ winding & 1;\r\n  }\r\n  function d3_geo_clipCircle(radius) {\r\n    var cr = Math.cos(radius), smallRadius = cr > 0, notHemisphere = abs(cr) > ε, interpolate = d3_geo_circleInterpolate(radius, 6 * d3_radians);\r\n    return d3_geo_clip(visible, clipLine, interpolate, smallRadius ? [ 0, -radius ] : [ -π, radius - π ]);\r\n    function visible(λ, φ) {\r\n      return Math.cos(λ) * Math.cos(φ) > cr;\r\n    }\r\n    function clipLine(listener) {\r\n      var point0, c0, v0, v00, clean;\r\n      return {\r\n        lineStart: function() {\r\n          v00 = v0 = false;\r\n          clean = 1;\r\n        },\r\n        point: function(λ, φ) {\r\n          var point1 = [ λ, φ ], point2, v = visible(λ, φ), c = smallRadius ? v ? 0 : code(λ, φ) : v ? code(λ + (λ < 0 ? π : -π), φ) : 0;\r\n          if (!point0 && (v00 = v0 = v)) listener.lineStart();\r\n          if (v !== v0) {\r\n            point2 = intersect(point0, point1);\r\n            if (d3_geo_sphericalEqual(point0, point2) || d3_geo_sphericalEqual(point1, point2)) {\r\n              point1[0] += ε;\r\n              point1[1] += ε;\r\n              v = visible(point1[0], point1[1]);\r\n            }\r\n          }\r\n          if (v !== v0) {\r\n            clean = 0;\r\n            if (v) {\r\n              listener.lineStart();\r\n              point2 = intersect(point1, point0);\r\n              listener.point(point2[0], point2[1]);\r\n            } else {\r\n              point2 = intersect(point0, point1);\r\n              listener.point(point2[0], point2[1]);\r\n              listener.lineEnd();\r\n            }\r\n            point0 = point2;\r\n          } else if (notHemisphere && point0 && smallRadius ^ v) {\r\n            var t;\r\n            if (!(c & c0) && (t = intersect(point1, point0, true))) {\r\n              clean = 0;\r\n              if (smallRadius) {\r\n                listener.lineStart();\r\n                listener.point(t[0][0], t[0][1]);\r\n                listener.point(t[1][0], t[1][1]);\r\n                listener.lineEnd();\r\n              } else {\r\n                listener.point(t[1][0], t[1][1]);\r\n                listener.lineEnd();\r\n                listener.lineStart();\r\n                listener.point(t[0][0], t[0][1]);\r\n              }\r\n            }\r\n          }\r\n          if (v && (!point0 || !d3_geo_sphericalEqual(point0, point1))) {\r\n            listener.point(point1[0], point1[1]);\r\n          }\r\n          point0 = point1, v0 = v, c0 = c;\r\n        },\r\n        lineEnd: function() {\r\n          if (v0) listener.lineEnd();\r\n          point0 = null;\r\n        },\r\n        clean: function() {\r\n          return clean | (v00 && v0) << 1;\r\n        }\r\n      };\r\n    }\r\n    function intersect(a, b, two) {\r\n      var pa = d3_geo_cartesian(a), pb = d3_geo_cartesian(b);\r\n      var n1 = [ 1, 0, 0 ], n2 = d3_geo_cartesianCross(pa, pb), n2n2 = d3_geo_cartesianDot(n2, n2), n1n2 = n2[0], determinant = n2n2 - n1n2 * n1n2;\r\n      if (!determinant) return !two && a;\r\n      var c1 = cr * n2n2 / determinant, c2 = -cr * n1n2 / determinant, n1xn2 = d3_geo_cartesianCross(n1, n2), A = d3_geo_cartesianScale(n1, c1), B = d3_geo_cartesianScale(n2, c2);\r\n      d3_geo_cartesianAdd(A, B);\r\n      var u = n1xn2, w = d3_geo_cartesianDot(A, u), uu = d3_geo_cartesianDot(u, u), t2 = w * w - uu * (d3_geo_cartesianDot(A, A) - 1);\r\n      if (t2 < 0) return;\r\n      var t = Math.sqrt(t2), q = d3_geo_cartesianScale(u, (-w - t) / uu);\r\n      d3_geo_cartesianAdd(q, A);\r\n      q = d3_geo_spherical(q);\r\n      if (!two) return q;\r\n      var λ0 = a[0], λ1 = b[0], φ0 = a[1], φ1 = b[1], z;\r\n      if (λ1 < λ0) z = λ0, λ0 = λ1, λ1 = z;\r\n      var δλ = λ1 - λ0, polar = abs(δλ - π) < ε, meridian = polar || δλ < ε;\r\n      if (!polar && φ1 < φ0) z = φ0, φ0 = φ1, φ1 = z;\r\n      if (meridian ? polar ? φ0 + φ1 > 0 ^ q[1] < (abs(q[0] - λ0) < ε ? φ0 : φ1) : φ0 <= q[1] && q[1] <= φ1 : δλ > π ^ (λ0 <= q[0] && q[0] <= λ1)) {\r\n        var q1 = d3_geo_cartesianScale(u, (-w + t) / uu);\r\n        d3_geo_cartesianAdd(q1, A);\r\n        return [ q, d3_geo_spherical(q1) ];\r\n      }\r\n    }\r\n    function code(λ, φ) {\r\n      var r = smallRadius ? radius : π - radius, code = 0;\r\n      if (λ < -r) code |= 1; else if (λ > r) code |= 2;\r\n      if (φ < -r) code |= 4; else if (φ > r) code |= 8;\r\n      return code;\r\n    }\r\n  }\r\n  function d3_geom_clipLine(x0, y0, x1, y1) {\r\n    return function(line) {\r\n      var a = line.a, b = line.b, ax = a.x, ay = a.y, bx = b.x, by = b.y, t0 = 0, t1 = 1, dx = bx - ax, dy = by - ay, r;\r\n      r = x0 - ax;\r\n      if (!dx && r > 0) return;\r\n      r /= dx;\r\n      if (dx < 0) {\r\n        if (r < t0) return;\r\n        if (r < t1) t1 = r;\r\n      } else if (dx > 0) {\r\n        if (r > t1) return;\r\n        if (r > t0) t0 = r;\r\n      }\r\n      r = x1 - ax;\r\n      if (!dx && r < 0) return;\r\n      r /= dx;\r\n      if (dx < 0) {\r\n        if (r > t1) return;\r\n        if (r > t0) t0 = r;\r\n      } else if (dx > 0) {\r\n        if (r < t0) return;\r\n        if (r < t1) t1 = r;\r\n      }\r\n      r = y0 - ay;\r\n      if (!dy && r > 0) return;\r\n      r /= dy;\r\n      if (dy < 0) {\r\n        if (r < t0) return;\r\n        if (r < t1) t1 = r;\r\n      } else if (dy > 0) {\r\n        if (r > t1) return;\r\n        if (r > t0) t0 = r;\r\n      }\r\n      r = y1 - ay;\r\n      if (!dy && r < 0) return;\r\n      r /= dy;\r\n      if (dy < 0) {\r\n        if (r > t1) return;\r\n        if (r > t0) t0 = r;\r\n      } else if (dy > 0) {\r\n        if (r < t0) return;\r\n        if (r < t1) t1 = r;\r\n      }\r\n      if (t0 > 0) line.a = {\r\n        x: ax + t0 * dx,\r\n        y: ay + t0 * dy\r\n      };\r\n      if (t1 < 1) line.b = {\r\n        x: ax + t1 * dx,\r\n        y: ay + t1 * dy\r\n      };\r\n      return line;\r\n    };\r\n  }\r\n  var d3_geo_clipExtentMAX = 1e9;\r\n  d3.geo.clipExtent = function() {\r\n    var x0, y0, x1, y1, stream, clip, clipExtent = {\r\n      stream: function(output) {\r\n        if (stream) stream.valid = false;\r\n        stream = clip(output);\r\n        stream.valid = true;\r\n        return stream;\r\n      },\r\n      extent: function(_) {\r\n        if (!arguments.length) return [ [ x0, y0 ], [ x1, y1 ] ];\r\n        clip = d3_geo_clipExtent(x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1]);\r\n        if (stream) stream.valid = false, stream = null;\r\n        return clipExtent;\r\n      }\r\n    };\r\n    return clipExtent.extent([ [ 0, 0 ], [ 960, 500 ] ]);\r\n  };\r\n  function d3_geo_clipExtent(x0, y0, x1, y1) {\r\n    return function(listener) {\r\n      var listener_ = listener, bufferListener = d3_geo_clipBufferListener(), clipLine = d3_geom_clipLine(x0, y0, x1, y1), segments, polygon, ring;\r\n      var clip = {\r\n        point: point,\r\n        lineStart: lineStart,\r\n        lineEnd: lineEnd,\r\n        polygonStart: function() {\r\n          listener = bufferListener;\r\n          segments = [];\r\n          polygon = [];\r\n          clean = true;\r\n        },\r\n        polygonEnd: function() {\r\n          listener = listener_;\r\n          segments = d3.merge(segments);\r\n          var clipStartInside = insidePolygon([ x0, y1 ]), inside = clean && clipStartInside, visible = segments.length;\r\n          if (inside || visible) {\r\n            listener.polygonStart();\r\n            if (inside) {\r\n              listener.lineStart();\r\n              interpolate(null, null, 1, listener);\r\n              listener.lineEnd();\r\n            }\r\n            if (visible) {\r\n              d3_geo_clipPolygon(segments, compare, clipStartInside, interpolate, listener);\r\n            }\r\n            listener.polygonEnd();\r\n          }\r\n          segments = polygon = ring = null;\r\n        }\r\n      };\r\n      function insidePolygon(p) {\r\n        var wn = 0, n = polygon.length, y = p[1];\r\n        for (var i = 0; i < n; ++i) {\r\n          for (var j = 1, v = polygon[i], m = v.length, a = v[0], b; j < m; ++j) {\r\n            b = v[j];\r\n            if (a[1] <= y) {\r\n              if (b[1] > y && d3_cross2d(a, b, p) > 0) ++wn;\r\n            } else {\r\n              if (b[1] <= y && d3_cross2d(a, b, p) < 0) --wn;\r\n            }\r\n            a = b;\r\n          }\r\n        }\r\n        return wn !== 0;\r\n      }\r\n      function interpolate(from, to, direction, listener) {\r\n        var a = 0, a1 = 0;\r\n        if (from == null || (a = corner(from, direction)) !== (a1 = corner(to, direction)) || comparePoints(from, to) < 0 ^ direction > 0) {\r\n          do {\r\n            listener.point(a === 0 || a === 3 ? x0 : x1, a > 1 ? y1 : y0);\r\n          } while ((a = (a + direction + 4) % 4) !== a1);\r\n        } else {\r\n          listener.point(to[0], to[1]);\r\n        }\r\n      }\r\n      function pointVisible(x, y) {\r\n        return x0 <= x && x <= x1 && y0 <= y && y <= y1;\r\n      }\r\n      function point(x, y) {\r\n        if (pointVisible(x, y)) listener.point(x, y);\r\n      }\r\n      var x__, y__, v__, x_, y_, v_, first, clean;\r\n      function lineStart() {\r\n        clip.point = linePoint;\r\n        if (polygon) polygon.push(ring = []);\r\n        first = true;\r\n        v_ = false;\r\n        x_ = y_ = NaN;\r\n      }\r\n      function lineEnd() {\r\n        if (segments) {\r\n          linePoint(x__, y__);\r\n          if (v__ && v_) bufferListener.rejoin();\r\n          segments.push(bufferListener.buffer());\r\n        }\r\n        clip.point = point;\r\n        if (v_) listener.lineEnd();\r\n      }\r\n      function linePoint(x, y) {\r\n        x = Math.max(-d3_geo_clipExtentMAX, Math.min(d3_geo_clipExtentMAX, x));\r\n        y = Math.max(-d3_geo_clipExtentMAX, Math.min(d3_geo_clipExtentMAX, y));\r\n        var v = pointVisible(x, y);\r\n        if (polygon) ring.push([ x, y ]);\r\n        if (first) {\r\n          x__ = x, y__ = y, v__ = v;\r\n          first = false;\r\n          if (v) {\r\n            listener.lineStart();\r\n            listener.point(x, y);\r\n          }\r\n        } else {\r\n          if (v && v_) listener.point(x, y); else {\r\n            var l = {\r\n              a: {\r\n                x: x_,\r\n                y: y_\r\n              },\r\n              b: {\r\n                x: x,\r\n                y: y\r\n              }\r\n            };\r\n            if (clipLine(l)) {\r\n              if (!v_) {\r\n                listener.lineStart();\r\n                listener.point(l.a.x, l.a.y);\r\n              }\r\n              listener.point(l.b.x, l.b.y);\r\n              if (!v) listener.lineEnd();\r\n              clean = false;\r\n            } else if (v) {\r\n              listener.lineStart();\r\n              listener.point(x, y);\r\n              clean = false;\r\n            }\r\n          }\r\n        }\r\n        x_ = x, y_ = y, v_ = v;\r\n      }\r\n      return clip;\r\n    };\r\n    function corner(p, direction) {\r\n      return abs(p[0] - x0) < ε ? direction > 0 ? 0 : 3 : abs(p[0] - x1) < ε ? direction > 0 ? 2 : 1 : abs(p[1] - y0) < ε ? direction > 0 ? 1 : 0 : direction > 0 ? 3 : 2;\r\n    }\r\n    function compare(a, b) {\r\n      return comparePoints(a.x, b.x);\r\n    }\r\n    function comparePoints(a, b) {\r\n      var ca = corner(a, 1), cb = corner(b, 1);\r\n      return ca !== cb ? ca - cb : ca === 0 ? b[1] - a[1] : ca === 1 ? a[0] - b[0] : ca === 2 ? a[1] - b[1] : b[0] - a[0];\r\n    }\r\n  }\r\n  function d3_geo_conic(projectAt) {\r\n    var φ0 = 0, φ1 = π / 3, m = d3_geo_projectionMutator(projectAt), p = m(φ0, φ1);\r\n    p.parallels = function(_) {\r\n      if (!arguments.length) return [ φ0 / π * 180, φ1 / π * 180 ];\r\n      return m(φ0 = _[0] * π / 180, φ1 = _[1] * π / 180);\r\n    };\r\n    return p;\r\n  }\r\n  function d3_geo_conicEqualArea(φ0, φ1) {\r\n    var sinφ0 = Math.sin(φ0), n = (sinφ0 + Math.sin(φ1)) / 2, C = 1 + sinφ0 * (2 * n - sinφ0), ρ0 = Math.sqrt(C) / n;\r\n    function forward(λ, φ) {\r\n      var ρ = Math.sqrt(C - 2 * n * Math.sin(φ)) / n;\r\n      return [ ρ * Math.sin(λ *= n), ρ0 - ρ * Math.cos(λ) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var ρ0_y = ρ0 - y;\r\n      return [ Math.atan2(x, ρ0_y) / n, d3_asin((C - (x * x + ρ0_y * ρ0_y) * n * n) / (2 * n)) ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.conicEqualArea = function() {\r\n    return d3_geo_conic(d3_geo_conicEqualArea);\r\n  }).raw = d3_geo_conicEqualArea;\r\n  d3.geo.albers = function() {\r\n    return d3.geo.conicEqualArea().rotate([ 96, 0 ]).center([ -.6, 38.7 ]).parallels([ 29.5, 45.5 ]).scale(1070);\r\n  };\r\n  d3.geo.albersUsa = function() {\r\n    var lower48 = d3.geo.albers();\r\n    var alaska = d3.geo.conicEqualArea().rotate([ 154, 0 ]).center([ -2, 58.5 ]).parallels([ 55, 65 ]);\r\n    var hawaii = d3.geo.conicEqualArea().rotate([ 157, 0 ]).center([ -3, 19.9 ]).parallels([ 8, 18 ]);\r\n    var point, pointStream = {\r\n      point: function(x, y) {\r\n        point = [ x, y ];\r\n      }\r\n    }, lower48Point, alaskaPoint, hawaiiPoint;\r\n    function albersUsa(coordinates) {\r\n      var x = coordinates[0], y = coordinates[1];\r\n      point = null;\r\n      (lower48Point(x, y), point) || (alaskaPoint(x, y), point) || hawaiiPoint(x, y);\r\n      return point;\r\n    }\r\n    albersUsa.invert = function(coordinates) {\r\n      var k = lower48.scale(), t = lower48.translate(), x = (coordinates[0] - t[0]) / k, y = (coordinates[1] - t[1]) / k;\r\n      return (y >= .12 && y < .234 && x >= -.425 && x < -.214 ? alaska : y >= .166 && y < .234 && x >= -.214 && x < -.115 ? hawaii : lower48).invert(coordinates);\r\n    };\r\n    albersUsa.stream = function(stream) {\r\n      var lower48Stream = lower48.stream(stream), alaskaStream = alaska.stream(stream), hawaiiStream = hawaii.stream(stream);\r\n      return {\r\n        point: function(x, y) {\r\n          lower48Stream.point(x, y);\r\n          alaskaStream.point(x, y);\r\n          hawaiiStream.point(x, y);\r\n        },\r\n        sphere: function() {\r\n          lower48Stream.sphere();\r\n          alaskaStream.sphere();\r\n          hawaiiStream.sphere();\r\n        },\r\n        lineStart: function() {\r\n          lower48Stream.lineStart();\r\n          alaskaStream.lineStart();\r\n          hawaiiStream.lineStart();\r\n        },\r\n        lineEnd: function() {\r\n          lower48Stream.lineEnd();\r\n          alaskaStream.lineEnd();\r\n          hawaiiStream.lineEnd();\r\n        },\r\n        polygonStart: function() {\r\n          lower48Stream.polygonStart();\r\n          alaskaStream.polygonStart();\r\n          hawaiiStream.polygonStart();\r\n        },\r\n        polygonEnd: function() {\r\n          lower48Stream.polygonEnd();\r\n          alaskaStream.polygonEnd();\r\n          hawaiiStream.polygonEnd();\r\n        }\r\n      };\r\n    };\r\n    albersUsa.precision = function(_) {\r\n      if (!arguments.length) return lower48.precision();\r\n      lower48.precision(_);\r\n      alaska.precision(_);\r\n      hawaii.precision(_);\r\n      return albersUsa;\r\n    };\r\n    albersUsa.scale = function(_) {\r\n      if (!arguments.length) return lower48.scale();\r\n      lower48.scale(_);\r\n      alaska.scale(_ * .35);\r\n      hawaii.scale(_);\r\n      return albersUsa.translate(lower48.translate());\r\n    };\r\n    albersUsa.translate = function(_) {\r\n      if (!arguments.length) return lower48.translate();\r\n      var k = lower48.scale(), x = +_[0], y = +_[1];\r\n      lower48Point = lower48.translate(_).clipExtent([ [ x - .455 * k, y - .238 * k ], [ x + .455 * k, y + .238 * k ] ]).stream(pointStream).point;\r\n      alaskaPoint = alaska.translate([ x - .307 * k, y + .201 * k ]).clipExtent([ [ x - .425 * k + ε, y + .12 * k + ε ], [ x - .214 * k - ε, y + .234 * k - ε ] ]).stream(pointStream).point;\r\n      hawaiiPoint = hawaii.translate([ x - .205 * k, y + .212 * k ]).clipExtent([ [ x - .214 * k + ε, y + .166 * k + ε ], [ x - .115 * k - ε, y + .234 * k - ε ] ]).stream(pointStream).point;\r\n      return albersUsa;\r\n    };\r\n    return albersUsa.scale(1070);\r\n  };\r\n  var d3_geo_pathAreaSum, d3_geo_pathAreaPolygon, d3_geo_pathArea = {\r\n    point: d3_noop,\r\n    lineStart: d3_noop,\r\n    lineEnd: d3_noop,\r\n    polygonStart: function() {\r\n      d3_geo_pathAreaPolygon = 0;\r\n      d3_geo_pathArea.lineStart = d3_geo_pathAreaRingStart;\r\n    },\r\n    polygonEnd: function() {\r\n      d3_geo_pathArea.lineStart = d3_geo_pathArea.lineEnd = d3_geo_pathArea.point = d3_noop;\r\n      d3_geo_pathAreaSum += abs(d3_geo_pathAreaPolygon / 2);\r\n    }\r\n  };\r\n  function d3_geo_pathAreaRingStart() {\r\n    var x00, y00, x0, y0;\r\n    d3_geo_pathArea.point = function(x, y) {\r\n      d3_geo_pathArea.point = nextPoint;\r\n      x00 = x0 = x, y00 = y0 = y;\r\n    };\r\n    function nextPoint(x, y) {\r\n      d3_geo_pathAreaPolygon += y0 * x - x0 * y;\r\n      x0 = x, y0 = y;\r\n    }\r\n    d3_geo_pathArea.lineEnd = function() {\r\n      nextPoint(x00, y00);\r\n    };\r\n  }\r\n  var d3_geo_pathBoundsX0, d3_geo_pathBoundsY0, d3_geo_pathBoundsX1, d3_geo_pathBoundsY1;\r\n  var d3_geo_pathBounds = {\r\n    point: d3_geo_pathBoundsPoint,\r\n    lineStart: d3_noop,\r\n    lineEnd: d3_noop,\r\n    polygonStart: d3_noop,\r\n    polygonEnd: d3_noop\r\n  };\r\n  function d3_geo_pathBoundsPoint(x, y) {\r\n    if (x < d3_geo_pathBoundsX0) d3_geo_pathBoundsX0 = x;\r\n    if (x > d3_geo_pathBoundsX1) d3_geo_pathBoundsX1 = x;\r\n    if (y < d3_geo_pathBoundsY0) d3_geo_pathBoundsY0 = y;\r\n    if (y > d3_geo_pathBoundsY1) d3_geo_pathBoundsY1 = y;\r\n  }\r\n  function d3_geo_pathBuffer() {\r\n    var pointCircle = d3_geo_pathBufferCircle(4.5), buffer = [];\r\n    var stream = {\r\n      point: point,\r\n      lineStart: function() {\r\n        stream.point = pointLineStart;\r\n      },\r\n      lineEnd: lineEnd,\r\n      polygonStart: function() {\r\n        stream.lineEnd = lineEndPolygon;\r\n      },\r\n      polygonEnd: function() {\r\n        stream.lineEnd = lineEnd;\r\n        stream.point = point;\r\n      },\r\n      pointRadius: function(_) {\r\n        pointCircle = d3_geo_pathBufferCircle(_);\r\n        return stream;\r\n      },\r\n      result: function() {\r\n        if (buffer.length) {\r\n          var result = buffer.join(\"\");\r\n          buffer = [];\r\n          return result;\r\n        }\r\n      }\r\n    };\r\n    function point(x, y) {\r\n      buffer.push(\"M\", x, \",\", y, pointCircle);\r\n    }\r\n    function pointLineStart(x, y) {\r\n      buffer.push(\"M\", x, \",\", y);\r\n      stream.point = pointLine;\r\n    }\r\n    function pointLine(x, y) {\r\n      buffer.push(\"L\", x, \",\", y);\r\n    }\r\n    function lineEnd() {\r\n      stream.point = point;\r\n    }\r\n    function lineEndPolygon() {\r\n      buffer.push(\"Z\");\r\n    }\r\n    return stream;\r\n  }\r\n  function d3_geo_pathBufferCircle(radius) {\r\n    return \"m0,\" + radius + \"a\" + radius + \",\" + radius + \" 0 1,1 0,\" + -2 * radius + \"a\" + radius + \",\" + radius + \" 0 1,1 0,\" + 2 * radius + \"z\";\r\n  }\r\n  var d3_geo_pathCentroid = {\r\n    point: d3_geo_pathCentroidPoint,\r\n    lineStart: d3_geo_pathCentroidLineStart,\r\n    lineEnd: d3_geo_pathCentroidLineEnd,\r\n    polygonStart: function() {\r\n      d3_geo_pathCentroid.lineStart = d3_geo_pathCentroidRingStart;\r\n    },\r\n    polygonEnd: function() {\r\n      d3_geo_pathCentroid.point = d3_geo_pathCentroidPoint;\r\n      d3_geo_pathCentroid.lineStart = d3_geo_pathCentroidLineStart;\r\n      d3_geo_pathCentroid.lineEnd = d3_geo_pathCentroidLineEnd;\r\n    }\r\n  };\r\n  function d3_geo_pathCentroidPoint(x, y) {\r\n    d3_geo_centroidX0 += x;\r\n    d3_geo_centroidY0 += y;\r\n    ++d3_geo_centroidZ0;\r\n  }\r\n  function d3_geo_pathCentroidLineStart() {\r\n    var x0, y0;\r\n    d3_geo_pathCentroid.point = function(x, y) {\r\n      d3_geo_pathCentroid.point = nextPoint;\r\n      d3_geo_pathCentroidPoint(x0 = x, y0 = y);\r\n    };\r\n    function nextPoint(x, y) {\r\n      var dx = x - x0, dy = y - y0, z = Math.sqrt(dx * dx + dy * dy);\r\n      d3_geo_centroidX1 += z * (x0 + x) / 2;\r\n      d3_geo_centroidY1 += z * (y0 + y) / 2;\r\n      d3_geo_centroidZ1 += z;\r\n      d3_geo_pathCentroidPoint(x0 = x, y0 = y);\r\n    }\r\n  }\r\n  function d3_geo_pathCentroidLineEnd() {\r\n    d3_geo_pathCentroid.point = d3_geo_pathCentroidPoint;\r\n  }\r\n  function d3_geo_pathCentroidRingStart() {\r\n    var x00, y00, x0, y0;\r\n    d3_geo_pathCentroid.point = function(x, y) {\r\n      d3_geo_pathCentroid.point = nextPoint;\r\n      d3_geo_pathCentroidPoint(x00 = x0 = x, y00 = y0 = y);\r\n    };\r\n    function nextPoint(x, y) {\r\n      var dx = x - x0, dy = y - y0, z = Math.sqrt(dx * dx + dy * dy);\r\n      d3_geo_centroidX1 += z * (x0 + x) / 2;\r\n      d3_geo_centroidY1 += z * (y0 + y) / 2;\r\n      d3_geo_centroidZ1 += z;\r\n      z = y0 * x - x0 * y;\r\n      d3_geo_centroidX2 += z * (x0 + x);\r\n      d3_geo_centroidY2 += z * (y0 + y);\r\n      d3_geo_centroidZ2 += z * 3;\r\n      d3_geo_pathCentroidPoint(x0 = x, y0 = y);\r\n    }\r\n    d3_geo_pathCentroid.lineEnd = function() {\r\n      nextPoint(x00, y00);\r\n    };\r\n  }\r\n  function d3_geo_pathContext(context) {\r\n    var pointRadius = 4.5;\r\n    var stream = {\r\n      point: point,\r\n      lineStart: function() {\r\n        stream.point = pointLineStart;\r\n      },\r\n      lineEnd: lineEnd,\r\n      polygonStart: function() {\r\n        stream.lineEnd = lineEndPolygon;\r\n      },\r\n      polygonEnd: function() {\r\n        stream.lineEnd = lineEnd;\r\n        stream.point = point;\r\n      },\r\n      pointRadius: function(_) {\r\n        pointRadius = _;\r\n        return stream;\r\n      },\r\n      result: d3_noop\r\n    };\r\n    function point(x, y) {\r\n      context.moveTo(x + pointRadius, y);\r\n      context.arc(x, y, pointRadius, 0, τ);\r\n    }\r\n    function pointLineStart(x, y) {\r\n      context.moveTo(x, y);\r\n      stream.point = pointLine;\r\n    }\r\n    function pointLine(x, y) {\r\n      context.lineTo(x, y);\r\n    }\r\n    function lineEnd() {\r\n      stream.point = point;\r\n    }\r\n    function lineEndPolygon() {\r\n      context.closePath();\r\n    }\r\n    return stream;\r\n  }\r\n  function d3_geo_resample(project) {\r\n    var δ2 = .5, cosMinDistance = Math.cos(30 * d3_radians), maxDepth = 16;\r\n    function resample(stream) {\r\n      return (maxDepth ? resampleRecursive : resampleNone)(stream);\r\n    }\r\n    function resampleNone(stream) {\r\n      return d3_geo_transformPoint(stream, function(x, y) {\r\n        x = project(x, y);\r\n        stream.point(x[0], x[1]);\r\n      });\r\n    }\r\n    function resampleRecursive(stream) {\r\n      var λ00, φ00, x00, y00, a00, b00, c00, λ0, x0, y0, a0, b0, c0;\r\n      var resample = {\r\n        point: point,\r\n        lineStart: lineStart,\r\n        lineEnd: lineEnd,\r\n        polygonStart: function() {\r\n          stream.polygonStart();\r\n          resample.lineStart = ringStart;\r\n        },\r\n        polygonEnd: function() {\r\n          stream.polygonEnd();\r\n          resample.lineStart = lineStart;\r\n        }\r\n      };\r\n      function point(x, y) {\r\n        x = project(x, y);\r\n        stream.point(x[0], x[1]);\r\n      }\r\n      function lineStart() {\r\n        x0 = NaN;\r\n        resample.point = linePoint;\r\n        stream.lineStart();\r\n      }\r\n      function linePoint(λ, φ) {\r\n        var c = d3_geo_cartesian([ λ, φ ]), p = project(λ, φ);\r\n        resampleLineTo(x0, y0, λ0, a0, b0, c0, x0 = p[0], y0 = p[1], λ0 = λ, a0 = c[0], b0 = c[1], c0 = c[2], maxDepth, stream);\r\n        stream.point(x0, y0);\r\n      }\r\n      function lineEnd() {\r\n        resample.point = point;\r\n        stream.lineEnd();\r\n      }\r\n      function ringStart() {\r\n        lineStart();\r\n        resample.point = ringPoint;\r\n        resample.lineEnd = ringEnd;\r\n      }\r\n      function ringPoint(λ, φ) {\r\n        linePoint(λ00 = λ, φ00 = φ), x00 = x0, y00 = y0, a00 = a0, b00 = b0, c00 = c0;\r\n        resample.point = linePoint;\r\n      }\r\n      function ringEnd() {\r\n        resampleLineTo(x0, y0, λ0, a0, b0, c0, x00, y00, λ00, a00, b00, c00, maxDepth, stream);\r\n        resample.lineEnd = lineEnd;\r\n        lineEnd();\r\n      }\r\n      return resample;\r\n    }\r\n    function resampleLineTo(x0, y0, λ0, a0, b0, c0, x1, y1, λ1, a1, b1, c1, depth, stream) {\r\n      var dx = x1 - x0, dy = y1 - y0, d2 = dx * dx + dy * dy;\r\n      if (d2 > 4 * δ2 && depth--) {\r\n        var a = a0 + a1, b = b0 + b1, c = c0 + c1, m = Math.sqrt(a * a + b * b + c * c), φ2 = Math.asin(c /= m), λ2 = abs(abs(c) - 1) < ε || abs(λ0 - λ1) < ε ? (λ0 + λ1) / 2 : Math.atan2(b, a), p = project(λ2, φ2), x2 = p[0], y2 = p[1], dx2 = x2 - x0, dy2 = y2 - y0, dz = dy * dx2 - dx * dy2;\r\n        if (dz * dz / d2 > δ2 || abs((dx * dx2 + dy * dy2) / d2 - .5) > .3 || a0 * a1 + b0 * b1 + c0 * c1 < cosMinDistance) {\r\n          resampleLineTo(x0, y0, λ0, a0, b0, c0, x2, y2, λ2, a /= m, b /= m, c, depth, stream);\r\n          stream.point(x2, y2);\r\n          resampleLineTo(x2, y2, λ2, a, b, c, x1, y1, λ1, a1, b1, c1, depth, stream);\r\n        }\r\n      }\r\n    }\r\n    resample.precision = function(_) {\r\n      if (!arguments.length) return Math.sqrt(δ2);\r\n      maxDepth = (δ2 = _ * _) > 0 && 16;\r\n      return resample;\r\n    };\r\n    return resample;\r\n  }\r\n  d3.geo.path = function() {\r\n    var pointRadius = 4.5, projection, context, projectStream, contextStream, cacheStream;\r\n    function path(object) {\r\n      if (object) {\r\n        if (typeof pointRadius === \"function\") contextStream.pointRadius(+pointRadius.apply(this, arguments));\r\n        if (!cacheStream || !cacheStream.valid) cacheStream = projectStream(contextStream);\r\n        d3.geo.stream(object, cacheStream);\r\n      }\r\n      return contextStream.result();\r\n    }\r\n    path.area = function(object) {\r\n      d3_geo_pathAreaSum = 0;\r\n      d3.geo.stream(object, projectStream(d3_geo_pathArea));\r\n      return d3_geo_pathAreaSum;\r\n    };\r\n    path.centroid = function(object) {\r\n      d3_geo_centroidX0 = d3_geo_centroidY0 = d3_geo_centroidZ0 = d3_geo_centroidX1 = d3_geo_centroidY1 = d3_geo_centroidZ1 = d3_geo_centroidX2 = d3_geo_centroidY2 = d3_geo_centroidZ2 = 0;\r\n      d3.geo.stream(object, projectStream(d3_geo_pathCentroid));\r\n      return d3_geo_centroidZ2 ? [ d3_geo_centroidX2 / d3_geo_centroidZ2, d3_geo_centroidY2 / d3_geo_centroidZ2 ] : d3_geo_centroidZ1 ? [ d3_geo_centroidX1 / d3_geo_centroidZ1, d3_geo_centroidY1 / d3_geo_centroidZ1 ] : d3_geo_centroidZ0 ? [ d3_geo_centroidX0 / d3_geo_centroidZ0, d3_geo_centroidY0 / d3_geo_centroidZ0 ] : [ NaN, NaN ];\r\n    };\r\n    path.bounds = function(object) {\r\n      d3_geo_pathBoundsX1 = d3_geo_pathBoundsY1 = -(d3_geo_pathBoundsX0 = d3_geo_pathBoundsY0 = Infinity);\r\n      d3.geo.stream(object, projectStream(d3_geo_pathBounds));\r\n      return [ [ d3_geo_pathBoundsX0, d3_geo_pathBoundsY0 ], [ d3_geo_pathBoundsX1, d3_geo_pathBoundsY1 ] ];\r\n    };\r\n    path.projection = function(_) {\r\n      if (!arguments.length) return projection;\r\n      projectStream = (projection = _) ? _.stream || d3_geo_pathProjectStream(_) : d3_identity;\r\n      return reset();\r\n    };\r\n    path.context = function(_) {\r\n      if (!arguments.length) return context;\r\n      contextStream = (context = _) == null ? new d3_geo_pathBuffer() : new d3_geo_pathContext(_);\r\n      if (typeof pointRadius !== \"function\") contextStream.pointRadius(pointRadius);\r\n      return reset();\r\n    };\r\n    path.pointRadius = function(_) {\r\n      if (!arguments.length) return pointRadius;\r\n      pointRadius = typeof _ === \"function\" ? _ : (contextStream.pointRadius(+_), +_);\r\n      return path;\r\n    };\r\n    function reset() {\r\n      cacheStream = null;\r\n      return path;\r\n    }\r\n    return path.projection(d3.geo.albersUsa()).context(null);\r\n  };\r\n  function d3_geo_pathProjectStream(project) {\r\n    var resample = d3_geo_resample(function(x, y) {\r\n      return project([ x * d3_degrees, y * d3_degrees ]);\r\n    });\r\n    return function(stream) {\r\n      return d3_geo_projectionRadians(resample(stream));\r\n    };\r\n  }\r\n  d3.geo.transform = function(methods) {\r\n    return {\r\n      stream: function(stream) {\r\n        var transform = new d3_geo_transform(stream);\r\n        for (var k in methods) transform[k] = methods[k];\r\n        return transform;\r\n      }\r\n    };\r\n  };\r\n  function d3_geo_transform(stream) {\r\n    this.stream = stream;\r\n  }\r\n  d3_geo_transform.prototype = {\r\n    point: function(x, y) {\r\n      this.stream.point(x, y);\r\n    },\r\n    sphere: function() {\r\n      this.stream.sphere();\r\n    },\r\n    lineStart: function() {\r\n      this.stream.lineStart();\r\n    },\r\n    lineEnd: function() {\r\n      this.stream.lineEnd();\r\n    },\r\n    polygonStart: function() {\r\n      this.stream.polygonStart();\r\n    },\r\n    polygonEnd: function() {\r\n      this.stream.polygonEnd();\r\n    }\r\n  };\r\n  function d3_geo_transformPoint(stream, point) {\r\n    return {\r\n      point: point,\r\n      sphere: function() {\r\n        stream.sphere();\r\n      },\r\n      lineStart: function() {\r\n        stream.lineStart();\r\n      },\r\n      lineEnd: function() {\r\n        stream.lineEnd();\r\n      },\r\n      polygonStart: function() {\r\n        stream.polygonStart();\r\n      },\r\n      polygonEnd: function() {\r\n        stream.polygonEnd();\r\n      }\r\n    };\r\n  }\r\n  d3.geo.projection = d3_geo_projection;\r\n  d3.geo.projectionMutator = d3_geo_projectionMutator;\r\n  function d3_geo_projection(project) {\r\n    return d3_geo_projectionMutator(function() {\r\n      return project;\r\n    })();\r\n  }\r\n  function d3_geo_projectionMutator(projectAt) {\r\n    var project, rotate, projectRotate, projectResample = d3_geo_resample(function(x, y) {\r\n      x = project(x, y);\r\n      return [ x[0] * k + δx, δy - x[1] * k ];\r\n    }), k = 150, x = 480, y = 250, λ = 0, φ = 0, δλ = 0, δφ = 0, δγ = 0, δx, δy, preclip = d3_geo_clipAntimeridian, postclip = d3_identity, clipAngle = null, clipExtent = null, stream;\r\n    function projection(point) {\r\n      point = projectRotate(point[0] * d3_radians, point[1] * d3_radians);\r\n      return [ point[0] * k + δx, δy - point[1] * k ];\r\n    }\r\n    function invert(point) {\r\n      point = projectRotate.invert((point[0] - δx) / k, (δy - point[1]) / k);\r\n      return point && [ point[0] * d3_degrees, point[1] * d3_degrees ];\r\n    }\r\n    projection.stream = function(output) {\r\n      if (stream) stream.valid = false;\r\n      stream = d3_geo_projectionRadians(preclip(rotate, projectResample(postclip(output))));\r\n      stream.valid = true;\r\n      return stream;\r\n    };\r\n    projection.clipAngle = function(_) {\r\n      if (!arguments.length) return clipAngle;\r\n      preclip = _ == null ? (clipAngle = _, d3_geo_clipAntimeridian) : d3_geo_clipCircle((clipAngle = +_) * d3_radians);\r\n      return invalidate();\r\n    };\r\n    projection.clipExtent = function(_) {\r\n      if (!arguments.length) return clipExtent;\r\n      clipExtent = _;\r\n      postclip = _ ? d3_geo_clipExtent(_[0][0], _[0][1], _[1][0], _[1][1]) : d3_identity;\r\n      return invalidate();\r\n    };\r\n    projection.scale = function(_) {\r\n      if (!arguments.length) return k;\r\n      k = +_;\r\n      return reset();\r\n    };\r\n    projection.translate = function(_) {\r\n      if (!arguments.length) return [ x, y ];\r\n      x = +_[0];\r\n      y = +_[1];\r\n      return reset();\r\n    };\r\n    projection.center = function(_) {\r\n      if (!arguments.length) return [ λ * d3_degrees, φ * d3_degrees ];\r\n      λ = _[0] % 360 * d3_radians;\r\n      φ = _[1] % 360 * d3_radians;\r\n      return reset();\r\n    };\r\n    projection.rotate = function(_) {\r\n      if (!arguments.length) return [ δλ * d3_degrees, δφ * d3_degrees, δγ * d3_degrees ];\r\n      δλ = _[0] % 360 * d3_radians;\r\n      δφ = _[1] % 360 * d3_radians;\r\n      δγ = _.length > 2 ? _[2] % 360 * d3_radians : 0;\r\n      return reset();\r\n    };\r\n    d3.rebind(projection, projectResample, \"precision\");\r\n    function reset() {\r\n      projectRotate = d3_geo_compose(rotate = d3_geo_rotation(δλ, δφ, δγ), project);\r\n      var center = project(λ, φ);\r\n      δx = x - center[0] * k;\r\n      δy = y + center[1] * k;\r\n      return invalidate();\r\n    }\r\n    function invalidate() {\r\n      if (stream) stream.valid = false, stream = null;\r\n      return projection;\r\n    }\r\n    return function() {\r\n      project = projectAt.apply(this, arguments);\r\n      projection.invert = project.invert && invert;\r\n      return reset();\r\n    };\r\n  }\r\n  function d3_geo_projectionRadians(stream) {\r\n    return d3_geo_transformPoint(stream, function(x, y) {\r\n      stream.point(x * d3_radians, y * d3_radians);\r\n    });\r\n  }\r\n  function d3_geo_equirectangular(λ, φ) {\r\n    return [ λ, φ ];\r\n  }\r\n  (d3.geo.equirectangular = function() {\r\n    return d3_geo_projection(d3_geo_equirectangular);\r\n  }).raw = d3_geo_equirectangular.invert = d3_geo_equirectangular;\r\n  d3.geo.rotation = function(rotate) {\r\n    rotate = d3_geo_rotation(rotate[0] % 360 * d3_radians, rotate[1] * d3_radians, rotate.length > 2 ? rotate[2] * d3_radians : 0);\r\n    function forward(coordinates) {\r\n      coordinates = rotate(coordinates[0] * d3_radians, coordinates[1] * d3_radians);\r\n      return coordinates[0] *= d3_degrees, coordinates[1] *= d3_degrees, coordinates;\r\n    }\r\n    forward.invert = function(coordinates) {\r\n      coordinates = rotate.invert(coordinates[0] * d3_radians, coordinates[1] * d3_radians);\r\n      return coordinates[0] *= d3_degrees, coordinates[1] *= d3_degrees, coordinates;\r\n    };\r\n    return forward;\r\n  };\r\n  function d3_geo_identityRotation(λ, φ) {\r\n    return [ λ > π ? λ - τ : λ < -π ? λ + τ : λ, φ ];\r\n  }\r\n  d3_geo_identityRotation.invert = d3_geo_equirectangular;\r\n  function d3_geo_rotation(δλ, δφ, δγ) {\r\n    return δλ ? δφ || δγ ? d3_geo_compose(d3_geo_rotationλ(δλ), d3_geo_rotationφγ(δφ, δγ)) : d3_geo_rotationλ(δλ) : δφ || δγ ? d3_geo_rotationφγ(δφ, δγ) : d3_geo_identityRotation;\r\n  }\r\n  function d3_geo_forwardRotationλ(δλ) {\r\n    return function(λ, φ) {\r\n      return λ += δλ, [ λ > π ? λ - τ : λ < -π ? λ + τ : λ, φ ];\r\n    };\r\n  }\r\n  function d3_geo_rotationλ(δλ) {\r\n    var rotation = d3_geo_forwardRotationλ(δλ);\r\n    rotation.invert = d3_geo_forwardRotationλ(-δλ);\r\n    return rotation;\r\n  }\r\n  function d3_geo_rotationφγ(δφ, δγ) {\r\n    var cosδφ = Math.cos(δφ), sinδφ = Math.sin(δφ), cosδγ = Math.cos(δγ), sinδγ = Math.sin(δγ);\r\n    function rotation(λ, φ) {\r\n      var cosφ = Math.cos(φ), x = Math.cos(λ) * cosφ, y = Math.sin(λ) * cosφ, z = Math.sin(φ), k = z * cosδφ + x * sinδφ;\r\n      return [ Math.atan2(y * cosδγ - k * sinδγ, x * cosδφ - z * sinδφ), d3_asin(k * cosδγ + y * sinδγ) ];\r\n    }\r\n    rotation.invert = function(λ, φ) {\r\n      var cosφ = Math.cos(φ), x = Math.cos(λ) * cosφ, y = Math.sin(λ) * cosφ, z = Math.sin(φ), k = z * cosδγ - y * sinδγ;\r\n      return [ Math.atan2(y * cosδγ + z * sinδγ, x * cosδφ + k * sinδφ), d3_asin(k * cosδφ - x * sinδφ) ];\r\n    };\r\n    return rotation;\r\n  }\r\n  d3.geo.circle = function() {\r\n    var origin = [ 0, 0 ], angle, precision = 6, interpolate;\r\n    function circle() {\r\n      var center = typeof origin === \"function\" ? origin.apply(this, arguments) : origin, rotate = d3_geo_rotation(-center[0] * d3_radians, -center[1] * d3_radians, 0).invert, ring = [];\r\n      interpolate(null, null, 1, {\r\n        point: function(x, y) {\r\n          ring.push(x = rotate(x, y));\r\n          x[0] *= d3_degrees, x[1] *= d3_degrees;\r\n        }\r\n      });\r\n      return {\r\n        type: \"Polygon\",\r\n        coordinates: [ ring ]\r\n      };\r\n    }\r\n    circle.origin = function(x) {\r\n      if (!arguments.length) return origin;\r\n      origin = x;\r\n      return circle;\r\n    };\r\n    circle.angle = function(x) {\r\n      if (!arguments.length) return angle;\r\n      interpolate = d3_geo_circleInterpolate((angle = +x) * d3_radians, precision * d3_radians);\r\n      return circle;\r\n    };\r\n    circle.precision = function(_) {\r\n      if (!arguments.length) return precision;\r\n      interpolate = d3_geo_circleInterpolate(angle * d3_radians, (precision = +_) * d3_radians);\r\n      return circle;\r\n    };\r\n    return circle.angle(90);\r\n  };\r\n  function d3_geo_circleInterpolate(radius, precision) {\r\n    var cr = Math.cos(radius), sr = Math.sin(radius);\r\n    return function(from, to, direction, listener) {\r\n      var step = direction * precision;\r\n      if (from != null) {\r\n        from = d3_geo_circleAngle(cr, from);\r\n        to = d3_geo_circleAngle(cr, to);\r\n        if (direction > 0 ? from < to : from > to) from += direction * τ;\r\n      } else {\r\n        from = radius + direction * τ;\r\n        to = radius - .5 * step;\r\n      }\r\n      for (var point, t = from; direction > 0 ? t > to : t < to; t -= step) {\r\n        listener.point((point = d3_geo_spherical([ cr, -sr * Math.cos(t), -sr * Math.sin(t) ]))[0], point[1]);\r\n      }\r\n    };\r\n  }\r\n  function d3_geo_circleAngle(cr, point) {\r\n    var a = d3_geo_cartesian(point);\r\n    a[0] -= cr;\r\n    d3_geo_cartesianNormalize(a);\r\n    var angle = d3_acos(-a[1]);\r\n    return ((-a[2] < 0 ? -angle : angle) + 2 * Math.PI - ε) % (2 * Math.PI);\r\n  }\r\n  d3.geo.distance = function(a, b) {\r\n    var Δλ = (b[0] - a[0]) * d3_radians, φ0 = a[1] * d3_radians, φ1 = b[1] * d3_radians, sinΔλ = Math.sin(Δλ), cosΔλ = Math.cos(Δλ), sinφ0 = Math.sin(φ0), cosφ0 = Math.cos(φ0), sinφ1 = Math.sin(φ1), cosφ1 = Math.cos(φ1), t;\r\n    return Math.atan2(Math.sqrt((t = cosφ1 * sinΔλ) * t + (t = cosφ0 * sinφ1 - sinφ0 * cosφ1 * cosΔλ) * t), sinφ0 * sinφ1 + cosφ0 * cosφ1 * cosΔλ);\r\n  };\r\n  d3.geo.graticule = function() {\r\n    var x1, x0, X1, X0, y1, y0, Y1, Y0, dx = 10, dy = dx, DX = 90, DY = 360, x, y, X, Y, precision = 2.5;\r\n    function graticule() {\r\n      return {\r\n        type: \"MultiLineString\",\r\n        coordinates: lines()\r\n      };\r\n    }\r\n    function lines() {\r\n      return d3.range(Math.ceil(X0 / DX) * DX, X1, DX).map(X).concat(d3.range(Math.ceil(Y0 / DY) * DY, Y1, DY).map(Y)).concat(d3.range(Math.ceil(x0 / dx) * dx, x1, dx).filter(function(x) {\r\n        return abs(x % DX) > ε;\r\n      }).map(x)).concat(d3.range(Math.ceil(y0 / dy) * dy, y1, dy).filter(function(y) {\r\n        return abs(y % DY) > ε;\r\n      }).map(y));\r\n    }\r\n    graticule.lines = function() {\r\n      return lines().map(function(coordinates) {\r\n        return {\r\n          type: \"LineString\",\r\n          coordinates: coordinates\r\n        };\r\n      });\r\n    };\r\n    graticule.outline = function() {\r\n      return {\r\n        type: \"Polygon\",\r\n        coordinates: [ X(X0).concat(Y(Y1).slice(1), X(X1).reverse().slice(1), Y(Y0).reverse().slice(1)) ]\r\n      };\r\n    };\r\n    graticule.extent = function(_) {\r\n      if (!arguments.length) return graticule.minorExtent();\r\n      return graticule.majorExtent(_).minorExtent(_);\r\n    };\r\n    graticule.majorExtent = function(_) {\r\n      if (!arguments.length) return [ [ X0, Y0 ], [ X1, Y1 ] ];\r\n      X0 = +_[0][0], X1 = +_[1][0];\r\n      Y0 = +_[0][1], Y1 = +_[1][1];\r\n      if (X0 > X1) _ = X0, X0 = X1, X1 = _;\r\n      if (Y0 > Y1) _ = Y0, Y0 = Y1, Y1 = _;\r\n      return graticule.precision(precision);\r\n    };\r\n    graticule.minorExtent = function(_) {\r\n      if (!arguments.length) return [ [ x0, y0 ], [ x1, y1 ] ];\r\n      x0 = +_[0][0], x1 = +_[1][0];\r\n      y0 = +_[0][1], y1 = +_[1][1];\r\n      if (x0 > x1) _ = x0, x0 = x1, x1 = _;\r\n      if (y0 > y1) _ = y0, y0 = y1, y1 = _;\r\n      return graticule.precision(precision);\r\n    };\r\n    graticule.step = function(_) {\r\n      if (!arguments.length) return graticule.minorStep();\r\n      return graticule.majorStep(_).minorStep(_);\r\n    };\r\n    graticule.majorStep = function(_) {\r\n      if (!arguments.length) return [ DX, DY ];\r\n      DX = +_[0], DY = +_[1];\r\n      return graticule;\r\n    };\r\n    graticule.minorStep = function(_) {\r\n      if (!arguments.length) return [ dx, dy ];\r\n      dx = +_[0], dy = +_[1];\r\n      return graticule;\r\n    };\r\n    graticule.precision = function(_) {\r\n      if (!arguments.length) return precision;\r\n      precision = +_;\r\n      x = d3_geo_graticuleX(y0, y1, 90);\r\n      y = d3_geo_graticuleY(x0, x1, precision);\r\n      X = d3_geo_graticuleX(Y0, Y1, 90);\r\n      Y = d3_geo_graticuleY(X0, X1, precision);\r\n      return graticule;\r\n    };\r\n    return graticule.majorExtent([ [ -180, -90 + ε ], [ 180, 90 - ε ] ]).minorExtent([ [ -180, -80 - ε ], [ 180, 80 + ε ] ]);\r\n  };\r\n  function d3_geo_graticuleX(y0, y1, dy) {\r\n    var y = d3.range(y0, y1 - ε, dy).concat(y1);\r\n    return function(x) {\r\n      return y.map(function(y) {\r\n        return [ x, y ];\r\n      });\r\n    };\r\n  }\r\n  function d3_geo_graticuleY(x0, x1, dx) {\r\n    var x = d3.range(x0, x1 - ε, dx).concat(x1);\r\n    return function(y) {\r\n      return x.map(function(x) {\r\n        return [ x, y ];\r\n      });\r\n    };\r\n  }\r\n  function d3_source(d) {\r\n    return d.source;\r\n  }\r\n  function d3_target(d) {\r\n    return d.target;\r\n  }\r\n  d3.geo.greatArc = function() {\r\n    var source = d3_source, source_, target = d3_target, target_;\r\n    function greatArc() {\r\n      return {\r\n        type: \"LineString\",\r\n        coordinates: [ source_ || source.apply(this, arguments), target_ || target.apply(this, arguments) ]\r\n      };\r\n    }\r\n    greatArc.distance = function() {\r\n      return d3.geo.distance(source_ || source.apply(this, arguments), target_ || target.apply(this, arguments));\r\n    };\r\n    greatArc.source = function(_) {\r\n      if (!arguments.length) return source;\r\n      source = _, source_ = typeof _ === \"function\" ? null : _;\r\n      return greatArc;\r\n    };\r\n    greatArc.target = function(_) {\r\n      if (!arguments.length) return target;\r\n      target = _, target_ = typeof _ === \"function\" ? null : _;\r\n      return greatArc;\r\n    };\r\n    greatArc.precision = function() {\r\n      return arguments.length ? greatArc : 0;\r\n    };\r\n    return greatArc;\r\n  };\r\n  d3.geo.interpolate = function(source, target) {\r\n    return d3_geo_interpolate(source[0] * d3_radians, source[1] * d3_radians, target[0] * d3_radians, target[1] * d3_radians);\r\n  };\r\n  function d3_geo_interpolate(x0, y0, x1, y1) {\r\n    var cy0 = Math.cos(y0), sy0 = Math.sin(y0), cy1 = Math.cos(y1), sy1 = Math.sin(y1), kx0 = cy0 * Math.cos(x0), ky0 = cy0 * Math.sin(x0), kx1 = cy1 * Math.cos(x1), ky1 = cy1 * Math.sin(x1), d = 2 * Math.asin(Math.sqrt(d3_haversin(y1 - y0) + cy0 * cy1 * d3_haversin(x1 - x0))), k = 1 / Math.sin(d);\r\n    var interpolate = d ? function(t) {\r\n      var B = Math.sin(t *= d) * k, A = Math.sin(d - t) * k, x = A * kx0 + B * kx1, y = A * ky0 + B * ky1, z = A * sy0 + B * sy1;\r\n      return [ Math.atan2(y, x) * d3_degrees, Math.atan2(z, Math.sqrt(x * x + y * y)) * d3_degrees ];\r\n    } : function() {\r\n      return [ x0 * d3_degrees, y0 * d3_degrees ];\r\n    };\r\n    interpolate.distance = d;\r\n    return interpolate;\r\n  }\r\n  d3.geo.length = function(object) {\r\n    d3_geo_lengthSum = 0;\r\n    d3.geo.stream(object, d3_geo_length);\r\n    return d3_geo_lengthSum;\r\n  };\r\n  var d3_geo_lengthSum;\r\n  var d3_geo_length = {\r\n    sphere: d3_noop,\r\n    point: d3_noop,\r\n    lineStart: d3_geo_lengthLineStart,\r\n    lineEnd: d3_noop,\r\n    polygonStart: d3_noop,\r\n    polygonEnd: d3_noop\r\n  };\r\n  function d3_geo_lengthLineStart() {\r\n    var λ0, sinφ0, cosφ0;\r\n    d3_geo_length.point = function(λ, φ) {\r\n      λ0 = λ * d3_radians, sinφ0 = Math.sin(φ *= d3_radians), cosφ0 = Math.cos(φ);\r\n      d3_geo_length.point = nextPoint;\r\n    };\r\n    d3_geo_length.lineEnd = function() {\r\n      d3_geo_length.point = d3_geo_length.lineEnd = d3_noop;\r\n    };\r\n    function nextPoint(λ, φ) {\r\n      var sinφ = Math.sin(φ *= d3_radians), cosφ = Math.cos(φ), t = abs((λ *= d3_radians) - λ0), cosΔλ = Math.cos(t);\r\n      d3_geo_lengthSum += Math.atan2(Math.sqrt((t = cosφ * Math.sin(t)) * t + (t = cosφ0 * sinφ - sinφ0 * cosφ * cosΔλ) * t), sinφ0 * sinφ + cosφ0 * cosφ * cosΔλ);\r\n      λ0 = λ, sinφ0 = sinφ, cosφ0 = cosφ;\r\n    }\r\n  }\r\n  function d3_geo_azimuthal(scale, angle) {\r\n    function azimuthal(λ, φ) {\r\n      var cosλ = Math.cos(λ), cosφ = Math.cos(φ), k = scale(cosλ * cosφ);\r\n      return [ k * cosφ * Math.sin(λ), k * Math.sin(φ) ];\r\n    }\r\n    azimuthal.invert = function(x, y) {\r\n      var ρ = Math.sqrt(x * x + y * y), c = angle(ρ), sinc = Math.sin(c), cosc = Math.cos(c);\r\n      return [ Math.atan2(x * sinc, ρ * cosc), Math.asin(ρ && y * sinc / ρ) ];\r\n    };\r\n    return azimuthal;\r\n  }\r\n  var d3_geo_azimuthalEqualArea = d3_geo_azimuthal(function(cosλcosφ) {\r\n    return Math.sqrt(2 / (1 + cosλcosφ));\r\n  }, function(ρ) {\r\n    return 2 * Math.asin(ρ / 2);\r\n  });\r\n  (d3.geo.azimuthalEqualArea = function() {\r\n    return d3_geo_projection(d3_geo_azimuthalEqualArea);\r\n  }).raw = d3_geo_azimuthalEqualArea;\r\n  var d3_geo_azimuthalEquidistant = d3_geo_azimuthal(function(cosλcosφ) {\r\n    var c = Math.acos(cosλcosφ);\r\n    return c && c / Math.sin(c);\r\n  }, d3_identity);\r\n  (d3.geo.azimuthalEquidistant = function() {\r\n    return d3_geo_projection(d3_geo_azimuthalEquidistant);\r\n  }).raw = d3_geo_azimuthalEquidistant;\r\n  function d3_geo_conicConformal(φ0, φ1) {\r\n    var cosφ0 = Math.cos(φ0), t = function(φ) {\r\n      return Math.tan(π / 4 + φ / 2);\r\n    }, n = φ0 === φ1 ? Math.sin(φ0) : Math.log(cosφ0 / Math.cos(φ1)) / Math.log(t(φ1) / t(φ0)), F = cosφ0 * Math.pow(t(φ0), n) / n;\r\n    if (!n) return d3_geo_mercator;\r\n    function forward(λ, φ) {\r\n      if (F > 0) {\r\n        if (φ < -halfπ + ε) φ = -halfπ + ε;\r\n      } else {\r\n        if (φ > halfπ - ε) φ = halfπ - ε;\r\n      }\r\n      var ρ = F / Math.pow(t(φ), n);\r\n      return [ ρ * Math.sin(n * λ), F - ρ * Math.cos(n * λ) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var ρ0_y = F - y, ρ = d3_sgn(n) * Math.sqrt(x * x + ρ0_y * ρ0_y);\r\n      return [ Math.atan2(x, ρ0_y) / n, 2 * Math.atan(Math.pow(F / ρ, 1 / n)) - halfπ ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.conicConformal = function() {\r\n    return d3_geo_conic(d3_geo_conicConformal);\r\n  }).raw = d3_geo_conicConformal;\r\n  function d3_geo_conicEquidistant(φ0, φ1) {\r\n    var cosφ0 = Math.cos(φ0), n = φ0 === φ1 ? Math.sin(φ0) : (cosφ0 - Math.cos(φ1)) / (φ1 - φ0), G = cosφ0 / n + φ0;\r\n    if (abs(n) < ε) return d3_geo_equirectangular;\r\n    function forward(λ, φ) {\r\n      var ρ = G - φ;\r\n      return [ ρ * Math.sin(n * λ), G - ρ * Math.cos(n * λ) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var ρ0_y = G - y;\r\n      return [ Math.atan2(x, ρ0_y) / n, G - d3_sgn(n) * Math.sqrt(x * x + ρ0_y * ρ0_y) ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.conicEquidistant = function() {\r\n    return d3_geo_conic(d3_geo_conicEquidistant);\r\n  }).raw = d3_geo_conicEquidistant;\r\n  var d3_geo_gnomonic = d3_geo_azimuthal(function(cosλcosφ) {\r\n    return 1 / cosλcosφ;\r\n  }, Math.atan);\r\n  (d3.geo.gnomonic = function() {\r\n    return d3_geo_projection(d3_geo_gnomonic);\r\n  }).raw = d3_geo_gnomonic;\r\n  function d3_geo_mercator(λ, φ) {\r\n    return [ λ, Math.log(Math.tan(π / 4 + φ / 2)) ];\r\n  }\r\n  d3_geo_mercator.invert = function(x, y) {\r\n    return [ x, 2 * Math.atan(Math.exp(y)) - halfπ ];\r\n  };\r\n  function d3_geo_mercatorProjection(project) {\r\n    var m = d3_geo_projection(project), scale = m.scale, translate = m.translate, clipExtent = m.clipExtent, clipAuto;\r\n    m.scale = function() {\r\n      var v = scale.apply(m, arguments);\r\n      return v === m ? clipAuto ? m.clipExtent(null) : m : v;\r\n    };\r\n    m.translate = function() {\r\n      var v = translate.apply(m, arguments);\r\n      return v === m ? clipAuto ? m.clipExtent(null) : m : v;\r\n    };\r\n    m.clipExtent = function(_) {\r\n      var v = clipExtent.apply(m, arguments);\r\n      if (v === m) {\r\n        if (clipAuto = _ == null) {\r\n          var k = π * scale(), t = translate();\r\n          clipExtent([ [ t[0] - k, t[1] - k ], [ t[0] + k, t[1] + k ] ]);\r\n        }\r\n      } else if (clipAuto) {\r\n        v = null;\r\n      }\r\n      return v;\r\n    };\r\n    return m.clipExtent(null);\r\n  }\r\n  (d3.geo.mercator = function() {\r\n    return d3_geo_mercatorProjection(d3_geo_mercator);\r\n  }).raw = d3_geo_mercator;\r\n  var d3_geo_orthographic = d3_geo_azimuthal(function() {\r\n    return 1;\r\n  }, Math.asin);\r\n  (d3.geo.orthographic = function() {\r\n    return d3_geo_projection(d3_geo_orthographic);\r\n  }).raw = d3_geo_orthographic;\r\n  var d3_geo_stereographic = d3_geo_azimuthal(function(cosλcosφ) {\r\n    return 1 / (1 + cosλcosφ);\r\n  }, function(ρ) {\r\n    return 2 * Math.atan(ρ);\r\n  });\r\n  (d3.geo.stereographic = function() {\r\n    return d3_geo_projection(d3_geo_stereographic);\r\n  }).raw = d3_geo_stereographic;\r\n  function d3_geo_transverseMercator(λ, φ) {\r\n    return [ Math.log(Math.tan(π / 4 + φ / 2)), -λ ];\r\n  }\r\n  d3_geo_transverseMercator.invert = function(x, y) {\r\n    return [ -y, 2 * Math.atan(Math.exp(x)) - halfπ ];\r\n  };\r\n  (d3.geo.transverseMercator = function() {\r\n    var projection = d3_geo_mercatorProjection(d3_geo_transverseMercator), center = projection.center, rotate = projection.rotate;\r\n    projection.center = function(_) {\r\n      return _ ? center([ -_[1], _[0] ]) : (_ = center(), [ _[1], -_[0] ]);\r\n    };\r\n    projection.rotate = function(_) {\r\n      return _ ? rotate([ _[0], _[1], _.length > 2 ? _[2] + 90 : 90 ]) : (_ = rotate(), \r\n      [ _[0], _[1], _[2] - 90 ]);\r\n    };\r\n    return rotate([ 0, 0, 90 ]);\r\n  }).raw = d3_geo_transverseMercator;\r\n  d3.geom = {};\r\n  function d3_geom_pointX(d) {\r\n    return d[0];\r\n  }\r\n  function d3_geom_pointY(d) {\r\n    return d[1];\r\n  }\r\n  d3.geom.hull = function(vertices) {\r\n    var x = d3_geom_pointX, y = d3_geom_pointY;\r\n    if (arguments.length) return hull(vertices);\r\n    function hull(data) {\r\n      if (data.length < 3) return [];\r\n      var fx = d3_functor(x), fy = d3_functor(y), i, n = data.length, points = [], flippedPoints = [];\r\n      for (i = 0; i < n; i++) {\r\n        points.push([ +fx.call(this, data[i], i), +fy.call(this, data[i], i), i ]);\r\n      }\r\n      points.sort(d3_geom_hullOrder);\r\n      for (i = 0; i < n; i++) flippedPoints.push([ points[i][0], -points[i][1] ]);\r\n      var upper = d3_geom_hullUpper(points), lower = d3_geom_hullUpper(flippedPoints);\r\n      var skipLeft = lower[0] === upper[0], skipRight = lower[lower.length - 1] === upper[upper.length - 1], polygon = [];\r\n      for (i = upper.length - 1; i >= 0; --i) polygon.push(data[points[upper[i]][2]]);\r\n      for (i = +skipLeft; i < lower.length - skipRight; ++i) polygon.push(data[points[lower[i]][2]]);\r\n      return polygon;\r\n    }\r\n    hull.x = function(_) {\r\n      return arguments.length ? (x = _, hull) : x;\r\n    };\r\n    hull.y = function(_) {\r\n      return arguments.length ? (y = _, hull) : y;\r\n    };\r\n    return hull;\r\n  };\r\n  function d3_geom_hullUpper(points) {\r\n    var n = points.length, hull = [ 0, 1 ], hs = 2;\r\n    for (var i = 2; i < n; i++) {\r\n      while (hs > 1 && d3_cross2d(points[hull[hs - 2]], points[hull[hs - 1]], points[i]) <= 0) --hs;\r\n      hull[hs++] = i;\r\n    }\r\n    return hull.slice(0, hs);\r\n  }\r\n  function d3_geom_hullOrder(a, b) {\r\n    return a[0] - b[0] || a[1] - b[1];\r\n  }\r\n  d3.geom.polygon = function(coordinates) {\r\n    d3_subclass(coordinates, d3_geom_polygonPrototype);\r\n    return coordinates;\r\n  };\r\n  var d3_geom_polygonPrototype = d3.geom.polygon.prototype = [];\r\n  d3_geom_polygonPrototype.area = function() {\r\n    var i = -1, n = this.length, a, b = this[n - 1], area = 0;\r\n    while (++i < n) {\r\n      a = b;\r\n      b = this[i];\r\n      area += a[1] * b[0] - a[0] * b[1];\r\n    }\r\n    return area * .5;\r\n  };\r\n  d3_geom_polygonPrototype.centroid = function(k) {\r\n    var i = -1, n = this.length, x = 0, y = 0, a, b = this[n - 1], c;\r\n    if (!arguments.length) k = -1 / (6 * this.area());\r\n    while (++i < n) {\r\n      a = b;\r\n      b = this[i];\r\n      c = a[0] * b[1] - b[0] * a[1];\r\n      x += (a[0] + b[0]) * c;\r\n      y += (a[1] + b[1]) * c;\r\n    }\r\n    return [ x * k, y * k ];\r\n  };\r\n  d3_geom_polygonPrototype.clip = function(subject) {\r\n    var input, closed = d3_geom_polygonClosed(subject), i = -1, n = this.length - d3_geom_polygonClosed(this), j, m, a = this[n - 1], b, c, d;\r\n    while (++i < n) {\r\n      input = subject.slice();\r\n      subject.length = 0;\r\n      b = this[i];\r\n      c = input[(m = input.length - closed) - 1];\r\n      j = -1;\r\n      while (++j < m) {\r\n        d = input[j];\r\n        if (d3_geom_polygonInside(d, a, b)) {\r\n          if (!d3_geom_polygonInside(c, a, b)) {\r\n            subject.push(d3_geom_polygonIntersect(c, d, a, b));\r\n          }\r\n          subject.push(d);\r\n        } else if (d3_geom_polygonInside(c, a, b)) {\r\n          subject.push(d3_geom_polygonIntersect(c, d, a, b));\r\n        }\r\n        c = d;\r\n      }\r\n      if (closed) subject.push(subject[0]);\r\n      a = b;\r\n    }\r\n    return subject;\r\n  };\r\n  function d3_geom_polygonInside(p, a, b) {\r\n    return (b[0] - a[0]) * (p[1] - a[1]) < (b[1] - a[1]) * (p[0] - a[0]);\r\n  }\r\n  function d3_geom_polygonIntersect(c, d, a, b) {\r\n    var x1 = c[0], x3 = a[0], x21 = d[0] - x1, x43 = b[0] - x3, y1 = c[1], y3 = a[1], y21 = d[1] - y1, y43 = b[1] - y3, ua = (x43 * (y1 - y3) - y43 * (x1 - x3)) / (y43 * x21 - x43 * y21);\r\n    return [ x1 + ua * x21, y1 + ua * y21 ];\r\n  }\r\n  function d3_geom_polygonClosed(coordinates) {\r\n    var a = coordinates[0], b = coordinates[coordinates.length - 1];\r\n    return !(a[0] - b[0] || a[1] - b[1]);\r\n  }\r\n  var d3_geom_voronoiEdges, d3_geom_voronoiCells, d3_geom_voronoiBeaches, d3_geom_voronoiBeachPool = [], d3_geom_voronoiFirstCircle, d3_geom_voronoiCircles, d3_geom_voronoiCirclePool = [];\r\n  function d3_geom_voronoiBeach() {\r\n    d3_geom_voronoiRedBlackNode(this);\r\n    this.edge = this.site = this.circle = null;\r\n  }\r\n  function d3_geom_voronoiCreateBeach(site) {\r\n    var beach = d3_geom_voronoiBeachPool.pop() || new d3_geom_voronoiBeach();\r\n    beach.site = site;\r\n    return beach;\r\n  }\r\n  function d3_geom_voronoiDetachBeach(beach) {\r\n    d3_geom_voronoiDetachCircle(beach);\r\n    d3_geom_voronoiBeaches.remove(beach);\r\n    d3_geom_voronoiBeachPool.push(beach);\r\n    d3_geom_voronoiRedBlackNode(beach);\r\n  }\r\n  function d3_geom_voronoiRemoveBeach(beach) {\r\n    var circle = beach.circle, x = circle.x, y = circle.cy, vertex = {\r\n      x: x,\r\n      y: y\r\n    }, previous = beach.P, next = beach.N, disappearing = [ beach ];\r\n    d3_geom_voronoiDetachBeach(beach);\r\n    var lArc = previous;\r\n    while (lArc.circle && abs(x - lArc.circle.x) < ε && abs(y - lArc.circle.cy) < ε) {\r\n      previous = lArc.P;\r\n      disappearing.unshift(lArc);\r\n      d3_geom_voronoiDetachBeach(lArc);\r\n      lArc = previous;\r\n    }\r\n    disappearing.unshift(lArc);\r\n    d3_geom_voronoiDetachCircle(lArc);\r\n    var rArc = next;\r\n    while (rArc.circle && abs(x - rArc.circle.x) < ε && abs(y - rArc.circle.cy) < ε) {\r\n      next = rArc.N;\r\n      disappearing.push(rArc);\r\n      d3_geom_voronoiDetachBeach(rArc);\r\n      rArc = next;\r\n    }\r\n    disappearing.push(rArc);\r\n    d3_geom_voronoiDetachCircle(rArc);\r\n    var nArcs = disappearing.length, iArc;\r\n    for (iArc = 1; iArc < nArcs; ++iArc) {\r\n      rArc = disappearing[iArc];\r\n      lArc = disappearing[iArc - 1];\r\n      d3_geom_voronoiSetEdgeEnd(rArc.edge, lArc.site, rArc.site, vertex);\r\n    }\r\n    lArc = disappearing[0];\r\n    rArc = disappearing[nArcs - 1];\r\n    rArc.edge = d3_geom_voronoiCreateEdge(lArc.site, rArc.site, null, vertex);\r\n    d3_geom_voronoiAttachCircle(lArc);\r\n    d3_geom_voronoiAttachCircle(rArc);\r\n  }\r\n  function d3_geom_voronoiAddBeach(site) {\r\n    var x = site.x, directrix = site.y, lArc, rArc, dxl, dxr, node = d3_geom_voronoiBeaches._;\r\n    while (node) {\r\n      dxl = d3_geom_voronoiLeftBreakPoint(node, directrix) - x;\r\n      if (dxl > ε) node = node.L; else {\r\n        dxr = x - d3_geom_voronoiRightBreakPoint(node, directrix);\r\n        if (dxr > ε) {\r\n          if (!node.R) {\r\n            lArc = node;\r\n            break;\r\n          }\r\n          node = node.R;\r\n        } else {\r\n          if (dxl > -ε) {\r\n            lArc = node.P;\r\n            rArc = node;\r\n          } else if (dxr > -ε) {\r\n            lArc = node;\r\n            rArc = node.N;\r\n          } else {\r\n            lArc = rArc = node;\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    var newArc = d3_geom_voronoiCreateBeach(site);\r\n    d3_geom_voronoiBeaches.insert(lArc, newArc);\r\n    if (!lArc && !rArc) return;\r\n    if (lArc === rArc) {\r\n      d3_geom_voronoiDetachCircle(lArc);\r\n      rArc = d3_geom_voronoiCreateBeach(lArc.site);\r\n      d3_geom_voronoiBeaches.insert(newArc, rArc);\r\n      newArc.edge = rArc.edge = d3_geom_voronoiCreateEdge(lArc.site, newArc.site);\r\n      d3_geom_voronoiAttachCircle(lArc);\r\n      d3_geom_voronoiAttachCircle(rArc);\r\n      return;\r\n    }\r\n    if (!rArc) {\r\n      newArc.edge = d3_geom_voronoiCreateEdge(lArc.site, newArc.site);\r\n      return;\r\n    }\r\n    d3_geom_voronoiDetachCircle(lArc);\r\n    d3_geom_voronoiDetachCircle(rArc);\r\n    var lSite = lArc.site, ax = lSite.x, ay = lSite.y, bx = site.x - ax, by = site.y - ay, rSite = rArc.site, cx = rSite.x - ax, cy = rSite.y - ay, d = 2 * (bx * cy - by * cx), hb = bx * bx + by * by, hc = cx * cx + cy * cy, vertex = {\r\n      x: (cy * hb - by * hc) / d + ax,\r\n      y: (bx * hc - cx * hb) / d + ay\r\n    };\r\n    d3_geom_voronoiSetEdgeEnd(rArc.edge, lSite, rSite, vertex);\r\n    newArc.edge = d3_geom_voronoiCreateEdge(lSite, site, null, vertex);\r\n    rArc.edge = d3_geom_voronoiCreateEdge(site, rSite, null, vertex);\r\n    d3_geom_voronoiAttachCircle(lArc);\r\n    d3_geom_voronoiAttachCircle(rArc);\r\n  }\r\n  function d3_geom_voronoiLeftBreakPoint(arc, directrix) {\r\n    var site = arc.site, rfocx = site.x, rfocy = site.y, pby2 = rfocy - directrix;\r\n    if (!pby2) return rfocx;\r\n    var lArc = arc.P;\r\n    if (!lArc) return -Infinity;\r\n    site = lArc.site;\r\n    var lfocx = site.x, lfocy = site.y, plby2 = lfocy - directrix;\r\n    if (!plby2) return lfocx;\r\n    var hl = lfocx - rfocx, aby2 = 1 / pby2 - 1 / plby2, b = hl / plby2;\r\n    if (aby2) return (-b + Math.sqrt(b * b - 2 * aby2 * (hl * hl / (-2 * plby2) - lfocy + plby2 / 2 + rfocy - pby2 / 2))) / aby2 + rfocx;\r\n    return (rfocx + lfocx) / 2;\r\n  }\r\n  function d3_geom_voronoiRightBreakPoint(arc, directrix) {\r\n    var rArc = arc.N;\r\n    if (rArc) return d3_geom_voronoiLeftBreakPoint(rArc, directrix);\r\n    var site = arc.site;\r\n    return site.y === directrix ? site.x : Infinity;\r\n  }\r\n  function d3_geom_voronoiCell(site) {\r\n    this.site = site;\r\n    this.edges = [];\r\n  }\r\n  d3_geom_voronoiCell.prototype.prepare = function() {\r\n    var halfEdges = this.edges, iHalfEdge = halfEdges.length, edge;\r\n    while (iHalfEdge--) {\r\n      edge = halfEdges[iHalfEdge].edge;\r\n      if (!edge.b || !edge.a) halfEdges.splice(iHalfEdge, 1);\r\n    }\r\n    halfEdges.sort(d3_geom_voronoiHalfEdgeOrder);\r\n    return halfEdges.length;\r\n  };\r\n  function d3_geom_voronoiCloseCells(extent) {\r\n    var x0 = extent[0][0], x1 = extent[1][0], y0 = extent[0][1], y1 = extent[1][1], x2, y2, x3, y3, cells = d3_geom_voronoiCells, iCell = cells.length, cell, iHalfEdge, halfEdges, nHalfEdges, start, end;\r\n    while (iCell--) {\r\n      cell = cells[iCell];\r\n      if (!cell || !cell.prepare()) continue;\r\n      halfEdges = cell.edges;\r\n      nHalfEdges = halfEdges.length;\r\n      iHalfEdge = 0;\r\n      while (iHalfEdge < nHalfEdges) {\r\n        end = halfEdges[iHalfEdge].end(), x3 = end.x, y3 = end.y;\r\n        start = halfEdges[++iHalfEdge % nHalfEdges].start(), x2 = start.x, y2 = start.y;\r\n        if (abs(x3 - x2) > ε || abs(y3 - y2) > ε) {\r\n          halfEdges.splice(iHalfEdge, 0, new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site, end, abs(x3 - x0) < ε && y1 - y3 > ε ? {\r\n            x: x0,\r\n            y: abs(x2 - x0) < ε ? y2 : y1\r\n          } : abs(y3 - y1) < ε && x1 - x3 > ε ? {\r\n            x: abs(y2 - y1) < ε ? x2 : x1,\r\n            y: y1\r\n          } : abs(x3 - x1) < ε && y3 - y0 > ε ? {\r\n            x: x1,\r\n            y: abs(x2 - x1) < ε ? y2 : y0\r\n          } : abs(y3 - y0) < ε && x3 - x0 > ε ? {\r\n            x: abs(y2 - y0) < ε ? x2 : x0,\r\n            y: y0\r\n          } : null), cell.site, null));\r\n          ++nHalfEdges;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  function d3_geom_voronoiHalfEdgeOrder(a, b) {\r\n    return b.angle - a.angle;\r\n  }\r\n  function d3_geom_voronoiCircle() {\r\n    d3_geom_voronoiRedBlackNode(this);\r\n    this.x = this.y = this.arc = this.site = this.cy = null;\r\n  }\r\n  function d3_geom_voronoiAttachCircle(arc) {\r\n    var lArc = arc.P, rArc = arc.N;\r\n    if (!lArc || !rArc) return;\r\n    var lSite = lArc.site, cSite = arc.site, rSite = rArc.site;\r\n    if (lSite === rSite) return;\r\n    var bx = cSite.x, by = cSite.y, ax = lSite.x - bx, ay = lSite.y - by, cx = rSite.x - bx, cy = rSite.y - by;\r\n    var d = 2 * (ax * cy - ay * cx);\r\n    if (d >= -ε2) return;\r\n    var ha = ax * ax + ay * ay, hc = cx * cx + cy * cy, x = (cy * ha - ay * hc) / d, y = (ax * hc - cx * ha) / d, cy = y + by;\r\n    var circle = d3_geom_voronoiCirclePool.pop() || new d3_geom_voronoiCircle();\r\n    circle.arc = arc;\r\n    circle.site = cSite;\r\n    circle.x = x + bx;\r\n    circle.y = cy + Math.sqrt(x * x + y * y);\r\n    circle.cy = cy;\r\n    arc.circle = circle;\r\n    var before = null, node = d3_geom_voronoiCircles._;\r\n    while (node) {\r\n      if (circle.y < node.y || circle.y === node.y && circle.x <= node.x) {\r\n        if (node.L) node = node.L; else {\r\n          before = node.P;\r\n          break;\r\n        }\r\n      } else {\r\n        if (node.R) node = node.R; else {\r\n          before = node;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    d3_geom_voronoiCircles.insert(before, circle);\r\n    if (!before) d3_geom_voronoiFirstCircle = circle;\r\n  }\r\n  function d3_geom_voronoiDetachCircle(arc) {\r\n    var circle = arc.circle;\r\n    if (circle) {\r\n      if (!circle.P) d3_geom_voronoiFirstCircle = circle.N;\r\n      d3_geom_voronoiCircles.remove(circle);\r\n      d3_geom_voronoiCirclePool.push(circle);\r\n      d3_geom_voronoiRedBlackNode(circle);\r\n      arc.circle = null;\r\n    }\r\n  }\r\n  function d3_geom_voronoiClipEdges(extent) {\r\n    var edges = d3_geom_voronoiEdges, clip = d3_geom_clipLine(extent[0][0], extent[0][1], extent[1][0], extent[1][1]), i = edges.length, e;\r\n    while (i--) {\r\n      e = edges[i];\r\n      if (!d3_geom_voronoiConnectEdge(e, extent) || !clip(e) || abs(e.a.x - e.b.x) < ε && abs(e.a.y - e.b.y) < ε) {\r\n        e.a = e.b = null;\r\n        edges.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n  function d3_geom_voronoiConnectEdge(edge, extent) {\r\n    var vb = edge.b;\r\n    if (vb) return true;\r\n    var va = edge.a, x0 = extent[0][0], x1 = extent[1][0], y0 = extent[0][1], y1 = extent[1][1], lSite = edge.l, rSite = edge.r, lx = lSite.x, ly = lSite.y, rx = rSite.x, ry = rSite.y, fx = (lx + rx) / 2, fy = (ly + ry) / 2, fm, fb;\r\n    if (ry === ly) {\r\n      if (fx < x0 || fx >= x1) return;\r\n      if (lx > rx) {\r\n        if (!va) va = {\r\n          x: fx,\r\n          y: y0\r\n        }; else if (va.y >= y1) return;\r\n        vb = {\r\n          x: fx,\r\n          y: y1\r\n        };\r\n      } else {\r\n        if (!va) va = {\r\n          x: fx,\r\n          y: y1\r\n        }; else if (va.y < y0) return;\r\n        vb = {\r\n          x: fx,\r\n          y: y0\r\n        };\r\n      }\r\n    } else {\r\n      fm = (lx - rx) / (ry - ly);\r\n      fb = fy - fm * fx;\r\n      if (fm < -1 || fm > 1) {\r\n        if (lx > rx) {\r\n          if (!va) va = {\r\n            x: (y0 - fb) / fm,\r\n            y: y0\r\n          }; else if (va.y >= y1) return;\r\n          vb = {\r\n            x: (y1 - fb) / fm,\r\n            y: y1\r\n          };\r\n        } else {\r\n          if (!va) va = {\r\n            x: (y1 - fb) / fm,\r\n            y: y1\r\n          }; else if (va.y < y0) return;\r\n          vb = {\r\n            x: (y0 - fb) / fm,\r\n            y: y0\r\n          };\r\n        }\r\n      } else {\r\n        if (ly < ry) {\r\n          if (!va) va = {\r\n            x: x0,\r\n            y: fm * x0 + fb\r\n          }; else if (va.x >= x1) return;\r\n          vb = {\r\n            x: x1,\r\n            y: fm * x1 + fb\r\n          };\r\n        } else {\r\n          if (!va) va = {\r\n            x: x1,\r\n            y: fm * x1 + fb\r\n          }; else if (va.x < x0) return;\r\n          vb = {\r\n            x: x0,\r\n            y: fm * x0 + fb\r\n          };\r\n        }\r\n      }\r\n    }\r\n    edge.a = va;\r\n    edge.b = vb;\r\n    return true;\r\n  }\r\n  function d3_geom_voronoiEdge(lSite, rSite) {\r\n    this.l = lSite;\r\n    this.r = rSite;\r\n    this.a = this.b = null;\r\n  }\r\n  function d3_geom_voronoiCreateEdge(lSite, rSite, va, vb) {\r\n    var edge = new d3_geom_voronoiEdge(lSite, rSite);\r\n    d3_geom_voronoiEdges.push(edge);\r\n    if (va) d3_geom_voronoiSetEdgeEnd(edge, lSite, rSite, va);\r\n    if (vb) d3_geom_voronoiSetEdgeEnd(edge, rSite, lSite, vb);\r\n    d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge, lSite, rSite));\r\n    d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge, rSite, lSite));\r\n    return edge;\r\n  }\r\n  function d3_geom_voronoiCreateBorderEdge(lSite, va, vb) {\r\n    var edge = new d3_geom_voronoiEdge(lSite, null);\r\n    edge.a = va;\r\n    edge.b = vb;\r\n    d3_geom_voronoiEdges.push(edge);\r\n    return edge;\r\n  }\r\n  function d3_geom_voronoiSetEdgeEnd(edge, lSite, rSite, vertex) {\r\n    if (!edge.a && !edge.b) {\r\n      edge.a = vertex;\r\n      edge.l = lSite;\r\n      edge.r = rSite;\r\n    } else if (edge.l === rSite) {\r\n      edge.b = vertex;\r\n    } else {\r\n      edge.a = vertex;\r\n    }\r\n  }\r\n  function d3_geom_voronoiHalfEdge(edge, lSite, rSite) {\r\n    var va = edge.a, vb = edge.b;\r\n    this.edge = edge;\r\n    this.site = lSite;\r\n    this.angle = rSite ? Math.atan2(rSite.y - lSite.y, rSite.x - lSite.x) : edge.l === lSite ? Math.atan2(vb.x - va.x, va.y - vb.y) : Math.atan2(va.x - vb.x, vb.y - va.y);\r\n  }\r\n  d3_geom_voronoiHalfEdge.prototype = {\r\n    start: function() {\r\n      return this.edge.l === this.site ? this.edge.a : this.edge.b;\r\n    },\r\n    end: function() {\r\n      return this.edge.l === this.site ? this.edge.b : this.edge.a;\r\n    }\r\n  };\r\n  function d3_geom_voronoiRedBlackTree() {\r\n    this._ = null;\r\n  }\r\n  function d3_geom_voronoiRedBlackNode(node) {\r\n    node.U = node.C = node.L = node.R = node.P = node.N = null;\r\n  }\r\n  d3_geom_voronoiRedBlackTree.prototype = {\r\n    insert: function(after, node) {\r\n      var parent, grandpa, uncle;\r\n      if (after) {\r\n        node.P = after;\r\n        node.N = after.N;\r\n        if (after.N) after.N.P = node;\r\n        after.N = node;\r\n        if (after.R) {\r\n          after = after.R;\r\n          while (after.L) after = after.L;\r\n          after.L = node;\r\n        } else {\r\n          after.R = node;\r\n        }\r\n        parent = after;\r\n      } else if (this._) {\r\n        after = d3_geom_voronoiRedBlackFirst(this._);\r\n        node.P = null;\r\n        node.N = after;\r\n        after.P = after.L = node;\r\n        parent = after;\r\n      } else {\r\n        node.P = node.N = null;\r\n        this._ = node;\r\n        parent = null;\r\n      }\r\n      node.L = node.R = null;\r\n      node.U = parent;\r\n      node.C = true;\r\n      after = node;\r\n      while (parent && parent.C) {\r\n        grandpa = parent.U;\r\n        if (parent === grandpa.L) {\r\n          uncle = grandpa.R;\r\n          if (uncle && uncle.C) {\r\n            parent.C = uncle.C = false;\r\n            grandpa.C = true;\r\n            after = grandpa;\r\n          } else {\r\n            if (after === parent.R) {\r\n              d3_geom_voronoiRedBlackRotateLeft(this, parent);\r\n              after = parent;\r\n              parent = after.U;\r\n            }\r\n            parent.C = false;\r\n            grandpa.C = true;\r\n            d3_geom_voronoiRedBlackRotateRight(this, grandpa);\r\n          }\r\n        } else {\r\n          uncle = grandpa.L;\r\n          if (uncle && uncle.C) {\r\n            parent.C = uncle.C = false;\r\n            grandpa.C = true;\r\n            after = grandpa;\r\n          } else {\r\n            if (after === parent.L) {\r\n              d3_geom_voronoiRedBlackRotateRight(this, parent);\r\n              after = parent;\r\n              parent = after.U;\r\n            }\r\n            parent.C = false;\r\n            grandpa.C = true;\r\n            d3_geom_voronoiRedBlackRotateLeft(this, grandpa);\r\n          }\r\n        }\r\n        parent = after.U;\r\n      }\r\n      this._.C = false;\r\n    },\r\n    remove: function(node) {\r\n      if (node.N) node.N.P = node.P;\r\n      if (node.P) node.P.N = node.N;\r\n      node.N = node.P = null;\r\n      var parent = node.U, sibling, left = node.L, right = node.R, next, red;\r\n      if (!left) next = right; else if (!right) next = left; else next = d3_geom_voronoiRedBlackFirst(right);\r\n      if (parent) {\r\n        if (parent.L === node) parent.L = next; else parent.R = next;\r\n      } else {\r\n        this._ = next;\r\n      }\r\n      if (left && right) {\r\n        red = next.C;\r\n        next.C = node.C;\r\n        next.L = left;\r\n        left.U = next;\r\n        if (next !== right) {\r\n          parent = next.U;\r\n          next.U = node.U;\r\n          node = next.R;\r\n          parent.L = node;\r\n          next.R = right;\r\n          right.U = next;\r\n        } else {\r\n          next.U = parent;\r\n          parent = next;\r\n          node = next.R;\r\n        }\r\n      } else {\r\n        red = node.C;\r\n        node = next;\r\n      }\r\n      if (node) node.U = parent;\r\n      if (red) return;\r\n      if (node && node.C) {\r\n        node.C = false;\r\n        return;\r\n      }\r\n      do {\r\n        if (node === this._) break;\r\n        if (node === parent.L) {\r\n          sibling = parent.R;\r\n          if (sibling.C) {\r\n            sibling.C = false;\r\n            parent.C = true;\r\n            d3_geom_voronoiRedBlackRotateLeft(this, parent);\r\n            sibling = parent.R;\r\n          }\r\n          if (sibling.L && sibling.L.C || sibling.R && sibling.R.C) {\r\n            if (!sibling.R || !sibling.R.C) {\r\n              sibling.L.C = false;\r\n              sibling.C = true;\r\n              d3_geom_voronoiRedBlackRotateRight(this, sibling);\r\n              sibling = parent.R;\r\n            }\r\n            sibling.C = parent.C;\r\n            parent.C = sibling.R.C = false;\r\n            d3_geom_voronoiRedBlackRotateLeft(this, parent);\r\n            node = this._;\r\n            break;\r\n          }\r\n        } else {\r\n          sibling = parent.L;\r\n          if (sibling.C) {\r\n            sibling.C = false;\r\n            parent.C = true;\r\n            d3_geom_voronoiRedBlackRotateRight(this, parent);\r\n            sibling = parent.L;\r\n          }\r\n          if (sibling.L && sibling.L.C || sibling.R && sibling.R.C) {\r\n            if (!sibling.L || !sibling.L.C) {\r\n              sibling.R.C = false;\r\n              sibling.C = true;\r\n              d3_geom_voronoiRedBlackRotateLeft(this, sibling);\r\n              sibling = parent.L;\r\n            }\r\n            sibling.C = parent.C;\r\n            parent.C = sibling.L.C = false;\r\n            d3_geom_voronoiRedBlackRotateRight(this, parent);\r\n            node = this._;\r\n            break;\r\n          }\r\n        }\r\n        sibling.C = true;\r\n        node = parent;\r\n        parent = parent.U;\r\n      } while (!node.C);\r\n      if (node) node.C = false;\r\n    }\r\n  };\r\n  function d3_geom_voronoiRedBlackRotateLeft(tree, node) {\r\n    var p = node, q = node.R, parent = p.U;\r\n    if (parent) {\r\n      if (parent.L === p) parent.L = q; else parent.R = q;\r\n    } else {\r\n      tree._ = q;\r\n    }\r\n    q.U = parent;\r\n    p.U = q;\r\n    p.R = q.L;\r\n    if (p.R) p.R.U = p;\r\n    q.L = p;\r\n  }\r\n  function d3_geom_voronoiRedBlackRotateRight(tree, node) {\r\n    var p = node, q = node.L, parent = p.U;\r\n    if (parent) {\r\n      if (parent.L === p) parent.L = q; else parent.R = q;\r\n    } else {\r\n      tree._ = q;\r\n    }\r\n    q.U = parent;\r\n    p.U = q;\r\n    p.L = q.R;\r\n    if (p.L) p.L.U = p;\r\n    q.R = p;\r\n  }\r\n  function d3_geom_voronoiRedBlackFirst(node) {\r\n    while (node.L) node = node.L;\r\n    return node;\r\n  }\r\n  function d3_geom_voronoi(sites, bbox) {\r\n    var site = sites.sort(d3_geom_voronoiVertexOrder).pop(), x0, y0, circle;\r\n    d3_geom_voronoiEdges = [];\r\n    d3_geom_voronoiCells = new Array(sites.length);\r\n    d3_geom_voronoiBeaches = new d3_geom_voronoiRedBlackTree();\r\n    d3_geom_voronoiCircles = new d3_geom_voronoiRedBlackTree();\r\n    while (true) {\r\n      circle = d3_geom_voronoiFirstCircle;\r\n      if (site && (!circle || site.y < circle.y || site.y === circle.y && site.x < circle.x)) {\r\n        if (site.x !== x0 || site.y !== y0) {\r\n          d3_geom_voronoiCells[site.i] = new d3_geom_voronoiCell(site);\r\n          d3_geom_voronoiAddBeach(site);\r\n          x0 = site.x, y0 = site.y;\r\n        }\r\n        site = sites.pop();\r\n      } else if (circle) {\r\n        d3_geom_voronoiRemoveBeach(circle.arc);\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n    if (bbox) d3_geom_voronoiClipEdges(bbox), d3_geom_voronoiCloseCells(bbox);\r\n    var diagram = {\r\n      cells: d3_geom_voronoiCells,\r\n      edges: d3_geom_voronoiEdges\r\n    };\r\n    d3_geom_voronoiBeaches = d3_geom_voronoiCircles = d3_geom_voronoiEdges = d3_geom_voronoiCells = null;\r\n    return diagram;\r\n  }\r\n  function d3_geom_voronoiVertexOrder(a, b) {\r\n    return b.y - a.y || b.x - a.x;\r\n  }\r\n  d3.geom.voronoi = function(points) {\r\n    var x = d3_geom_pointX, y = d3_geom_pointY, fx = x, fy = y, clipExtent = d3_geom_voronoiClipExtent;\r\n    if (points) return voronoi(points);\r\n    function voronoi(data) {\r\n      var polygons = new Array(data.length), x0 = clipExtent[0][0], y0 = clipExtent[0][1], x1 = clipExtent[1][0], y1 = clipExtent[1][1];\r\n      d3_geom_voronoi(sites(data), clipExtent).cells.forEach(function(cell, i) {\r\n        var edges = cell.edges, site = cell.site, polygon = polygons[i] = edges.length ? edges.map(function(e) {\r\n          var s = e.start();\r\n          return [ s.x, s.y ];\r\n        }) : site.x >= x0 && site.x <= x1 && site.y >= y0 && site.y <= y1 ? [ [ x0, y1 ], [ x1, y1 ], [ x1, y0 ], [ x0, y0 ] ] : [];\r\n        polygon.point = data[i];\r\n      });\r\n      return polygons;\r\n    }\r\n    function sites(data) {\r\n      return data.map(function(d, i) {\r\n        return {\r\n          x: Math.round(fx(d, i) / ε) * ε,\r\n          y: Math.round(fy(d, i) / ε) * ε,\r\n          i: i\r\n        };\r\n      });\r\n    }\r\n    voronoi.links = function(data) {\r\n      return d3_geom_voronoi(sites(data)).edges.filter(function(edge) {\r\n        return edge.l && edge.r;\r\n      }).map(function(edge) {\r\n        return {\r\n          source: data[edge.l.i],\r\n          target: data[edge.r.i]\r\n        };\r\n      });\r\n    };\r\n    voronoi.triangles = function(data) {\r\n      var triangles = [];\r\n      d3_geom_voronoi(sites(data)).cells.forEach(function(cell, i) {\r\n        var site = cell.site, edges = cell.edges.sort(d3_geom_voronoiHalfEdgeOrder), j = -1, m = edges.length, e0, s0, e1 = edges[m - 1].edge, s1 = e1.l === site ? e1.r : e1.l;\r\n        while (++j < m) {\r\n          e0 = e1;\r\n          s0 = s1;\r\n          e1 = edges[j].edge;\r\n          s1 = e1.l === site ? e1.r : e1.l;\r\n          if (i < s0.i && i < s1.i && d3_geom_voronoiTriangleArea(site, s0, s1) < 0) {\r\n            triangles.push([ data[i], data[s0.i], data[s1.i] ]);\r\n          }\r\n        }\r\n      });\r\n      return triangles;\r\n    };\r\n    voronoi.x = function(_) {\r\n      return arguments.length ? (fx = d3_functor(x = _), voronoi) : x;\r\n    };\r\n    voronoi.y = function(_) {\r\n      return arguments.length ? (fy = d3_functor(y = _), voronoi) : y;\r\n    };\r\n    voronoi.clipExtent = function(_) {\r\n      if (!arguments.length) return clipExtent === d3_geom_voronoiClipExtent ? null : clipExtent;\r\n      clipExtent = _ == null ? d3_geom_voronoiClipExtent : _;\r\n      return voronoi;\r\n    };\r\n    voronoi.size = function(_) {\r\n      if (!arguments.length) return clipExtent === d3_geom_voronoiClipExtent ? null : clipExtent && clipExtent[1];\r\n      return voronoi.clipExtent(_ && [ [ 0, 0 ], _ ]);\r\n    };\r\n    return voronoi;\r\n  };\r\n  var d3_geom_voronoiClipExtent = [ [ -1e6, -1e6 ], [ 1e6, 1e6 ] ];\r\n  function d3_geom_voronoiTriangleArea(a, b, c) {\r\n    return (a.x - c.x) * (b.y - a.y) - (a.x - b.x) * (c.y - a.y);\r\n  }\r\n  d3.geom.delaunay = function(vertices) {\r\n    return d3.geom.voronoi().triangles(vertices);\r\n  };\r\n  d3.geom.quadtree = function(points, x1, y1, x2, y2) {\r\n    var x = d3_geom_pointX, y = d3_geom_pointY, compat;\r\n    if (compat = arguments.length) {\r\n      x = d3_geom_quadtreeCompatX;\r\n      y = d3_geom_quadtreeCompatY;\r\n      if (compat === 3) {\r\n        y2 = y1;\r\n        x2 = x1;\r\n        y1 = x1 = 0;\r\n      }\r\n      return quadtree(points);\r\n    }\r\n    function quadtree(data) {\r\n      var d, fx = d3_functor(x), fy = d3_functor(y), xs, ys, i, n, x1_, y1_, x2_, y2_;\r\n      if (x1 != null) {\r\n        x1_ = x1, y1_ = y1, x2_ = x2, y2_ = y2;\r\n      } else {\r\n        x2_ = y2_ = -(x1_ = y1_ = Infinity);\r\n        xs = [], ys = [];\r\n        n = data.length;\r\n        if (compat) for (i = 0; i < n; ++i) {\r\n          d = data[i];\r\n          if (d.x < x1_) x1_ = d.x;\r\n          if (d.y < y1_) y1_ = d.y;\r\n          if (d.x > x2_) x2_ = d.x;\r\n          if (d.y > y2_) y2_ = d.y;\r\n          xs.push(d.x);\r\n          ys.push(d.y);\r\n        } else for (i = 0; i < n; ++i) {\r\n          var x_ = +fx(d = data[i], i), y_ = +fy(d, i);\r\n          if (x_ < x1_) x1_ = x_;\r\n          if (y_ < y1_) y1_ = y_;\r\n          if (x_ > x2_) x2_ = x_;\r\n          if (y_ > y2_) y2_ = y_;\r\n          xs.push(x_);\r\n          ys.push(y_);\r\n        }\r\n      }\r\n      var dx = x2_ - x1_, dy = y2_ - y1_;\r\n      if (dx > dy) y2_ = y1_ + dx; else x2_ = x1_ + dy;\r\n      function insert(n, d, x, y, x1, y1, x2, y2) {\r\n        if (isNaN(x) || isNaN(y)) return;\r\n        if (n.leaf) {\r\n          var nx = n.x, ny = n.y;\r\n          if (nx != null) {\r\n            if (abs(nx - x) + abs(ny - y) < .01) {\r\n              insertChild(n, d, x, y, x1, y1, x2, y2);\r\n            } else {\r\n              var nPoint = n.point;\r\n              n.x = n.y = n.point = null;\r\n              insertChild(n, nPoint, nx, ny, x1, y1, x2, y2);\r\n              insertChild(n, d, x, y, x1, y1, x2, y2);\r\n            }\r\n          } else {\r\n            n.x = x, n.y = y, n.point = d;\r\n          }\r\n        } else {\r\n          insertChild(n, d, x, y, x1, y1, x2, y2);\r\n        }\r\n      }\r\n      function insertChild(n, d, x, y, x1, y1, x2, y2) {\r\n        var xm = (x1 + x2) * .5, ym = (y1 + y2) * .5, right = x >= xm, below = y >= ym, i = below << 1 | right;\r\n        n.leaf = false;\r\n        n = n.nodes[i] || (n.nodes[i] = d3_geom_quadtreeNode());\r\n        if (right) x1 = xm; else x2 = xm;\r\n        if (below) y1 = ym; else y2 = ym;\r\n        insert(n, d, x, y, x1, y1, x2, y2);\r\n      }\r\n      var root = d3_geom_quadtreeNode();\r\n      root.add = function(d) {\r\n        insert(root, d, +fx(d, ++i), +fy(d, i), x1_, y1_, x2_, y2_);\r\n      };\r\n      root.visit = function(f) {\r\n        d3_geom_quadtreeVisit(f, root, x1_, y1_, x2_, y2_);\r\n      };\r\n      root.find = function(point) {\r\n        return d3_geom_quadtreeFind(root, point[0], point[1], x1_, y1_, x2_, y2_);\r\n      };\r\n      i = -1;\r\n      if (x1 == null) {\r\n        while (++i < n) {\r\n          insert(root, data[i], xs[i], ys[i], x1_, y1_, x2_, y2_);\r\n        }\r\n        --i;\r\n      } else data.forEach(root.add);\r\n      xs = ys = data = d = null;\r\n      return root;\r\n    }\r\n    quadtree.x = function(_) {\r\n      return arguments.length ? (x = _, quadtree) : x;\r\n    };\r\n    quadtree.y = function(_) {\r\n      return arguments.length ? (y = _, quadtree) : y;\r\n    };\r\n    quadtree.extent = function(_) {\r\n      if (!arguments.length) return x1 == null ? null : [ [ x1, y1 ], [ x2, y2 ] ];\r\n      if (_ == null) x1 = y1 = x2 = y2 = null; else x1 = +_[0][0], y1 = +_[0][1], x2 = +_[1][0], \r\n      y2 = +_[1][1];\r\n      return quadtree;\r\n    };\r\n    quadtree.size = function(_) {\r\n      if (!arguments.length) return x1 == null ? null : [ x2 - x1, y2 - y1 ];\r\n      if (_ == null) x1 = y1 = x2 = y2 = null; else x1 = y1 = 0, x2 = +_[0], y2 = +_[1];\r\n      return quadtree;\r\n    };\r\n    return quadtree;\r\n  };\r\n  function d3_geom_quadtreeCompatX(d) {\r\n    return d.x;\r\n  }\r\n  function d3_geom_quadtreeCompatY(d) {\r\n    return d.y;\r\n  }\r\n  function d3_geom_quadtreeNode() {\r\n    return {\r\n      leaf: true,\r\n      nodes: [],\r\n      point: null,\r\n      x: null,\r\n      y: null\r\n    };\r\n  }\r\n  function d3_geom_quadtreeVisit(f, node, x1, y1, x2, y2) {\r\n    if (!f(node, x1, y1, x2, y2)) {\r\n      var sx = (x1 + x2) * .5, sy = (y1 + y2) * .5, children = node.nodes;\r\n      if (children[0]) d3_geom_quadtreeVisit(f, children[0], x1, y1, sx, sy);\r\n      if (children[1]) d3_geom_quadtreeVisit(f, children[1], sx, y1, x2, sy);\r\n      if (children[2]) d3_geom_quadtreeVisit(f, children[2], x1, sy, sx, y2);\r\n      if (children[3]) d3_geom_quadtreeVisit(f, children[3], sx, sy, x2, y2);\r\n    }\r\n  }\r\n  function d3_geom_quadtreeFind(root, x, y, x0, y0, x3, y3) {\r\n    var minDistance2 = Infinity, closestPoint;\r\n    (function find(node, x1, y1, x2, y2) {\r\n      if (x1 > x3 || y1 > y3 || x2 < x0 || y2 < y0) return;\r\n      if (point = node.point) {\r\n        var point, dx = x - node.x, dy = y - node.y, distance2 = dx * dx + dy * dy;\r\n        if (distance2 < minDistance2) {\r\n          var distance = Math.sqrt(minDistance2 = distance2);\r\n          x0 = x - distance, y0 = y - distance;\r\n          x3 = x + distance, y3 = y + distance;\r\n          closestPoint = point;\r\n        }\r\n      }\r\n      var children = node.nodes, xm = (x1 + x2) * .5, ym = (y1 + y2) * .5, right = x >= xm, below = y >= ym;\r\n      for (var i = below << 1 | right, j = i + 4; i < j; ++i) {\r\n        if (node = children[i & 3]) switch (i & 3) {\r\n         case 0:\r\n          find(node, x1, y1, xm, ym);\r\n          break;\r\n\r\n         case 1:\r\n          find(node, xm, y1, x2, ym);\r\n          break;\r\n\r\n         case 2:\r\n          find(node, x1, ym, xm, y2);\r\n          break;\r\n\r\n         case 3:\r\n          find(node, xm, ym, x2, y2);\r\n          break;\r\n        }\r\n      }\r\n    })(root, x0, y0, x3, y3);\r\n    return closestPoint;\r\n  }\r\n  d3.interpolateRgb = d3_interpolateRgb;\r\n  function d3_interpolateRgb(a, b) {\r\n    a = d3.rgb(a);\r\n    b = d3.rgb(b);\r\n    var ar = a.r, ag = a.g, ab = a.b, br = b.r - ar, bg = b.g - ag, bb = b.b - ab;\r\n    return function(t) {\r\n      return \"#\" + d3_rgb_hex(Math.round(ar + br * t)) + d3_rgb_hex(Math.round(ag + bg * t)) + d3_rgb_hex(Math.round(ab + bb * t));\r\n    };\r\n  }\r\n  d3.interpolateObject = d3_interpolateObject;\r\n  function d3_interpolateObject(a, b) {\r\n    var i = {}, c = {}, k;\r\n    for (k in a) {\r\n      if (k in b) {\r\n        i[k] = d3_interpolate(a[k], b[k]);\r\n      } else {\r\n        c[k] = a[k];\r\n      }\r\n    }\r\n    for (k in b) {\r\n      if (!(k in a)) {\r\n        c[k] = b[k];\r\n      }\r\n    }\r\n    return function(t) {\r\n      for (k in i) c[k] = i[k](t);\r\n      return c;\r\n    };\r\n  }\r\n  d3.interpolateNumber = d3_interpolateNumber;\r\n  function d3_interpolateNumber(a, b) {\r\n    a = +a, b = +b;\r\n    return function(t) {\r\n      return a * (1 - t) + b * t;\r\n    };\r\n  }\r\n  d3.interpolateString = d3_interpolateString;\r\n  function d3_interpolateString(a, b) {\r\n    var bi = d3_interpolate_numberA.lastIndex = d3_interpolate_numberB.lastIndex = 0, am, bm, bs, i = -1, s = [], q = [];\r\n    a = a + \"\", b = b + \"\";\r\n    while ((am = d3_interpolate_numberA.exec(a)) && (bm = d3_interpolate_numberB.exec(b))) {\r\n      if ((bs = bm.index) > bi) {\r\n        bs = b.slice(bi, bs);\r\n        if (s[i]) s[i] += bs; else s[++i] = bs;\r\n      }\r\n      if ((am = am[0]) === (bm = bm[0])) {\r\n        if (s[i]) s[i] += bm; else s[++i] = bm;\r\n      } else {\r\n        s[++i] = null;\r\n        q.push({\r\n          i: i,\r\n          x: d3_interpolateNumber(am, bm)\r\n        });\r\n      }\r\n      bi = d3_interpolate_numberB.lastIndex;\r\n    }\r\n    if (bi < b.length) {\r\n      bs = b.slice(bi);\r\n      if (s[i]) s[i] += bs; else s[++i] = bs;\r\n    }\r\n    return s.length < 2 ? q[0] ? (b = q[0].x, function(t) {\r\n      return b(t) + \"\";\r\n    }) : function() {\r\n      return b;\r\n    } : (b = q.length, function(t) {\r\n      for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\r\n      return s.join(\"\");\r\n    });\r\n  }\r\n  var d3_interpolate_numberA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g, d3_interpolate_numberB = new RegExp(d3_interpolate_numberA.source, \"g\");\r\n  d3.interpolate = d3_interpolate;\r\n  function d3_interpolate(a, b) {\r\n    var i = d3.interpolators.length, f;\r\n    while (--i >= 0 && !(f = d3.interpolators[i](a, b))) ;\r\n    return f;\r\n  }\r\n  d3.interpolators = [ function(a, b) {\r\n    var t = typeof b;\r\n    return (t === \"string\" ? d3_rgb_names.has(b.toLowerCase()) || /^(#|rgb\\(|hsl\\()/i.test(b) ? d3_interpolateRgb : d3_interpolateString : b instanceof d3_color ? d3_interpolateRgb : Array.isArray(b) ? d3_interpolateArray : t === \"object\" && isNaN(b) ? d3_interpolateObject : d3_interpolateNumber)(a, b);\r\n  } ];\r\n  d3.interpolateArray = d3_interpolateArray;\r\n  function d3_interpolateArray(a, b) {\r\n    var x = [], c = [], na = a.length, nb = b.length, n0 = Math.min(a.length, b.length), i;\r\n    for (i = 0; i < n0; ++i) x.push(d3_interpolate(a[i], b[i]));\r\n    for (;i < na; ++i) c[i] = a[i];\r\n    for (;i < nb; ++i) c[i] = b[i];\r\n    return function(t) {\r\n      for (i = 0; i < n0; ++i) c[i] = x[i](t);\r\n      return c;\r\n    };\r\n  }\r\n  var d3_ease_default = function() {\r\n    return d3_identity;\r\n  };\r\n  var d3_ease = d3.map({\r\n    linear: d3_ease_default,\r\n    poly: d3_ease_poly,\r\n    quad: function() {\r\n      return d3_ease_quad;\r\n    },\r\n    cubic: function() {\r\n      return d3_ease_cubic;\r\n    },\r\n    sin: function() {\r\n      return d3_ease_sin;\r\n    },\r\n    exp: function() {\r\n      return d3_ease_exp;\r\n    },\r\n    circle: function() {\r\n      return d3_ease_circle;\r\n    },\r\n    elastic: d3_ease_elastic,\r\n    back: d3_ease_back,\r\n    bounce: function() {\r\n      return d3_ease_bounce;\r\n    }\r\n  });\r\n  var d3_ease_mode = d3.map({\r\n    \"in\": d3_identity,\r\n    out: d3_ease_reverse,\r\n    \"in-out\": d3_ease_reflect,\r\n    \"out-in\": function(f) {\r\n      return d3_ease_reflect(d3_ease_reverse(f));\r\n    }\r\n  });\r\n  d3.ease = function(name) {\r\n    var i = name.indexOf(\"-\"), t = i >= 0 ? name.slice(0, i) : name, m = i >= 0 ? name.slice(i + 1) : \"in\";\r\n    t = d3_ease.get(t) || d3_ease_default;\r\n    m = d3_ease_mode.get(m) || d3_identity;\r\n    return d3_ease_clamp(m(t.apply(null, d3_arraySlice.call(arguments, 1))));\r\n  };\r\n  function d3_ease_clamp(f) {\r\n    return function(t) {\r\n      return t <= 0 ? 0 : t >= 1 ? 1 : f(t);\r\n    };\r\n  }\r\n  function d3_ease_reverse(f) {\r\n    return function(t) {\r\n      return 1 - f(1 - t);\r\n    };\r\n  }\r\n  function d3_ease_reflect(f) {\r\n    return function(t) {\r\n      return .5 * (t < .5 ? f(2 * t) : 2 - f(2 - 2 * t));\r\n    };\r\n  }\r\n  function d3_ease_quad(t) {\r\n    return t * t;\r\n  }\r\n  function d3_ease_cubic(t) {\r\n    return t * t * t;\r\n  }\r\n  function d3_ease_cubicInOut(t) {\r\n    if (t <= 0) return 0;\r\n    if (t >= 1) return 1;\r\n    var t2 = t * t, t3 = t2 * t;\r\n    return 4 * (t < .5 ? t3 : 3 * (t - t2) + t3 - .75);\r\n  }\r\n  function d3_ease_poly(e) {\r\n    return function(t) {\r\n      return Math.pow(t, e);\r\n    };\r\n  }\r\n  function d3_ease_sin(t) {\r\n    return 1 - Math.cos(t * halfπ);\r\n  }\r\n  function d3_ease_exp(t) {\r\n    return Math.pow(2, 10 * (t - 1));\r\n  }\r\n  function d3_ease_circle(t) {\r\n    return 1 - Math.sqrt(1 - t * t);\r\n  }\r\n  function d3_ease_elastic(a, p) {\r\n    var s;\r\n    if (arguments.length < 2) p = .45;\r\n    if (arguments.length) s = p / τ * Math.asin(1 / a); else a = 1, s = p / 4;\r\n    return function(t) {\r\n      return 1 + a * Math.pow(2, -10 * t) * Math.sin((t - s) * τ / p);\r\n    };\r\n  }\r\n  function d3_ease_back(s) {\r\n    if (!s) s = 1.70158;\r\n    return function(t) {\r\n      return t * t * ((s + 1) * t - s);\r\n    };\r\n  }\r\n  function d3_ease_bounce(t) {\r\n    return t < 1 / 2.75 ? 7.5625 * t * t : t < 2 / 2.75 ? 7.5625 * (t -= 1.5 / 2.75) * t + .75 : t < 2.5 / 2.75 ? 7.5625 * (t -= 2.25 / 2.75) * t + .9375 : 7.5625 * (t -= 2.625 / 2.75) * t + .984375;\r\n  }\r\n  d3.interpolateHcl = d3_interpolateHcl;\r\n  function d3_interpolateHcl(a, b) {\r\n    a = d3.hcl(a);\r\n    b = d3.hcl(b);\r\n    var ah = a.h, ac = a.c, al = a.l, bh = b.h - ah, bc = b.c - ac, bl = b.l - al;\r\n    if (isNaN(bc)) bc = 0, ac = isNaN(ac) ? b.c : ac;\r\n    if (isNaN(bh)) bh = 0, ah = isNaN(ah) ? b.h : ah; else if (bh > 180) bh -= 360; else if (bh < -180) bh += 360;\r\n    return function(t) {\r\n      return d3_hcl_lab(ah + bh * t, ac + bc * t, al + bl * t) + \"\";\r\n    };\r\n  }\r\n  d3.interpolateHsl = d3_interpolateHsl;\r\n  function d3_interpolateHsl(a, b) {\r\n    a = d3.hsl(a);\r\n    b = d3.hsl(b);\r\n    var ah = a.h, as = a.s, al = a.l, bh = b.h - ah, bs = b.s - as, bl = b.l - al;\r\n    if (isNaN(bs)) bs = 0, as = isNaN(as) ? b.s : as;\r\n    if (isNaN(bh)) bh = 0, ah = isNaN(ah) ? b.h : ah; else if (bh > 180) bh -= 360; else if (bh < -180) bh += 360;\r\n    return function(t) {\r\n      return d3_hsl_rgb(ah + bh * t, as + bs * t, al + bl * t) + \"\";\r\n    };\r\n  }\r\n  d3.interpolateLab = d3_interpolateLab;\r\n  function d3_interpolateLab(a, b) {\r\n    a = d3.lab(a);\r\n    b = d3.lab(b);\r\n    var al = a.l, aa = a.a, ab = a.b, bl = b.l - al, ba = b.a - aa, bb = b.b - ab;\r\n    return function(t) {\r\n      return d3_lab_rgb(al + bl * t, aa + ba * t, ab + bb * t) + \"\";\r\n    };\r\n  }\r\n  d3.interpolateRound = d3_interpolateRound;\r\n  function d3_interpolateRound(a, b) {\r\n    b -= a;\r\n    return function(t) {\r\n      return Math.round(a + b * t);\r\n    };\r\n  }\r\n  d3.transform = function(string) {\r\n    var g = d3_document.createElementNS(d3.ns.prefix.svg, \"g\");\r\n    return (d3.transform = function(string) {\r\n      if (string != null) {\r\n        g.setAttribute(\"transform\", string);\r\n        var t = g.transform.baseVal.consolidate();\r\n      }\r\n      return new d3_transform(t ? t.matrix : d3_transformIdentity);\r\n    })(string);\r\n  };\r\n  function d3_transform(m) {\r\n    var r0 = [ m.a, m.b ], r1 = [ m.c, m.d ], kx = d3_transformNormalize(r0), kz = d3_transformDot(r0, r1), ky = d3_transformNormalize(d3_transformCombine(r1, r0, -kz)) || 0;\r\n    if (r0[0] * r1[1] < r1[0] * r0[1]) {\r\n      r0[0] *= -1;\r\n      r0[1] *= -1;\r\n      kx *= -1;\r\n      kz *= -1;\r\n    }\r\n    this.rotate = (kx ? Math.atan2(r0[1], r0[0]) : Math.atan2(-r1[0], r1[1])) * d3_degrees;\r\n    this.translate = [ m.e, m.f ];\r\n    this.scale = [ kx, ky ];\r\n    this.skew = ky ? Math.atan2(kz, ky) * d3_degrees : 0;\r\n  }\r\n  d3_transform.prototype.toString = function() {\r\n    return \"translate(\" + this.translate + \")rotate(\" + this.rotate + \")skewX(\" + this.skew + \")scale(\" + this.scale + \")\";\r\n  };\r\n  function d3_transformDot(a, b) {\r\n    return a[0] * b[0] + a[1] * b[1];\r\n  }\r\n  function d3_transformNormalize(a) {\r\n    var k = Math.sqrt(d3_transformDot(a, a));\r\n    if (k) {\r\n      a[0] /= k;\r\n      a[1] /= k;\r\n    }\r\n    return k;\r\n  }\r\n  function d3_transformCombine(a, b, k) {\r\n    a[0] += k * b[0];\r\n    a[1] += k * b[1];\r\n    return a;\r\n  }\r\n  var d3_transformIdentity = {\r\n    a: 1,\r\n    b: 0,\r\n    c: 0,\r\n    d: 1,\r\n    e: 0,\r\n    f: 0\r\n  };\r\n  d3.interpolateTransform = d3_interpolateTransform;\r\n  function d3_interpolateTransformPop(s) {\r\n    return s.length ? s.pop() + \",\" : \"\";\r\n  }\r\n  function d3_interpolateTranslate(ta, tb, s, q) {\r\n    if (ta[0] !== tb[0] || ta[1] !== tb[1]) {\r\n      var i = s.push(\"translate(\", null, \",\", null, \")\");\r\n      q.push({\r\n        i: i - 4,\r\n        x: d3_interpolateNumber(ta[0], tb[0])\r\n      }, {\r\n        i: i - 2,\r\n        x: d3_interpolateNumber(ta[1], tb[1])\r\n      });\r\n    } else if (tb[0] || tb[1]) {\r\n      s.push(\"translate(\" + tb + \")\");\r\n    }\r\n  }\r\n  function d3_interpolateRotate(ra, rb, s, q) {\r\n    if (ra !== rb) {\r\n      if (ra - rb > 180) rb += 360; else if (rb - ra > 180) ra += 360;\r\n      q.push({\r\n        i: s.push(d3_interpolateTransformPop(s) + \"rotate(\", null, \")\") - 2,\r\n        x: d3_interpolateNumber(ra, rb)\r\n      });\r\n    } else if (rb) {\r\n      s.push(d3_interpolateTransformPop(s) + \"rotate(\" + rb + \")\");\r\n    }\r\n  }\r\n  function d3_interpolateSkew(wa, wb, s, q) {\r\n    if (wa !== wb) {\r\n      q.push({\r\n        i: s.push(d3_interpolateTransformPop(s) + \"skewX(\", null, \")\") - 2,\r\n        x: d3_interpolateNumber(wa, wb)\r\n      });\r\n    } else if (wb) {\r\n      s.push(d3_interpolateTransformPop(s) + \"skewX(\" + wb + \")\");\r\n    }\r\n  }\r\n  function d3_interpolateScale(ka, kb, s, q) {\r\n    if (ka[0] !== kb[0] || ka[1] !== kb[1]) {\r\n      var i = s.push(d3_interpolateTransformPop(s) + \"scale(\", null, \",\", null, \")\");\r\n      q.push({\r\n        i: i - 4,\r\n        x: d3_interpolateNumber(ka[0], kb[0])\r\n      }, {\r\n        i: i - 2,\r\n        x: d3_interpolateNumber(ka[1], kb[1])\r\n      });\r\n    } else if (kb[0] !== 1 || kb[1] !== 1) {\r\n      s.push(d3_interpolateTransformPop(s) + \"scale(\" + kb + \")\");\r\n    }\r\n  }\r\n  function d3_interpolateTransform(a, b) {\r\n    var s = [], q = [];\r\n    a = d3.transform(a), b = d3.transform(b);\r\n    d3_interpolateTranslate(a.translate, b.translate, s, q);\r\n    d3_interpolateRotate(a.rotate, b.rotate, s, q);\r\n    d3_interpolateSkew(a.skew, b.skew, s, q);\r\n    d3_interpolateScale(a.scale, b.scale, s, q);\r\n    a = b = null;\r\n    return function(t) {\r\n      var i = -1, n = q.length, o;\r\n      while (++i < n) s[(o = q[i]).i] = o.x(t);\r\n      return s.join(\"\");\r\n    };\r\n  }\r\n  function d3_uninterpolateNumber(a, b) {\r\n    b = (b -= a = +a) || 1 / b;\r\n    return function(x) {\r\n      return (x - a) / b;\r\n    };\r\n  }\r\n  function d3_uninterpolateClamp(a, b) {\r\n    b = (b -= a = +a) || 1 / b;\r\n    return function(x) {\r\n      return Math.max(0, Math.min(1, (x - a) / b));\r\n    };\r\n  }\r\n  d3.layout = {};\r\n  d3.layout.bundle = function() {\r\n    return function(links) {\r\n      var paths = [], i = -1, n = links.length;\r\n      while (++i < n) paths.push(d3_layout_bundlePath(links[i]));\r\n      return paths;\r\n    };\r\n  };\r\n  function d3_layout_bundlePath(link) {\r\n    var start = link.source, end = link.target, lca = d3_layout_bundleLeastCommonAncestor(start, end), points = [ start ];\r\n    while (start !== lca) {\r\n      start = start.parent;\r\n      points.push(start);\r\n    }\r\n    var k = points.length;\r\n    while (end !== lca) {\r\n      points.splice(k, 0, end);\r\n      end = end.parent;\r\n    }\r\n    return points;\r\n  }\r\n  function d3_layout_bundleAncestors(node) {\r\n    var ancestors = [], parent = node.parent;\r\n    while (parent != null) {\r\n      ancestors.push(node);\r\n      node = parent;\r\n      parent = parent.parent;\r\n    }\r\n    ancestors.push(node);\r\n    return ancestors;\r\n  }\r\n  function d3_layout_bundleLeastCommonAncestor(a, b) {\r\n    if (a === b) return a;\r\n    var aNodes = d3_layout_bundleAncestors(a), bNodes = d3_layout_bundleAncestors(b), aNode = aNodes.pop(), bNode = bNodes.pop(), sharedNode = null;\r\n    while (aNode === bNode) {\r\n      sharedNode = aNode;\r\n      aNode = aNodes.pop();\r\n      bNode = bNodes.pop();\r\n    }\r\n    return sharedNode;\r\n  }\r\n  d3.layout.chord = function() {\r\n    var chord = {}, chords, groups, matrix, n, padding = 0, sortGroups, sortSubgroups, sortChords;\r\n    function relayout() {\r\n      var subgroups = {}, groupSums = [], groupIndex = d3.range(n), subgroupIndex = [], k, x, x0, i, j;\r\n      chords = [];\r\n      groups = [];\r\n      k = 0, i = -1;\r\n      while (++i < n) {\r\n        x = 0, j = -1;\r\n        while (++j < n) {\r\n          x += matrix[i][j];\r\n        }\r\n        groupSums.push(x);\r\n        subgroupIndex.push(d3.range(n));\r\n        k += x;\r\n      }\r\n      if (sortGroups) {\r\n        groupIndex.sort(function(a, b) {\r\n          return sortGroups(groupSums[a], groupSums[b]);\r\n        });\r\n      }\r\n      if (sortSubgroups) {\r\n        subgroupIndex.forEach(function(d, i) {\r\n          d.sort(function(a, b) {\r\n            return sortSubgroups(matrix[i][a], matrix[i][b]);\r\n          });\r\n        });\r\n      }\r\n      k = (τ - padding * n) / k;\r\n      x = 0, i = -1;\r\n      while (++i < n) {\r\n        x0 = x, j = -1;\r\n        while (++j < n) {\r\n          var di = groupIndex[i], dj = subgroupIndex[di][j], v = matrix[di][dj], a0 = x, a1 = x += v * k;\r\n          subgroups[di + \"-\" + dj] = {\r\n            index: di,\r\n            subindex: dj,\r\n            startAngle: a0,\r\n            endAngle: a1,\r\n            value: v\r\n          };\r\n        }\r\n        groups[di] = {\r\n          index: di,\r\n          startAngle: x0,\r\n          endAngle: x,\r\n          value: groupSums[di]\r\n        };\r\n        x += padding;\r\n      }\r\n      i = -1;\r\n      while (++i < n) {\r\n        j = i - 1;\r\n        while (++j < n) {\r\n          var source = subgroups[i + \"-\" + j], target = subgroups[j + \"-\" + i];\r\n          if (source.value || target.value) {\r\n            chords.push(source.value < target.value ? {\r\n              source: target,\r\n              target: source\r\n            } : {\r\n              source: source,\r\n              target: target\r\n            });\r\n          }\r\n        }\r\n      }\r\n      if (sortChords) resort();\r\n    }\r\n    function resort() {\r\n      chords.sort(function(a, b) {\r\n        return sortChords((a.source.value + a.target.value) / 2, (b.source.value + b.target.value) / 2);\r\n      });\r\n    }\r\n    chord.matrix = function(x) {\r\n      if (!arguments.length) return matrix;\r\n      n = (matrix = x) && matrix.length;\r\n      chords = groups = null;\r\n      return chord;\r\n    };\r\n    chord.padding = function(x) {\r\n      if (!arguments.length) return padding;\r\n      padding = x;\r\n      chords = groups = null;\r\n      return chord;\r\n    };\r\n    chord.sortGroups = function(x) {\r\n      if (!arguments.length) return sortGroups;\r\n      sortGroups = x;\r\n      chords = groups = null;\r\n      return chord;\r\n    };\r\n    chord.sortSubgroups = function(x) {\r\n      if (!arguments.length) return sortSubgroups;\r\n      sortSubgroups = x;\r\n      chords = null;\r\n      return chord;\r\n    };\r\n    chord.sortChords = function(x) {\r\n      if (!arguments.length) return sortChords;\r\n      sortChords = x;\r\n      if (chords) resort();\r\n      return chord;\r\n    };\r\n    chord.chords = function() {\r\n      if (!chords) relayout();\r\n      return chords;\r\n    };\r\n    chord.groups = function() {\r\n      if (!groups) relayout();\r\n      return groups;\r\n    };\r\n    return chord;\r\n  };\r\n  d3.layout.force = function() {\r\n    var force = {}, event = d3.dispatch(\"start\", \"tick\", \"end\"), timer, size = [ 1, 1 ], drag, alpha, friction = .9, linkDistance = d3_layout_forceLinkDistance, linkStrength = d3_layout_forceLinkStrength, charge = -30, chargeDistance2 = d3_layout_forceChargeDistance2, gravity = .1, theta2 = .64, nodes = [], links = [], distances, strengths, charges;\r\n    function repulse(node) {\r\n      return function(quad, x1, _, x2) {\r\n        if (quad.point !== node) {\r\n          var dx = quad.cx - node.x, dy = quad.cy - node.y, dw = x2 - x1, dn = dx * dx + dy * dy;\r\n          if (dw * dw / theta2 < dn) {\r\n            if (dn < chargeDistance2) {\r\n              var k = quad.charge / dn;\r\n              node.px -= dx * k;\r\n              node.py -= dy * k;\r\n            }\r\n            return true;\r\n          }\r\n          if (quad.point && dn && dn < chargeDistance2) {\r\n            var k = quad.pointCharge / dn;\r\n            node.px -= dx * k;\r\n            node.py -= dy * k;\r\n          }\r\n        }\r\n        return !quad.charge;\r\n      };\r\n    }\r\n    force.tick = function() {\r\n      if ((alpha *= .99) < .005) {\r\n        timer = null;\r\n        event.end({\r\n          type: \"end\",\r\n          alpha: alpha = 0\r\n        });\r\n        return true;\r\n      }\r\n      var n = nodes.length, m = links.length, q, i, o, s, t, l, k, x, y;\r\n      for (i = 0; i < m; ++i) {\r\n        o = links[i];\r\n        s = o.source;\r\n        t = o.target;\r\n        x = t.x - s.x;\r\n        y = t.y - s.y;\r\n        if (l = x * x + y * y) {\r\n          l = alpha * strengths[i] * ((l = Math.sqrt(l)) - distances[i]) / l;\r\n          x *= l;\r\n          y *= l;\r\n          t.x -= x * (k = s.weight + t.weight ? s.weight / (s.weight + t.weight) : .5);\r\n          t.y -= y * k;\r\n          s.x += x * (k = 1 - k);\r\n          s.y += y * k;\r\n        }\r\n      }\r\n      if (k = alpha * gravity) {\r\n        x = size[0] / 2;\r\n        y = size[1] / 2;\r\n        i = -1;\r\n        if (k) while (++i < n) {\r\n          o = nodes[i];\r\n          o.x += (x - o.x) * k;\r\n          o.y += (y - o.y) * k;\r\n        }\r\n      }\r\n      if (charge) {\r\n        d3_layout_forceAccumulate(q = d3.geom.quadtree(nodes), alpha, charges);\r\n        i = -1;\r\n        while (++i < n) {\r\n          if (!(o = nodes[i]).fixed) {\r\n            q.visit(repulse(o));\r\n          }\r\n        }\r\n      }\r\n      i = -1;\r\n      while (++i < n) {\r\n        o = nodes[i];\r\n        if (o.fixed) {\r\n          o.x = o.px;\r\n          o.y = o.py;\r\n        } else {\r\n          o.x -= (o.px - (o.px = o.x)) * friction;\r\n          o.y -= (o.py - (o.py = o.y)) * friction;\r\n        }\r\n      }\r\n      event.tick({\r\n        type: \"tick\",\r\n        alpha: alpha\r\n      });\r\n    };\r\n    force.nodes = function(x) {\r\n      if (!arguments.length) return nodes;\r\n      nodes = x;\r\n      return force;\r\n    };\r\n    force.links = function(x) {\r\n      if (!arguments.length) return links;\r\n      links = x;\r\n      return force;\r\n    };\r\n    force.size = function(x) {\r\n      if (!arguments.length) return size;\r\n      size = x;\r\n      return force;\r\n    };\r\n    force.linkDistance = function(x) {\r\n      if (!arguments.length) return linkDistance;\r\n      linkDistance = typeof x === \"function\" ? x : +x;\r\n      return force;\r\n    };\r\n    force.distance = force.linkDistance;\r\n    force.linkStrength = function(x) {\r\n      if (!arguments.length) return linkStrength;\r\n      linkStrength = typeof x === \"function\" ? x : +x;\r\n      return force;\r\n    };\r\n    force.friction = function(x) {\r\n      if (!arguments.length) return friction;\r\n      friction = +x;\r\n      return force;\r\n    };\r\n    force.charge = function(x) {\r\n      if (!arguments.length) return charge;\r\n      charge = typeof x === \"function\" ? x : +x;\r\n      return force;\r\n    };\r\n    force.chargeDistance = function(x) {\r\n      if (!arguments.length) return Math.sqrt(chargeDistance2);\r\n      chargeDistance2 = x * x;\r\n      return force;\r\n    };\r\n    force.gravity = function(x) {\r\n      if (!arguments.length) return gravity;\r\n      gravity = +x;\r\n      return force;\r\n    };\r\n    force.theta = function(x) {\r\n      if (!arguments.length) return Math.sqrt(theta2);\r\n      theta2 = x * x;\r\n      return force;\r\n    };\r\n    force.alpha = function(x) {\r\n      if (!arguments.length) return alpha;\r\n      x = +x;\r\n      if (alpha) {\r\n        if (x > 0) {\r\n          alpha = x;\r\n        } else {\r\n          timer.c = null, timer.t = NaN, timer = null;\r\n          event.end({\r\n            type: \"end\",\r\n            alpha: alpha = 0\r\n          });\r\n        }\r\n      } else if (x > 0) {\r\n        event.start({\r\n          type: \"start\",\r\n          alpha: alpha = x\r\n        });\r\n        timer = d3_timer(force.tick);\r\n      }\r\n      return force;\r\n    };\r\n    force.start = function() {\r\n      var i, n = nodes.length, m = links.length, w = size[0], h = size[1], neighbors, o;\r\n      for (i = 0; i < n; ++i) {\r\n        (o = nodes[i]).index = i;\r\n        o.weight = 0;\r\n      }\r\n      for (i = 0; i < m; ++i) {\r\n        o = links[i];\r\n        if (typeof o.source == \"number\") o.source = nodes[o.source];\r\n        if (typeof o.target == \"number\") o.target = nodes[o.target];\r\n        ++o.source.weight;\r\n        ++o.target.weight;\r\n      }\r\n      for (i = 0; i < n; ++i) {\r\n        o = nodes[i];\r\n        if (isNaN(o.x)) o.x = position(\"x\", w);\r\n        if (isNaN(o.y)) o.y = position(\"y\", h);\r\n        if (isNaN(o.px)) o.px = o.x;\r\n        if (isNaN(o.py)) o.py = o.y;\r\n      }\r\n      distances = [];\r\n      if (typeof linkDistance === \"function\") for (i = 0; i < m; ++i) distances[i] = +linkDistance.call(this, links[i], i); else for (i = 0; i < m; ++i) distances[i] = linkDistance;\r\n      strengths = [];\r\n      if (typeof linkStrength === \"function\") for (i = 0; i < m; ++i) strengths[i] = +linkStrength.call(this, links[i], i); else for (i = 0; i < m; ++i) strengths[i] = linkStrength;\r\n      charges = [];\r\n      if (typeof charge === \"function\") for (i = 0; i < n; ++i) charges[i] = +charge.call(this, nodes[i], i); else for (i = 0; i < n; ++i) charges[i] = charge;\r\n      function position(dimension, size) {\r\n        if (!neighbors) {\r\n          neighbors = new Array(n);\r\n          for (j = 0; j < n; ++j) {\r\n            neighbors[j] = [];\r\n          }\r\n          for (j = 0; j < m; ++j) {\r\n            var o = links[j];\r\n            neighbors[o.source.index].push(o.target);\r\n            neighbors[o.target.index].push(o.source);\r\n          }\r\n        }\r\n        var candidates = neighbors[i], j = -1, l = candidates.length, x;\r\n        while (++j < l) if (!isNaN(x = candidates[j][dimension])) return x;\r\n        return Math.random() * size;\r\n      }\r\n      return force.resume();\r\n    };\r\n    force.resume = function() {\r\n      return force.alpha(.1);\r\n    };\r\n    force.stop = function() {\r\n      return force.alpha(0);\r\n    };\r\n    force.drag = function() {\r\n      if (!drag) drag = d3.behavior.drag().origin(d3_identity).on(\"dragstart.force\", d3_layout_forceDragstart).on(\"drag.force\", dragmove).on(\"dragend.force\", d3_layout_forceDragend);\r\n      if (!arguments.length) return drag;\r\n      this.on(\"mouseover.force\", d3_layout_forceMouseover).on(\"mouseout.force\", d3_layout_forceMouseout).call(drag);\r\n    };\r\n    function dragmove(d) {\r\n      d.px = d3.event.x, d.py = d3.event.y;\r\n      force.resume();\r\n    }\r\n    return d3.rebind(force, event, \"on\");\r\n  };\r\n  function d3_layout_forceDragstart(d) {\r\n    d.fixed |= 2;\r\n  }\r\n  function d3_layout_forceDragend(d) {\r\n    d.fixed &= ~6;\r\n  }\r\n  function d3_layout_forceMouseover(d) {\r\n    d.fixed |= 4;\r\n    d.px = d.x, d.py = d.y;\r\n  }\r\n  function d3_layout_forceMouseout(d) {\r\n    d.fixed &= ~4;\r\n  }\r\n  function d3_layout_forceAccumulate(quad, alpha, charges) {\r\n    var cx = 0, cy = 0;\r\n    quad.charge = 0;\r\n    if (!quad.leaf) {\r\n      var nodes = quad.nodes, n = nodes.length, i = -1, c;\r\n      while (++i < n) {\r\n        c = nodes[i];\r\n        if (c == null) continue;\r\n        d3_layout_forceAccumulate(c, alpha, charges);\r\n        quad.charge += c.charge;\r\n        cx += c.charge * c.cx;\r\n        cy += c.charge * c.cy;\r\n      }\r\n    }\r\n    if (quad.point) {\r\n      if (!quad.leaf) {\r\n        quad.point.x += Math.random() - .5;\r\n        quad.point.y += Math.random() - .5;\r\n      }\r\n      var k = alpha * charges[quad.point.index];\r\n      quad.charge += quad.pointCharge = k;\r\n      cx += k * quad.point.x;\r\n      cy += k * quad.point.y;\r\n    }\r\n    quad.cx = cx / quad.charge;\r\n    quad.cy = cy / quad.charge;\r\n  }\r\n  var d3_layout_forceLinkDistance = 20, d3_layout_forceLinkStrength = 1, d3_layout_forceChargeDistance2 = Infinity;\r\n  d3.layout.hierarchy = function() {\r\n    var sort = d3_layout_hierarchySort, children = d3_layout_hierarchyChildren, value = d3_layout_hierarchyValue;\r\n    function hierarchy(root) {\r\n      var stack = [ root ], nodes = [], node;\r\n      root.depth = 0;\r\n      while ((node = stack.pop()) != null) {\r\n        nodes.push(node);\r\n        if ((childs = children.call(hierarchy, node, node.depth)) && (n = childs.length)) {\r\n          var n, childs, child;\r\n          while (--n >= 0) {\r\n            stack.push(child = childs[n]);\r\n            child.parent = node;\r\n            child.depth = node.depth + 1;\r\n          }\r\n          if (value) node.value = 0;\r\n          node.children = childs;\r\n        } else {\r\n          if (value) node.value = +value.call(hierarchy, node, node.depth) || 0;\r\n          delete node.children;\r\n        }\r\n      }\r\n      d3_layout_hierarchyVisitAfter(root, function(node) {\r\n        var childs, parent;\r\n        if (sort && (childs = node.children)) childs.sort(sort);\r\n        if (value && (parent = node.parent)) parent.value += node.value;\r\n      });\r\n      return nodes;\r\n    }\r\n    hierarchy.sort = function(x) {\r\n      if (!arguments.length) return sort;\r\n      sort = x;\r\n      return hierarchy;\r\n    };\r\n    hierarchy.children = function(x) {\r\n      if (!arguments.length) return children;\r\n      children = x;\r\n      return hierarchy;\r\n    };\r\n    hierarchy.value = function(x) {\r\n      if (!arguments.length) return value;\r\n      value = x;\r\n      return hierarchy;\r\n    };\r\n    hierarchy.revalue = function(root) {\r\n      if (value) {\r\n        d3_layout_hierarchyVisitBefore(root, function(node) {\r\n          if (node.children) node.value = 0;\r\n        });\r\n        d3_layout_hierarchyVisitAfter(root, function(node) {\r\n          var parent;\r\n          if (!node.children) node.value = +value.call(hierarchy, node, node.depth) || 0;\r\n          if (parent = node.parent) parent.value += node.value;\r\n        });\r\n      }\r\n      return root;\r\n    };\r\n    return hierarchy;\r\n  };\r\n  function d3_layout_hierarchyRebind(object, hierarchy) {\r\n    d3.rebind(object, hierarchy, \"sort\", \"children\", \"value\");\r\n    object.nodes = object;\r\n    object.links = d3_layout_hierarchyLinks;\r\n    return object;\r\n  }\r\n  function d3_layout_hierarchyVisitBefore(node, callback) {\r\n    var nodes = [ node ];\r\n    while ((node = nodes.pop()) != null) {\r\n      callback(node);\r\n      if ((children = node.children) && (n = children.length)) {\r\n        var n, children;\r\n        while (--n >= 0) nodes.push(children[n]);\r\n      }\r\n    }\r\n  }\r\n  function d3_layout_hierarchyVisitAfter(node, callback) {\r\n    var nodes = [ node ], nodes2 = [];\r\n    while ((node = nodes.pop()) != null) {\r\n      nodes2.push(node);\r\n      if ((children = node.children) && (n = children.length)) {\r\n        var i = -1, n, children;\r\n        while (++i < n) nodes.push(children[i]);\r\n      }\r\n    }\r\n    while ((node = nodes2.pop()) != null) {\r\n      callback(node);\r\n    }\r\n  }\r\n  function d3_layout_hierarchyChildren(d) {\r\n    return d.children;\r\n  }\r\n  function d3_layout_hierarchyValue(d) {\r\n    return d.value;\r\n  }\r\n  function d3_layout_hierarchySort(a, b) {\r\n    return b.value - a.value;\r\n  }\r\n  function d3_layout_hierarchyLinks(nodes) {\r\n    return d3.merge(nodes.map(function(parent) {\r\n      return (parent.children || []).map(function(child) {\r\n        return {\r\n          source: parent,\r\n          target: child\r\n        };\r\n      });\r\n    }));\r\n  }\r\n  d3.layout.partition = function() {\r\n    var hierarchy = d3.layout.hierarchy(), size = [ 1, 1 ];\r\n    function position(node, x, dx, dy) {\r\n      var children = node.children;\r\n      node.x = x;\r\n      node.y = node.depth * dy;\r\n      node.dx = dx;\r\n      node.dy = dy;\r\n      if (children && (n = children.length)) {\r\n        var i = -1, n, c, d;\r\n        dx = node.value ? dx / node.value : 0;\r\n        while (++i < n) {\r\n          position(c = children[i], x, d = c.value * dx, dy);\r\n          x += d;\r\n        }\r\n      }\r\n    }\r\n    function depth(node) {\r\n      var children = node.children, d = 0;\r\n      if (children && (n = children.length)) {\r\n        var i = -1, n;\r\n        while (++i < n) d = Math.max(d, depth(children[i]));\r\n      }\r\n      return 1 + d;\r\n    }\r\n    function partition(d, i) {\r\n      var nodes = hierarchy.call(this, d, i);\r\n      position(nodes[0], 0, size[0], size[1] / depth(nodes[0]));\r\n      return nodes;\r\n    }\r\n    partition.size = function(x) {\r\n      if (!arguments.length) return size;\r\n      size = x;\r\n      return partition;\r\n    };\r\n    return d3_layout_hierarchyRebind(partition, hierarchy);\r\n  };\r\n  d3.layout.pie = function() {\r\n    var value = Number, sort = d3_layout_pieSortByValue, startAngle = 0, endAngle = τ, padAngle = 0;\r\n    function pie(data) {\r\n      var n = data.length, values = data.map(function(d, i) {\r\n        return +value.call(pie, d, i);\r\n      }), a = +(typeof startAngle === \"function\" ? startAngle.apply(this, arguments) : startAngle), da = (typeof endAngle === \"function\" ? endAngle.apply(this, arguments) : endAngle) - a, p = Math.min(Math.abs(da) / n, +(typeof padAngle === \"function\" ? padAngle.apply(this, arguments) : padAngle)), pa = p * (da < 0 ? -1 : 1), sum = d3.sum(values), k = sum ? (da - n * pa) / sum : 0, index = d3.range(n), arcs = [], v;\r\n      if (sort != null) index.sort(sort === d3_layout_pieSortByValue ? function(i, j) {\r\n        return values[j] - values[i];\r\n      } : function(i, j) {\r\n        return sort(data[i], data[j]);\r\n      });\r\n      index.forEach(function(i) {\r\n        arcs[i] = {\r\n          data: data[i],\r\n          value: v = values[i],\r\n          startAngle: a,\r\n          endAngle: a += v * k + pa,\r\n          padAngle: p\r\n        };\r\n      });\r\n      return arcs;\r\n    }\r\n    pie.value = function(_) {\r\n      if (!arguments.length) return value;\r\n      value = _;\r\n      return pie;\r\n    };\r\n    pie.sort = function(_) {\r\n      if (!arguments.length) return sort;\r\n      sort = _;\r\n      return pie;\r\n    };\r\n    pie.startAngle = function(_) {\r\n      if (!arguments.length) return startAngle;\r\n      startAngle = _;\r\n      return pie;\r\n    };\r\n    pie.endAngle = function(_) {\r\n      if (!arguments.length) return endAngle;\r\n      endAngle = _;\r\n      return pie;\r\n    };\r\n    pie.padAngle = function(_) {\r\n      if (!arguments.length) return padAngle;\r\n      padAngle = _;\r\n      return pie;\r\n    };\r\n    return pie;\r\n  };\r\n  var d3_layout_pieSortByValue = {};\r\n  d3.layout.stack = function() {\r\n    var values = d3_identity, order = d3_layout_stackOrderDefault, offset = d3_layout_stackOffsetZero, out = d3_layout_stackOut, x = d3_layout_stackX, y = d3_layout_stackY;\r\n    function stack(data, index) {\r\n      if (!(n = data.length)) return data;\r\n      var series = data.map(function(d, i) {\r\n        return values.call(stack, d, i);\r\n      });\r\n      var points = series.map(function(d) {\r\n        return d.map(function(v, i) {\r\n          return [ x.call(stack, v, i), y.call(stack, v, i) ];\r\n        });\r\n      });\r\n      var orders = order.call(stack, points, index);\r\n      series = d3.permute(series, orders);\r\n      points = d3.permute(points, orders);\r\n      var offsets = offset.call(stack, points, index);\r\n      var m = series[0].length, n, i, j, o;\r\n      for (j = 0; j < m; ++j) {\r\n        out.call(stack, series[0][j], o = offsets[j], points[0][j][1]);\r\n        for (i = 1; i < n; ++i) {\r\n          out.call(stack, series[i][j], o += points[i - 1][j][1], points[i][j][1]);\r\n        }\r\n      }\r\n      return data;\r\n    }\r\n    stack.values = function(x) {\r\n      if (!arguments.length) return values;\r\n      values = x;\r\n      return stack;\r\n    };\r\n    stack.order = function(x) {\r\n      if (!arguments.length) return order;\r\n      order = typeof x === \"function\" ? x : d3_layout_stackOrders.get(x) || d3_layout_stackOrderDefault;\r\n      return stack;\r\n    };\r\n    stack.offset = function(x) {\r\n      if (!arguments.length) return offset;\r\n      offset = typeof x === \"function\" ? x : d3_layout_stackOffsets.get(x) || d3_layout_stackOffsetZero;\r\n      return stack;\r\n    };\r\n    stack.x = function(z) {\r\n      if (!arguments.length) return x;\r\n      x = z;\r\n      return stack;\r\n    };\r\n    stack.y = function(z) {\r\n      if (!arguments.length) return y;\r\n      y = z;\r\n      return stack;\r\n    };\r\n    stack.out = function(z) {\r\n      if (!arguments.length) return out;\r\n      out = z;\r\n      return stack;\r\n    };\r\n    return stack;\r\n  };\r\n  function d3_layout_stackX(d) {\r\n    return d.x;\r\n  }\r\n  function d3_layout_stackY(d) {\r\n    return d.y;\r\n  }\r\n  function d3_layout_stackOut(d, y0, y) {\r\n    d.y0 = y0;\r\n    d.y = y;\r\n  }\r\n  var d3_layout_stackOrders = d3.map({\r\n    \"inside-out\": function(data) {\r\n      var n = data.length, i, j, max = data.map(d3_layout_stackMaxIndex), sums = data.map(d3_layout_stackReduceSum), index = d3.range(n).sort(function(a, b) {\r\n        return max[a] - max[b];\r\n      }), top = 0, bottom = 0, tops = [], bottoms = [];\r\n      for (i = 0; i < n; ++i) {\r\n        j = index[i];\r\n        if (top < bottom) {\r\n          top += sums[j];\r\n          tops.push(j);\r\n        } else {\r\n          bottom += sums[j];\r\n          bottoms.push(j);\r\n        }\r\n      }\r\n      return bottoms.reverse().concat(tops);\r\n    },\r\n    reverse: function(data) {\r\n      return d3.range(data.length).reverse();\r\n    },\r\n    \"default\": d3_layout_stackOrderDefault\r\n  });\r\n  var d3_layout_stackOffsets = d3.map({\r\n    silhouette: function(data) {\r\n      var n = data.length, m = data[0].length, sums = [], max = 0, i, j, o, y0 = [];\r\n      for (j = 0; j < m; ++j) {\r\n        for (i = 0, o = 0; i < n; i++) o += data[i][j][1];\r\n        if (o > max) max = o;\r\n        sums.push(o);\r\n      }\r\n      for (j = 0; j < m; ++j) {\r\n        y0[j] = (max - sums[j]) / 2;\r\n      }\r\n      return y0;\r\n    },\r\n    wiggle: function(data) {\r\n      var n = data.length, x = data[0], m = x.length, i, j, k, s1, s2, s3, dx, o, o0, y0 = [];\r\n      y0[0] = o = o0 = 0;\r\n      for (j = 1; j < m; ++j) {\r\n        for (i = 0, s1 = 0; i < n; ++i) s1 += data[i][j][1];\r\n        for (i = 0, s2 = 0, dx = x[j][0] - x[j - 1][0]; i < n; ++i) {\r\n          for (k = 0, s3 = (data[i][j][1] - data[i][j - 1][1]) / (2 * dx); k < i; ++k) {\r\n            s3 += (data[k][j][1] - data[k][j - 1][1]) / dx;\r\n          }\r\n          s2 += s3 * data[i][j][1];\r\n        }\r\n        y0[j] = o -= s1 ? s2 / s1 * dx : 0;\r\n        if (o < o0) o0 = o;\r\n      }\r\n      for (j = 0; j < m; ++j) y0[j] -= o0;\r\n      return y0;\r\n    },\r\n    expand: function(data) {\r\n      var n = data.length, m = data[0].length, k = 1 / n, i, j, o, y0 = [];\r\n      for (j = 0; j < m; ++j) {\r\n        for (i = 0, o = 0; i < n; i++) o += data[i][j][1];\r\n        if (o) for (i = 0; i < n; i++) data[i][j][1] /= o; else for (i = 0; i < n; i++) data[i][j][1] = k;\r\n      }\r\n      for (j = 0; j < m; ++j) y0[j] = 0;\r\n      return y0;\r\n    },\r\n    zero: d3_layout_stackOffsetZero\r\n  });\r\n  function d3_layout_stackOrderDefault(data) {\r\n    return d3.range(data.length);\r\n  }\r\n  function d3_layout_stackOffsetZero(data) {\r\n    var j = -1, m = data[0].length, y0 = [];\r\n    while (++j < m) y0[j] = 0;\r\n    return y0;\r\n  }\r\n  function d3_layout_stackMaxIndex(array) {\r\n    var i = 1, j = 0, v = array[0][1], k, n = array.length;\r\n    for (;i < n; ++i) {\r\n      if ((k = array[i][1]) > v) {\r\n        j = i;\r\n        v = k;\r\n      }\r\n    }\r\n    return j;\r\n  }\r\n  function d3_layout_stackReduceSum(d) {\r\n    return d.reduce(d3_layout_stackSum, 0);\r\n  }\r\n  function d3_layout_stackSum(p, d) {\r\n    return p + d[1];\r\n  }\r\n  d3.layout.histogram = function() {\r\n    var frequency = true, valuer = Number, ranger = d3_layout_histogramRange, binner = d3_layout_histogramBinSturges;\r\n    function histogram(data, i) {\r\n      var bins = [], values = data.map(valuer, this), range = ranger.call(this, values, i), thresholds = binner.call(this, range, values, i), bin, i = -1, n = values.length, m = thresholds.length - 1, k = frequency ? 1 : 1 / n, x;\r\n      while (++i < m) {\r\n        bin = bins[i] = [];\r\n        bin.dx = thresholds[i + 1] - (bin.x = thresholds[i]);\r\n        bin.y = 0;\r\n      }\r\n      if (m > 0) {\r\n        i = -1;\r\n        while (++i < n) {\r\n          x = values[i];\r\n          if (x >= range[0] && x <= range[1]) {\r\n            bin = bins[d3.bisect(thresholds, x, 1, m) - 1];\r\n            bin.y += k;\r\n            bin.push(data[i]);\r\n          }\r\n        }\r\n      }\r\n      return bins;\r\n    }\r\n    histogram.value = function(x) {\r\n      if (!arguments.length) return valuer;\r\n      valuer = x;\r\n      return histogram;\r\n    };\r\n    histogram.range = function(x) {\r\n      if (!arguments.length) return ranger;\r\n      ranger = d3_functor(x);\r\n      return histogram;\r\n    };\r\n    histogram.bins = function(x) {\r\n      if (!arguments.length) return binner;\r\n      binner = typeof x === \"number\" ? function(range) {\r\n        return d3_layout_histogramBinFixed(range, x);\r\n      } : d3_functor(x);\r\n      return histogram;\r\n    };\r\n    histogram.frequency = function(x) {\r\n      if (!arguments.length) return frequency;\r\n      frequency = !!x;\r\n      return histogram;\r\n    };\r\n    return histogram;\r\n  };\r\n  function d3_layout_histogramBinSturges(range, values) {\r\n    return d3_layout_histogramBinFixed(range, Math.ceil(Math.log(values.length) / Math.LN2 + 1));\r\n  }\r\n  function d3_layout_histogramBinFixed(range, n) {\r\n    var x = -1, b = +range[0], m = (range[1] - b) / n, f = [];\r\n    while (++x <= n) f[x] = m * x + b;\r\n    return f;\r\n  }\r\n  function d3_layout_histogramRange(values) {\r\n    return [ d3.min(values), d3.max(values) ];\r\n  }\r\n  d3.layout.pack = function() {\r\n    var hierarchy = d3.layout.hierarchy().sort(d3_layout_packSort), padding = 0, size = [ 1, 1 ], radius;\r\n    function pack(d, i) {\r\n      var nodes = hierarchy.call(this, d, i), root = nodes[0], w = size[0], h = size[1], r = radius == null ? Math.sqrt : typeof radius === \"function\" ? radius : function() {\r\n        return radius;\r\n      };\r\n      root.x = root.y = 0;\r\n      d3_layout_hierarchyVisitAfter(root, function(d) {\r\n        d.r = +r(d.value);\r\n      });\r\n      d3_layout_hierarchyVisitAfter(root, d3_layout_packSiblings);\r\n      if (padding) {\r\n        var dr = padding * (radius ? 1 : Math.max(2 * root.r / w, 2 * root.r / h)) / 2;\r\n        d3_layout_hierarchyVisitAfter(root, function(d) {\r\n          d.r += dr;\r\n        });\r\n        d3_layout_hierarchyVisitAfter(root, d3_layout_packSiblings);\r\n        d3_layout_hierarchyVisitAfter(root, function(d) {\r\n          d.r -= dr;\r\n        });\r\n      }\r\n      d3_layout_packTransform(root, w / 2, h / 2, radius ? 1 : 1 / Math.max(2 * root.r / w, 2 * root.r / h));\r\n      return nodes;\r\n    }\r\n    pack.size = function(_) {\r\n      if (!arguments.length) return size;\r\n      size = _;\r\n      return pack;\r\n    };\r\n    pack.radius = function(_) {\r\n      if (!arguments.length) return radius;\r\n      radius = _ == null || typeof _ === \"function\" ? _ : +_;\r\n      return pack;\r\n    };\r\n    pack.padding = function(_) {\r\n      if (!arguments.length) return padding;\r\n      padding = +_;\r\n      return pack;\r\n    };\r\n    return d3_layout_hierarchyRebind(pack, hierarchy);\r\n  };\r\n  function d3_layout_packSort(a, b) {\r\n    return a.value - b.value;\r\n  }\r\n  function d3_layout_packInsert(a, b) {\r\n    var c = a._pack_next;\r\n    a._pack_next = b;\r\n    b._pack_prev = a;\r\n    b._pack_next = c;\r\n    c._pack_prev = b;\r\n  }\r\n  function d3_layout_packSplice(a, b) {\r\n    a._pack_next = b;\r\n    b._pack_prev = a;\r\n  }\r\n  function d3_layout_packIntersects(a, b) {\r\n    var dx = b.x - a.x, dy = b.y - a.y, dr = a.r + b.r;\r\n    return .999 * dr * dr > dx * dx + dy * dy;\r\n  }\r\n  function d3_layout_packSiblings(node) {\r\n    if (!(nodes = node.children) || !(n = nodes.length)) return;\r\n    var nodes, xMin = Infinity, xMax = -Infinity, yMin = Infinity, yMax = -Infinity, a, b, c, i, j, k, n;\r\n    function bound(node) {\r\n      xMin = Math.min(node.x - node.r, xMin);\r\n      xMax = Math.max(node.x + node.r, xMax);\r\n      yMin = Math.min(node.y - node.r, yMin);\r\n      yMax = Math.max(node.y + node.r, yMax);\r\n    }\r\n    nodes.forEach(d3_layout_packLink);\r\n    a = nodes[0];\r\n    a.x = -a.r;\r\n    a.y = 0;\r\n    bound(a);\r\n    if (n > 1) {\r\n      b = nodes[1];\r\n      b.x = b.r;\r\n      b.y = 0;\r\n      bound(b);\r\n      if (n > 2) {\r\n        c = nodes[2];\r\n        d3_layout_packPlace(a, b, c);\r\n        bound(c);\r\n        d3_layout_packInsert(a, c);\r\n        a._pack_prev = c;\r\n        d3_layout_packInsert(c, b);\r\n        b = a._pack_next;\r\n        for (i = 3; i < n; i++) {\r\n          d3_layout_packPlace(a, b, c = nodes[i]);\r\n          var isect = 0, s1 = 1, s2 = 1;\r\n          for (j = b._pack_next; j !== b; j = j._pack_next, s1++) {\r\n            if (d3_layout_packIntersects(j, c)) {\r\n              isect = 1;\r\n              break;\r\n            }\r\n          }\r\n          if (isect == 1) {\r\n            for (k = a._pack_prev; k !== j._pack_prev; k = k._pack_prev, s2++) {\r\n              if (d3_layout_packIntersects(k, c)) {\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (isect) {\r\n            if (s1 < s2 || s1 == s2 && b.r < a.r) d3_layout_packSplice(a, b = j); else d3_layout_packSplice(a = k, b);\r\n            i--;\r\n          } else {\r\n            d3_layout_packInsert(a, c);\r\n            b = c;\r\n            bound(c);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    var cx = (xMin + xMax) / 2, cy = (yMin + yMax) / 2, cr = 0;\r\n    for (i = 0; i < n; i++) {\r\n      c = nodes[i];\r\n      c.x -= cx;\r\n      c.y -= cy;\r\n      cr = Math.max(cr, c.r + Math.sqrt(c.x * c.x + c.y * c.y));\r\n    }\r\n    node.r = cr;\r\n    nodes.forEach(d3_layout_packUnlink);\r\n  }\r\n  function d3_layout_packLink(node) {\r\n    node._pack_next = node._pack_prev = node;\r\n  }\r\n  function d3_layout_packUnlink(node) {\r\n    delete node._pack_next;\r\n    delete node._pack_prev;\r\n  }\r\n  function d3_layout_packTransform(node, x, y, k) {\r\n    var children = node.children;\r\n    node.x = x += k * node.x;\r\n    node.y = y += k * node.y;\r\n    node.r *= k;\r\n    if (children) {\r\n      var i = -1, n = children.length;\r\n      while (++i < n) d3_layout_packTransform(children[i], x, y, k);\r\n    }\r\n  }\r\n  function d3_layout_packPlace(a, b, c) {\r\n    var db = a.r + c.r, dx = b.x - a.x, dy = b.y - a.y;\r\n    if (db && (dx || dy)) {\r\n      var da = b.r + c.r, dc = dx * dx + dy * dy;\r\n      da *= da;\r\n      db *= db;\r\n      var x = .5 + (db - da) / (2 * dc), y = Math.sqrt(Math.max(0, 2 * da * (db + dc) - (db -= dc) * db - da * da)) / (2 * dc);\r\n      c.x = a.x + x * dx + y * dy;\r\n      c.y = a.y + x * dy - y * dx;\r\n    } else {\r\n      c.x = a.x + db;\r\n      c.y = a.y;\r\n    }\r\n  }\r\n  d3.layout.tree = function() {\r\n    var hierarchy = d3.layout.hierarchy().sort(null).value(null), separation = d3_layout_treeSeparation, size = [ 1, 1 ], nodeSize = null;\r\n    function tree(d, i) {\r\n      var nodes = hierarchy.call(this, d, i), root0 = nodes[0], root1 = wrapTree(root0);\r\n      d3_layout_hierarchyVisitAfter(root1, firstWalk), root1.parent.m = -root1.z;\r\n      d3_layout_hierarchyVisitBefore(root1, secondWalk);\r\n      if (nodeSize) d3_layout_hierarchyVisitBefore(root0, sizeNode); else {\r\n        var left = root0, right = root0, bottom = root0;\r\n        d3_layout_hierarchyVisitBefore(root0, function(node) {\r\n          if (node.x < left.x) left = node;\r\n          if (node.x > right.x) right = node;\r\n          if (node.depth > bottom.depth) bottom = node;\r\n        });\r\n        var tx = separation(left, right) / 2 - left.x, kx = size[0] / (right.x + separation(right, left) / 2 + tx), ky = size[1] / (bottom.depth || 1);\r\n        d3_layout_hierarchyVisitBefore(root0, function(node) {\r\n          node.x = (node.x + tx) * kx;\r\n          node.y = node.depth * ky;\r\n        });\r\n      }\r\n      return nodes;\r\n    }\r\n    function wrapTree(root0) {\r\n      var root1 = {\r\n        A: null,\r\n        children: [ root0 ]\r\n      }, queue = [ root1 ], node1;\r\n      while ((node1 = queue.pop()) != null) {\r\n        for (var children = node1.children, child, i = 0, n = children.length; i < n; ++i) {\r\n          queue.push((children[i] = child = {\r\n            _: children[i],\r\n            parent: node1,\r\n            children: (child = children[i].children) && child.slice() || [],\r\n            A: null,\r\n            a: null,\r\n            z: 0,\r\n            m: 0,\r\n            c: 0,\r\n            s: 0,\r\n            t: null,\r\n            i: i\r\n          }).a = child);\r\n        }\r\n      }\r\n      return root1.children[0];\r\n    }\r\n    function firstWalk(v) {\r\n      var children = v.children, siblings = v.parent.children, w = v.i ? siblings[v.i - 1] : null;\r\n      if (children.length) {\r\n        d3_layout_treeShift(v);\r\n        var midpoint = (children[0].z + children[children.length - 1].z) / 2;\r\n        if (w) {\r\n          v.z = w.z + separation(v._, w._);\r\n          v.m = v.z - midpoint;\r\n        } else {\r\n          v.z = midpoint;\r\n        }\r\n      } else if (w) {\r\n        v.z = w.z + separation(v._, w._);\r\n      }\r\n      v.parent.A = apportion(v, w, v.parent.A || siblings[0]);\r\n    }\r\n    function secondWalk(v) {\r\n      v._.x = v.z + v.parent.m;\r\n      v.m += v.parent.m;\r\n    }\r\n    function apportion(v, w, ancestor) {\r\n      if (w) {\r\n        var vip = v, vop = v, vim = w, vom = vip.parent.children[0], sip = vip.m, sop = vop.m, sim = vim.m, som = vom.m, shift;\r\n        while (vim = d3_layout_treeRight(vim), vip = d3_layout_treeLeft(vip), vim && vip) {\r\n          vom = d3_layout_treeLeft(vom);\r\n          vop = d3_layout_treeRight(vop);\r\n          vop.a = v;\r\n          shift = vim.z + sim - vip.z - sip + separation(vim._, vip._);\r\n          if (shift > 0) {\r\n            d3_layout_treeMove(d3_layout_treeAncestor(vim, v, ancestor), v, shift);\r\n            sip += shift;\r\n            sop += shift;\r\n          }\r\n          sim += vim.m;\r\n          sip += vip.m;\r\n          som += vom.m;\r\n          sop += vop.m;\r\n        }\r\n        if (vim && !d3_layout_treeRight(vop)) {\r\n          vop.t = vim;\r\n          vop.m += sim - sop;\r\n        }\r\n        if (vip && !d3_layout_treeLeft(vom)) {\r\n          vom.t = vip;\r\n          vom.m += sip - som;\r\n          ancestor = v;\r\n        }\r\n      }\r\n      return ancestor;\r\n    }\r\n    function sizeNode(node) {\r\n      node.x *= size[0];\r\n      node.y = node.depth * size[1];\r\n    }\r\n    tree.separation = function(x) {\r\n      if (!arguments.length) return separation;\r\n      separation = x;\r\n      return tree;\r\n    };\r\n    tree.size = function(x) {\r\n      if (!arguments.length) return nodeSize ? null : size;\r\n      nodeSize = (size = x) == null ? sizeNode : null;\r\n      return tree;\r\n    };\r\n    tree.nodeSize = function(x) {\r\n      if (!arguments.length) return nodeSize ? size : null;\r\n      nodeSize = (size = x) == null ? null : sizeNode;\r\n      return tree;\r\n    };\r\n    return d3_layout_hierarchyRebind(tree, hierarchy);\r\n  };\r\n  function d3_layout_treeSeparation(a, b) {\r\n    return a.parent == b.parent ? 1 : 2;\r\n  }\r\n  function d3_layout_treeLeft(v) {\r\n    var children = v.children;\r\n    return children.length ? children[0] : v.t;\r\n  }\r\n  function d3_layout_treeRight(v) {\r\n    var children = v.children, n;\r\n    return (n = children.length) ? children[n - 1] : v.t;\r\n  }\r\n  function d3_layout_treeMove(wm, wp, shift) {\r\n    var change = shift / (wp.i - wm.i);\r\n    wp.c -= change;\r\n    wp.s += shift;\r\n    wm.c += change;\r\n    wp.z += shift;\r\n    wp.m += shift;\r\n  }\r\n  function d3_layout_treeShift(v) {\r\n    var shift = 0, change = 0, children = v.children, i = children.length, w;\r\n    while (--i >= 0) {\r\n      w = children[i];\r\n      w.z += shift;\r\n      w.m += shift;\r\n      shift += w.s + (change += w.c);\r\n    }\r\n  }\r\n  function d3_layout_treeAncestor(vim, v, ancestor) {\r\n    return vim.a.parent === v.parent ? vim.a : ancestor;\r\n  }\r\n  d3.layout.cluster = function() {\r\n    var hierarchy = d3.layout.hierarchy().sort(null).value(null), separation = d3_layout_treeSeparation, size = [ 1, 1 ], nodeSize = false;\r\n    function cluster(d, i) {\r\n      var nodes = hierarchy.call(this, d, i), root = nodes[0], previousNode, x = 0;\r\n      d3_layout_hierarchyVisitAfter(root, function(node) {\r\n        var children = node.children;\r\n        if (children && children.length) {\r\n          node.x = d3_layout_clusterX(children);\r\n          node.y = d3_layout_clusterY(children);\r\n        } else {\r\n          node.x = previousNode ? x += separation(node, previousNode) : 0;\r\n          node.y = 0;\r\n          previousNode = node;\r\n        }\r\n      });\r\n      var left = d3_layout_clusterLeft(root), right = d3_layout_clusterRight(root), x0 = left.x - separation(left, right) / 2, x1 = right.x + separation(right, left) / 2;\r\n      d3_layout_hierarchyVisitAfter(root, nodeSize ? function(node) {\r\n        node.x = (node.x - root.x) * size[0];\r\n        node.y = (root.y - node.y) * size[1];\r\n      } : function(node) {\r\n        node.x = (node.x - x0) / (x1 - x0) * size[0];\r\n        node.y = (1 - (root.y ? node.y / root.y : 1)) * size[1];\r\n      });\r\n      return nodes;\r\n    }\r\n    cluster.separation = function(x) {\r\n      if (!arguments.length) return separation;\r\n      separation = x;\r\n      return cluster;\r\n    };\r\n    cluster.size = function(x) {\r\n      if (!arguments.length) return nodeSize ? null : size;\r\n      nodeSize = (size = x) == null;\r\n      return cluster;\r\n    };\r\n    cluster.nodeSize = function(x) {\r\n      if (!arguments.length) return nodeSize ? size : null;\r\n      nodeSize = (size = x) != null;\r\n      return cluster;\r\n    };\r\n    return d3_layout_hierarchyRebind(cluster, hierarchy);\r\n  };\r\n  function d3_layout_clusterY(children) {\r\n    return 1 + d3.max(children, function(child) {\r\n      return child.y;\r\n    });\r\n  }\r\n  function d3_layout_clusterX(children) {\r\n    return children.reduce(function(x, child) {\r\n      return x + child.x;\r\n    }, 0) / children.length;\r\n  }\r\n  function d3_layout_clusterLeft(node) {\r\n    var children = node.children;\r\n    return children && children.length ? d3_layout_clusterLeft(children[0]) : node;\r\n  }\r\n  function d3_layout_clusterRight(node) {\r\n    var children = node.children, n;\r\n    return children && (n = children.length) ? d3_layout_clusterRight(children[n - 1]) : node;\r\n  }\r\n  d3.layout.treemap = function() {\r\n    var hierarchy = d3.layout.hierarchy(), round = Math.round, size = [ 1, 1 ], padding = null, pad = d3_layout_treemapPadNull, sticky = false, stickies, mode = \"squarify\", ratio = .5 * (1 + Math.sqrt(5));\r\n    function scale(children, k) {\r\n      var i = -1, n = children.length, child, area;\r\n      while (++i < n) {\r\n        area = (child = children[i]).value * (k < 0 ? 0 : k);\r\n        child.area = isNaN(area) || area <= 0 ? 0 : area;\r\n      }\r\n    }\r\n    function squarify(node) {\r\n      var children = node.children;\r\n      if (children && children.length) {\r\n        var rect = pad(node), row = [], remaining = children.slice(), child, best = Infinity, score, u = mode === \"slice\" ? rect.dx : mode === \"dice\" ? rect.dy : mode === \"slice-dice\" ? node.depth & 1 ? rect.dy : rect.dx : Math.min(rect.dx, rect.dy), n;\r\n        scale(remaining, rect.dx * rect.dy / node.value);\r\n        row.area = 0;\r\n        while ((n = remaining.length) > 0) {\r\n          row.push(child = remaining[n - 1]);\r\n          row.area += child.area;\r\n          if (mode !== \"squarify\" || (score = worst(row, u)) <= best) {\r\n            remaining.pop();\r\n            best = score;\r\n          } else {\r\n            row.area -= row.pop().area;\r\n            position(row, u, rect, false);\r\n            u = Math.min(rect.dx, rect.dy);\r\n            row.length = row.area = 0;\r\n            best = Infinity;\r\n          }\r\n        }\r\n        if (row.length) {\r\n          position(row, u, rect, true);\r\n          row.length = row.area = 0;\r\n        }\r\n        children.forEach(squarify);\r\n      }\r\n    }\r\n    function stickify(node) {\r\n      var children = node.children;\r\n      if (children && children.length) {\r\n        var rect = pad(node), remaining = children.slice(), child, row = [];\r\n        scale(remaining, rect.dx * rect.dy / node.value);\r\n        row.area = 0;\r\n        while (child = remaining.pop()) {\r\n          row.push(child);\r\n          row.area += child.area;\r\n          if (child.z != null) {\r\n            position(row, child.z ? rect.dx : rect.dy, rect, !remaining.length);\r\n            row.length = row.area = 0;\r\n          }\r\n        }\r\n        children.forEach(stickify);\r\n      }\r\n    }\r\n    function worst(row, u) {\r\n      var s = row.area, r, rmax = 0, rmin = Infinity, i = -1, n = row.length;\r\n      while (++i < n) {\r\n        if (!(r = row[i].area)) continue;\r\n        if (r < rmin) rmin = r;\r\n        if (r > rmax) rmax = r;\r\n      }\r\n      s *= s;\r\n      u *= u;\r\n      return s ? Math.max(u * rmax * ratio / s, s / (u * rmin * ratio)) : Infinity;\r\n    }\r\n    function position(row, u, rect, flush) {\r\n      var i = -1, n = row.length, x = rect.x, y = rect.y, v = u ? round(row.area / u) : 0, o;\r\n      if (u == rect.dx) {\r\n        if (flush || v > rect.dy) v = rect.dy;\r\n        while (++i < n) {\r\n          o = row[i];\r\n          o.x = x;\r\n          o.y = y;\r\n          o.dy = v;\r\n          x += o.dx = Math.min(rect.x + rect.dx - x, v ? round(o.area / v) : 0);\r\n        }\r\n        o.z = true;\r\n        o.dx += rect.x + rect.dx - x;\r\n        rect.y += v;\r\n        rect.dy -= v;\r\n      } else {\r\n        if (flush || v > rect.dx) v = rect.dx;\r\n        while (++i < n) {\r\n          o = row[i];\r\n          o.x = x;\r\n          o.y = y;\r\n          o.dx = v;\r\n          y += o.dy = Math.min(rect.y + rect.dy - y, v ? round(o.area / v) : 0);\r\n        }\r\n        o.z = false;\r\n        o.dy += rect.y + rect.dy - y;\r\n        rect.x += v;\r\n        rect.dx -= v;\r\n      }\r\n    }\r\n    function treemap(d) {\r\n      var nodes = stickies || hierarchy(d), root = nodes[0];\r\n      root.x = root.y = 0;\r\n      if (root.value) root.dx = size[0], root.dy = size[1]; else root.dx = root.dy = 0;\r\n      if (stickies) hierarchy.revalue(root);\r\n      scale([ root ], root.dx * root.dy / root.value);\r\n      (stickies ? stickify : squarify)(root);\r\n      if (sticky) stickies = nodes;\r\n      return nodes;\r\n    }\r\n    treemap.size = function(x) {\r\n      if (!arguments.length) return size;\r\n      size = x;\r\n      return treemap;\r\n    };\r\n    treemap.padding = function(x) {\r\n      if (!arguments.length) return padding;\r\n      function padFunction(node) {\r\n        var p = x.call(treemap, node, node.depth);\r\n        return p == null ? d3_layout_treemapPadNull(node) : d3_layout_treemapPad(node, typeof p === \"number\" ? [ p, p, p, p ] : p);\r\n      }\r\n      function padConstant(node) {\r\n        return d3_layout_treemapPad(node, x);\r\n      }\r\n      var type;\r\n      pad = (padding = x) == null ? d3_layout_treemapPadNull : (type = typeof x) === \"function\" ? padFunction : type === \"number\" ? (x = [ x, x, x, x ], \r\n      padConstant) : padConstant;\r\n      return treemap;\r\n    };\r\n    treemap.round = function(x) {\r\n      if (!arguments.length) return round != Number;\r\n      round = x ? Math.round : Number;\r\n      return treemap;\r\n    };\r\n    treemap.sticky = function(x) {\r\n      if (!arguments.length) return sticky;\r\n      sticky = x;\r\n      stickies = null;\r\n      return treemap;\r\n    };\r\n    treemap.ratio = function(x) {\r\n      if (!arguments.length) return ratio;\r\n      ratio = x;\r\n      return treemap;\r\n    };\r\n    treemap.mode = function(x) {\r\n      if (!arguments.length) return mode;\r\n      mode = x + \"\";\r\n      return treemap;\r\n    };\r\n    return d3_layout_hierarchyRebind(treemap, hierarchy);\r\n  };\r\n  function d3_layout_treemapPadNull(node) {\r\n    return {\r\n      x: node.x,\r\n      y: node.y,\r\n      dx: node.dx,\r\n      dy: node.dy\r\n    };\r\n  }\r\n  function d3_layout_treemapPad(node, padding) {\r\n    var x = node.x + padding[3], y = node.y + padding[0], dx = node.dx - padding[1] - padding[3], dy = node.dy - padding[0] - padding[2];\r\n    if (dx < 0) {\r\n      x += dx / 2;\r\n      dx = 0;\r\n    }\r\n    if (dy < 0) {\r\n      y += dy / 2;\r\n      dy = 0;\r\n    }\r\n    return {\r\n      x: x,\r\n      y: y,\r\n      dx: dx,\r\n      dy: dy\r\n    };\r\n  }\r\n  d3.random = {\r\n    normal: function(µ, σ) {\r\n      var n = arguments.length;\r\n      if (n < 2) σ = 1;\r\n      if (n < 1) µ = 0;\r\n      return function() {\r\n        var x, y, r;\r\n        do {\r\n          x = Math.random() * 2 - 1;\r\n          y = Math.random() * 2 - 1;\r\n          r = x * x + y * y;\r\n        } while (!r || r > 1);\r\n        return µ + σ * x * Math.sqrt(-2 * Math.log(r) / r);\r\n      };\r\n    },\r\n    logNormal: function() {\r\n      var random = d3.random.normal.apply(d3, arguments);\r\n      return function() {\r\n        return Math.exp(random());\r\n      };\r\n    },\r\n    bates: function(m) {\r\n      var random = d3.random.irwinHall(m);\r\n      return function() {\r\n        return random() / m;\r\n      };\r\n    },\r\n    irwinHall: function(m) {\r\n      return function() {\r\n        for (var s = 0, j = 0; j < m; j++) s += Math.random();\r\n        return s;\r\n      };\r\n    }\r\n  };\r\n  d3.scale = {};\r\n  function d3_scaleExtent(domain) {\r\n    var start = domain[0], stop = domain[domain.length - 1];\r\n    return start < stop ? [ start, stop ] : [ stop, start ];\r\n  }\r\n  function d3_scaleRange(scale) {\r\n    return scale.rangeExtent ? scale.rangeExtent() : d3_scaleExtent(scale.range());\r\n  }\r\n  function d3_scale_bilinear(domain, range, uninterpolate, interpolate) {\r\n    var u = uninterpolate(domain[0], domain[1]), i = interpolate(range[0], range[1]);\r\n    return function(x) {\r\n      return i(u(x));\r\n    };\r\n  }\r\n  function d3_scale_nice(domain, nice) {\r\n    var i0 = 0, i1 = domain.length - 1, x0 = domain[i0], x1 = domain[i1], dx;\r\n    if (x1 < x0) {\r\n      dx = i0, i0 = i1, i1 = dx;\r\n      dx = x0, x0 = x1, x1 = dx;\r\n    }\r\n    domain[i0] = nice.floor(x0);\r\n    domain[i1] = nice.ceil(x1);\r\n    return domain;\r\n  }\r\n  function d3_scale_niceStep(step) {\r\n    return step ? {\r\n      floor: function(x) {\r\n        return Math.floor(x / step) * step;\r\n      },\r\n      ceil: function(x) {\r\n        return Math.ceil(x / step) * step;\r\n      }\r\n    } : d3_scale_niceIdentity;\r\n  }\r\n  var d3_scale_niceIdentity = {\r\n    floor: d3_identity,\r\n    ceil: d3_identity\r\n  };\r\n  function d3_scale_polylinear(domain, range, uninterpolate, interpolate) {\r\n    var u = [], i = [], j = 0, k = Math.min(domain.length, range.length) - 1;\r\n    if (domain[k] < domain[0]) {\r\n      domain = domain.slice().reverse();\r\n      range = range.slice().reverse();\r\n    }\r\n    while (++j <= k) {\r\n      u.push(uninterpolate(domain[j - 1], domain[j]));\r\n      i.push(interpolate(range[j - 1], range[j]));\r\n    }\r\n    return function(x) {\r\n      var j = d3.bisect(domain, x, 1, k) - 1;\r\n      return i[j](u[j](x));\r\n    };\r\n  }\r\n  d3.scale.linear = function() {\r\n    return d3_scale_linear([ 0, 1 ], [ 0, 1 ], d3_interpolate, false);\r\n  };\r\n  function d3_scale_linear(domain, range, interpolate, clamp) {\r\n    var output, input;\r\n    function rescale() {\r\n      var linear = Math.min(domain.length, range.length) > 2 ? d3_scale_polylinear : d3_scale_bilinear, uninterpolate = clamp ? d3_uninterpolateClamp : d3_uninterpolateNumber;\r\n      output = linear(domain, range, uninterpolate, interpolate);\r\n      input = linear(range, domain, uninterpolate, d3_interpolate);\r\n      return scale;\r\n    }\r\n    function scale(x) {\r\n      return output(x);\r\n    }\r\n    scale.invert = function(y) {\r\n      return input(y);\r\n    };\r\n    scale.domain = function(x) {\r\n      if (!arguments.length) return domain;\r\n      domain = x.map(Number);\r\n      return rescale();\r\n    };\r\n    scale.range = function(x) {\r\n      if (!arguments.length) return range;\r\n      range = x;\r\n      return rescale();\r\n    };\r\n    scale.rangeRound = function(x) {\r\n      return scale.range(x).interpolate(d3_interpolateRound);\r\n    };\r\n    scale.clamp = function(x) {\r\n      if (!arguments.length) return clamp;\r\n      clamp = x;\r\n      return rescale();\r\n    };\r\n    scale.interpolate = function(x) {\r\n      if (!arguments.length) return interpolate;\r\n      interpolate = x;\r\n      return rescale();\r\n    };\r\n    scale.ticks = function(m) {\r\n      return d3_scale_linearTicks(domain, m);\r\n    };\r\n    scale.tickFormat = function(m, format) {\r\n      return d3_scale_linearTickFormat(domain, m, format);\r\n    };\r\n    scale.nice = function(m) {\r\n      d3_scale_linearNice(domain, m);\r\n      return rescale();\r\n    };\r\n    scale.copy = function() {\r\n      return d3_scale_linear(domain, range, interpolate, clamp);\r\n    };\r\n    return rescale();\r\n  }\r\n  function d3_scale_linearRebind(scale, linear) {\r\n    return d3.rebind(scale, linear, \"range\", \"rangeRound\", \"interpolate\", \"clamp\");\r\n  }\r\n  function d3_scale_linearNice(domain, m) {\r\n    d3_scale_nice(domain, d3_scale_niceStep(d3_scale_linearTickRange(domain, m)[2]));\r\n    d3_scale_nice(domain, d3_scale_niceStep(d3_scale_linearTickRange(domain, m)[2]));\r\n    return domain;\r\n  }\r\n  function d3_scale_linearTickRange(domain, m) {\r\n    if (m == null) m = 10;\r\n    var extent = d3_scaleExtent(domain), span = extent[1] - extent[0], step = Math.pow(10, Math.floor(Math.log(span / m) / Math.LN10)), err = m / span * step;\r\n    if (err <= .15) step *= 10; else if (err <= .35) step *= 5; else if (err <= .75) step *= 2;\r\n    extent[0] = Math.ceil(extent[0] / step) * step;\r\n    extent[1] = Math.floor(extent[1] / step) * step + step * .5;\r\n    extent[2] = step;\r\n    return extent;\r\n  }\r\n  function d3_scale_linearTicks(domain, m) {\r\n    return d3.range.apply(d3, d3_scale_linearTickRange(domain, m));\r\n  }\r\n  function d3_scale_linearTickFormat(domain, m, format) {\r\n    var range = d3_scale_linearTickRange(domain, m);\r\n    if (format) {\r\n      var match = d3_format_re.exec(format);\r\n      match.shift();\r\n      if (match[8] === \"s\") {\r\n        var prefix = d3.formatPrefix(Math.max(abs(range[0]), abs(range[1])));\r\n        if (!match[7]) match[7] = \".\" + d3_scale_linearPrecision(prefix.scale(range[2]));\r\n        match[8] = \"f\";\r\n        format = d3.format(match.join(\"\"));\r\n        return function(d) {\r\n          return format(prefix.scale(d)) + prefix.symbol;\r\n        };\r\n      }\r\n      if (!match[7]) match[7] = \".\" + d3_scale_linearFormatPrecision(match[8], range);\r\n      format = match.join(\"\");\r\n    } else {\r\n      format = \",.\" + d3_scale_linearPrecision(range[2]) + \"f\";\r\n    }\r\n    return d3.format(format);\r\n  }\r\n  var d3_scale_linearFormatSignificant = {\r\n    s: 1,\r\n    g: 1,\r\n    p: 1,\r\n    r: 1,\r\n    e: 1\r\n  };\r\n  function d3_scale_linearPrecision(value) {\r\n    return -Math.floor(Math.log(value) / Math.LN10 + .01);\r\n  }\r\n  function d3_scale_linearFormatPrecision(type, range) {\r\n    var p = d3_scale_linearPrecision(range[2]);\r\n    return type in d3_scale_linearFormatSignificant ? Math.abs(p - d3_scale_linearPrecision(Math.max(abs(range[0]), abs(range[1])))) + +(type !== \"e\") : p - (type === \"%\") * 2;\r\n  }\r\n  d3.scale.log = function() {\r\n    return d3_scale_log(d3.scale.linear().domain([ 0, 1 ]), 10, true, [ 1, 10 ]);\r\n  };\r\n  function d3_scale_log(linear, base, positive, domain) {\r\n    function log(x) {\r\n      return (positive ? Math.log(x < 0 ? 0 : x) : -Math.log(x > 0 ? 0 : -x)) / Math.log(base);\r\n    }\r\n    function pow(x) {\r\n      return positive ? Math.pow(base, x) : -Math.pow(base, -x);\r\n    }\r\n    function scale(x) {\r\n      return linear(log(x));\r\n    }\r\n    scale.invert = function(x) {\r\n      return pow(linear.invert(x));\r\n    };\r\n    scale.domain = function(x) {\r\n      if (!arguments.length) return domain;\r\n      positive = x[0] >= 0;\r\n      linear.domain((domain = x.map(Number)).map(log));\r\n      return scale;\r\n    };\r\n    scale.base = function(_) {\r\n      if (!arguments.length) return base;\r\n      base = +_;\r\n      linear.domain(domain.map(log));\r\n      return scale;\r\n    };\r\n    scale.nice = function() {\r\n      var niced = d3_scale_nice(domain.map(log), positive ? Math : d3_scale_logNiceNegative);\r\n      linear.domain(niced);\r\n      domain = niced.map(pow);\r\n      return scale;\r\n    };\r\n    scale.ticks = function() {\r\n      var extent = d3_scaleExtent(domain), ticks = [], u = extent[0], v = extent[1], i = Math.floor(log(u)), j = Math.ceil(log(v)), n = base % 1 ? 2 : base;\r\n      if (isFinite(j - i)) {\r\n        if (positive) {\r\n          for (;i < j; i++) for (var k = 1; k < n; k++) ticks.push(pow(i) * k);\r\n          ticks.push(pow(i));\r\n        } else {\r\n          ticks.push(pow(i));\r\n          for (;i++ < j; ) for (var k = n - 1; k > 0; k--) ticks.push(pow(i) * k);\r\n        }\r\n        for (i = 0; ticks[i] < u; i++) {}\r\n        for (j = ticks.length; ticks[j - 1] > v; j--) {}\r\n        ticks = ticks.slice(i, j);\r\n      }\r\n      return ticks;\r\n    };\r\n    scale.tickFormat = function(n, format) {\r\n      if (!arguments.length) return d3_scale_logFormat;\r\n      if (arguments.length < 2) format = d3_scale_logFormat; else if (typeof format !== \"function\") format = d3.format(format);\r\n      var k = Math.max(1, base * n / scale.ticks().length);\r\n      return function(d) {\r\n        var i = d / pow(Math.round(log(d)));\r\n        if (i * base < base - .5) i *= base;\r\n        return i <= k ? format(d) : \"\";\r\n      };\r\n    };\r\n    scale.copy = function() {\r\n      return d3_scale_log(linear.copy(), base, positive, domain);\r\n    };\r\n    return d3_scale_linearRebind(scale, linear);\r\n  }\r\n  var d3_scale_logFormat = d3.format(\".0e\"), d3_scale_logNiceNegative = {\r\n    floor: function(x) {\r\n      return -Math.ceil(-x);\r\n    },\r\n    ceil: function(x) {\r\n      return -Math.floor(-x);\r\n    }\r\n  };\r\n  d3.scale.pow = function() {\r\n    return d3_scale_pow(d3.scale.linear(), 1, [ 0, 1 ]);\r\n  };\r\n  function d3_scale_pow(linear, exponent, domain) {\r\n    var powp = d3_scale_powPow(exponent), powb = d3_scale_powPow(1 / exponent);\r\n    function scale(x) {\r\n      return linear(powp(x));\r\n    }\r\n    scale.invert = function(x) {\r\n      return powb(linear.invert(x));\r\n    };\r\n    scale.domain = function(x) {\r\n      if (!arguments.length) return domain;\r\n      linear.domain((domain = x.map(Number)).map(powp));\r\n      return scale;\r\n    };\r\n    scale.ticks = function(m) {\r\n      return d3_scale_linearTicks(domain, m);\r\n    };\r\n    scale.tickFormat = function(m, format) {\r\n      return d3_scale_linearTickFormat(domain, m, format);\r\n    };\r\n    scale.nice = function(m) {\r\n      return scale.domain(d3_scale_linearNice(domain, m));\r\n    };\r\n    scale.exponent = function(x) {\r\n      if (!arguments.length) return exponent;\r\n      powp = d3_scale_powPow(exponent = x);\r\n      powb = d3_scale_powPow(1 / exponent);\r\n      linear.domain(domain.map(powp));\r\n      return scale;\r\n    };\r\n    scale.copy = function() {\r\n      return d3_scale_pow(linear.copy(), exponent, domain);\r\n    };\r\n    return d3_scale_linearRebind(scale, linear);\r\n  }\r\n  function d3_scale_powPow(e) {\r\n    return function(x) {\r\n      return x < 0 ? -Math.pow(-x, e) : Math.pow(x, e);\r\n    };\r\n  }\r\n  d3.scale.sqrt = function() {\r\n    return d3.scale.pow().exponent(.5);\r\n  };\r\n  d3.scale.ordinal = function() {\r\n    return d3_scale_ordinal([], {\r\n      t: \"range\",\r\n      a: [ [] ]\r\n    });\r\n  };\r\n  function d3_scale_ordinal(domain, ranger) {\r\n    var index, range, rangeBand;\r\n    function scale(x) {\r\n      return range[((index.get(x) || (ranger.t === \"range\" ? index.set(x, domain.push(x)) : NaN)) - 1) % range.length];\r\n    }\r\n    function steps(start, step) {\r\n      return d3.range(domain.length).map(function(i) {\r\n        return start + step * i;\r\n      });\r\n    }\r\n    scale.domain = function(x) {\r\n      if (!arguments.length) return domain;\r\n      domain = [];\r\n      index = new d3_Map();\r\n      var i = -1, n = x.length, xi;\r\n      while (++i < n) if (!index.has(xi = x[i])) index.set(xi, domain.push(xi));\r\n      return scale[ranger.t].apply(scale, ranger.a);\r\n    };\r\n    scale.range = function(x) {\r\n      if (!arguments.length) return range;\r\n      range = x;\r\n      rangeBand = 0;\r\n      ranger = {\r\n        t: \"range\",\r\n        a: arguments\r\n      };\r\n      return scale;\r\n    };\r\n    scale.rangePoints = function(x, padding) {\r\n      if (arguments.length < 2) padding = 0;\r\n      var start = x[0], stop = x[1], step = domain.length < 2 ? (start = (start + stop) / 2, \r\n      0) : (stop - start) / (domain.length - 1 + padding);\r\n      range = steps(start + step * padding / 2, step);\r\n      rangeBand = 0;\r\n      ranger = {\r\n        t: \"rangePoints\",\r\n        a: arguments\r\n      };\r\n      return scale;\r\n    };\r\n    scale.rangeRoundPoints = function(x, padding) {\r\n      if (arguments.length < 2) padding = 0;\r\n      var start = x[0], stop = x[1], step = domain.length < 2 ? (start = stop = Math.round((start + stop) / 2), \r\n      0) : (stop - start) / (domain.length - 1 + padding) | 0;\r\n      range = steps(start + Math.round(step * padding / 2 + (stop - start - (domain.length - 1 + padding) * step) / 2), step);\r\n      rangeBand = 0;\r\n      ranger = {\r\n        t: \"rangeRoundPoints\",\r\n        a: arguments\r\n      };\r\n      return scale;\r\n    };\r\n    scale.rangeBands = function(x, padding, outerPadding) {\r\n      if (arguments.length < 2) padding = 0;\r\n      if (arguments.length < 3) outerPadding = padding;\r\n      var reverse = x[1] < x[0], start = x[reverse - 0], stop = x[1 - reverse], step = (stop - start) / (domain.length - padding + 2 * outerPadding);\r\n      range = steps(start + step * outerPadding, step);\r\n      if (reverse) range.reverse();\r\n      rangeBand = step * (1 - padding);\r\n      ranger = {\r\n        t: \"rangeBands\",\r\n        a: arguments\r\n      };\r\n      return scale;\r\n    };\r\n    scale.rangeRoundBands = function(x, padding, outerPadding) {\r\n      if (arguments.length < 2) padding = 0;\r\n      if (arguments.length < 3) outerPadding = padding;\r\n      var reverse = x[1] < x[0], start = x[reverse - 0], stop = x[1 - reverse], step = Math.floor((stop - start) / (domain.length - padding + 2 * outerPadding));\r\n      range = steps(start + Math.round((stop - start - (domain.length - padding) * step) / 2), step);\r\n      if (reverse) range.reverse();\r\n      rangeBand = Math.round(step * (1 - padding));\r\n      ranger = {\r\n        t: \"rangeRoundBands\",\r\n        a: arguments\r\n      };\r\n      return scale;\r\n    };\r\n    scale.rangeBand = function() {\r\n      return rangeBand;\r\n    };\r\n    scale.rangeExtent = function() {\r\n      return d3_scaleExtent(ranger.a[0]);\r\n    };\r\n    scale.copy = function() {\r\n      return d3_scale_ordinal(domain, ranger);\r\n    };\r\n    return scale.domain(domain);\r\n  }\r\n  d3.scale.category10 = function() {\r\n    return d3.scale.ordinal().range(d3_category10);\r\n  };\r\n  d3.scale.category20 = function() {\r\n    return d3.scale.ordinal().range(d3_category20);\r\n  };\r\n  d3.scale.category20b = function() {\r\n    return d3.scale.ordinal().range(d3_category20b);\r\n  };\r\n  d3.scale.category20c = function() {\r\n    return d3.scale.ordinal().range(d3_category20c);\r\n  };\r\n  var d3_category10 = [ 2062260, 16744206, 2924588, 14034728, 9725885, 9197131, 14907330, 8355711, 12369186, 1556175 ].map(d3_rgbString);\r\n  var d3_category20 = [ 2062260, 11454440, 16744206, 16759672, 2924588, 10018698, 14034728, 16750742, 9725885, 12955861, 9197131, 12885140, 14907330, 16234194, 8355711, 13092807, 12369186, 14408589, 1556175, 10410725 ].map(d3_rgbString);\r\n  var d3_category20b = [ 3750777, 5395619, 7040719, 10264286, 6519097, 9216594, 11915115, 13556636, 9202993, 12426809, 15186514, 15190932, 8666169, 11356490, 14049643, 15177372, 8077683, 10834324, 13528509, 14589654 ].map(d3_rgbString);\r\n  var d3_category20c = [ 3244733, 7057110, 10406625, 13032431, 15095053, 16616764, 16625259, 16634018, 3253076, 7652470, 10607003, 13101504, 7695281, 10394312, 12369372, 14342891, 6513507, 9868950, 12434877, 14277081 ].map(d3_rgbString);\r\n  d3.scale.quantile = function() {\r\n    return d3_scale_quantile([], []);\r\n  };\r\n  function d3_scale_quantile(domain, range) {\r\n    var thresholds;\r\n    function rescale() {\r\n      var k = 0, q = range.length;\r\n      thresholds = [];\r\n      while (++k < q) thresholds[k - 1] = d3.quantile(domain, k / q);\r\n      return scale;\r\n    }\r\n    function scale(x) {\r\n      if (!isNaN(x = +x)) return range[d3.bisect(thresholds, x)];\r\n    }\r\n    scale.domain = function(x) {\r\n      if (!arguments.length) return domain;\r\n      domain = x.map(d3_number).filter(d3_numeric).sort(d3_ascending);\r\n      return rescale();\r\n    };\r\n    scale.range = function(x) {\r\n      if (!arguments.length) return range;\r\n      range = x;\r\n      return rescale();\r\n    };\r\n    scale.quantiles = function() {\r\n      return thresholds;\r\n    };\r\n    scale.invertExtent = function(y) {\r\n      y = range.indexOf(y);\r\n      return y < 0 ? [ NaN, NaN ] : [ y > 0 ? thresholds[y - 1] : domain[0], y < thresholds.length ? thresholds[y] : domain[domain.length - 1] ];\r\n    };\r\n    scale.copy = function() {\r\n      return d3_scale_quantile(domain, range);\r\n    };\r\n    return rescale();\r\n  }\r\n  d3.scale.quantize = function() {\r\n    return d3_scale_quantize(0, 1, [ 0, 1 ]);\r\n  };\r\n  function d3_scale_quantize(x0, x1, range) {\r\n    var kx, i;\r\n    function scale(x) {\r\n      return range[Math.max(0, Math.min(i, Math.floor(kx * (x - x0))))];\r\n    }\r\n    function rescale() {\r\n      kx = range.length / (x1 - x0);\r\n      i = range.length - 1;\r\n      return scale;\r\n    }\r\n    scale.domain = function(x) {\r\n      if (!arguments.length) return [ x0, x1 ];\r\n      x0 = +x[0];\r\n      x1 = +x[x.length - 1];\r\n      return rescale();\r\n    };\r\n    scale.range = function(x) {\r\n      if (!arguments.length) return range;\r\n      range = x;\r\n      return rescale();\r\n    };\r\n    scale.invertExtent = function(y) {\r\n      y = range.indexOf(y);\r\n      y = y < 0 ? NaN : y / kx + x0;\r\n      return [ y, y + 1 / kx ];\r\n    };\r\n    scale.copy = function() {\r\n      return d3_scale_quantize(x0, x1, range);\r\n    };\r\n    return rescale();\r\n  }\r\n  d3.scale.threshold = function() {\r\n    return d3_scale_threshold([ .5 ], [ 0, 1 ]);\r\n  };\r\n  function d3_scale_threshold(domain, range) {\r\n    function scale(x) {\r\n      if (x <= x) return range[d3.bisect(domain, x)];\r\n    }\r\n    scale.domain = function(_) {\r\n      if (!arguments.length) return domain;\r\n      domain = _;\r\n      return scale;\r\n    };\r\n    scale.range = function(_) {\r\n      if (!arguments.length) return range;\r\n      range = _;\r\n      return scale;\r\n    };\r\n    scale.invertExtent = function(y) {\r\n      y = range.indexOf(y);\r\n      return [ domain[y - 1], domain[y] ];\r\n    };\r\n    scale.copy = function() {\r\n      return d3_scale_threshold(domain, range);\r\n    };\r\n    return scale;\r\n  }\r\n  d3.scale.identity = function() {\r\n    return d3_scale_identity([ 0, 1 ]);\r\n  };\r\n  function d3_scale_identity(domain) {\r\n    function identity(x) {\r\n      return +x;\r\n    }\r\n    identity.invert = identity;\r\n    identity.domain = identity.range = function(x) {\r\n      if (!arguments.length) return domain;\r\n      domain = x.map(identity);\r\n      return identity;\r\n    };\r\n    identity.ticks = function(m) {\r\n      return d3_scale_linearTicks(domain, m);\r\n    };\r\n    identity.tickFormat = function(m, format) {\r\n      return d3_scale_linearTickFormat(domain, m, format);\r\n    };\r\n    identity.copy = function() {\r\n      return d3_scale_identity(domain);\r\n    };\r\n    return identity;\r\n  }\r\n  d3.svg = {};\r\n  function d3_zero() {\r\n    return 0;\r\n  }\r\n  d3.svg.arc = function() {\r\n    var innerRadius = d3_svg_arcInnerRadius, outerRadius = d3_svg_arcOuterRadius, cornerRadius = d3_zero, padRadius = d3_svg_arcAuto, startAngle = d3_svg_arcStartAngle, endAngle = d3_svg_arcEndAngle, padAngle = d3_svg_arcPadAngle;\r\n    function arc() {\r\n      var r0 = Math.max(0, +innerRadius.apply(this, arguments)), r1 = Math.max(0, +outerRadius.apply(this, arguments)), a0 = startAngle.apply(this, arguments) - halfπ, a1 = endAngle.apply(this, arguments) - halfπ, da = Math.abs(a1 - a0), cw = a0 > a1 ? 0 : 1;\r\n      if (r1 < r0) rc = r1, r1 = r0, r0 = rc;\r\n      if (da >= τε) return circleSegment(r1, cw) + (r0 ? circleSegment(r0, 1 - cw) : \"\") + \"Z\";\r\n      var rc, cr, rp, ap, p0 = 0, p1 = 0, x0, y0, x1, y1, x2, y2, x3, y3, path = [];\r\n      if (ap = (+padAngle.apply(this, arguments) || 0) / 2) {\r\n        rp = padRadius === d3_svg_arcAuto ? Math.sqrt(r0 * r0 + r1 * r1) : +padRadius.apply(this, arguments);\r\n        if (!cw) p1 *= -1;\r\n        if (r1) p1 = d3_asin(rp / r1 * Math.sin(ap));\r\n        if (r0) p0 = d3_asin(rp / r0 * Math.sin(ap));\r\n      }\r\n      if (r1) {\r\n        x0 = r1 * Math.cos(a0 + p1);\r\n        y0 = r1 * Math.sin(a0 + p1);\r\n        x1 = r1 * Math.cos(a1 - p1);\r\n        y1 = r1 * Math.sin(a1 - p1);\r\n        var l1 = Math.abs(a1 - a0 - 2 * p1) <= π ? 0 : 1;\r\n        if (p1 && d3_svg_arcSweep(x0, y0, x1, y1) === cw ^ l1) {\r\n          var h1 = (a0 + a1) / 2;\r\n          x0 = r1 * Math.cos(h1);\r\n          y0 = r1 * Math.sin(h1);\r\n          x1 = y1 = null;\r\n        }\r\n      } else {\r\n        x0 = y0 = 0;\r\n      }\r\n      if (r0) {\r\n        x2 = r0 * Math.cos(a1 - p0);\r\n        y2 = r0 * Math.sin(a1 - p0);\r\n        x3 = r0 * Math.cos(a0 + p0);\r\n        y3 = r0 * Math.sin(a0 + p0);\r\n        var l0 = Math.abs(a0 - a1 + 2 * p0) <= π ? 0 : 1;\r\n        if (p0 && d3_svg_arcSweep(x2, y2, x3, y3) === 1 - cw ^ l0) {\r\n          var h0 = (a0 + a1) / 2;\r\n          x2 = r0 * Math.cos(h0);\r\n          y2 = r0 * Math.sin(h0);\r\n          x3 = y3 = null;\r\n        }\r\n      } else {\r\n        x2 = y2 = 0;\r\n      }\r\n      if (da > ε && (rc = Math.min(Math.abs(r1 - r0) / 2, +cornerRadius.apply(this, arguments))) > .001) {\r\n        cr = r0 < r1 ^ cw ? 0 : 1;\r\n        var rc1 = rc, rc0 = rc;\r\n        if (da < π) {\r\n          var oc = x3 == null ? [ x2, y2 ] : x1 == null ? [ x0, y0 ] : d3_geom_polygonIntersect([ x0, y0 ], [ x3, y3 ], [ x1, y1 ], [ x2, y2 ]), ax = x0 - oc[0], ay = y0 - oc[1], bx = x1 - oc[0], by = y1 - oc[1], kc = 1 / Math.sin(Math.acos((ax * bx + ay * by) / (Math.sqrt(ax * ax + ay * ay) * Math.sqrt(bx * bx + by * by))) / 2), lc = Math.sqrt(oc[0] * oc[0] + oc[1] * oc[1]);\r\n          rc0 = Math.min(rc, (r0 - lc) / (kc - 1));\r\n          rc1 = Math.min(rc, (r1 - lc) / (kc + 1));\r\n        }\r\n        if (x1 != null) {\r\n          var t30 = d3_svg_arcCornerTangents(x3 == null ? [ x2, y2 ] : [ x3, y3 ], [ x0, y0 ], r1, rc1, cw), t12 = d3_svg_arcCornerTangents([ x1, y1 ], [ x2, y2 ], r1, rc1, cw);\r\n          if (rc === rc1) {\r\n            path.push(\"M\", t30[0], \"A\", rc1, \",\", rc1, \" 0 0,\", cr, \" \", t30[1], \"A\", r1, \",\", r1, \" 0 \", 1 - cw ^ d3_svg_arcSweep(t30[1][0], t30[1][1], t12[1][0], t12[1][1]), \",\", cw, \" \", t12[1], \"A\", rc1, \",\", rc1, \" 0 0,\", cr, \" \", t12[0]);\r\n          } else {\r\n            path.push(\"M\", t30[0], \"A\", rc1, \",\", rc1, \" 0 1,\", cr, \" \", t12[0]);\r\n          }\r\n        } else {\r\n          path.push(\"M\", x0, \",\", y0);\r\n        }\r\n        if (x3 != null) {\r\n          var t03 = d3_svg_arcCornerTangents([ x0, y0 ], [ x3, y3 ], r0, -rc0, cw), t21 = d3_svg_arcCornerTangents([ x2, y2 ], x1 == null ? [ x0, y0 ] : [ x1, y1 ], r0, -rc0, cw);\r\n          if (rc === rc0) {\r\n            path.push(\"L\", t21[0], \"A\", rc0, \",\", rc0, \" 0 0,\", cr, \" \", t21[1], \"A\", r0, \",\", r0, \" 0 \", cw ^ d3_svg_arcSweep(t21[1][0], t21[1][1], t03[1][0], t03[1][1]), \",\", 1 - cw, \" \", t03[1], \"A\", rc0, \",\", rc0, \" 0 0,\", cr, \" \", t03[0]);\r\n          } else {\r\n            path.push(\"L\", t21[0], \"A\", rc0, \",\", rc0, \" 0 0,\", cr, \" \", t03[0]);\r\n          }\r\n        } else {\r\n          path.push(\"L\", x2, \",\", y2);\r\n        }\r\n      } else {\r\n        path.push(\"M\", x0, \",\", y0);\r\n        if (x1 != null) path.push(\"A\", r1, \",\", r1, \" 0 \", l1, \",\", cw, \" \", x1, \",\", y1);\r\n        path.push(\"L\", x2, \",\", y2);\r\n        if (x3 != null) path.push(\"A\", r0, \",\", r0, \" 0 \", l0, \",\", 1 - cw, \" \", x3, \",\", y3);\r\n      }\r\n      path.push(\"Z\");\r\n      return path.join(\"\");\r\n    }\r\n    function circleSegment(r1, cw) {\r\n      return \"M0,\" + r1 + \"A\" + r1 + \",\" + r1 + \" 0 1,\" + cw + \" 0,\" + -r1 + \"A\" + r1 + \",\" + r1 + \" 0 1,\" + cw + \" 0,\" + r1;\r\n    }\r\n    arc.innerRadius = function(v) {\r\n      if (!arguments.length) return innerRadius;\r\n      innerRadius = d3_functor(v);\r\n      return arc;\r\n    };\r\n    arc.outerRadius = function(v) {\r\n      if (!arguments.length) return outerRadius;\r\n      outerRadius = d3_functor(v);\r\n      return arc;\r\n    };\r\n    arc.cornerRadius = function(v) {\r\n      if (!arguments.length) return cornerRadius;\r\n      cornerRadius = d3_functor(v);\r\n      return arc;\r\n    };\r\n    arc.padRadius = function(v) {\r\n      if (!arguments.length) return padRadius;\r\n      padRadius = v == d3_svg_arcAuto ? d3_svg_arcAuto : d3_functor(v);\r\n      return arc;\r\n    };\r\n    arc.startAngle = function(v) {\r\n      if (!arguments.length) return startAngle;\r\n      startAngle = d3_functor(v);\r\n      return arc;\r\n    };\r\n    arc.endAngle = function(v) {\r\n      if (!arguments.length) return endAngle;\r\n      endAngle = d3_functor(v);\r\n      return arc;\r\n    };\r\n    arc.padAngle = function(v) {\r\n      if (!arguments.length) return padAngle;\r\n      padAngle = d3_functor(v);\r\n      return arc;\r\n    };\r\n    arc.centroid = function() {\r\n      var r = (+innerRadius.apply(this, arguments) + +outerRadius.apply(this, arguments)) / 2, a = (+startAngle.apply(this, arguments) + +endAngle.apply(this, arguments)) / 2 - halfπ;\r\n      return [ Math.cos(a) * r, Math.sin(a) * r ];\r\n    };\r\n    return arc;\r\n  };\r\n  var d3_svg_arcAuto = \"auto\";\r\n  function d3_svg_arcInnerRadius(d) {\r\n    return d.innerRadius;\r\n  }\r\n  function d3_svg_arcOuterRadius(d) {\r\n    return d.outerRadius;\r\n  }\r\n  function d3_svg_arcStartAngle(d) {\r\n    return d.startAngle;\r\n  }\r\n  function d3_svg_arcEndAngle(d) {\r\n    return d.endAngle;\r\n  }\r\n  function d3_svg_arcPadAngle(d) {\r\n    return d && d.padAngle;\r\n  }\r\n  function d3_svg_arcSweep(x0, y0, x1, y1) {\r\n    return (x0 - x1) * y0 - (y0 - y1) * x0 > 0 ? 0 : 1;\r\n  }\r\n  function d3_svg_arcCornerTangents(p0, p1, r1, rc, cw) {\r\n    var x01 = p0[0] - p1[0], y01 = p0[1] - p1[1], lo = (cw ? rc : -rc) / Math.sqrt(x01 * x01 + y01 * y01), ox = lo * y01, oy = -lo * x01, x1 = p0[0] + ox, y1 = p0[1] + oy, x2 = p1[0] + ox, y2 = p1[1] + oy, x3 = (x1 + x2) / 2, y3 = (y1 + y2) / 2, dx = x2 - x1, dy = y2 - y1, d2 = dx * dx + dy * dy, r = r1 - rc, D = x1 * y2 - x2 * y1, d = (dy < 0 ? -1 : 1) * Math.sqrt(Math.max(0, r * r * d2 - D * D)), cx0 = (D * dy - dx * d) / d2, cy0 = (-D * dx - dy * d) / d2, cx1 = (D * dy + dx * d) / d2, cy1 = (-D * dx + dy * d) / d2, dx0 = cx0 - x3, dy0 = cy0 - y3, dx1 = cx1 - x3, dy1 = cy1 - y3;\r\n    if (dx0 * dx0 + dy0 * dy0 > dx1 * dx1 + dy1 * dy1) cx0 = cx1, cy0 = cy1;\r\n    return [ [ cx0 - ox, cy0 - oy ], [ cx0 * r1 / r, cy0 * r1 / r ] ];\r\n  }\r\n  function d3_svg_line(projection) {\r\n    var x = d3_geom_pointX, y = d3_geom_pointY, defined = d3_true, interpolate = d3_svg_lineLinear, interpolateKey = interpolate.key, tension = .7;\r\n    function line(data) {\r\n      var segments = [], points = [], i = -1, n = data.length, d, fx = d3_functor(x), fy = d3_functor(y);\r\n      function segment() {\r\n        segments.push(\"M\", interpolate(projection(points), tension));\r\n      }\r\n      while (++i < n) {\r\n        if (defined.call(this, d = data[i], i)) {\r\n          points.push([ +fx.call(this, d, i), +fy.call(this, d, i) ]);\r\n        } else if (points.length) {\r\n          segment();\r\n          points = [];\r\n        }\r\n      }\r\n      if (points.length) segment();\r\n      return segments.length ? segments.join(\"\") : null;\r\n    }\r\n    line.x = function(_) {\r\n      if (!arguments.length) return x;\r\n      x = _;\r\n      return line;\r\n    };\r\n    line.y = function(_) {\r\n      if (!arguments.length) return y;\r\n      y = _;\r\n      return line;\r\n    };\r\n    line.defined = function(_) {\r\n      if (!arguments.length) return defined;\r\n      defined = _;\r\n      return line;\r\n    };\r\n    line.interpolate = function(_) {\r\n      if (!arguments.length) return interpolateKey;\r\n      if (typeof _ === \"function\") interpolateKey = interpolate = _; else interpolateKey = (interpolate = d3_svg_lineInterpolators.get(_) || d3_svg_lineLinear).key;\r\n      return line;\r\n    };\r\n    line.tension = function(_) {\r\n      if (!arguments.length) return tension;\r\n      tension = _;\r\n      return line;\r\n    };\r\n    return line;\r\n  }\r\n  d3.svg.line = function() {\r\n    return d3_svg_line(d3_identity);\r\n  };\r\n  var d3_svg_lineInterpolators = d3.map({\r\n    linear: d3_svg_lineLinear,\r\n    \"linear-closed\": d3_svg_lineLinearClosed,\r\n    step: d3_svg_lineStep,\r\n    \"step-before\": d3_svg_lineStepBefore,\r\n    \"step-after\": d3_svg_lineStepAfter,\r\n    basis: d3_svg_lineBasis,\r\n    \"basis-open\": d3_svg_lineBasisOpen,\r\n    \"basis-closed\": d3_svg_lineBasisClosed,\r\n    bundle: d3_svg_lineBundle,\r\n    cardinal: d3_svg_lineCardinal,\r\n    \"cardinal-open\": d3_svg_lineCardinalOpen,\r\n    \"cardinal-closed\": d3_svg_lineCardinalClosed,\r\n    monotone: d3_svg_lineMonotone\r\n  });\r\n  d3_svg_lineInterpolators.forEach(function(key, value) {\r\n    value.key = key;\r\n    value.closed = /-closed$/.test(key);\r\n  });\r\n  function d3_svg_lineLinear(points) {\r\n    return points.length > 1 ? points.join(\"L\") : points + \"Z\";\r\n  }\r\n  function d3_svg_lineLinearClosed(points) {\r\n    return points.join(\"L\") + \"Z\";\r\n  }\r\n  function d3_svg_lineStep(points) {\r\n    var i = 0, n = points.length, p = points[0], path = [ p[0], \",\", p[1] ];\r\n    while (++i < n) path.push(\"H\", (p[0] + (p = points[i])[0]) / 2, \"V\", p[1]);\r\n    if (n > 1) path.push(\"H\", p[0]);\r\n    return path.join(\"\");\r\n  }\r\n  function d3_svg_lineStepBefore(points) {\r\n    var i = 0, n = points.length, p = points[0], path = [ p[0], \",\", p[1] ];\r\n    while (++i < n) path.push(\"V\", (p = points[i])[1], \"H\", p[0]);\r\n    return path.join(\"\");\r\n  }\r\n  function d3_svg_lineStepAfter(points) {\r\n    var i = 0, n = points.length, p = points[0], path = [ p[0], \",\", p[1] ];\r\n    while (++i < n) path.push(\"H\", (p = points[i])[0], \"V\", p[1]);\r\n    return path.join(\"\");\r\n  }\r\n  function d3_svg_lineCardinalOpen(points, tension) {\r\n    return points.length < 4 ? d3_svg_lineLinear(points) : points[1] + d3_svg_lineHermite(points.slice(1, -1), d3_svg_lineCardinalTangents(points, tension));\r\n  }\r\n  function d3_svg_lineCardinalClosed(points, tension) {\r\n    return points.length < 3 ? d3_svg_lineLinearClosed(points) : points[0] + d3_svg_lineHermite((points.push(points[0]), \r\n    points), d3_svg_lineCardinalTangents([ points[points.length - 2] ].concat(points, [ points[1] ]), tension));\r\n  }\r\n  function d3_svg_lineCardinal(points, tension) {\r\n    return points.length < 3 ? d3_svg_lineLinear(points) : points[0] + d3_svg_lineHermite(points, d3_svg_lineCardinalTangents(points, tension));\r\n  }\r\n  function d3_svg_lineHermite(points, tangents) {\r\n    if (tangents.length < 1 || points.length != tangents.length && points.length != tangents.length + 2) {\r\n      return d3_svg_lineLinear(points);\r\n    }\r\n    var quad = points.length != tangents.length, path = \"\", p0 = points[0], p = points[1], t0 = tangents[0], t = t0, pi = 1;\r\n    if (quad) {\r\n      path += \"Q\" + (p[0] - t0[0] * 2 / 3) + \",\" + (p[1] - t0[1] * 2 / 3) + \",\" + p[0] + \",\" + p[1];\r\n      p0 = points[1];\r\n      pi = 2;\r\n    }\r\n    if (tangents.length > 1) {\r\n      t = tangents[1];\r\n      p = points[pi];\r\n      pi++;\r\n      path += \"C\" + (p0[0] + t0[0]) + \",\" + (p0[1] + t0[1]) + \",\" + (p[0] - t[0]) + \",\" + (p[1] - t[1]) + \",\" + p[0] + \",\" + p[1];\r\n      for (var i = 2; i < tangents.length; i++, pi++) {\r\n        p = points[pi];\r\n        t = tangents[i];\r\n        path += \"S\" + (p[0] - t[0]) + \",\" + (p[1] - t[1]) + \",\" + p[0] + \",\" + p[1];\r\n      }\r\n    }\r\n    if (quad) {\r\n      var lp = points[pi];\r\n      path += \"Q\" + (p[0] + t[0] * 2 / 3) + \",\" + (p[1] + t[1] * 2 / 3) + \",\" + lp[0] + \",\" + lp[1];\r\n    }\r\n    return path;\r\n  }\r\n  function d3_svg_lineCardinalTangents(points, tension) {\r\n    var tangents = [], a = (1 - tension) / 2, p0, p1 = points[0], p2 = points[1], i = 1, n = points.length;\r\n    while (++i < n) {\r\n      p0 = p1;\r\n      p1 = p2;\r\n      p2 = points[i];\r\n      tangents.push([ a * (p2[0] - p0[0]), a * (p2[1] - p0[1]) ]);\r\n    }\r\n    return tangents;\r\n  }\r\n  function d3_svg_lineBasis(points) {\r\n    if (points.length < 3) return d3_svg_lineLinear(points);\r\n    var i = 1, n = points.length, pi = points[0], x0 = pi[0], y0 = pi[1], px = [ x0, x0, x0, (pi = points[1])[0] ], py = [ y0, y0, y0, pi[1] ], path = [ x0, \",\", y0, \"L\", d3_svg_lineDot4(d3_svg_lineBasisBezier3, px), \",\", d3_svg_lineDot4(d3_svg_lineBasisBezier3, py) ];\r\n    points.push(points[n - 1]);\r\n    while (++i <= n) {\r\n      pi = points[i];\r\n      px.shift();\r\n      px.push(pi[0]);\r\n      py.shift();\r\n      py.push(pi[1]);\r\n      d3_svg_lineBasisBezier(path, px, py);\r\n    }\r\n    points.pop();\r\n    path.push(\"L\", pi);\r\n    return path.join(\"\");\r\n  }\r\n  function d3_svg_lineBasisOpen(points) {\r\n    if (points.length < 4) return d3_svg_lineLinear(points);\r\n    var path = [], i = -1, n = points.length, pi, px = [ 0 ], py = [ 0 ];\r\n    while (++i < 3) {\r\n      pi = points[i];\r\n      px.push(pi[0]);\r\n      py.push(pi[1]);\r\n    }\r\n    path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3, px) + \",\" + d3_svg_lineDot4(d3_svg_lineBasisBezier3, py));\r\n    --i;\r\n    while (++i < n) {\r\n      pi = points[i];\r\n      px.shift();\r\n      px.push(pi[0]);\r\n      py.shift();\r\n      py.push(pi[1]);\r\n      d3_svg_lineBasisBezier(path, px, py);\r\n    }\r\n    return path.join(\"\");\r\n  }\r\n  function d3_svg_lineBasisClosed(points) {\r\n    var path, i = -1, n = points.length, m = n + 4, pi, px = [], py = [];\r\n    while (++i < 4) {\r\n      pi = points[i % n];\r\n      px.push(pi[0]);\r\n      py.push(pi[1]);\r\n    }\r\n    path = [ d3_svg_lineDot4(d3_svg_lineBasisBezier3, px), \",\", d3_svg_lineDot4(d3_svg_lineBasisBezier3, py) ];\r\n    --i;\r\n    while (++i < m) {\r\n      pi = points[i % n];\r\n      px.shift();\r\n      px.push(pi[0]);\r\n      py.shift();\r\n      py.push(pi[1]);\r\n      d3_svg_lineBasisBezier(path, px, py);\r\n    }\r\n    return path.join(\"\");\r\n  }\r\n  function d3_svg_lineBundle(points, tension) {\r\n    var n = points.length - 1;\r\n    if (n) {\r\n      var x0 = points[0][0], y0 = points[0][1], dx = points[n][0] - x0, dy = points[n][1] - y0, i = -1, p, t;\r\n      while (++i <= n) {\r\n        p = points[i];\r\n        t = i / n;\r\n        p[0] = tension * p[0] + (1 - tension) * (x0 + t * dx);\r\n        p[1] = tension * p[1] + (1 - tension) * (y0 + t * dy);\r\n      }\r\n    }\r\n    return d3_svg_lineBasis(points);\r\n  }\r\n  function d3_svg_lineDot4(a, b) {\r\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\r\n  }\r\n  var d3_svg_lineBasisBezier1 = [ 0, 2 / 3, 1 / 3, 0 ], d3_svg_lineBasisBezier2 = [ 0, 1 / 3, 2 / 3, 0 ], d3_svg_lineBasisBezier3 = [ 0, 1 / 6, 2 / 3, 1 / 6 ];\r\n  function d3_svg_lineBasisBezier(path, x, y) {\r\n    path.push(\"C\", d3_svg_lineDot4(d3_svg_lineBasisBezier1, x), \",\", d3_svg_lineDot4(d3_svg_lineBasisBezier1, y), \",\", d3_svg_lineDot4(d3_svg_lineBasisBezier2, x), \",\", d3_svg_lineDot4(d3_svg_lineBasisBezier2, y), \",\", d3_svg_lineDot4(d3_svg_lineBasisBezier3, x), \",\", d3_svg_lineDot4(d3_svg_lineBasisBezier3, y));\r\n  }\r\n  function d3_svg_lineSlope(p0, p1) {\r\n    return (p1[1] - p0[1]) / (p1[0] - p0[0]);\r\n  }\r\n  function d3_svg_lineFiniteDifferences(points) {\r\n    var i = 0, j = points.length - 1, m = [], p0 = points[0], p1 = points[1], d = m[0] = d3_svg_lineSlope(p0, p1);\r\n    while (++i < j) {\r\n      m[i] = (d + (d = d3_svg_lineSlope(p0 = p1, p1 = points[i + 1]))) / 2;\r\n    }\r\n    m[i] = d;\r\n    return m;\r\n  }\r\n  function d3_svg_lineMonotoneTangents(points) {\r\n    var tangents = [], d, a, b, s, m = d3_svg_lineFiniteDifferences(points), i = -1, j = points.length - 1;\r\n    while (++i < j) {\r\n      d = d3_svg_lineSlope(points[i], points[i + 1]);\r\n      if (abs(d) < ε) {\r\n        m[i] = m[i + 1] = 0;\r\n      } else {\r\n        a = m[i] / d;\r\n        b = m[i + 1] / d;\r\n        s = a * a + b * b;\r\n        if (s > 9) {\r\n          s = d * 3 / Math.sqrt(s);\r\n          m[i] = s * a;\r\n          m[i + 1] = s * b;\r\n        }\r\n      }\r\n    }\r\n    i = -1;\r\n    while (++i <= j) {\r\n      s = (points[Math.min(j, i + 1)][0] - points[Math.max(0, i - 1)][0]) / (6 * (1 + m[i] * m[i]));\r\n      tangents.push([ s || 0, m[i] * s || 0 ]);\r\n    }\r\n    return tangents;\r\n  }\r\n  function d3_svg_lineMonotone(points) {\r\n    return points.length < 3 ? d3_svg_lineLinear(points) : points[0] + d3_svg_lineHermite(points, d3_svg_lineMonotoneTangents(points));\r\n  }\r\n  d3.svg.line.radial = function() {\r\n    var line = d3_svg_line(d3_svg_lineRadial);\r\n    line.radius = line.x, delete line.x;\r\n    line.angle = line.y, delete line.y;\r\n    return line;\r\n  };\r\n  function d3_svg_lineRadial(points) {\r\n    var point, i = -1, n = points.length, r, a;\r\n    while (++i < n) {\r\n      point = points[i];\r\n      r = point[0];\r\n      a = point[1] - halfπ;\r\n      point[0] = r * Math.cos(a);\r\n      point[1] = r * Math.sin(a);\r\n    }\r\n    return points;\r\n  }\r\n  function d3_svg_area(projection) {\r\n    var x0 = d3_geom_pointX, x1 = d3_geom_pointX, y0 = 0, y1 = d3_geom_pointY, defined = d3_true, interpolate = d3_svg_lineLinear, interpolateKey = interpolate.key, interpolateReverse = interpolate, L = \"L\", tension = .7;\r\n    function area(data) {\r\n      var segments = [], points0 = [], points1 = [], i = -1, n = data.length, d, fx0 = d3_functor(x0), fy0 = d3_functor(y0), fx1 = x0 === x1 ? function() {\r\n        return x;\r\n      } : d3_functor(x1), fy1 = y0 === y1 ? function() {\r\n        return y;\r\n      } : d3_functor(y1), x, y;\r\n      function segment() {\r\n        segments.push(\"M\", interpolate(projection(points1), tension), L, interpolateReverse(projection(points0.reverse()), tension), \"Z\");\r\n      }\r\n      while (++i < n) {\r\n        if (defined.call(this, d = data[i], i)) {\r\n          points0.push([ x = +fx0.call(this, d, i), y = +fy0.call(this, d, i) ]);\r\n          points1.push([ +fx1.call(this, d, i), +fy1.call(this, d, i) ]);\r\n        } else if (points0.length) {\r\n          segment();\r\n          points0 = [];\r\n          points1 = [];\r\n        }\r\n      }\r\n      if (points0.length) segment();\r\n      return segments.length ? segments.join(\"\") : null;\r\n    }\r\n    area.x = function(_) {\r\n      if (!arguments.length) return x1;\r\n      x0 = x1 = _;\r\n      return area;\r\n    };\r\n    area.x0 = function(_) {\r\n      if (!arguments.length) return x0;\r\n      x0 = _;\r\n      return area;\r\n    };\r\n    area.x1 = function(_) {\r\n      if (!arguments.length) return x1;\r\n      x1 = _;\r\n      return area;\r\n    };\r\n    area.y = function(_) {\r\n      if (!arguments.length) return y1;\r\n      y0 = y1 = _;\r\n      return area;\r\n    };\r\n    area.y0 = function(_) {\r\n      if (!arguments.length) return y0;\r\n      y0 = _;\r\n      return area;\r\n    };\r\n    area.y1 = function(_) {\r\n      if (!arguments.length) return y1;\r\n      y1 = _;\r\n      return area;\r\n    };\r\n    area.defined = function(_) {\r\n      if (!arguments.length) return defined;\r\n      defined = _;\r\n      return area;\r\n    };\r\n    area.interpolate = function(_) {\r\n      if (!arguments.length) return interpolateKey;\r\n      if (typeof _ === \"function\") interpolateKey = interpolate = _; else interpolateKey = (interpolate = d3_svg_lineInterpolators.get(_) || d3_svg_lineLinear).key;\r\n      interpolateReverse = interpolate.reverse || interpolate;\r\n      L = interpolate.closed ? \"M\" : \"L\";\r\n      return area;\r\n    };\r\n    area.tension = function(_) {\r\n      if (!arguments.length) return tension;\r\n      tension = _;\r\n      return area;\r\n    };\r\n    return area;\r\n  }\r\n  d3_svg_lineStepBefore.reverse = d3_svg_lineStepAfter;\r\n  d3_svg_lineStepAfter.reverse = d3_svg_lineStepBefore;\r\n  d3.svg.area = function() {\r\n    return d3_svg_area(d3_identity);\r\n  };\r\n  d3.svg.area.radial = function() {\r\n    var area = d3_svg_area(d3_svg_lineRadial);\r\n    area.radius = area.x, delete area.x;\r\n    area.innerRadius = area.x0, delete area.x0;\r\n    area.outerRadius = area.x1, delete area.x1;\r\n    area.angle = area.y, delete area.y;\r\n    area.startAngle = area.y0, delete area.y0;\r\n    area.endAngle = area.y1, delete area.y1;\r\n    return area;\r\n  };\r\n  d3.svg.chord = function() {\r\n    var source = d3_source, target = d3_target, radius = d3_svg_chordRadius, startAngle = d3_svg_arcStartAngle, endAngle = d3_svg_arcEndAngle;\r\n    function chord(d, i) {\r\n      var s = subgroup(this, source, d, i), t = subgroup(this, target, d, i);\r\n      return \"M\" + s.p0 + arc(s.r, s.p1, s.a1 - s.a0) + (equals(s, t) ? curve(s.r, s.p1, s.r, s.p0) : curve(s.r, s.p1, t.r, t.p0) + arc(t.r, t.p1, t.a1 - t.a0) + curve(t.r, t.p1, s.r, s.p0)) + \"Z\";\r\n    }\r\n    function subgroup(self, f, d, i) {\r\n      var subgroup = f.call(self, d, i), r = radius.call(self, subgroup, i), a0 = startAngle.call(self, subgroup, i) - halfπ, a1 = endAngle.call(self, subgroup, i) - halfπ;\r\n      return {\r\n        r: r,\r\n        a0: a0,\r\n        a1: a1,\r\n        p0: [ r * Math.cos(a0), r * Math.sin(a0) ],\r\n        p1: [ r * Math.cos(a1), r * Math.sin(a1) ]\r\n      };\r\n    }\r\n    function equals(a, b) {\r\n      return a.a0 == b.a0 && a.a1 == b.a1;\r\n    }\r\n    function arc(r, p, a) {\r\n      return \"A\" + r + \",\" + r + \" 0 \" + +(a > π) + \",1 \" + p;\r\n    }\r\n    function curve(r0, p0, r1, p1) {\r\n      return \"Q 0,0 \" + p1;\r\n    }\r\n    chord.radius = function(v) {\r\n      if (!arguments.length) return radius;\r\n      radius = d3_functor(v);\r\n      return chord;\r\n    };\r\n    chord.source = function(v) {\r\n      if (!arguments.length) return source;\r\n      source = d3_functor(v);\r\n      return chord;\r\n    };\r\n    chord.target = function(v) {\r\n      if (!arguments.length) return target;\r\n      target = d3_functor(v);\r\n      return chord;\r\n    };\r\n    chord.startAngle = function(v) {\r\n      if (!arguments.length) return startAngle;\r\n      startAngle = d3_functor(v);\r\n      return chord;\r\n    };\r\n    chord.endAngle = function(v) {\r\n      if (!arguments.length) return endAngle;\r\n      endAngle = d3_functor(v);\r\n      return chord;\r\n    };\r\n    return chord;\r\n  };\r\n  function d3_svg_chordRadius(d) {\r\n    return d.radius;\r\n  }\r\n  d3.svg.diagonal = function() {\r\n    var source = d3_source, target = d3_target, projection = d3_svg_diagonalProjection;\r\n    function diagonal(d, i) {\r\n      var p0 = source.call(this, d, i), p3 = target.call(this, d, i), m = (p0.y + p3.y) / 2, p = [ p0, {\r\n        x: p0.x,\r\n        y: m\r\n      }, {\r\n        x: p3.x,\r\n        y: m\r\n      }, p3 ];\r\n      p = p.map(projection);\r\n      return \"M\" + p[0] + \"C\" + p[1] + \" \" + p[2] + \" \" + p[3];\r\n    }\r\n    diagonal.source = function(x) {\r\n      if (!arguments.length) return source;\r\n      source = d3_functor(x);\r\n      return diagonal;\r\n    };\r\n    diagonal.target = function(x) {\r\n      if (!arguments.length) return target;\r\n      target = d3_functor(x);\r\n      return diagonal;\r\n    };\r\n    diagonal.projection = function(x) {\r\n      if (!arguments.length) return projection;\r\n      projection = x;\r\n      return diagonal;\r\n    };\r\n    return diagonal;\r\n  };\r\n  function d3_svg_diagonalProjection(d) {\r\n    return [ d.x, d.y ];\r\n  }\r\n  d3.svg.diagonal.radial = function() {\r\n    var diagonal = d3.svg.diagonal(), projection = d3_svg_diagonalProjection, projection_ = diagonal.projection;\r\n    diagonal.projection = function(x) {\r\n      return arguments.length ? projection_(d3_svg_diagonalRadialProjection(projection = x)) : projection;\r\n    };\r\n    return diagonal;\r\n  };\r\n  function d3_svg_diagonalRadialProjection(projection) {\r\n    return function() {\r\n      var d = projection.apply(this, arguments), r = d[0], a = d[1] - halfπ;\r\n      return [ r * Math.cos(a), r * Math.sin(a) ];\r\n    };\r\n  }\r\n  d3.svg.symbol = function() {\r\n    var type = d3_svg_symbolType, size = d3_svg_symbolSize;\r\n    function symbol(d, i) {\r\n      return (d3_svg_symbols.get(type.call(this, d, i)) || d3_svg_symbolCircle)(size.call(this, d, i));\r\n    }\r\n    symbol.type = function(x) {\r\n      if (!arguments.length) return type;\r\n      type = d3_functor(x);\r\n      return symbol;\r\n    };\r\n    symbol.size = function(x) {\r\n      if (!arguments.length) return size;\r\n      size = d3_functor(x);\r\n      return symbol;\r\n    };\r\n    return symbol;\r\n  };\r\n  function d3_svg_symbolSize() {\r\n    return 64;\r\n  }\r\n  function d3_svg_symbolType() {\r\n    return \"circle\";\r\n  }\r\n  function d3_svg_symbolCircle(size) {\r\n    var r = Math.sqrt(size / π);\r\n    return \"M0,\" + r + \"A\" + r + \",\" + r + \" 0 1,1 0,\" + -r + \"A\" + r + \",\" + r + \" 0 1,1 0,\" + r + \"Z\";\r\n  }\r\n  var d3_svg_symbols = d3.map({\r\n    circle: d3_svg_symbolCircle,\r\n    cross: function(size) {\r\n      var r = Math.sqrt(size / 5) / 2;\r\n      return \"M\" + -3 * r + \",\" + -r + \"H\" + -r + \"V\" + -3 * r + \"H\" + r + \"V\" + -r + \"H\" + 3 * r + \"V\" + r + \"H\" + r + \"V\" + 3 * r + \"H\" + -r + \"V\" + r + \"H\" + -3 * r + \"Z\";\r\n    },\r\n    diamond: function(size) {\r\n      var ry = Math.sqrt(size / (2 * d3_svg_symbolTan30)), rx = ry * d3_svg_symbolTan30;\r\n      return \"M0,\" + -ry + \"L\" + rx + \",0\" + \" 0,\" + ry + \" \" + -rx + \",0\" + \"Z\";\r\n    },\r\n    square: function(size) {\r\n      var r = Math.sqrt(size) / 2;\r\n      return \"M\" + -r + \",\" + -r + \"L\" + r + \",\" + -r + \" \" + r + \",\" + r + \" \" + -r + \",\" + r + \"Z\";\r\n    },\r\n    \"triangle-down\": function(size) {\r\n      var rx = Math.sqrt(size / d3_svg_symbolSqrt3), ry = rx * d3_svg_symbolSqrt3 / 2;\r\n      return \"M0,\" + ry + \"L\" + rx + \",\" + -ry + \" \" + -rx + \",\" + -ry + \"Z\";\r\n    },\r\n    \"triangle-up\": function(size) {\r\n      var rx = Math.sqrt(size / d3_svg_symbolSqrt3), ry = rx * d3_svg_symbolSqrt3 / 2;\r\n      return \"M0,\" + -ry + \"L\" + rx + \",\" + ry + \" \" + -rx + \",\" + ry + \"Z\";\r\n    }\r\n  });\r\n  d3.svg.symbolTypes = d3_svg_symbols.keys();\r\n  var d3_svg_symbolSqrt3 = Math.sqrt(3), d3_svg_symbolTan30 = Math.tan(30 * d3_radians);\r\n  d3_selectionPrototype.transition = function(name) {\r\n    var id = d3_transitionInheritId || ++d3_transitionId, ns = d3_transitionNamespace(name), subgroups = [], subgroup, node, transition = d3_transitionInherit || {\r\n      time: Date.now(),\r\n      ease: d3_ease_cubicInOut,\r\n      delay: 0,\r\n      duration: 250\r\n    };\r\n    for (var j = -1, m = this.length; ++j < m; ) {\r\n      subgroups.push(subgroup = []);\r\n      for (var group = this[j], i = -1, n = group.length; ++i < n; ) {\r\n        if (node = group[i]) d3_transitionNode(node, i, ns, id, transition);\r\n        subgroup.push(node);\r\n      }\r\n    }\r\n    return d3_transition(subgroups, ns, id);\r\n  };\r\n  d3_selectionPrototype.interrupt = function(name) {\r\n    return this.each(name == null ? d3_selection_interrupt : d3_selection_interruptNS(d3_transitionNamespace(name)));\r\n  };\r\n  var d3_selection_interrupt = d3_selection_interruptNS(d3_transitionNamespace());\r\n  function d3_selection_interruptNS(ns) {\r\n    return function() {\r\n      var lock, activeId, active;\r\n      if ((lock = this[ns]) && (active = lock[activeId = lock.active])) {\r\n        active.timer.c = null;\r\n        active.timer.t = NaN;\r\n        if (--lock.count) delete lock[activeId]; else delete this[ns];\r\n        lock.active += .5;\r\n        active.event && active.event.interrupt.call(this, this.__data__, active.index);\r\n      }\r\n    };\r\n  }\r\n  function d3_transition(groups, ns, id) {\r\n    d3_subclass(groups, d3_transitionPrototype);\r\n    groups.namespace = ns;\r\n    groups.id = id;\r\n    return groups;\r\n  }\r\n  var d3_transitionPrototype = [], d3_transitionId = 0, d3_transitionInheritId, d3_transitionInherit;\r\n  d3_transitionPrototype.call = d3_selectionPrototype.call;\r\n  d3_transitionPrototype.empty = d3_selectionPrototype.empty;\r\n  d3_transitionPrototype.node = d3_selectionPrototype.node;\r\n  d3_transitionPrototype.size = d3_selectionPrototype.size;\r\n  d3.transition = function(selection, name) {\r\n    return selection && selection.transition ? d3_transitionInheritId ? selection.transition(name) : selection : d3.selection().transition(selection);\r\n  };\r\n  d3.transition.prototype = d3_transitionPrototype;\r\n  d3_transitionPrototype.select = function(selector) {\r\n    var id = this.id, ns = this.namespace, subgroups = [], subgroup, subnode, node;\r\n    selector = d3_selection_selector(selector);\r\n    for (var j = -1, m = this.length; ++j < m; ) {\r\n      subgroups.push(subgroup = []);\r\n      for (var group = this[j], i = -1, n = group.length; ++i < n; ) {\r\n        if ((node = group[i]) && (subnode = selector.call(node, node.__data__, i, j))) {\r\n          if (\"__data__\" in node) subnode.__data__ = node.__data__;\r\n          d3_transitionNode(subnode, i, ns, id, node[ns][id]);\r\n          subgroup.push(subnode);\r\n        } else {\r\n          subgroup.push(null);\r\n        }\r\n      }\r\n    }\r\n    return d3_transition(subgroups, ns, id);\r\n  };\r\n  d3_transitionPrototype.selectAll = function(selector) {\r\n    var id = this.id, ns = this.namespace, subgroups = [], subgroup, subnodes, node, subnode, transition;\r\n    selector = d3_selection_selectorAll(selector);\r\n    for (var j = -1, m = this.length; ++j < m; ) {\r\n      for (var group = this[j], i = -1, n = group.length; ++i < n; ) {\r\n        if (node = group[i]) {\r\n          transition = node[ns][id];\r\n          subnodes = selector.call(node, node.__data__, i, j);\r\n          subgroups.push(subgroup = []);\r\n          for (var k = -1, o = subnodes.length; ++k < o; ) {\r\n            if (subnode = subnodes[k]) d3_transitionNode(subnode, k, ns, id, transition);\r\n            subgroup.push(subnode);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return d3_transition(subgroups, ns, id);\r\n  };\r\n  d3_transitionPrototype.filter = function(filter) {\r\n    var subgroups = [], subgroup, group, node;\r\n    if (typeof filter !== \"function\") filter = d3_selection_filter(filter);\r\n    for (var j = 0, m = this.length; j < m; j++) {\r\n      subgroups.push(subgroup = []);\r\n      for (var group = this[j], i = 0, n = group.length; i < n; i++) {\r\n        if ((node = group[i]) && filter.call(node, node.__data__, i, j)) {\r\n          subgroup.push(node);\r\n        }\r\n      }\r\n    }\r\n    return d3_transition(subgroups, this.namespace, this.id);\r\n  };\r\n  d3_transitionPrototype.tween = function(name, tween) {\r\n    var id = this.id, ns = this.namespace;\r\n    if (arguments.length < 2) return this.node()[ns][id].tween.get(name);\r\n    return d3_selection_each(this, tween == null ? function(node) {\r\n      node[ns][id].tween.remove(name);\r\n    } : function(node) {\r\n      node[ns][id].tween.set(name, tween);\r\n    });\r\n  };\r\n  function d3_transition_tween(groups, name, value, tween) {\r\n    var id = groups.id, ns = groups.namespace;\r\n    return d3_selection_each(groups, typeof value === \"function\" ? function(node, i, j) {\r\n      node[ns][id].tween.set(name, tween(value.call(node, node.__data__, i, j)));\r\n    } : (value = tween(value), function(node) {\r\n      node[ns][id].tween.set(name, value);\r\n    }));\r\n  }\r\n  d3_transitionPrototype.attr = function(nameNS, value) {\r\n    if (arguments.length < 2) {\r\n      for (value in nameNS) this.attr(value, nameNS[value]);\r\n      return this;\r\n    }\r\n    var interpolate = nameNS == \"transform\" ? d3_interpolateTransform : d3_interpolate, name = d3.ns.qualify(nameNS);\r\n    function attrNull() {\r\n      this.removeAttribute(name);\r\n    }\r\n    function attrNullNS() {\r\n      this.removeAttributeNS(name.space, name.local);\r\n    }\r\n    function attrTween(b) {\r\n      return b == null ? attrNull : (b += \"\", function() {\r\n        var a = this.getAttribute(name), i;\r\n        return a !== b && (i = interpolate(a, b), function(t) {\r\n          this.setAttribute(name, i(t));\r\n        });\r\n      });\r\n    }\r\n    function attrTweenNS(b) {\r\n      return b == null ? attrNullNS : (b += \"\", function() {\r\n        var a = this.getAttributeNS(name.space, name.local), i;\r\n        return a !== b && (i = interpolate(a, b), function(t) {\r\n          this.setAttributeNS(name.space, name.local, i(t));\r\n        });\r\n      });\r\n    }\r\n    return d3_transition_tween(this, \"attr.\" + nameNS, value, name.local ? attrTweenNS : attrTween);\r\n  };\r\n  d3_transitionPrototype.attrTween = function(nameNS, tween) {\r\n    var name = d3.ns.qualify(nameNS);\r\n    function attrTween(d, i) {\r\n      var f = tween.call(this, d, i, this.getAttribute(name));\r\n      return f && function(t) {\r\n        this.setAttribute(name, f(t));\r\n      };\r\n    }\r\n    function attrTweenNS(d, i) {\r\n      var f = tween.call(this, d, i, this.getAttributeNS(name.space, name.local));\r\n      return f && function(t) {\r\n        this.setAttributeNS(name.space, name.local, f(t));\r\n      };\r\n    }\r\n    return this.tween(\"attr.\" + nameNS, name.local ? attrTweenNS : attrTween);\r\n  };\r\n  d3_transitionPrototype.style = function(name, value, priority) {\r\n    var n = arguments.length;\r\n    if (n < 3) {\r\n      if (typeof name !== \"string\") {\r\n        if (n < 2) value = \"\";\r\n        for (priority in name) this.style(priority, name[priority], value);\r\n        return this;\r\n      }\r\n      priority = \"\";\r\n    }\r\n    function styleNull() {\r\n      this.style.removeProperty(name);\r\n    }\r\n    function styleString(b) {\r\n      return b == null ? styleNull : (b += \"\", function() {\r\n        var a = d3_window(this).getComputedStyle(this, null).getPropertyValue(name), i;\r\n        return a !== b && (i = d3_interpolate(a, b), function(t) {\r\n          this.style.setProperty(name, i(t), priority);\r\n        });\r\n      });\r\n    }\r\n    return d3_transition_tween(this, \"style.\" + name, value, styleString);\r\n  };\r\n  d3_transitionPrototype.styleTween = function(name, tween, priority) {\r\n    if (arguments.length < 3) priority = \"\";\r\n    function styleTween(d, i) {\r\n      var f = tween.call(this, d, i, d3_window(this).getComputedStyle(this, null).getPropertyValue(name));\r\n      return f && function(t) {\r\n        this.style.setProperty(name, f(t), priority);\r\n      };\r\n    }\r\n    return this.tween(\"style.\" + name, styleTween);\r\n  };\r\n  d3_transitionPrototype.text = function(value) {\r\n    return d3_transition_tween(this, \"text\", value, d3_transition_text);\r\n  };\r\n  function d3_transition_text(b) {\r\n    if (b == null) b = \"\";\r\n    return function() {\r\n      this.textContent = b;\r\n    };\r\n  }\r\n  d3_transitionPrototype.remove = function() {\r\n    var ns = this.namespace;\r\n    return this.each(\"end.transition\", function() {\r\n      var p;\r\n      if (this[ns].count < 2 && (p = this.parentNode)) p.removeChild(this);\r\n    });\r\n  };\r\n  d3_transitionPrototype.ease = function(value) {\r\n    var id = this.id, ns = this.namespace;\r\n    if (arguments.length < 1) return this.node()[ns][id].ease;\r\n    if (typeof value !== \"function\") value = d3.ease.apply(d3, arguments);\r\n    return d3_selection_each(this, function(node) {\r\n      node[ns][id].ease = value;\r\n    });\r\n  };\r\n  d3_transitionPrototype.delay = function(value) {\r\n    var id = this.id, ns = this.namespace;\r\n    if (arguments.length < 1) return this.node()[ns][id].delay;\r\n    return d3_selection_each(this, typeof value === \"function\" ? function(node, i, j) {\r\n      node[ns][id].delay = +value.call(node, node.__data__, i, j);\r\n    } : (value = +value, function(node) {\r\n      node[ns][id].delay = value;\r\n    }));\r\n  };\r\n  d3_transitionPrototype.duration = function(value) {\r\n    var id = this.id, ns = this.namespace;\r\n    if (arguments.length < 1) return this.node()[ns][id].duration;\r\n    return d3_selection_each(this, typeof value === \"function\" ? function(node, i, j) {\r\n      node[ns][id].duration = Math.max(1, value.call(node, node.__data__, i, j));\r\n    } : (value = Math.max(1, value), function(node) {\r\n      node[ns][id].duration = value;\r\n    }));\r\n  };\r\n  d3_transitionPrototype.each = function(type, listener) {\r\n    var id = this.id, ns = this.namespace;\r\n    if (arguments.length < 2) {\r\n      var inherit = d3_transitionInherit, inheritId = d3_transitionInheritId;\r\n      try {\r\n        d3_transitionInheritId = id;\r\n        d3_selection_each(this, function(node, i, j) {\r\n          d3_transitionInherit = node[ns][id];\r\n          type.call(node, node.__data__, i, j);\r\n        });\r\n      } finally {\r\n        d3_transitionInherit = inherit;\r\n        d3_transitionInheritId = inheritId;\r\n      }\r\n    } else {\r\n      d3_selection_each(this, function(node) {\r\n        var transition = node[ns][id];\r\n        (transition.event || (transition.event = d3.dispatch(\"start\", \"end\", \"interrupt\"))).on(type, listener);\r\n      });\r\n    }\r\n    return this;\r\n  };\r\n  d3_transitionPrototype.transition = function() {\r\n    var id0 = this.id, id1 = ++d3_transitionId, ns = this.namespace, subgroups = [], subgroup, group, node, transition;\r\n    for (var j = 0, m = this.length; j < m; j++) {\r\n      subgroups.push(subgroup = []);\r\n      for (var group = this[j], i = 0, n = group.length; i < n; i++) {\r\n        if (node = group[i]) {\r\n          transition = node[ns][id0];\r\n          d3_transitionNode(node, i, ns, id1, {\r\n            time: transition.time,\r\n            ease: transition.ease,\r\n            delay: transition.delay + transition.duration,\r\n            duration: transition.duration\r\n          });\r\n        }\r\n        subgroup.push(node);\r\n      }\r\n    }\r\n    return d3_transition(subgroups, ns, id1);\r\n  };\r\n  function d3_transitionNamespace(name) {\r\n    return name == null ? \"__transition__\" : \"__transition_\" + name + \"__\";\r\n  }\r\n  function d3_transitionNode(node, i, ns, id, inherit) {\r\n    var lock = node[ns] || (node[ns] = {\r\n      active: 0,\r\n      count: 0\r\n    }), transition = lock[id], time, timer, duration, ease, tweens;\r\n    function schedule(elapsed) {\r\n      var delay = transition.delay;\r\n      timer.t = delay + time;\r\n      if (delay <= elapsed) return start(elapsed - delay);\r\n      timer.c = start;\r\n    }\r\n    function start(elapsed) {\r\n      var activeId = lock.active, active = lock[activeId];\r\n      if (active) {\r\n        active.timer.c = null;\r\n        active.timer.t = NaN;\r\n        --lock.count;\r\n        delete lock[activeId];\r\n        active.event && active.event.interrupt.call(node, node.__data__, active.index);\r\n      }\r\n      for (var cancelId in lock) {\r\n        if (+cancelId < id) {\r\n          var cancel = lock[cancelId];\r\n          cancel.timer.c = null;\r\n          cancel.timer.t = NaN;\r\n          --lock.count;\r\n          delete lock[cancelId];\r\n        }\r\n      }\r\n      timer.c = tick;\r\n      d3_timer(function() {\r\n        if (timer.c && tick(elapsed || 1)) {\r\n          timer.c = null;\r\n          timer.t = NaN;\r\n        }\r\n        return 1;\r\n      }, 0, time);\r\n      lock.active = id;\r\n      transition.event && transition.event.start.call(node, node.__data__, i);\r\n      tweens = [];\r\n      transition.tween.forEach(function(key, value) {\r\n        if (value = value.call(node, node.__data__, i)) {\r\n          tweens.push(value);\r\n        }\r\n      });\r\n      ease = transition.ease;\r\n      duration = transition.duration;\r\n    }\r\n    function tick(elapsed) {\r\n      var t = elapsed / duration, e = ease(t), n = tweens.length;\r\n      while (n > 0) {\r\n        tweens[--n].call(node, e);\r\n      }\r\n      if (t >= 1) {\r\n        transition.event && transition.event.end.call(node, node.__data__, i);\r\n        if (--lock.count) delete lock[id]; else delete node[ns];\r\n        return 1;\r\n      }\r\n    }\r\n    if (!transition) {\r\n      time = inherit.time;\r\n      timer = d3_timer(schedule, 0, time);\r\n      transition = lock[id] = {\r\n        tween: new d3_Map(),\r\n        time: time,\r\n        timer: timer,\r\n        delay: inherit.delay,\r\n        duration: inherit.duration,\r\n        ease: inherit.ease,\r\n        index: i\r\n      };\r\n      inherit = null;\r\n      ++lock.count;\r\n    }\r\n  }\r\n  d3.svg.axis = function() {\r\n    var scale = d3.scale.linear(), orient = d3_svg_axisDefaultOrient, innerTickSize = 6, outerTickSize = 6, tickPadding = 3, tickArguments_ = [ 10 ], tickValues = null, tickFormat_;\r\n    function axis(g) {\r\n      g.each(function() {\r\n        var g = d3.select(this);\r\n        var scale0 = this.__chart__ || scale, scale1 = this.__chart__ = scale.copy();\r\n        var ticks = tickValues == null ? scale1.ticks ? scale1.ticks.apply(scale1, tickArguments_) : scale1.domain() : tickValues, tickFormat = tickFormat_ == null ? scale1.tickFormat ? scale1.tickFormat.apply(scale1, tickArguments_) : d3_identity : tickFormat_, tick = g.selectAll(\".tick\").data(ticks, scale1), tickEnter = tick.enter().insert(\"g\", \".domain\").attr(\"class\", \"tick\").style(\"opacity\", ε), tickExit = d3.transition(tick.exit()).style(\"opacity\", ε).remove(), tickUpdate = d3.transition(tick.order()).style(\"opacity\", 1), tickSpacing = Math.max(innerTickSize, 0) + tickPadding, tickTransform;\r\n        var range = d3_scaleRange(scale1), path = g.selectAll(\".domain\").data([ 0 ]), pathUpdate = (path.enter().append(\"path\").attr(\"class\", \"domain\"), \r\n        d3.transition(path));\r\n        tickEnter.append(\"line\");\r\n        tickEnter.append(\"text\");\r\n        var lineEnter = tickEnter.select(\"line\"), lineUpdate = tickUpdate.select(\"line\"), text = tick.select(\"text\").text(tickFormat), textEnter = tickEnter.select(\"text\"), textUpdate = tickUpdate.select(\"text\"), sign = orient === \"top\" || orient === \"left\" ? -1 : 1, x1, x2, y1, y2;\r\n        if (orient === \"bottom\" || orient === \"top\") {\r\n          tickTransform = d3_svg_axisX, x1 = \"x\", y1 = \"y\", x2 = \"x2\", y2 = \"y2\";\r\n          text.attr(\"dy\", sign < 0 ? \"0em\" : \".71em\").style(\"text-anchor\", \"middle\");\r\n          pathUpdate.attr(\"d\", \"M\" + range[0] + \",\" + sign * outerTickSize + \"V0H\" + range[1] + \"V\" + sign * outerTickSize);\r\n        } else {\r\n          tickTransform = d3_svg_axisY, x1 = \"y\", y1 = \"x\", x2 = \"y2\", y2 = \"x2\";\r\n          text.attr(\"dy\", \".32em\").style(\"text-anchor\", sign < 0 ? \"end\" : \"start\");\r\n          pathUpdate.attr(\"d\", \"M\" + sign * outerTickSize + \",\" + range[0] + \"H0V\" + range[1] + \"H\" + sign * outerTickSize);\r\n        }\r\n        lineEnter.attr(y2, sign * innerTickSize);\r\n        textEnter.attr(y1, sign * tickSpacing);\r\n        lineUpdate.attr(x2, 0).attr(y2, sign * innerTickSize);\r\n        textUpdate.attr(x1, 0).attr(y1, sign * tickSpacing);\r\n        if (scale1.rangeBand) {\r\n          var x = scale1, dx = x.rangeBand() / 2;\r\n          scale0 = scale1 = function(d) {\r\n            return x(d) + dx;\r\n          };\r\n        } else if (scale0.rangeBand) {\r\n          scale0 = scale1;\r\n        } else {\r\n          tickExit.call(tickTransform, scale1, scale0);\r\n        }\r\n        tickEnter.call(tickTransform, scale0, scale1);\r\n        tickUpdate.call(tickTransform, scale1, scale1);\r\n      });\r\n    }\r\n    axis.scale = function(x) {\r\n      if (!arguments.length) return scale;\r\n      scale = x;\r\n      return axis;\r\n    };\r\n    axis.orient = function(x) {\r\n      if (!arguments.length) return orient;\r\n      orient = x in d3_svg_axisOrients ? x + \"\" : d3_svg_axisDefaultOrient;\r\n      return axis;\r\n    };\r\n    axis.ticks = function() {\r\n      if (!arguments.length) return tickArguments_;\r\n      tickArguments_ = d3_array(arguments);\r\n      return axis;\r\n    };\r\n    axis.tickValues = function(x) {\r\n      if (!arguments.length) return tickValues;\r\n      tickValues = x;\r\n      return axis;\r\n    };\r\n    axis.tickFormat = function(x) {\r\n      if (!arguments.length) return tickFormat_;\r\n      tickFormat_ = x;\r\n      return axis;\r\n    };\r\n    axis.tickSize = function(x) {\r\n      var n = arguments.length;\r\n      if (!n) return innerTickSize;\r\n      innerTickSize = +x;\r\n      outerTickSize = +arguments[n - 1];\r\n      return axis;\r\n    };\r\n    axis.innerTickSize = function(x) {\r\n      if (!arguments.length) return innerTickSize;\r\n      innerTickSize = +x;\r\n      return axis;\r\n    };\r\n    axis.outerTickSize = function(x) {\r\n      if (!arguments.length) return outerTickSize;\r\n      outerTickSize = +x;\r\n      return axis;\r\n    };\r\n    axis.tickPadding = function(x) {\r\n      if (!arguments.length) return tickPadding;\r\n      tickPadding = +x;\r\n      return axis;\r\n    };\r\n    axis.tickSubdivide = function() {\r\n      return arguments.length && axis;\r\n    };\r\n    return axis;\r\n  };\r\n  var d3_svg_axisDefaultOrient = \"bottom\", d3_svg_axisOrients = {\r\n    top: 1,\r\n    right: 1,\r\n    bottom: 1,\r\n    left: 1\r\n  };\r\n  function d3_svg_axisX(selection, x0, x1) {\r\n    selection.attr(\"transform\", function(d) {\r\n      var v0 = x0(d);\r\n      return \"translate(\" + (isFinite(v0) ? v0 : x1(d)) + \",0)\";\r\n    });\r\n  }\r\n  function d3_svg_axisY(selection, y0, y1) {\r\n    selection.attr(\"transform\", function(d) {\r\n      var v0 = y0(d);\r\n      return \"translate(0,\" + (isFinite(v0) ? v0 : y1(d)) + \")\";\r\n    });\r\n  }\r\n  d3.svg.brush = function() {\r\n    var event = d3_eventDispatch(brush, \"brushstart\", \"brush\", \"brushend\"), x = null, y = null, xExtent = [ 0, 0 ], yExtent = [ 0, 0 ], xExtentDomain, yExtentDomain, xClamp = true, yClamp = true, resizes = d3_svg_brushResizes[0];\r\n    function brush(g) {\r\n      g.each(function() {\r\n        var g = d3.select(this).style(\"pointer-events\", \"all\").style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\").on(\"mousedown.brush\", brushstart).on(\"touchstart.brush\", brushstart);\r\n        var background = g.selectAll(\".background\").data([ 0 ]);\r\n        background.enter().append(\"rect\").attr(\"class\", \"background\").style(\"visibility\", \"hidden\").style(\"cursor\", \"crosshair\");\r\n        g.selectAll(\".extent\").data([ 0 ]).enter().append(\"rect\").attr(\"class\", \"extent\").style(\"cursor\", \"move\");\r\n        var resize = g.selectAll(\".resize\").data(resizes, d3_identity);\r\n        resize.exit().remove();\r\n        resize.enter().append(\"g\").attr(\"class\", function(d) {\r\n          return \"resize \" + d;\r\n        }).style(\"cursor\", function(d) {\r\n          return d3_svg_brushCursor[d];\r\n        }).append(\"rect\").attr(\"x\", function(d) {\r\n          return /[ew]$/.test(d) ? -3 : null;\r\n        }).attr(\"y\", function(d) {\r\n          return /^[ns]/.test(d) ? -3 : null;\r\n        }).attr(\"width\", 6).attr(\"height\", 6).style(\"visibility\", \"hidden\");\r\n        resize.style(\"display\", brush.empty() ? \"none\" : null);\r\n        var gUpdate = d3.transition(g), backgroundUpdate = d3.transition(background), range;\r\n        if (x) {\r\n          range = d3_scaleRange(x);\r\n          backgroundUpdate.attr(\"x\", range[0]).attr(\"width\", range[1] - range[0]);\r\n          redrawX(gUpdate);\r\n        }\r\n        if (y) {\r\n          range = d3_scaleRange(y);\r\n          backgroundUpdate.attr(\"y\", range[0]).attr(\"height\", range[1] - range[0]);\r\n          redrawY(gUpdate);\r\n        }\r\n        redraw(gUpdate);\r\n      });\r\n    }\r\n    brush.event = function(g) {\r\n      g.each(function() {\r\n        var event_ = event.of(this, arguments), extent1 = {\r\n          x: xExtent,\r\n          y: yExtent,\r\n          i: xExtentDomain,\r\n          j: yExtentDomain\r\n        }, extent0 = this.__chart__ || extent1;\r\n        this.__chart__ = extent1;\r\n        if (d3_transitionInheritId) {\r\n          d3.select(this).transition().each(\"start.brush\", function() {\r\n            xExtentDomain = extent0.i;\r\n            yExtentDomain = extent0.j;\r\n            xExtent = extent0.x;\r\n            yExtent = extent0.y;\r\n            event_({\r\n              type: \"brushstart\"\r\n            });\r\n          }).tween(\"brush:brush\", function() {\r\n            var xi = d3_interpolateArray(xExtent, extent1.x), yi = d3_interpolateArray(yExtent, extent1.y);\r\n            xExtentDomain = yExtentDomain = null;\r\n            return function(t) {\r\n              xExtent = extent1.x = xi(t);\r\n              yExtent = extent1.y = yi(t);\r\n              event_({\r\n                type: \"brush\",\r\n                mode: \"resize\"\r\n              });\r\n            };\r\n          }).each(\"end.brush\", function() {\r\n            xExtentDomain = extent1.i;\r\n            yExtentDomain = extent1.j;\r\n            event_({\r\n              type: \"brush\",\r\n              mode: \"resize\"\r\n            });\r\n            event_({\r\n              type: \"brushend\"\r\n            });\r\n          });\r\n        } else {\r\n          event_({\r\n            type: \"brushstart\"\r\n          });\r\n          event_({\r\n            type: \"brush\",\r\n            mode: \"resize\"\r\n          });\r\n          event_({\r\n            type: \"brushend\"\r\n          });\r\n        }\r\n      });\r\n    };\r\n    function redraw(g) {\r\n      g.selectAll(\".resize\").attr(\"transform\", function(d) {\r\n        return \"translate(\" + xExtent[+/e$/.test(d)] + \",\" + yExtent[+/^s/.test(d)] + \")\";\r\n      });\r\n    }\r\n    function redrawX(g) {\r\n      g.select(\".extent\").attr(\"x\", xExtent[0]);\r\n      g.selectAll(\".extent,.n>rect,.s>rect\").attr(\"width\", xExtent[1] - xExtent[0]);\r\n    }\r\n    function redrawY(g) {\r\n      g.select(\".extent\").attr(\"y\", yExtent[0]);\r\n      g.selectAll(\".extent,.e>rect,.w>rect\").attr(\"height\", yExtent[1] - yExtent[0]);\r\n    }\r\n    function brushstart() {\r\n      var target = this, eventTarget = d3.select(d3.event.target), event_ = event.of(target, arguments), g = d3.select(target), resizing = eventTarget.datum(), resizingX = !/^(n|s)$/.test(resizing) && x, resizingY = !/^(e|w)$/.test(resizing) && y, dragging = eventTarget.classed(\"extent\"), dragRestore = d3_event_dragSuppress(target), center, origin = d3.mouse(target), offset;\r\n      var w = d3.select(d3_window(target)).on(\"keydown.brush\", keydown).on(\"keyup.brush\", keyup);\r\n      if (d3.event.changedTouches) {\r\n        w.on(\"touchmove.brush\", brushmove).on(\"touchend.brush\", brushend);\r\n      } else {\r\n        w.on(\"mousemove.brush\", brushmove).on(\"mouseup.brush\", brushend);\r\n      }\r\n      g.interrupt().selectAll(\"*\").interrupt();\r\n      if (dragging) {\r\n        origin[0] = xExtent[0] - origin[0];\r\n        origin[1] = yExtent[0] - origin[1];\r\n      } else if (resizing) {\r\n        var ex = +/w$/.test(resizing), ey = +/^n/.test(resizing);\r\n        offset = [ xExtent[1 - ex] - origin[0], yExtent[1 - ey] - origin[1] ];\r\n        origin[0] = xExtent[ex];\r\n        origin[1] = yExtent[ey];\r\n      } else if (d3.event.altKey) center = origin.slice();\r\n      g.style(\"pointer-events\", \"none\").selectAll(\".resize\").style(\"display\", null);\r\n      d3.select(\"body\").style(\"cursor\", eventTarget.style(\"cursor\"));\r\n      event_({\r\n        type: \"brushstart\"\r\n      });\r\n      brushmove();\r\n      function keydown() {\r\n        if (d3.event.keyCode == 32) {\r\n          if (!dragging) {\r\n            center = null;\r\n            origin[0] -= xExtent[1];\r\n            origin[1] -= yExtent[1];\r\n            dragging = 2;\r\n          }\r\n          d3_eventPreventDefault();\r\n        }\r\n      }\r\n      function keyup() {\r\n        if (d3.event.keyCode == 32 && dragging == 2) {\r\n          origin[0] += xExtent[1];\r\n          origin[1] += yExtent[1];\r\n          dragging = 0;\r\n          d3_eventPreventDefault();\r\n        }\r\n      }\r\n      function brushmove() {\r\n        var point = d3.mouse(target), moved = false;\r\n        if (offset) {\r\n          point[0] += offset[0];\r\n          point[1] += offset[1];\r\n        }\r\n        if (!dragging) {\r\n          if (d3.event.altKey) {\r\n            if (!center) center = [ (xExtent[0] + xExtent[1]) / 2, (yExtent[0] + yExtent[1]) / 2 ];\r\n            origin[0] = xExtent[+(point[0] < center[0])];\r\n            origin[1] = yExtent[+(point[1] < center[1])];\r\n          } else center = null;\r\n        }\r\n        if (resizingX && move1(point, x, 0)) {\r\n          redrawX(g);\r\n          moved = true;\r\n        }\r\n        if (resizingY && move1(point, y, 1)) {\r\n          redrawY(g);\r\n          moved = true;\r\n        }\r\n        if (moved) {\r\n          redraw(g);\r\n          event_({\r\n            type: \"brush\",\r\n            mode: dragging ? \"move\" : \"resize\"\r\n          });\r\n        }\r\n      }\r\n      function move1(point, scale, i) {\r\n        var range = d3_scaleRange(scale), r0 = range[0], r1 = range[1], position = origin[i], extent = i ? yExtent : xExtent, size = extent[1] - extent[0], min, max;\r\n        if (dragging) {\r\n          r0 -= position;\r\n          r1 -= size + position;\r\n        }\r\n        min = (i ? yClamp : xClamp) ? Math.max(r0, Math.min(r1, point[i])) : point[i];\r\n        if (dragging) {\r\n          max = (min += position) + size;\r\n        } else {\r\n          if (center) position = Math.max(r0, Math.min(r1, 2 * center[i] - min));\r\n          if (position < min) {\r\n            max = min;\r\n            min = position;\r\n          } else {\r\n            max = position;\r\n          }\r\n        }\r\n        if (extent[0] != min || extent[1] != max) {\r\n          if (i) yExtentDomain = null; else xExtentDomain = null;\r\n          extent[0] = min;\r\n          extent[1] = max;\r\n          return true;\r\n        }\r\n      }\r\n      function brushend() {\r\n        brushmove();\r\n        g.style(\"pointer-events\", \"all\").selectAll(\".resize\").style(\"display\", brush.empty() ? \"none\" : null);\r\n        d3.select(\"body\").style(\"cursor\", null);\r\n        w.on(\"mousemove.brush\", null).on(\"mouseup.brush\", null).on(\"touchmove.brush\", null).on(\"touchend.brush\", null).on(\"keydown.brush\", null).on(\"keyup.brush\", null);\r\n        dragRestore();\r\n        event_({\r\n          type: \"brushend\"\r\n        });\r\n      }\r\n    }\r\n    brush.x = function(z) {\r\n      if (!arguments.length) return x;\r\n      x = z;\r\n      resizes = d3_svg_brushResizes[!x << 1 | !y];\r\n      return brush;\r\n    };\r\n    brush.y = function(z) {\r\n      if (!arguments.length) return y;\r\n      y = z;\r\n      resizes = d3_svg_brushResizes[!x << 1 | !y];\r\n      return brush;\r\n    };\r\n    brush.clamp = function(z) {\r\n      if (!arguments.length) return x && y ? [ xClamp, yClamp ] : x ? xClamp : y ? yClamp : null;\r\n      if (x && y) xClamp = !!z[0], yClamp = !!z[1]; else if (x) xClamp = !!z; else if (y) yClamp = !!z;\r\n      return brush;\r\n    };\r\n    brush.extent = function(z) {\r\n      var x0, x1, y0, y1, t;\r\n      if (!arguments.length) {\r\n        if (x) {\r\n          if (xExtentDomain) {\r\n            x0 = xExtentDomain[0], x1 = xExtentDomain[1];\r\n          } else {\r\n            x0 = xExtent[0], x1 = xExtent[1];\r\n            if (x.invert) x0 = x.invert(x0), x1 = x.invert(x1);\r\n            if (x1 < x0) t = x0, x0 = x1, x1 = t;\r\n          }\r\n        }\r\n        if (y) {\r\n          if (yExtentDomain) {\r\n            y0 = yExtentDomain[0], y1 = yExtentDomain[1];\r\n          } else {\r\n            y0 = yExtent[0], y1 = yExtent[1];\r\n            if (y.invert) y0 = y.invert(y0), y1 = y.invert(y1);\r\n            if (y1 < y0) t = y0, y0 = y1, y1 = t;\r\n          }\r\n        }\r\n        return x && y ? [ [ x0, y0 ], [ x1, y1 ] ] : x ? [ x0, x1 ] : y && [ y0, y1 ];\r\n      }\r\n      if (x) {\r\n        x0 = z[0], x1 = z[1];\r\n        if (y) x0 = x0[0], x1 = x1[0];\r\n        xExtentDomain = [ x0, x1 ];\r\n        if (x.invert) x0 = x(x0), x1 = x(x1);\r\n        if (x1 < x0) t = x0, x0 = x1, x1 = t;\r\n        if (x0 != xExtent[0] || x1 != xExtent[1]) xExtent = [ x0, x1 ];\r\n      }\r\n      if (y) {\r\n        y0 = z[0], y1 = z[1];\r\n        if (x) y0 = y0[1], y1 = y1[1];\r\n        yExtentDomain = [ y0, y1 ];\r\n        if (y.invert) y0 = y(y0), y1 = y(y1);\r\n        if (y1 < y0) t = y0, y0 = y1, y1 = t;\r\n        if (y0 != yExtent[0] || y1 != yExtent[1]) yExtent = [ y0, y1 ];\r\n      }\r\n      return brush;\r\n    };\r\n    brush.clear = function() {\r\n      if (!brush.empty()) {\r\n        xExtent = [ 0, 0 ], yExtent = [ 0, 0 ];\r\n        xExtentDomain = yExtentDomain = null;\r\n      }\r\n      return brush;\r\n    };\r\n    brush.empty = function() {\r\n      return !!x && xExtent[0] == xExtent[1] || !!y && yExtent[0] == yExtent[1];\r\n    };\r\n    return d3.rebind(brush, event, \"on\");\r\n  };\r\n  var d3_svg_brushCursor = {\r\n    n: \"ns-resize\",\r\n    e: \"ew-resize\",\r\n    s: \"ns-resize\",\r\n    w: \"ew-resize\",\r\n    nw: \"nwse-resize\",\r\n    ne: \"nesw-resize\",\r\n    se: \"nwse-resize\",\r\n    sw: \"nesw-resize\"\r\n  };\r\n  var d3_svg_brushResizes = [ [ \"n\", \"e\", \"s\", \"w\", \"nw\", \"ne\", \"se\", \"sw\" ], [ \"e\", \"w\" ], [ \"n\", \"s\" ], [] ];\r\n  var d3_time_format = d3_time.format = d3_locale_enUS.timeFormat;\r\n  var d3_time_formatUtc = d3_time_format.utc;\r\n  var d3_time_formatIso = d3_time_formatUtc(\"%Y-%m-%dT%H:%M:%S.%LZ\");\r\n  d3_time_format.iso = Date.prototype.toISOString && +new Date(\"2000-01-01T00:00:00.000Z\") ? d3_time_formatIsoNative : d3_time_formatIso;\r\n  function d3_time_formatIsoNative(date) {\r\n    return date.toISOString();\r\n  }\r\n  d3_time_formatIsoNative.parse = function(string) {\r\n    var date = new Date(string);\r\n    return isNaN(date) ? null : date;\r\n  };\r\n  d3_time_formatIsoNative.toString = d3_time_formatIso.toString;\r\n  d3_time.second = d3_time_interval(function(date) {\r\n    return new d3_date(Math.floor(date / 1e3) * 1e3);\r\n  }, function(date, offset) {\r\n    date.setTime(date.getTime() + Math.floor(offset) * 1e3);\r\n  }, function(date) {\r\n    return date.getSeconds();\r\n  });\r\n  d3_time.seconds = d3_time.second.range;\r\n  d3_time.seconds.utc = d3_time.second.utc.range;\r\n  d3_time.minute = d3_time_interval(function(date) {\r\n    return new d3_date(Math.floor(date / 6e4) * 6e4);\r\n  }, function(date, offset) {\r\n    date.setTime(date.getTime() + Math.floor(offset) * 6e4);\r\n  }, function(date) {\r\n    return date.getMinutes();\r\n  });\r\n  d3_time.minutes = d3_time.minute.range;\r\n  d3_time.minutes.utc = d3_time.minute.utc.range;\r\n  d3_time.hour = d3_time_interval(function(date) {\r\n    var timezone = date.getTimezoneOffset() / 60;\r\n    return new d3_date((Math.floor(date / 36e5 - timezone) + timezone) * 36e5);\r\n  }, function(date, offset) {\r\n    date.setTime(date.getTime() + Math.floor(offset) * 36e5);\r\n  }, function(date) {\r\n    return date.getHours();\r\n  });\r\n  d3_time.hours = d3_time.hour.range;\r\n  d3_time.hours.utc = d3_time.hour.utc.range;\r\n  d3_time.month = d3_time_interval(function(date) {\r\n    date = d3_time.day(date);\r\n    date.setDate(1);\r\n    return date;\r\n  }, function(date, offset) {\r\n    date.setMonth(date.getMonth() + offset);\r\n  }, function(date) {\r\n    return date.getMonth();\r\n  });\r\n  d3_time.months = d3_time.month.range;\r\n  d3_time.months.utc = d3_time.month.utc.range;\r\n  function d3_time_scale(linear, methods, format) {\r\n    function scale(x) {\r\n      return linear(x);\r\n    }\r\n    scale.invert = function(x) {\r\n      return d3_time_scaleDate(linear.invert(x));\r\n    };\r\n    scale.domain = function(x) {\r\n      if (!arguments.length) return linear.domain().map(d3_time_scaleDate);\r\n      linear.domain(x);\r\n      return scale;\r\n    };\r\n    function tickMethod(extent, count) {\r\n      var span = extent[1] - extent[0], target = span / count, i = d3.bisect(d3_time_scaleSteps, target);\r\n      return i == d3_time_scaleSteps.length ? [ methods.year, d3_scale_linearTickRange(extent.map(function(d) {\r\n        return d / 31536e6;\r\n      }), count)[2] ] : !i ? [ d3_time_scaleMilliseconds, d3_scale_linearTickRange(extent, count)[2] ] : methods[target / d3_time_scaleSteps[i - 1] < d3_time_scaleSteps[i] / target ? i - 1 : i];\r\n    }\r\n    scale.nice = function(interval, skip) {\r\n      var domain = scale.domain(), extent = d3_scaleExtent(domain), method = interval == null ? tickMethod(extent, 10) : typeof interval === \"number\" && tickMethod(extent, interval);\r\n      if (method) interval = method[0], skip = method[1];\r\n      function skipped(date) {\r\n        return !isNaN(date) && !interval.range(date, d3_time_scaleDate(+date + 1), skip).length;\r\n      }\r\n      return scale.domain(d3_scale_nice(domain, skip > 1 ? {\r\n        floor: function(date) {\r\n          while (skipped(date = interval.floor(date))) date = d3_time_scaleDate(date - 1);\r\n          return date;\r\n        },\r\n        ceil: function(date) {\r\n          while (skipped(date = interval.ceil(date))) date = d3_time_scaleDate(+date + 1);\r\n          return date;\r\n        }\r\n      } : interval));\r\n    };\r\n    scale.ticks = function(interval, skip) {\r\n      var extent = d3_scaleExtent(scale.domain()), method = interval == null ? tickMethod(extent, 10) : typeof interval === \"number\" ? tickMethod(extent, interval) : !interval.range && [ {\r\n        range: interval\r\n      }, skip ];\r\n      if (method) interval = method[0], skip = method[1];\r\n      return interval.range(extent[0], d3_time_scaleDate(+extent[1] + 1), skip < 1 ? 1 : skip);\r\n    };\r\n    scale.tickFormat = function() {\r\n      return format;\r\n    };\r\n    scale.copy = function() {\r\n      return d3_time_scale(linear.copy(), methods, format);\r\n    };\r\n    return d3_scale_linearRebind(scale, linear);\r\n  }\r\n  function d3_time_scaleDate(t) {\r\n    return new Date(t);\r\n  }\r\n  var d3_time_scaleSteps = [ 1e3, 5e3, 15e3, 3e4, 6e4, 3e5, 9e5, 18e5, 36e5, 108e5, 216e5, 432e5, 864e5, 1728e5, 6048e5, 2592e6, 7776e6, 31536e6 ];\r\n  var d3_time_scaleLocalMethods = [ [ d3_time.second, 1 ], [ d3_time.second, 5 ], [ d3_time.second, 15 ], [ d3_time.second, 30 ], [ d3_time.minute, 1 ], [ d3_time.minute, 5 ], [ d3_time.minute, 15 ], [ d3_time.minute, 30 ], [ d3_time.hour, 1 ], [ d3_time.hour, 3 ], [ d3_time.hour, 6 ], [ d3_time.hour, 12 ], [ d3_time.day, 1 ], [ d3_time.day, 2 ], [ d3_time.week, 1 ], [ d3_time.month, 1 ], [ d3_time.month, 3 ], [ d3_time.year, 1 ] ];\r\n  var d3_time_scaleLocalFormat = d3_time_format.multi([ [ \".%L\", function(d) {\r\n    return d.getMilliseconds();\r\n  } ], [ \":%S\", function(d) {\r\n    return d.getSeconds();\r\n  } ], [ \"%I:%M\", function(d) {\r\n    return d.getMinutes();\r\n  } ], [ \"%I %p\", function(d) {\r\n    return d.getHours();\r\n  } ], [ \"%a %d\", function(d) {\r\n    return d.getDay() && d.getDate() != 1;\r\n  } ], [ \"%b %d\", function(d) {\r\n    return d.getDate() != 1;\r\n  } ], [ \"%B\", function(d) {\r\n    return d.getMonth();\r\n  } ], [ \"%Y\", d3_true ] ]);\r\n  var d3_time_scaleMilliseconds = {\r\n    range: function(start, stop, step) {\r\n      return d3.range(Math.ceil(start / step) * step, +stop, step).map(d3_time_scaleDate);\r\n    },\r\n    floor: d3_identity,\r\n    ceil: d3_identity\r\n  };\r\n  d3_time_scaleLocalMethods.year = d3_time.year;\r\n  d3_time.scale = function() {\r\n    return d3_time_scale(d3.scale.linear(), d3_time_scaleLocalMethods, d3_time_scaleLocalFormat);\r\n  };\r\n  var d3_time_scaleUtcMethods = d3_time_scaleLocalMethods.map(function(m) {\r\n    return [ m[0].utc, m[1] ];\r\n  });\r\n  var d3_time_scaleUtcFormat = d3_time_formatUtc.multi([ [ \".%L\", function(d) {\r\n    return d.getUTCMilliseconds();\r\n  } ], [ \":%S\", function(d) {\r\n    return d.getUTCSeconds();\r\n  } ], [ \"%I:%M\", function(d) {\r\n    return d.getUTCMinutes();\r\n  } ], [ \"%I %p\", function(d) {\r\n    return d.getUTCHours();\r\n  } ], [ \"%a %d\", function(d) {\r\n    return d.getUTCDay() && d.getUTCDate() != 1;\r\n  } ], [ \"%b %d\", function(d) {\r\n    return d.getUTCDate() != 1;\r\n  } ], [ \"%B\", function(d) {\r\n    return d.getUTCMonth();\r\n  } ], [ \"%Y\", d3_true ] ]);\r\n  d3_time_scaleUtcMethods.year = d3_time.year.utc;\r\n  d3_time.scale.utc = function() {\r\n    return d3_time_scale(d3.scale.linear(), d3_time_scaleUtcMethods, d3_time_scaleUtcFormat);\r\n  };\r\n  d3.text = d3_xhrType(function(request) {\r\n    return request.responseText;\r\n  });\r\n  d3.json = function(url, callback) {\r\n    return d3_xhr(url, \"application/json\", d3_json, callback);\r\n  };\r\n  function d3_json(request) {\r\n    return JSON.parse(request.responseText);\r\n  }\r\n  d3.html = function(url, callback) {\r\n    return d3_xhr(url, \"text/html\", d3_html, callback);\r\n  };\r\n  function d3_html(request) {\r\n    var range = d3_document.createRange();\r\n    range.selectNode(d3_document.body);\r\n    return range.createContextualFragment(request.responseText);\r\n  }\r\n  d3.xml = d3_xhrType(function(request) {\r\n    return request.responseXML;\r\n  });\r\n  if (typeof define === \"function\" && define.amd) this.d3 = d3, define(d3); else if (typeof module === \"object\" && module.exports) module.exports = d3; else this.d3 = d3;\r\n}();\n;(function() {\r\n  d3.geo.project = function(object, projection) {\r\n    var stream = projection.stream;\r\n    if (!stream) throw new Error(\"not yet supported\");\r\n    return (object && d3_geo_projectObjectType.hasOwnProperty(object.type) ? d3_geo_projectObjectType[object.type] : d3_geo_projectGeometry)(object, stream);\r\n  };\r\n  function d3_geo_projectFeature(object, stream) {\r\n    return {\r\n      type: \"Feature\",\r\n      id: object.id,\r\n      properties: object.properties,\r\n      geometry: d3_geo_projectGeometry(object.geometry, stream)\r\n    };\r\n  }\r\n  function d3_geo_projectGeometry(geometry, stream) {\r\n    if (!geometry) return null;\r\n    if (geometry.type === \"GeometryCollection\") return {\r\n      type: \"GeometryCollection\",\r\n      geometries: object.geometries.map(function(geometry) {\r\n        return d3_geo_projectGeometry(geometry, stream);\r\n      })\r\n    };\r\n    if (!d3_geo_projectGeometryType.hasOwnProperty(geometry.type)) return null;\r\n    var sink = d3_geo_projectGeometryType[geometry.type];\r\n    d3.geo.stream(geometry, stream(sink));\r\n    return sink.result();\r\n  }\r\n  var d3_geo_projectObjectType = {\r\n    Feature: d3_geo_projectFeature,\r\n    FeatureCollection: function(object, stream) {\r\n      return {\r\n        type: \"FeatureCollection\",\r\n        features: object.features.map(function(feature) {\r\n          return d3_geo_projectFeature(feature, stream);\r\n        })\r\n      };\r\n    }\r\n  };\r\n  var d3_geo_projectPoints = [], d3_geo_projectLines = [];\r\n  var d3_geo_projectPoint = {\r\n    point: function(x, y) {\r\n      d3_geo_projectPoints.push([ x, y ]);\r\n    },\r\n    result: function() {\r\n      var result = !d3_geo_projectPoints.length ? null : d3_geo_projectPoints.length < 2 ? {\r\n        type: \"Point\",\r\n        coordinates: d3_geo_projectPoints[0]\r\n      } : {\r\n        type: \"MultiPoint\",\r\n        coordinates: d3_geo_projectPoints\r\n      };\r\n      d3_geo_projectPoints = [];\r\n      return result;\r\n    }\r\n  };\r\n  var d3_geo_projectLine = {\r\n    lineStart: d3_geo_projectNoop,\r\n    point: function(x, y) {\r\n      d3_geo_projectPoints.push([ x, y ]);\r\n    },\r\n    lineEnd: function() {\r\n      if (d3_geo_projectPoints.length) d3_geo_projectLines.push(d3_geo_projectPoints), \r\n      d3_geo_projectPoints = [];\r\n    },\r\n    result: function() {\r\n      var result = !d3_geo_projectLines.length ? null : d3_geo_projectLines.length < 2 ? {\r\n        type: \"LineString\",\r\n        coordinates: d3_geo_projectLines[0]\r\n      } : {\r\n        type: \"MultiLineString\",\r\n        coordinates: d3_geo_projectLines\r\n      };\r\n      d3_geo_projectLines = [];\r\n      return result;\r\n    }\r\n  };\r\n  var d3_geo_projectPolygon = {\r\n    polygonStart: d3_geo_projectNoop,\r\n    lineStart: d3_geo_projectNoop,\r\n    point: function(x, y) {\r\n      d3_geo_projectPoints.push([ x, y ]);\r\n    },\r\n    lineEnd: function() {\r\n      var n = d3_geo_projectPoints.length;\r\n      if (n) {\r\n        do d3_geo_projectPoints.push(d3_geo_projectPoints[0].slice()); while (++n < 4);\r\n        d3_geo_projectLines.push(d3_geo_projectPoints), d3_geo_projectPoints = [];\r\n      }\r\n    },\r\n    polygonEnd: d3_geo_projectNoop,\r\n    result: function() {\r\n      if (!d3_geo_projectLines.length) return null;\r\n      var polygons = [], holes = [];\r\n      d3_geo_projectLines.forEach(function(ring) {\r\n        if (d3_geo_projectClockwise(ring)) polygons.push([ ring ]); else holes.push(ring);\r\n      });\r\n      holes.forEach(function(hole) {\r\n        var point = hole[0];\r\n        polygons.some(function(polygon) {\r\n          if (d3_geo_projectContains(polygon[0], point)) {\r\n            polygon.push(hole);\r\n            return true;\r\n          }\r\n        }) || polygons.push([ hole ]);\r\n      });\r\n      d3_geo_projectLines = [];\r\n      return !polygons.length ? null : polygons.length > 1 ? {\r\n        type: \"MultiPolygon\",\r\n        coordinates: polygons\r\n      } : {\r\n        type: \"Polygon\",\r\n        coordinates: polygons[0]\r\n      };\r\n    }\r\n  };\r\n  var d3_geo_projectGeometryType = {\r\n    Point: d3_geo_projectPoint,\r\n    MultiPoint: d3_geo_projectPoint,\r\n    LineString: d3_geo_projectLine,\r\n    MultiLineString: d3_geo_projectLine,\r\n    Polygon: d3_geo_projectPolygon,\r\n    MultiPolygon: d3_geo_projectPolygon,\r\n    Sphere: d3_geo_projectPolygon\r\n  };\r\n  function d3_geo_projectNoop() {}\r\n  function d3_geo_projectClockwise(ring) {\r\n    if ((n = ring.length) < 4) return false;\r\n    var i = 0, n, area = ring[n - 1][1] * ring[0][0] - ring[n - 1][0] * ring[0][1];\r\n    while (++i < n) area += ring[i - 1][1] * ring[i][0] - ring[i - 1][0] * ring[i][1];\r\n    return area <= 0;\r\n  }\r\n  function d3_geo_projectContains(ring, point) {\r\n    var x = point[0], y = point[1], contains = false;\r\n    for (var i = 0, n = ring.length, j = n - 1; i < n; j = i++) {\r\n      var pi = ring[i], xi = pi[0], yi = pi[1], pj = ring[j], xj = pj[0], yj = pj[1];\r\n      if (yi > y ^ yj > y && x < (xj - xi) * (y - yi) / (yj - yi) + xi) contains = !contains;\r\n    }\r\n    return contains;\r\n  }\r\n  var ε = 1e-6, ε2 = ε * ε, π = Math.PI, halfπ = π / 2, sqrtπ = Math.sqrt(π), radians = π / 180, degrees = 180 / π;\r\n  function sinci(x) {\r\n    return x ? x / Math.sin(x) : 1;\r\n  }\r\n  function sgn(x) {\r\n    return x > 0 ? 1 : x < 0 ? -1 : 0;\r\n  }\r\n  function asin(x) {\r\n    return x > 1 ? halfπ : x < -1 ? -halfπ : Math.asin(x);\r\n  }\r\n  function acos(x) {\r\n    return x > 1 ? 0 : x < -1 ? π : Math.acos(x);\r\n  }\r\n  function asqrt(x) {\r\n    return x > 0 ? Math.sqrt(x) : 0;\r\n  }\r\n  var projection = d3.geo.projection, projectionMutator = d3.geo.projectionMutator;\r\n  d3.geo.interrupt = function(project) {\r\n    var lobes = [ [ [ [ -π, 0 ], [ 0, halfπ ], [ π, 0 ] ] ], [ [ [ -π, 0 ], [ 0, -halfπ ], [ π, 0 ] ] ] ];\r\n    var bounds;\r\n    function forward(λ, φ) {\r\n      var sign = φ < 0 ? -1 : +1, hemilobes = lobes[+(φ < 0)];\r\n      for (var i = 0, n = hemilobes.length - 1; i < n && λ > hemilobes[i][2][0]; ++i) ;\r\n      var coordinates = project(λ - hemilobes[i][1][0], φ);\r\n      coordinates[0] += project(hemilobes[i][1][0], sign * φ > sign * hemilobes[i][0][1] ? hemilobes[i][0][1] : φ)[0];\r\n      return coordinates;\r\n    }\r\n    function reset() {\r\n      bounds = lobes.map(function(hemilobes) {\r\n        return hemilobes.map(function(lobe) {\r\n          var x0 = project(lobe[0][0], lobe[0][1])[0], x1 = project(lobe[2][0], lobe[2][1])[0], y0 = project(lobe[1][0], lobe[0][1])[1], y1 = project(lobe[1][0], lobe[1][1])[1], t;\r\n          if (y0 > y1) t = y0, y0 = y1, y1 = t;\r\n          return [ [ x0, y0 ], [ x1, y1 ] ];\r\n        });\r\n      });\r\n    }\r\n    if (project.invert) forward.invert = function(x, y) {\r\n      var hemibounds = bounds[+(y < 0)], hemilobes = lobes[+(y < 0)];\r\n      for (var i = 0, n = hemibounds.length; i < n; ++i) {\r\n        var b = hemibounds[i];\r\n        if (b[0][0] <= x && x < b[1][0] && b[0][1] <= y && y < b[1][1]) {\r\n          var coordinates = project.invert(x - project(hemilobes[i][1][0], 0)[0], y);\r\n          coordinates[0] += hemilobes[i][1][0];\r\n          return pointEqual(forward(coordinates[0], coordinates[1]), [ x, y ]) ? coordinates : null;\r\n        }\r\n      }\r\n    };\r\n    var projection = d3.geo.projection(forward), stream_ = projection.stream;\r\n    projection.stream = function(stream) {\r\n      var rotate = projection.rotate(), rotateStream = stream_(stream), sphereStream = (projection.rotate([ 0, 0 ]), \r\n      stream_(stream));\r\n      projection.rotate(rotate);\r\n      rotateStream.sphere = function() {\r\n        d3.geo.stream(sphere(), sphereStream);\r\n      };\r\n      return rotateStream;\r\n    };\r\n    projection.lobes = function(_) {\r\n      if (!arguments.length) return lobes.map(function(lobes) {\r\n        return lobes.map(function(lobe) {\r\n          return [ [ lobe[0][0] * 180 / π, lobe[0][1] * 180 / π ], [ lobe[1][0] * 180 / π, lobe[1][1] * 180 / π ], [ lobe[2][0] * 180 / π, lobe[2][1] * 180 / π ] ];\r\n        });\r\n      });\r\n      lobes = _.map(function(lobes) {\r\n        return lobes.map(function(lobe) {\r\n          return [ [ lobe[0][0] * π / 180, lobe[0][1] * π / 180 ], [ lobe[1][0] * π / 180, lobe[1][1] * π / 180 ], [ lobe[2][0] * π / 180, lobe[2][1] * π / 180 ] ];\r\n        });\r\n      });\r\n      reset();\r\n      return projection;\r\n    };\r\n    function sphere() {\r\n      var ε = 1e-6, coordinates = [];\r\n      for (var i = 0, n = lobes[0].length; i < n; ++i) {\r\n        var lobe = lobes[0][i], λ0 = lobe[0][0] * 180 / π, φ0 = lobe[0][1] * 180 / π, φ1 = lobe[1][1] * 180 / π, λ2 = lobe[2][0] * 180 / π, φ2 = lobe[2][1] * 180 / π;\r\n        coordinates.push(resample([ [ λ0 + ε, φ0 + ε ], [ λ0 + ε, φ1 - ε ], [ λ2 - ε, φ1 - ε ], [ λ2 - ε, φ2 + ε ] ], 30));\r\n      }\r\n      for (var i = lobes[1].length - 1; i >= 0; --i) {\r\n        var lobe = lobes[1][i], λ0 = lobe[0][0] * 180 / π, φ0 = lobe[0][1] * 180 / π, φ1 = lobe[1][1] * 180 / π, λ2 = lobe[2][0] * 180 / π, φ2 = lobe[2][1] * 180 / π;\r\n        coordinates.push(resample([ [ λ2 - ε, φ2 - ε ], [ λ2 - ε, φ1 + ε ], [ λ0 + ε, φ1 + ε ], [ λ0 + ε, φ0 - ε ] ], 30));\r\n      }\r\n      return {\r\n        type: \"Polygon\",\r\n        coordinates: [ d3.merge(coordinates) ]\r\n      };\r\n    }\r\n    function resample(coordinates, m) {\r\n      var i = -1, n = coordinates.length, p0 = coordinates[0], p1, dx, dy, resampled = [];\r\n      while (++i < n) {\r\n        p1 = coordinates[i];\r\n        dx = (p1[0] - p0[0]) / m;\r\n        dy = (p1[1] - p0[1]) / m;\r\n        for (var j = 0; j < m; ++j) resampled.push([ p0[0] + j * dx, p0[1] + j * dy ]);\r\n        p0 = p1;\r\n      }\r\n      resampled.push(p1);\r\n      return resampled;\r\n    }\r\n    function pointEqual(a, b) {\r\n      return Math.abs(a[0] - b[0]) < ε && Math.abs(a[1] - b[1]) < ε;\r\n    }\r\n    return projection;\r\n  };\r\n  function airy(β) {\r\n    var tanβ_2 = Math.tan(.5 * β), B = 2 * Math.log(Math.cos(.5 * β)) / (tanβ_2 * tanβ_2);\r\n    function forward(λ, φ) {\r\n      var cosλ = Math.cos(λ), cosφ = Math.cos(φ), sinφ = Math.sin(φ), cosz = cosφ * cosλ, K = -((1 - cosz ? Math.log(.5 * (1 + cosz)) / (1 - cosz) : -.5) + B / (1 + cosz));\r\n      return [ K * cosφ * Math.sin(λ), K * sinφ ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var ρ = Math.sqrt(x * x + y * y), z = β * -.5, i = 50, δ;\r\n      if (!ρ) return [ 0, 0 ];\r\n      do {\r\n        var z_2 = .5 * z, cosz_2 = Math.cos(z_2), sinz_2 = Math.sin(z_2), tanz_2 = Math.tan(z_2), lnsecz_2 = Math.log(1 / cosz_2);\r\n        z -= δ = (2 / tanz_2 * lnsecz_2 - B * tanz_2 - ρ) / (-lnsecz_2 / (sinz_2 * sinz_2) + 1 - B / (2 * cosz_2 * cosz_2));\r\n      } while (Math.abs(δ) > ε && --i > 0);\r\n      var sinz = Math.sin(z);\r\n      return [ Math.atan2(x * sinz, ρ * Math.cos(z)), asin(y * sinz / ρ) ];\r\n    };\r\n    return forward;\r\n  }\r\n  function airyProjection() {\r\n    var β = halfπ, m = projectionMutator(airy), p = m(β);\r\n    p.radius = function(_) {\r\n      if (!arguments.length) return β / π * 180;\r\n      return m(β = _ * π / 180);\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.airy = airyProjection).raw = airy;\r\n  function aitoff(λ, φ) {\r\n    var cosφ = Math.cos(φ), sinciα = sinci(acos(cosφ * Math.cos(λ /= 2)));\r\n    return [ 2 * cosφ * Math.sin(λ) * sinciα, Math.sin(φ) * sinciα ];\r\n  }\r\n  aitoff.invert = function(x, y) {\r\n    if (x * x + 4 * y * y > π * π + ε) return;\r\n    var λ = x, φ = y, i = 25;\r\n    do {\r\n      var sinλ = Math.sin(λ), sinλ_2 = Math.sin(λ / 2), cosλ_2 = Math.cos(λ / 2), sinφ = Math.sin(φ), cosφ = Math.cos(φ), sin_2φ = Math.sin(2 * φ), sin2φ = sinφ * sinφ, cos2φ = cosφ * cosφ, sin2λ_2 = sinλ_2 * sinλ_2, C = 1 - cos2φ * cosλ_2 * cosλ_2, E = C ? acos(cosφ * cosλ_2) * Math.sqrt(F = 1 / C) : F = 0, F, fx = 2 * E * cosφ * sinλ_2 - x, fy = E * sinφ - y, δxδλ = F * (cos2φ * sin2λ_2 + E * cosφ * cosλ_2 * sin2φ), δxδφ = F * (.5 * sinλ * sin_2φ - E * 2 * sinφ * sinλ_2), δyδλ = F * .25 * (sin_2φ * sinλ_2 - E * sinφ * cos2φ * sinλ), δyδφ = F * (sin2φ * cosλ_2 + E * sin2λ_2 * cosφ), denominator = δxδφ * δyδλ - δyδφ * δxδλ;\r\n      if (!denominator) break;\r\n      var δλ = (fy * δxδφ - fx * δyδφ) / denominator, δφ = (fx * δyδλ - fy * δxδλ) / denominator;\r\n      λ -= δλ, φ -= δφ;\r\n    } while ((Math.abs(δλ) > ε || Math.abs(δφ) > ε) && --i > 0);\r\n    return [ λ, φ ];\r\n  };\r\n  (d3.geo.aitoff = function() {\r\n    return projection(aitoff);\r\n  }).raw = aitoff;\r\n  function armadillo(φ0) {\r\n    var sinφ0 = Math.sin(φ0), cosφ0 = Math.cos(φ0), sφ0 = φ0 > 0 ? 1 : -1, tanφ0 = Math.tan(sφ0 * φ0), k = (1 + sinφ0 - cosφ0) / 2;\r\n    function forward(λ, φ) {\r\n      var cosφ = Math.cos(φ), cosλ = Math.cos(λ /= 2);\r\n      return [ (1 + cosφ) * Math.sin(λ), (sφ0 * φ > -Math.atan2(cosλ, tanφ0) - .001 ? 0 : -sφ0 * 10) + k + Math.sin(φ) * cosφ0 - (1 + cosφ) * sinφ0 * cosλ ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var λ = 0, φ = 0, i = 50;\r\n      do {\r\n        var cosλ = Math.cos(λ), sinλ = Math.sin(λ), cosφ = Math.cos(φ), sinφ = Math.sin(φ), A = 1 + cosφ, fx = A * sinλ - x, fy = k + sinφ * cosφ0 - A * sinφ0 * cosλ - y, δxδλ = .5 * A * cosλ, δxδφ = -sinλ * sinφ, δyδλ = .5 * sinφ0 * A * sinλ, δyδφ = cosφ0 * cosφ + sinφ0 * cosλ * sinφ, denominator = δxδφ * δyδλ - δyδφ * δxδλ, δλ = .5 * (fy * δxδφ - fx * δyδφ) / denominator, δφ = (fx * δyδλ - fy * δxδλ) / denominator;\r\n        λ -= δλ, φ -= δφ;\r\n      } while ((Math.abs(δλ) > ε || Math.abs(δφ) > ε) && --i > 0);\r\n      return sφ0 * φ > -Math.atan2(Math.cos(λ), tanφ0) - .001 ? [ λ * 2, φ ] : null;\r\n    };\r\n    return forward;\r\n  }\r\n  function armadilloProjection() {\r\n    var φ0 = π / 9, sφ0 = φ0 > 0 ? 1 : -1, tanφ0 = Math.tan(sφ0 * φ0), m = projectionMutator(armadillo), p = m(φ0), stream_ = p.stream;\r\n    p.parallel = function(_) {\r\n      if (!arguments.length) return φ0 / π * 180;\r\n      tanφ0 = Math.tan((sφ0 = (φ0 = _ * π / 180) > 0 ? 1 : -1) * φ0);\r\n      return m(φ0);\r\n    };\r\n    p.stream = function(stream) {\r\n      var rotate = p.rotate(), rotateStream = stream_(stream), sphereStream = (p.rotate([ 0, 0 ]), \r\n      stream_(stream));\r\n      p.rotate(rotate);\r\n      rotateStream.sphere = function() {\r\n        sphereStream.polygonStart(), sphereStream.lineStart();\r\n        for (var λ = sφ0 * -180; sφ0 * λ < 180; λ += sφ0 * 90) sphereStream.point(λ, sφ0 * 90);\r\n        while (sφ0 * (λ -= φ0) >= -180) {\r\n          sphereStream.point(λ, sφ0 * -Math.atan2(Math.cos(λ * radians / 2), tanφ0) * degrees);\r\n        }\r\n        sphereStream.lineEnd(), sphereStream.polygonEnd();\r\n      };\r\n      return rotateStream;\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.armadillo = armadilloProjection).raw = armadillo;\r\n  function tanh(x) {\r\n    x = Math.exp(2 * x);\r\n    return (x - 1) / (x + 1);\r\n  }\r\n  function sinh(x) {\r\n    return .5 * (Math.exp(x) - Math.exp(-x));\r\n  }\r\n  function cosh(x) {\r\n    return .5 * (Math.exp(x) + Math.exp(-x));\r\n  }\r\n  function arsinh(x) {\r\n    return Math.log(x + asqrt(x * x + 1));\r\n  }\r\n  function arcosh(x) {\r\n    return Math.log(x + asqrt(x * x - 1));\r\n  }\r\n  function august(λ, φ) {\r\n    var tanφ = Math.tan(φ / 2), k = asqrt(1 - tanφ * tanφ), c = 1 + k * Math.cos(λ /= 2), x = Math.sin(λ) * k / c, y = tanφ / c, x2 = x * x, y2 = y * y;\r\n    return [ 4 / 3 * x * (3 + x2 - 3 * y2), 4 / 3 * y * (3 + 3 * x2 - y2) ];\r\n  }\r\n  august.invert = function(x, y) {\r\n    x *= 3 / 8, y *= 3 / 8;\r\n    if (!x && Math.abs(y) > 1) return null;\r\n    var x2 = x * x, y2 = y * y, s = 1 + x2 + y2, sin3η = Math.sqrt(.5 * (s - Math.sqrt(s * s - 4 * y * y))), η = asin(sin3η) / 3, ξ = sin3η ? arcosh(Math.abs(y / sin3η)) / 3 : arsinh(Math.abs(x)) / 3, cosη = Math.cos(η), coshξ = cosh(ξ), d = coshξ * coshξ - cosη * cosη;\r\n    return [ sgn(x) * 2 * Math.atan2(sinh(ξ) * cosη, .25 - d), sgn(y) * 2 * Math.atan2(coshξ * Math.sin(η), .25 + d) ];\r\n  };\r\n  (d3.geo.august = function() {\r\n    return projection(august);\r\n  }).raw = august;\r\n  var bakerφ = Math.log(1 + Math.SQRT2);\r\n  function baker(λ, φ) {\r\n    var φ0 = Math.abs(φ);\r\n    return φ0 < π / 4 ? [ λ, Math.log(Math.tan(π / 4 + φ / 2)) ] : [ λ * Math.cos(φ0) * (2 * Math.SQRT2 - 1 / Math.sin(φ0)), sgn(φ) * (2 * Math.SQRT2 * (φ0 - π / 4) - Math.log(Math.tan(φ0 / 2))) ];\r\n  }\r\n  baker.invert = function(x, y) {\r\n    if ((y0 = Math.abs(y)) < bakerφ) return [ x, 2 * Math.atan(Math.exp(y)) - halfπ ];\r\n    var sqrt8 = Math.sqrt(8), φ = π / 4, i = 25, δ, y0;\r\n    do {\r\n      var cosφ_2 = Math.cos(φ / 2), tanφ_2 = Math.tan(φ / 2);\r\n      φ -= δ = (sqrt8 * (φ - π / 4) - Math.log(tanφ_2) - y0) / (sqrt8 - .5 * cosφ_2 * cosφ_2 / tanφ_2);\r\n    } while (Math.abs(δ) > ε2 && --i > 0);\r\n    return [ x / (Math.cos(φ) * (sqrt8 - 1 / Math.sin(φ))), sgn(y) * φ ];\r\n  };\r\n  (d3.geo.baker = function() {\r\n    return projection(baker);\r\n  }).raw = baker;\r\n  var berghausAzimuthalEquidistant = d3.geo.azimuthalEquidistant.raw;\r\n  function berghaus(n) {\r\n    var k = 2 * π / n;\r\n    function forward(λ, φ) {\r\n      var p = berghausAzimuthalEquidistant(λ, φ);\r\n      if (Math.abs(λ) > halfπ) {\r\n        var θ = Math.atan2(p[1], p[0]), r = Math.sqrt(p[0] * p[0] + p[1] * p[1]), θ0 = k * Math.round((θ - halfπ) / k) + halfπ, α = Math.atan2(Math.sin(θ -= θ0), 2 - Math.cos(θ));\r\n        θ = θ0 + asin(π / r * Math.sin(α)) - α;\r\n        p[0] = r * Math.cos(θ);\r\n        p[1] = r * Math.sin(θ);\r\n      }\r\n      return p;\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var r = Math.sqrt(x * x + y * y);\r\n      if (r > halfπ) {\r\n        var θ = Math.atan2(y, x), θ0 = k * Math.round((θ - halfπ) / k) + halfπ, s = θ > θ0 ? -1 : 1, A = r * Math.cos(θ0 - θ), cotα = 1 / Math.tan(s * Math.acos((A - π) / Math.sqrt(π * (π - 2 * A) + r * r)));\r\n        θ = θ0 + 2 * Math.atan((cotα + s * Math.sqrt(cotα * cotα - 3)) / 3);\r\n        x = r * Math.cos(θ), y = r * Math.sin(θ);\r\n      }\r\n      return berghausAzimuthalEquidistant.invert(x, y);\r\n    };\r\n    return forward;\r\n  }\r\n  function berghausProjection() {\r\n    var n = 5, m = projectionMutator(berghaus), p = m(n), stream_ = p.stream, ε = .01, cr = -Math.cos(ε * radians), sr = Math.sin(ε * radians);\r\n    p.lobes = function(_) {\r\n      if (!arguments.length) return n;\r\n      return m(n = +_);\r\n    };\r\n    p.stream = function(stream) {\r\n      var rotate = p.rotate(), rotateStream = stream_(stream), sphereStream = (p.rotate([ 0, 0 ]), \r\n      stream_(stream));\r\n      p.rotate(rotate);\r\n      rotateStream.sphere = function() {\r\n        sphereStream.polygonStart(), sphereStream.lineStart();\r\n        for (var i = 0, δ = 360 / n, δ0 = 2 * π / n, φ = 90 - 180 / n, φ0 = halfπ; i < n; ++i, \r\n        φ -= δ, φ0 -= δ0) {\r\n          sphereStream.point(Math.atan2(sr * Math.cos(φ0), cr) * degrees, asin(sr * Math.sin(φ0)) * degrees);\r\n          if (φ < -90) {\r\n            sphereStream.point(-90, -180 - φ - ε);\r\n            sphereStream.point(-90, -180 - φ + ε);\r\n          } else {\r\n            sphereStream.point(90, φ + ε);\r\n            sphereStream.point(90, φ - ε);\r\n          }\r\n        }\r\n        sphereStream.lineEnd(), sphereStream.polygonEnd();\r\n      };\r\n      return rotateStream;\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.berghaus = berghausProjection).raw = berghaus;\r\n  function mollweideBromleyθ(Cp) {\r\n    return function(θ) {\r\n      var Cpsinθ = Cp * Math.sin(θ), i = 30, δ;\r\n      do θ -= δ = (θ + Math.sin(θ) - Cpsinθ) / (1 + Math.cos(θ)); while (Math.abs(δ) > ε && --i > 0);\r\n      return θ / 2;\r\n    };\r\n  }\r\n  function mollweideBromley(Cx, Cy, Cp) {\r\n    var θ = mollweideBromleyθ(Cp);\r\n    function forward(λ, φ) {\r\n      return [ Cx * λ * Math.cos(φ = θ(φ)), Cy * Math.sin(φ) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var θ = asin(y / Cy);\r\n      return [ x / (Cx * Math.cos(θ)), asin((2 * θ + Math.sin(2 * θ)) / Cp) ];\r\n    };\r\n    return forward;\r\n  }\r\n  var mollweideθ = mollweideBromleyθ(π), mollweide = mollweideBromley(Math.SQRT2 / halfπ, Math.SQRT2, π);\r\n  (d3.geo.mollweide = function() {\r\n    return projection(mollweide);\r\n  }).raw = mollweide;\r\n  function boggs(λ, φ) {\r\n    var k = 2.00276, θ = mollweideθ(φ);\r\n    return [ k * λ / (1 / Math.cos(φ) + 1.11072 / Math.cos(θ)), (φ + Math.SQRT2 * Math.sin(θ)) / k ];\r\n  }\r\n  boggs.invert = function(x, y) {\r\n    var k = 2.00276, ky = k * y, θ = y < 0 ? -π / 4 : π / 4, i = 25, δ, φ;\r\n    do {\r\n      φ = ky - Math.SQRT2 * Math.sin(θ);\r\n      θ -= δ = (Math.sin(2 * θ) + 2 * θ - π * Math.sin(φ)) / (2 * Math.cos(2 * θ) + 2 + π * Math.cos(φ) * Math.SQRT2 * Math.cos(θ));\r\n    } while (Math.abs(δ) > ε && --i > 0);\r\n    φ = ky - Math.SQRT2 * Math.sin(θ);\r\n    return [ x * (1 / Math.cos(φ) + 1.11072 / Math.cos(θ)) / k, φ ];\r\n  };\r\n  (d3.geo.boggs = function() {\r\n    return projection(boggs);\r\n  }).raw = boggs;\r\n  function parallel1Projection(projectAt) {\r\n    var φ0 = 0, m = projectionMutator(projectAt), p = m(φ0);\r\n    p.parallel = function(_) {\r\n      if (!arguments.length) return φ0 / π * 180;\r\n      return m(φ0 = _ * π / 180);\r\n    };\r\n    return p;\r\n  }\r\n  function sinusoidal(λ, φ) {\r\n    return [ λ * Math.cos(φ), φ ];\r\n  }\r\n  sinusoidal.invert = function(x, y) {\r\n    return [ x / Math.cos(y), y ];\r\n  };\r\n  (d3.geo.sinusoidal = function() {\r\n    return projection(sinusoidal);\r\n  }).raw = sinusoidal;\r\n  function bonne(φ0) {\r\n    if (!φ0) return sinusoidal;\r\n    var cotφ0 = 1 / Math.tan(φ0);\r\n    function forward(λ, φ) {\r\n      var ρ = cotφ0 + φ0 - φ, E = ρ ? λ * Math.cos(φ) / ρ : ρ;\r\n      return [ ρ * Math.sin(E), cotφ0 - ρ * Math.cos(E) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var ρ = Math.sqrt(x * x + (y = cotφ0 - y) * y), φ = cotφ0 + φ0 - ρ;\r\n      return [ ρ / Math.cos(φ) * Math.atan2(x, y), φ ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.bonne = function() {\r\n    return parallel1Projection(bonne).parallel(45);\r\n  }).raw = bonne;\r\n  function bottomleyRaw(ψ) {\r\n    var sinψ = Math.sin(ψ);\r\n    function forward(λ, φ) {\r\n      var ρ = halfπ - φ, η = ρ ? λ * sinψ * Math.sin(ρ) / ρ : ρ;\r\n      return [ ρ * Math.sin(η) / sinψ, halfπ - ρ * Math.cos(η) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var x1 = x * sinψ, y1 = halfπ - y, ρ = Math.sqrt(x1 * x1 + y1 * y1), η = Math.atan2(x1, y1);\r\n      return [ (ρ ? ρ / Math.sin(ρ) : 1) * η / sinψ, halfπ - ρ ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.bottomley = function() {\r\n    var ψ = π / 6, mutate = d3.geo.projectionMutator(bottomleyRaw), projection = mutate(ψ);\r\n    projection.variant = function(_) {\r\n      return arguments.length ? mutate(ψ = +_) : ψ;\r\n    };\r\n    return projection;\r\n  }).raw = bottomleyRaw;\r\n  var bromley = mollweideBromley(1, 4 / π, π);\r\n  (d3.geo.bromley = function() {\r\n    return projection(bromley);\r\n  }).raw = bromley;\r\n  function chamberlin(points) {\r\n    points = points.map(function(p) {\r\n      return [ p[0], p[1], Math.sin(p[1]), Math.cos(p[1]) ];\r\n    });\r\n    for (var a = points[2], b, i = 0; i < 3; ++i, a = b) {\r\n      b = points[i];\r\n      a.v = chamberlinDistanceAzimuth(b[1] - a[1], a[3], a[2], b[3], b[2], b[0] - a[0]);\r\n      a.point = [ 0, 0 ];\r\n    }\r\n    var β0 = chamberlinAngle(points[0].v[0], points[2].v[0], points[1].v[0]), β1 = chamberlinAngle(points[0].v[0], points[1].v[0], points[2].v[0]), β2 = π - β0;\r\n    points[2].point[1] = 0;\r\n    points[0].point[0] = -(points[1].point[0] = .5 * points[0].v[0]);\r\n    var mean = [ points[2].point[0] = points[0].point[0] + points[2].v[0] * Math.cos(β0), 2 * (points[0].point[1] = points[1].point[1] = points[2].v[0] * Math.sin(β0)) ];\r\n    function forward(λ, φ) {\r\n      var sinφ = Math.sin(φ), cosφ = Math.cos(φ), v = new Array(3);\r\n      for (var i = 0; i < 3; ++i) {\r\n        var p = points[i];\r\n        v[i] = chamberlinDistanceAzimuth(φ - p[1], p[3], p[2], cosφ, sinφ, λ - p[0]);\r\n        if (!v[i][0]) return p.point;\r\n        v[i][1] = chamberlinLongitude(v[i][1] - p.v[1]);\r\n      }\r\n      var point = mean.slice();\r\n      for (var i = 0; i < 3; ++i) {\r\n        var j = i == 2 ? 0 : i + 1;\r\n        var a = chamberlinAngle(points[i].v[0], v[i][0], v[j][0]);\r\n        if (v[i][1] < 0) a = -a;\r\n        if (!i) {\r\n          point[0] += v[i][0] * Math.cos(a);\r\n          point[1] -= v[i][0] * Math.sin(a);\r\n        } else if (i == 1) {\r\n          a = β1 - a;\r\n          point[0] -= v[i][0] * Math.cos(a);\r\n          point[1] -= v[i][0] * Math.sin(a);\r\n        } else {\r\n          a = β2 - a;\r\n          point[0] += v[i][0] * Math.cos(a);\r\n          point[1] += v[i][0] * Math.sin(a);\r\n        }\r\n      }\r\n      point[0] /= 3, point[1] /= 3;\r\n      return point;\r\n    }\r\n    return forward;\r\n  }\r\n  function chamberlinProjection() {\r\n    var points = [ [ 0, 0 ], [ 0, 0 ], [ 0, 0 ] ], m = projectionMutator(chamberlin), p = m(points), rotate = p.rotate;\r\n    delete p.rotate;\r\n    p.points = function(_) {\r\n      if (!arguments.length) return points;\r\n      points = _;\r\n      var origin = d3.geo.centroid({\r\n        type: \"MultiPoint\",\r\n        coordinates: points\r\n      }), r = [ -origin[0], -origin[1] ];\r\n      rotate.call(p, r);\r\n      return m(points.map(d3.geo.rotation(r)).map(chamberlinRadians));\r\n    };\r\n    return p.points([ [ -150, 55 ], [ -35, 55 ], [ -92.5, 10 ] ]);\r\n  }\r\n  function chamberlinDistanceAzimuth(dφ, c1, s1, c2, s2, dλ) {\r\n    var cosdλ = Math.cos(dλ), r;\r\n    if (Math.abs(dφ) > 1 || Math.abs(dλ) > 1) {\r\n      r = acos(s1 * s2 + c1 * c2 * cosdλ);\r\n    } else {\r\n      var sindφ = Math.sin(.5 * dφ), sindλ = Math.sin(.5 * dλ);\r\n      r = 2 * asin(Math.sqrt(sindφ * sindφ + c1 * c2 * sindλ * sindλ));\r\n    }\r\n    if (Math.abs(r) > ε) {\r\n      return [ r, Math.atan2(c2 * Math.sin(dλ), c1 * s2 - s1 * c2 * cosdλ) ];\r\n    }\r\n    return [ 0, 0 ];\r\n  }\r\n  function chamberlinAngle(b, c, a) {\r\n    return acos(.5 * (b * b + c * c - a * a) / (b * c));\r\n  }\r\n  function chamberlinLongitude(λ) {\r\n    return λ - 2 * π * Math.floor((λ + π) / (2 * π));\r\n  }\r\n  function chamberlinRadians(point) {\r\n    return [ point[0] * radians, point[1] * radians ];\r\n  }\r\n  (d3.geo.chamberlin = chamberlinProjection).raw = chamberlin;\r\n  function collignon(λ, φ) {\r\n    var α = asqrt(1 - Math.sin(φ));\r\n    return [ 2 / sqrtπ * λ * α, sqrtπ * (1 - α) ];\r\n  }\r\n  collignon.invert = function(x, y) {\r\n    var λ = (λ = y / sqrtπ - 1) * λ;\r\n    return [ λ > 0 ? x * Math.sqrt(π / λ) / 2 : 0, asin(1 - λ) ];\r\n  };\r\n  (d3.geo.collignon = function() {\r\n    return projection(collignon);\r\n  }).raw = collignon;\r\n  function craig(φ0) {\r\n    var tanφ0 = Math.tan(φ0);\r\n    function forward(λ, φ) {\r\n      return [ λ, (λ ? λ / Math.sin(λ) : 1) * (Math.sin(φ) * Math.cos(λ) - tanφ0 * Math.cos(φ)) ];\r\n    }\r\n    forward.invert = tanφ0 ? function(x, y) {\r\n      if (x) y *= Math.sin(x) / x;\r\n      var cosλ = Math.cos(x);\r\n      return [ x, 2 * Math.atan2(Math.sqrt(cosλ * cosλ + tanφ0 * tanφ0 - y * y) - cosλ, tanφ0 - y) ];\r\n    } : function(x, y) {\r\n      return [ x, asin(x ? y * Math.tan(x) / x : y) ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.craig = function() {\r\n    return parallel1Projection(craig);\r\n  }).raw = craig;\r\n  function craster(λ, φ) {\r\n    var sqrt3 = Math.sqrt(3);\r\n    return [ sqrt3 * λ * (2 * Math.cos(2 * φ / 3) - 1) / sqrtπ, sqrt3 * sqrtπ * Math.sin(φ / 3) ];\r\n  }\r\n  craster.invert = function(x, y) {\r\n    var sqrt3 = Math.sqrt(3), φ = 3 * asin(y / (sqrt3 * sqrtπ));\r\n    return [ sqrtπ * x / (sqrt3 * (2 * Math.cos(2 * φ / 3) - 1)), φ ];\r\n  };\r\n  (d3.geo.craster = function() {\r\n    return projection(craster);\r\n  }).raw = craster;\r\n  function cylindricalEqualArea(φ0) {\r\n    var cosφ0 = Math.cos(φ0);\r\n    function forward(λ, φ) {\r\n      return [ λ * cosφ0, Math.sin(φ) / cosφ0 ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      return [ x / cosφ0, asin(y * cosφ0) ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.cylindricalEqualArea = function() {\r\n    return parallel1Projection(cylindricalEqualArea);\r\n  }).raw = cylindricalEqualArea;\r\n  function cylindricalStereographic(φ0) {\r\n    var cosφ0 = Math.cos(φ0);\r\n    function forward(λ, φ) {\r\n      return [ λ * cosφ0, (1 + cosφ0) * Math.tan(φ * .5) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      return [ x / cosφ0, Math.atan(y / (1 + cosφ0)) * 2 ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.cylindricalStereographic = function() {\r\n    return parallel1Projection(cylindricalStereographic);\r\n  }).raw = cylindricalStereographic;\r\n  function eckert1(λ, φ) {\r\n    var α = Math.sqrt(8 / (3 * π));\r\n    return [ α * λ * (1 - Math.abs(φ) / π), α * φ ];\r\n  }\r\n  eckert1.invert = function(x, y) {\r\n    var α = Math.sqrt(8 / (3 * π)), φ = y / α;\r\n    return [ x / (α * (1 - Math.abs(φ) / π)), φ ];\r\n  };\r\n  (d3.geo.eckert1 = function() {\r\n    return projection(eckert1);\r\n  }).raw = eckert1;\r\n  function eckert2(λ, φ) {\r\n    var α = Math.sqrt(4 - 3 * Math.sin(Math.abs(φ)));\r\n    return [ 2 / Math.sqrt(6 * π) * λ * α, sgn(φ) * Math.sqrt(2 * π / 3) * (2 - α) ];\r\n  }\r\n  eckert2.invert = function(x, y) {\r\n    var α = 2 - Math.abs(y) / Math.sqrt(2 * π / 3);\r\n    return [ x * Math.sqrt(6 * π) / (2 * α), sgn(y) * asin((4 - α * α) / 3) ];\r\n  };\r\n  (d3.geo.eckert2 = function() {\r\n    return projection(eckert2);\r\n  }).raw = eckert2;\r\n  function eckert3(λ, φ) {\r\n    var k = Math.sqrt(π * (4 + π));\r\n    return [ 2 / k * λ * (1 + Math.sqrt(1 - 4 * φ * φ / (π * π))), 4 / k * φ ];\r\n  }\r\n  eckert3.invert = function(x, y) {\r\n    var k = Math.sqrt(π * (4 + π)) / 2;\r\n    return [ x * k / (1 + asqrt(1 - y * y * (4 + π) / (4 * π))), y * k / 2 ];\r\n  };\r\n  (d3.geo.eckert3 = function() {\r\n    return projection(eckert3);\r\n  }).raw = eckert3;\r\n  function eckert4(λ, φ) {\r\n    var k = (2 + halfπ) * Math.sin(φ);\r\n    φ /= 2;\r\n    for (var i = 0, δ = Infinity; i < 10 && Math.abs(δ) > ε; i++) {\r\n      var cosφ = Math.cos(φ);\r\n      φ -= δ = (φ + Math.sin(φ) * (cosφ + 2) - k) / (2 * cosφ * (1 + cosφ));\r\n    }\r\n    return [ 2 / Math.sqrt(π * (4 + π)) * λ * (1 + Math.cos(φ)), 2 * Math.sqrt(π / (4 + π)) * Math.sin(φ) ];\r\n  }\r\n  eckert4.invert = function(x, y) {\r\n    var A = .5 * y * Math.sqrt((4 + π) / π), k = asin(A), c = Math.cos(k);\r\n    return [ x / (2 / Math.sqrt(π * (4 + π)) * (1 + c)), asin((k + A * (c + 2)) / (2 + halfπ)) ];\r\n  };\r\n  (d3.geo.eckert4 = function() {\r\n    return projection(eckert4);\r\n  }).raw = eckert4;\r\n  function eckert5(λ, φ) {\r\n    return [ λ * (1 + Math.cos(φ)) / Math.sqrt(2 + π), 2 * φ / Math.sqrt(2 + π) ];\r\n  }\r\n  eckert5.invert = function(x, y) {\r\n    var k = Math.sqrt(2 + π), φ = y * k / 2;\r\n    return [ k * x / (1 + Math.cos(φ)), φ ];\r\n  };\r\n  (d3.geo.eckert5 = function() {\r\n    return projection(eckert5);\r\n  }).raw = eckert5;\r\n  function eckert6(λ, φ) {\r\n    var k = (1 + halfπ) * Math.sin(φ);\r\n    for (var i = 0, δ = Infinity; i < 10 && Math.abs(δ) > ε; i++) {\r\n      φ -= δ = (φ + Math.sin(φ) - k) / (1 + Math.cos(φ));\r\n    }\r\n    k = Math.sqrt(2 + π);\r\n    return [ λ * (1 + Math.cos(φ)) / k, 2 * φ / k ];\r\n  }\r\n  eckert6.invert = function(x, y) {\r\n    var j = 1 + halfπ, k = Math.sqrt(j / 2);\r\n    return [ x * 2 * k / (1 + Math.cos(y *= k)), asin((y + Math.sin(y)) / j) ];\r\n  };\r\n  (d3.geo.eckert6 = function() {\r\n    return projection(eckert6);\r\n  }).raw = eckert6;\r\n  function eisenlohr(λ, φ) {\r\n    var s0 = Math.sin(λ /= 2), c0 = Math.cos(λ), k = Math.sqrt(Math.cos(φ)), c1 = Math.cos(φ /= 2), t = Math.sin(φ) / (c1 + Math.SQRT2 * c0 * k), c = Math.sqrt(2 / (1 + t * t)), v = Math.sqrt((Math.SQRT2 * c1 + (c0 + s0) * k) / (Math.SQRT2 * c1 + (c0 - s0) * k));\r\n    return [ eisenlohrK * (c * (v - 1 / v) - 2 * Math.log(v)), eisenlohrK * (c * t * (v + 1 / v) - 2 * Math.atan(t)) ];\r\n  }\r\n  eisenlohr.invert = function(x, y) {\r\n    var p = d3.geo.august.raw.invert(x / 1.2, y * 1.065);\r\n    if (!p) return null;\r\n    var λ = p[0], φ = p[1], i = 20;\r\n    x /= eisenlohrK, y /= eisenlohrK;\r\n    do {\r\n      var _0 = λ / 2, _1 = φ / 2, s0 = Math.sin(_0), c0 = Math.cos(_0), s1 = Math.sin(_1), c1 = Math.cos(_1), cos1 = Math.cos(φ), k = Math.sqrt(cos1), t = s1 / (c1 + Math.SQRT2 * c0 * k), t2 = t * t, c = Math.sqrt(2 / (1 + t2)), v0 = Math.SQRT2 * c1 + (c0 + s0) * k, v1 = Math.SQRT2 * c1 + (c0 - s0) * k, v2 = v0 / v1, v = Math.sqrt(v2), vm1v = v - 1 / v, vp1v = v + 1 / v, fx = c * vm1v - 2 * Math.log(v) - x, fy = c * t * vp1v - 2 * Math.atan(t) - y, δtδλ = s1 && Math.SQRT1_2 * k * s0 * t2 / s1, δtδφ = (Math.SQRT2 * c0 * c1 + k) / (2 * (c1 + Math.SQRT2 * c0 * k) * (c1 + Math.SQRT2 * c0 * k) * k), δcδt = -.5 * t * c * c * c, δcδλ = δcδt * δtδλ, δcδφ = δcδt * δtδφ, A = (A = 2 * c1 + Math.SQRT2 * k * (c0 - s0)) * A * v, δvδλ = (Math.SQRT2 * c0 * c1 * k + cos1) / A, δvδφ = -(Math.SQRT2 * s0 * s1) / (k * A), δxδλ = vm1v * δcδλ - 2 * δvδλ / v + c * (δvδλ + δvδλ / v2), δxδφ = vm1v * δcδφ - 2 * δvδφ / v + c * (δvδφ + δvδφ / v2), δyδλ = t * vp1v * δcδλ - 2 * δtδλ / (1 + t2) + c * vp1v * δtδλ + c * t * (δvδλ - δvδλ / v2), δyδφ = t * vp1v * δcδφ - 2 * δtδφ / (1 + t2) + c * vp1v * δtδφ + c * t * (δvδφ - δvδφ / v2), denominator = δxδφ * δyδλ - δyδφ * δxδλ;\r\n      if (!denominator) break;\r\n      var δλ = (fy * δxδφ - fx * δyδφ) / denominator, δφ = (fx * δyδλ - fy * δxδλ) / denominator;\r\n      λ -= δλ;\r\n      φ = Math.max(-halfπ, Math.min(halfπ, φ - δφ));\r\n    } while ((Math.abs(δλ) > ε || Math.abs(δφ) > ε) && --i > 0);\r\n    return Math.abs(Math.abs(φ) - halfπ) < ε ? [ 0, φ ] : i && [ λ, φ ];\r\n  };\r\n  var eisenlohrK = 3 + 2 * Math.SQRT2;\r\n  (d3.geo.eisenlohr = function() {\r\n    return projection(eisenlohr);\r\n  }).raw = eisenlohr;\r\n  function fahey(λ, φ) {\r\n    var t = Math.tan(φ / 2);\r\n    return [ λ * faheyK * asqrt(1 - t * t), (1 + faheyK) * t ];\r\n  }\r\n  fahey.invert = function(x, y) {\r\n    var t = y / (1 + faheyK);\r\n    return [ x ? x / (faheyK * asqrt(1 - t * t)) : 0, 2 * Math.atan(t) ];\r\n  };\r\n  var faheyK = Math.cos(35 * radians);\r\n  (d3.geo.fahey = function() {\r\n    return projection(fahey);\r\n  }).raw = fahey;\r\n  function foucaut(λ, φ) {\r\n    var k = φ / 2, cosk = Math.cos(k);\r\n    return [ 2 * λ / sqrtπ * Math.cos(φ) * cosk * cosk, sqrtπ * Math.tan(k) ];\r\n  }\r\n  foucaut.invert = function(x, y) {\r\n    var k = Math.atan(y / sqrtπ), cosk = Math.cos(k), φ = 2 * k;\r\n    return [ x * sqrtπ * .5 / (Math.cos(φ) * cosk * cosk), φ ];\r\n  };\r\n  (d3.geo.foucaut = function() {\r\n    return projection(foucaut);\r\n  }).raw = foucaut;\r\n  d3.geo.gilbert = function(projection) {\r\n    var e = d3.geo.equirectangular().scale(degrees).translate([ 0, 0 ]);\r\n    function gilbert(coordinates) {\r\n      return projection([ coordinates[0] * .5, asin(Math.tan(coordinates[1] * .5 * radians)) * degrees ]);\r\n    }\r\n    if (projection.invert) gilbert.invert = function(coordinates) {\r\n      coordinates = projection.invert(coordinates);\r\n      coordinates[0] *= 2;\r\n      coordinates[1] = 2 * Math.atan(Math.sin(coordinates[1] * radians)) * degrees;\r\n      return coordinates;\r\n    };\r\n    gilbert.stream = function(stream) {\r\n      stream = projection.stream(stream);\r\n      var s = e.stream({\r\n        point: function(λ, φ) {\r\n          stream.point(λ * .5, asin(Math.tan(-φ * .5 * radians)) * degrees);\r\n        },\r\n        lineStart: function() {\r\n          stream.lineStart();\r\n        },\r\n        lineEnd: function() {\r\n          stream.lineEnd();\r\n        },\r\n        polygonStart: function() {\r\n          stream.polygonStart();\r\n        },\r\n        polygonEnd: function() {\r\n          stream.polygonEnd();\r\n        }\r\n      });\r\n      s.sphere = function() {\r\n        stream.sphere();\r\n      };\r\n      s.valid = false;\r\n      return s;\r\n    };\r\n    return gilbert;\r\n  };\r\n  var gingeryAzimuthalEquidistant = d3.geo.azimuthalEquidistant.raw;\r\n  function gingery(ρ, n) {\r\n    var k = 2 * π / n, ρ2 = ρ * ρ;\r\n    function forward(λ, φ) {\r\n      var p = gingeryAzimuthalEquidistant(λ, φ), x = p[0], y = p[1], r2 = x * x + y * y;\r\n      if (r2 > ρ2) {\r\n        var r = Math.sqrt(r2), θ = Math.atan2(y, x), θ0 = k * Math.round(θ / k), α = θ - θ0, ρcosα = ρ * Math.cos(α), k_ = (ρ * Math.sin(α) - α * Math.sin(ρcosα)) / (halfπ - ρcosα), s_ = arcLength_(α, k_), e = (π - ρ) / gingeryIntegrate(s_, ρcosα, π);\r\n        x = r;\r\n        var i = 50, δ;\r\n        do {\r\n          x -= δ = (ρ + gingeryIntegrate(s_, ρcosα, x) * e - r) / (s_(x) * e);\r\n        } while (Math.abs(δ) > ε && --i > 0);\r\n        y = α * Math.sin(x);\r\n        if (x < halfπ) y -= k_ * (x - halfπ);\r\n        var s = Math.sin(θ0), c = Math.cos(θ0);\r\n        p[0] = x * c - y * s;\r\n        p[1] = x * s + y * c;\r\n      }\r\n      return p;\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var r2 = x * x + y * y;\r\n      if (r2 > ρ2) {\r\n        var r = Math.sqrt(r2), θ = Math.atan2(y, x), θ0 = k * Math.round(θ / k), dθ = θ - θ0, x = r * Math.cos(dθ);\r\n        y = r * Math.sin(dθ);\r\n        var x_halfπ = x - halfπ, sinx = Math.sin(x), α = y / sinx, δ = x < halfπ ? Infinity : 0, i = 10;\r\n        while (true) {\r\n          var ρsinα = ρ * Math.sin(α), ρcosα = ρ * Math.cos(α), sinρcosα = Math.sin(ρcosα), halfπ_ρcosα = halfπ - ρcosα, k_ = (ρsinα - α * sinρcosα) / halfπ_ρcosα, s_ = arcLength_(α, k_);\r\n          if (Math.abs(δ) < ε2 || !--i) break;\r\n          α -= δ = (α * sinx - k_ * x_halfπ - y) / (sinx - x_halfπ * 2 * (halfπ_ρcosα * (ρcosα + α * ρsinα * Math.cos(ρcosα) - sinρcosα) - ρsinα * (ρsinα - α * sinρcosα)) / (halfπ_ρcosα * halfπ_ρcosα));\r\n        }\r\n        r = ρ + gingeryIntegrate(s_, ρcosα, x) * (π - ρ) / gingeryIntegrate(s_, ρcosα, π);\r\n        θ = θ0 + α;\r\n        x = r * Math.cos(θ);\r\n        y = r * Math.sin(θ);\r\n      }\r\n      return gingeryAzimuthalEquidistant.invert(x, y);\r\n    };\r\n    return forward;\r\n  }\r\n  function arcLength_(α, k) {\r\n    return function(x) {\r\n      var y_ = α * Math.cos(x);\r\n      if (x < halfπ) y_ -= k;\r\n      return Math.sqrt(1 + y_ * y_);\r\n    };\r\n  }\r\n  function gingeryProjection() {\r\n    var n = 6, ρ = 30 * radians, cρ = Math.cos(ρ), sρ = Math.sin(ρ), m = projectionMutator(gingery), p = m(ρ, n), stream_ = p.stream, ε = .01, cr = -Math.cos(ε * radians), sr = Math.sin(ε * radians);\r\n    p.radius = function(_) {\r\n      if (!arguments.length) return ρ * degrees;\r\n      cρ = Math.cos(ρ = _ * radians);\r\n      sρ = Math.sin(ρ);\r\n      return m(ρ, n);\r\n    };\r\n    p.lobes = function(_) {\r\n      if (!arguments.length) return n;\r\n      return m(ρ, n = +_);\r\n    };\r\n    p.stream = function(stream) {\r\n      var rotate = p.rotate(), rotateStream = stream_(stream), sphereStream = (p.rotate([ 0, 0 ]), \r\n      stream_(stream));\r\n      p.rotate(rotate);\r\n      rotateStream.sphere = function() {\r\n        sphereStream.polygonStart(), sphereStream.lineStart();\r\n        for (var i = 0, δ = 2 * π / n, φ = 0; i < n; ++i, φ -= δ) {\r\n          sphereStream.point(Math.atan2(sr * Math.cos(φ), cr) * degrees, Math.asin(sr * Math.sin(φ)) * degrees);\r\n          sphereStream.point(Math.atan2(sρ * Math.cos(φ - δ / 2), cρ) * degrees, Math.asin(sρ * Math.sin(φ - δ / 2)) * degrees);\r\n        }\r\n        sphereStream.lineEnd(), sphereStream.polygonEnd();\r\n      };\r\n      return rotateStream;\r\n    };\r\n    return p;\r\n  }\r\n  function gingeryIntegrate(f, a, b) {\r\n    var n = 50, h = (b - a) / n, s = f(a) + f(b);\r\n    for (var i = 1, x = a; i < n; ++i) s += 2 * f(x += h);\r\n    return s * .5 * h;\r\n  }\r\n  (d3.geo.gingery = gingeryProjection).raw = gingery;\r\n  function ginzburgPolyconic(a, b, c, d, e, f, g, h) {\r\n    if (arguments.length < 8) h = 0;\r\n    function forward(λ, φ) {\r\n      if (!φ) return [ a * λ / π, 0 ];\r\n      var φ2 = φ * φ, xB = a + φ2 * (b + φ2 * (c + φ2 * d)), yB = φ * (e - 1 + φ2 * (f - h + φ2 * g)), m = (xB * xB + yB * yB) / (2 * yB), α = λ * Math.asin(xB / m) / π;\r\n      return [ m * Math.sin(α), φ * (1 + φ2 * h) + m * (1 - Math.cos(α)) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var λ = π * x / a, φ = y, δλ, δφ, i = 50;\r\n      do {\r\n        var φ2 = φ * φ, xB = a + φ2 * (b + φ2 * (c + φ2 * d)), yB = φ * (e - 1 + φ2 * (f - h + φ2 * g)), p = xB * xB + yB * yB, q = 2 * yB, m = p / q, m2 = m * m, dαdλ = Math.asin(xB / m) / π, α = λ * dαdλ;\r\n        xB2 = xB * xB, dxBdφ = (2 * b + φ2 * (4 * c + φ2 * 6 * d)) * φ, dyBdφ = e + φ2 * (3 * f + φ2 * 5 * g), \r\n        dpdφ = 2 * (xB * dxBdφ + yB * (dyBdφ - 1)), dqdφ = 2 * (dyBdφ - 1), dmdφ = (dpdφ * q - p * dqdφ) / (q * q), \r\n        cosα = Math.cos(α), sinα = Math.sin(α), mcosα = m * cosα, msinα = m * sinα, dαdφ = λ / π * (1 / asqrt(1 - xB2 / m2)) * (dxBdφ * m - xB * dmdφ) / m2, \r\n        fx = msinα - x, fy = φ * (1 + φ2 * h) + m - mcosα - y, δxδφ = dmdφ * sinα + mcosα * dαdφ, \r\n        δxδλ = mcosα * dαdλ, δyδφ = 1 + dmdφ - (dmdφ * cosα - msinα * dαdφ), δyδλ = msinα * dαdλ, \r\n        denominator = δxδφ * δyδλ - δyδφ * δxδλ;\r\n        if (!denominator) break;\r\n        λ -= δλ = (fy * δxδφ - fx * δyδφ) / denominator;\r\n        φ -= δφ = (fx * δyδλ - fy * δxδλ) / denominator;\r\n      } while ((Math.abs(δλ) > ε || Math.abs(δφ) > ε) && --i > 0);\r\n      return [ λ, φ ];\r\n    };\r\n    return forward;\r\n  }\r\n  var ginzburg4 = ginzburgPolyconic(2.8284, -1.6988, .75432, -.18071, 1.76003, -.38914, .042555);\r\n  (d3.geo.ginzburg4 = function() {\r\n    return projection(ginzburg4);\r\n  }).raw = ginzburg4;\r\n  var ginzburg5 = ginzburgPolyconic(2.583819, -.835827, .170354, -.038094, 1.543313, -.411435, .082742);\r\n  (d3.geo.ginzburg5 = function() {\r\n    return projection(ginzburg5);\r\n  }).raw = ginzburg5;\r\n  var ginzburg6 = ginzburgPolyconic(5 / 6 * π, -.62636, -.0344, 0, 1.3493, -.05524, 0, .045);\r\n  (d3.geo.ginzburg6 = function() {\r\n    return projection(ginzburg6);\r\n  }).raw = ginzburg6;\r\n  function ginzburg8(λ, φ) {\r\n    var λ2 = λ * λ, φ2 = φ * φ;\r\n    return [ λ * (1 - .162388 * φ2) * (.87 - 952426e-9 * λ2 * λ2), φ * (1 + φ2 / 12) ];\r\n  }\r\n  ginzburg8.invert = function(x, y) {\r\n    var λ = x, φ = y, i = 50, δ;\r\n    do {\r\n      var φ2 = φ * φ;\r\n      φ -= δ = (φ * (1 + φ2 / 12) - y) / (1 + φ2 / 4);\r\n    } while (Math.abs(δ) > ε && --i > 0);\r\n    i = 50;\r\n    x /= 1 - .162388 * φ2;\r\n    do {\r\n      var λ4 = (λ4 = λ * λ) * λ4;\r\n      λ -= δ = (λ * (.87 - 952426e-9 * λ4) - x) / (.87 - .00476213 * λ4);\r\n    } while (Math.abs(δ) > ε && --i > 0);\r\n    return [ λ, φ ];\r\n  };\r\n  (d3.geo.ginzburg8 = function() {\r\n    return projection(ginzburg8);\r\n  }).raw = ginzburg8;\r\n  var ginzburg9 = ginzburgPolyconic(2.6516, -.76534, .19123, -.047094, 1.36289, -.13965, .031762);\r\n  (d3.geo.ginzburg9 = function() {\r\n    return projection(ginzburg9);\r\n  }).raw = ginzburg9;\r\n  function quincuncialProjection(projectHemisphere) {\r\n    var dx = projectHemisphere(halfπ, 0)[0] - projectHemisphere(-halfπ, 0)[0];\r\n    function projection() {\r\n      var quincuncial = false, m = projectionMutator(projectAt), p = m(quincuncial);\r\n      p.quincuncial = function(_) {\r\n        if (!arguments.length) return quincuncial;\r\n        return m(quincuncial = !!_);\r\n      };\r\n      return p;\r\n    }\r\n    function projectAt(quincuncial) {\r\n      var forward = quincuncial ? function(λ, φ) {\r\n        var t = Math.abs(λ) < halfπ, p = projectHemisphere(t ? λ : λ > 0 ? λ - π : λ + π, φ);\r\n        var x = (p[0] - p[1]) * Math.SQRT1_2, y = (p[0] + p[1]) * Math.SQRT1_2;\r\n        if (t) return [ x, y ];\r\n        var d = dx * Math.SQRT1_2, s = x > 0 ^ y > 0 ? -1 : 1;\r\n        return [ s * x - sgn(y) * d, s * y - sgn(x) * d ];\r\n      } : function(λ, φ) {\r\n        var s = λ > 0 ? -.5 : .5, point = projectHemisphere(λ + s * π, φ);\r\n        point[0] -= s * dx;\r\n        return point;\r\n      };\r\n      if (projectHemisphere.invert) forward.invert = quincuncial ? function(x0, y0) {\r\n        var x = (x0 + y0) * Math.SQRT1_2, y = (y0 - x0) * Math.SQRT1_2, t = Math.abs(x) < .5 * dx && Math.abs(y) < .5 * dx;\r\n        if (!t) {\r\n          var d = dx * Math.SQRT1_2, s = x > 0 ^ y > 0 ? -1 : 1, x1 = -s * (x0 + (y > 0 ? 1 : -1) * d), y1 = -s * (y0 + (x > 0 ? 1 : -1) * d);\r\n          x = (-x1 - y1) * Math.SQRT1_2;\r\n          y = (x1 - y1) * Math.SQRT1_2;\r\n        }\r\n        var p = projectHemisphere.invert(x, y);\r\n        if (!t) p[0] += x > 0 ? π : -π;\r\n        return p;\r\n      } : function(x, y) {\r\n        var s = x > 0 ? -.5 : .5, location = projectHemisphere.invert(x + s * dx, y), λ = location[0] - s * π;\r\n        if (λ < -π) λ += 2 * π; else if (λ > π) λ -= 2 * π;\r\n        location[0] = λ;\r\n        return location;\r\n      };\r\n      return forward;\r\n    }\r\n    projection.raw = projectAt;\r\n    return projection;\r\n  }\r\n  function gringorten(λ, φ) {\r\n    var sλ = sgn(λ), sφ = sgn(φ), cosφ = Math.cos(φ), x = Math.cos(λ) * cosφ, y = Math.sin(λ) * cosφ, z = Math.sin(sφ * φ);\r\n    λ = Math.abs(Math.atan2(y, z));\r\n    φ = asin(x);\r\n    if (Math.abs(λ - halfπ) > ε) λ %= halfπ;\r\n    var point = gringortenHexadecant(λ > π / 4 ? halfπ - λ : λ, φ);\r\n    if (λ > π / 4) z = point[0], point[0] = -point[1], point[1] = -z;\r\n    return point[0] *= sλ, point[1] *= -sφ, point;\r\n  }\r\n  gringorten.invert = function(x, y) {\r\n    var sx = sgn(x), sy = sgn(y), x0 = -sx * x, y0 = -sy * y, t = y0 / x0 < 1, p = gringortenHexadecantInvert(t ? y0 : x0, t ? x0 : y0), λ = p[0], φ = p[1];\r\n    if (t) λ = -halfπ - λ;\r\n    var cosφ = Math.cos(φ), x = Math.cos(λ) * cosφ, y = Math.sin(λ) * cosφ, z = Math.sin(φ);\r\n    return [ sx * (Math.atan2(y, -z) + π), sy * asin(x) ];\r\n  };\r\n  function gringortenHexadecant(λ, φ) {\r\n    if (φ === halfπ) return [ 0, 0 ];\r\n    var sinφ = Math.sin(φ), r = sinφ * sinφ, r2 = r * r, j = 1 + r2, k = 1 + 3 * r2, q = 1 - r2, z = asin(1 / Math.sqrt(j)), v = q + r * j * z, p2 = (1 - sinφ) / v, p = Math.sqrt(p2), a2 = p2 * j, a = Math.sqrt(a2), h = p * q;\r\n    if (λ === 0) return [ 0, -(h + r * a) ];\r\n    var cosφ = Math.cos(φ), secφ = 1 / cosφ, drdφ = 2 * sinφ * cosφ, dvdφ = (-3 * r + z * k) * drdφ, dp2dφ = (-v * cosφ - (1 - sinφ) * dvdφ) / (v * v), dpdφ = .5 * dp2dφ / p, dhdφ = q * dpdφ - 2 * r * p * drdφ, dra2dφ = r * j * dp2dφ + p2 * k * drdφ, μ = -secφ * drdφ, ν = -secφ * dra2dφ, ζ = -2 * secφ * dhdφ, Λ = 4 * λ / π;\r\n    if (λ > .222 * π || φ < π / 4 && λ > .175 * π) {\r\n      var x = (h + r * asqrt(a2 * (1 + r2) - h * h)) / (1 + r2);\r\n      if (λ > π / 4) return [ x, x ];\r\n      var x1 = x, x0 = .5 * x, i = 50;\r\n      x = .5 * (x0 + x1);\r\n      do {\r\n        var g = Math.sqrt(a2 - x * x), f = x * (ζ + μ * g) + ν * asin(x / a) - Λ;\r\n        if (!f) break;\r\n        if (f < 0) x0 = x; else x1 = x;\r\n        x = .5 * (x0 + x1);\r\n      } while (Math.abs(x1 - x0) > ε && --i > 0);\r\n    } else {\r\n      var x = ε, i = 25, δ;\r\n      do {\r\n        var x2 = x * x, g = asqrt(a2 - x2), ζμg = ζ + μ * g, f = x * ζμg + ν * asin(x / a) - Λ, df = ζμg + (ν - μ * x2) / g;\r\n        x -= δ = g ? f / df : 0;\r\n      } while (Math.abs(δ) > ε && --i > 0);\r\n    }\r\n    return [ x, -h - r * asqrt(a2 - x * x) ];\r\n  }\r\n  function gringortenHexadecantInvert(x, y) {\r\n    var x0 = 0, x1 = 1, r = .5, i = 50;\r\n    while (true) {\r\n      var r2 = r * r, sinφ = Math.sqrt(r), z = Math.asin(1 / Math.sqrt(1 + r2)), v = 1 - r2 + r * (1 + r2) * z, p2 = (1 - sinφ) / v, p = Math.sqrt(p2), a2 = p2 * (1 + r2), h = p * (1 - r2), g2 = a2 - x * x, g = Math.sqrt(g2), y0 = y + h + r * g;\r\n      if (Math.abs(x1 - x0) < ε2 || --i === 0 || y0 === 0) break;\r\n      if (y0 > 0) x0 = r; else x1 = r;\r\n      r = .5 * (x0 + x1);\r\n    }\r\n    if (!i) return null;\r\n    var φ = Math.asin(sinφ), cosφ = Math.cos(φ), secφ = 1 / cosφ, drdφ = 2 * sinφ * cosφ, dvdφ = (-3 * r + z * (1 + 3 * r2)) * drdφ, dp2dφ = (-v * cosφ - (1 - sinφ) * dvdφ) / (v * v), dpdφ = .5 * dp2dφ / p, dhdφ = (1 - r2) * dpdφ - 2 * r * p * drdφ, ζ = -2 * secφ * dhdφ, μ = -secφ * drdφ, ν = -secφ * (r * (1 + r2) * dp2dφ + p2 * (1 + 3 * r2) * drdφ);\r\n    return [ π / 4 * (x * (ζ + μ * g) + ν * Math.asin(x / Math.sqrt(a2))), φ ];\r\n  }\r\n  d3.geo.gringorten = quincuncialProjection(gringorten);\r\n  function ellipticJi(u, v, m) {\r\n    if (!u) {\r\n      var b = ellipticJ(v, 1 - m);\r\n      return [ [ 0, b[0] / b[1] ], [ 1 / b[1], 0 ], [ b[2] / b[1], 0 ] ];\r\n    }\r\n    var a = ellipticJ(u, m);\r\n    if (!v) return [ [ a[0], 0 ], [ a[1], 0 ], [ a[2], 0 ] ];\r\n    var b = ellipticJ(v, 1 - m), denominator = b[1] * b[1] + m * a[0] * a[0] * b[0] * b[0];\r\n    return [ [ a[0] * b[2] / denominator, a[1] * a[2] * b[0] * b[1] / denominator ], [ a[1] * b[1] / denominator, -a[0] * a[2] * b[0] * b[2] / denominator ], [ a[2] * b[1] * b[2] / denominator, -m * a[0] * a[1] * b[0] / denominator ] ];\r\n  }\r\n  function ellipticJ(u, m) {\r\n    var ai, b, φ, t, twon;\r\n    if (m < ε) {\r\n      t = Math.sin(u);\r\n      b = Math.cos(u);\r\n      ai = .25 * m * (u - t * b);\r\n      return [ t - ai * b, b + ai * t, 1 - .5 * m * t * t, u - ai ];\r\n    }\r\n    if (m >= 1 - ε) {\r\n      ai = .25 * (1 - m);\r\n      b = cosh(u);\r\n      t = tanh(u);\r\n      φ = 1 / b;\r\n      twon = b * sinh(u);\r\n      return [ t + ai * (twon - u) / (b * b), φ - ai * t * φ * (twon - u), φ + ai * t * φ * (twon + u), 2 * Math.atan(Math.exp(u)) - halfπ + ai * (twon - u) / b ];\r\n    }\r\n    var a = [ 1, 0, 0, 0, 0, 0, 0, 0, 0 ], c = [ Math.sqrt(m), 0, 0, 0, 0, 0, 0, 0, 0 ], i = 0;\r\n    b = Math.sqrt(1 - m);\r\n    twon = 1;\r\n    while (Math.abs(c[i] / a[i]) > ε && i < 8) {\r\n      ai = a[i++];\r\n      c[i] = .5 * (ai - b);\r\n      a[i] = .5 * (ai + b);\r\n      b = asqrt(ai * b);\r\n      twon *= 2;\r\n    }\r\n    φ = twon * a[i] * u;\r\n    do {\r\n      t = c[i] * Math.sin(b = φ) / a[i];\r\n      φ = .5 * (asin(t) + φ);\r\n    } while (--i);\r\n    return [ Math.sin(φ), t = Math.cos(φ), t / Math.cos(φ - b), φ ];\r\n  }\r\n  function ellipticFi(φ, ψ, m) {\r\n    var r = Math.abs(φ), i = Math.abs(ψ), sinhψ = sinh(i);\r\n    if (r) {\r\n      var cscφ = 1 / Math.sin(r), cotφ2 = 1 / (Math.tan(r) * Math.tan(r)), b = -(cotφ2 + m * sinhψ * sinhψ * cscφ * cscφ - 1 + m), c = (m - 1) * cotφ2, cotλ2 = .5 * (-b + Math.sqrt(b * b - 4 * c));\r\n      return [ ellipticF(Math.atan(1 / Math.sqrt(cotλ2)), m) * sgn(φ), ellipticF(Math.atan(asqrt((cotλ2 / cotφ2 - 1) / m)), 1 - m) * sgn(ψ) ];\r\n    }\r\n    return [ 0, ellipticF(Math.atan(sinhψ), 1 - m) * sgn(ψ) ];\r\n  }\r\n  function ellipticF(φ, m) {\r\n    if (!m) return φ;\r\n    if (m === 1) return Math.log(Math.tan(φ / 2 + π / 4));\r\n    var a = 1, b = Math.sqrt(1 - m), c = Math.sqrt(m);\r\n    for (var i = 0; Math.abs(c) > ε; i++) {\r\n      if (φ % π) {\r\n        var dφ = Math.atan(b * Math.tan(φ) / a);\r\n        if (dφ < 0) dφ += π;\r\n        φ += dφ + ~~(φ / π) * π;\r\n      } else φ += φ;\r\n      c = (a + b) / 2;\r\n      b = Math.sqrt(a * b);\r\n      c = ((a = c) - b) / 2;\r\n    }\r\n    return φ / (Math.pow(2, i) * a);\r\n  }\r\n  function guyou(λ, φ) {\r\n    var k_ = (Math.SQRT2 - 1) / (Math.SQRT2 + 1), k = Math.sqrt(1 - k_ * k_), K = ellipticF(halfπ, k * k), f = -1;\r\n    var ψ = Math.log(Math.tan(π / 4 + Math.abs(φ) / 2)), r = Math.exp(f * ψ) / Math.sqrt(k_), at = guyouComplexAtan(r * Math.cos(f * λ), r * Math.sin(f * λ)), t = ellipticFi(at[0], at[1], k * k);\r\n    return [ -t[1], (φ >= 0 ? 1 : -1) * (.5 * K - t[0]) ];\r\n  }\r\n  function guyouComplexAtan(x, y) {\r\n    var x2 = x * x, y_1 = y + 1, t = 1 - x2 - y * y;\r\n    return [ .5 * ((x >= 0 ? halfπ : -halfπ) - Math.atan2(t, 2 * x)), -.25 * Math.log(t * t + 4 * x2) + .5 * Math.log(y_1 * y_1 + x2) ];\r\n  }\r\n  function guyouComplexDivide(a, b) {\r\n    var denominator = b[0] * b[0] + b[1] * b[1];\r\n    return [ (a[0] * b[0] + a[1] * b[1]) / denominator, (a[1] * b[0] - a[0] * b[1]) / denominator ];\r\n  }\r\n  guyou.invert = function(x, y) {\r\n    var k_ = (Math.SQRT2 - 1) / (Math.SQRT2 + 1), k = Math.sqrt(1 - k_ * k_), K = ellipticF(halfπ, k * k), f = -1;\r\n    var j = ellipticJi(.5 * K - y, -x, k * k), tn = guyouComplexDivide(j[0], j[1]), λ = Math.atan2(tn[1], tn[0]) / f;\r\n    return [ λ, 2 * Math.atan(Math.exp(.5 / f * Math.log(k_ * tn[0] * tn[0] + k_ * tn[1] * tn[1]))) - halfπ ];\r\n  };\r\n  d3.geo.guyou = quincuncialProjection(guyou);\r\n  function hammerRetroazimuthal(φ0) {\r\n    var sinφ0 = Math.sin(φ0), cosφ0 = Math.cos(φ0), rotate = hammerRetroazimuthalRotation(φ0);\r\n    rotate.invert = hammerRetroazimuthalRotation(-φ0);\r\n    function forward(λ, φ) {\r\n      var p = rotate(λ, φ);\r\n      λ = p[0], φ = p[1];\r\n      var sinφ = Math.sin(φ), cosφ = Math.cos(φ), cosλ = Math.cos(λ), z = acos(sinφ0 * sinφ + cosφ0 * cosφ * cosλ), sinz = Math.sin(z), K = Math.abs(sinz) > ε ? z / sinz : 1;\r\n      return [ K * cosφ0 * Math.sin(λ), (Math.abs(λ) > halfπ ? K : -K) * (sinφ0 * cosφ - cosφ0 * sinφ * cosλ) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var ρ = Math.sqrt(x * x + y * y), sinz = -Math.sin(ρ), cosz = Math.cos(ρ), a = ρ * cosz, b = -y * sinz, c = ρ * sinφ0, d = asqrt(a * a + b * b - c * c), φ = Math.atan2(a * c + b * d, b * c - a * d), λ = (ρ > halfπ ? -1 : 1) * Math.atan2(x * sinz, ρ * Math.cos(φ) * cosz + y * Math.sin(φ) * sinz);\r\n      return rotate.invert(λ, φ);\r\n    };\r\n    return forward;\r\n  }\r\n  function hammerRetroazimuthalRotation(φ0) {\r\n    var sinφ0 = Math.sin(φ0), cosφ0 = Math.cos(φ0);\r\n    return function(λ, φ) {\r\n      var cosφ = Math.cos(φ), x = Math.cos(λ) * cosφ, y = Math.sin(λ) * cosφ, z = Math.sin(φ);\r\n      return [ Math.atan2(y, x * cosφ0 - z * sinφ0), asin(z * cosφ0 + x * sinφ0) ];\r\n    };\r\n  }\r\n  function hammerRetroazimuthalProjection() {\r\n    var φ0 = 0, m = projectionMutator(hammerRetroazimuthal), p = m(φ0), rotate_ = p.rotate, stream_ = p.stream, circle = d3.geo.circle();\r\n    p.parallel = function(_) {\r\n      if (!arguments.length) return φ0 / π * 180;\r\n      var r = p.rotate();\r\n      return m(φ0 = _ * π / 180).rotate(r);\r\n    };\r\n    p.rotate = function(_) {\r\n      if (!arguments.length) return _ = rotate_.call(p), _[1] += φ0 / π * 180, _;\r\n      rotate_.call(p, [ _[0], _[1] - φ0 / π * 180 ]);\r\n      circle.origin([ -_[0], -_[1] ]);\r\n      return p;\r\n    };\r\n    p.stream = function(stream) {\r\n      stream = stream_(stream);\r\n      stream.sphere = function() {\r\n        stream.polygonStart();\r\n        var ε = .01, ring = circle.angle(90 - ε)().coordinates[0], n = ring.length - 1, i = -1, p;\r\n        stream.lineStart();\r\n        while (++i < n) stream.point((p = ring[i])[0], p[1]);\r\n        stream.lineEnd();\r\n        ring = circle.angle(90 + ε)().coordinates[0];\r\n        n = ring.length - 1;\r\n        stream.lineStart();\r\n        while (--i >= 0) stream.point((p = ring[i])[0], p[1]);\r\n        stream.lineEnd();\r\n        stream.polygonEnd();\r\n      };\r\n      return stream;\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.hammerRetroazimuthal = hammerRetroazimuthalProjection).raw = hammerRetroazimuthal;\r\n  var hammerAzimuthalEqualArea = d3.geo.azimuthalEqualArea.raw;\r\n  function hammer(A, B) {\r\n    if (arguments.length < 2) B = A;\r\n    if (B === 1) return hammerAzimuthalEqualArea;\r\n    if (B === Infinity) return hammerQuarticAuthalic;\r\n    function forward(λ, φ) {\r\n      var coordinates = hammerAzimuthalEqualArea(λ / B, φ);\r\n      coordinates[0] *= A;\r\n      return coordinates;\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var coordinates = hammerAzimuthalEqualArea.invert(x / A, y);\r\n      coordinates[0] *= B;\r\n      return coordinates;\r\n    };\r\n    return forward;\r\n  }\r\n  function hammerProjection() {\r\n    var B = 2, m = projectionMutator(hammer), p = m(B);\r\n    p.coefficient = function(_) {\r\n      if (!arguments.length) return B;\r\n      return m(B = +_);\r\n    };\r\n    return p;\r\n  }\r\n  function hammerQuarticAuthalic(λ, φ) {\r\n    return [ λ * Math.cos(φ) / Math.cos(φ /= 2), 2 * Math.sin(φ) ];\r\n  }\r\n  hammerQuarticAuthalic.invert = function(x, y) {\r\n    var φ = 2 * asin(y / 2);\r\n    return [ x * Math.cos(φ / 2) / Math.cos(φ), φ ];\r\n  };\r\n  (d3.geo.hammer = hammerProjection).raw = hammer;\r\n  function hatano(λ, φ) {\r\n    var c = Math.sin(φ) * (φ < 0 ? 2.43763 : 2.67595);\r\n    for (var i = 0, δ; i < 20; i++) {\r\n      φ -= δ = (φ + Math.sin(φ) - c) / (1 + Math.cos(φ));\r\n      if (Math.abs(δ) < ε) break;\r\n    }\r\n    return [ .85 * λ * Math.cos(φ *= .5), Math.sin(φ) * (φ < 0 ? 1.93052 : 1.75859) ];\r\n  }\r\n  hatano.invert = function(x, y) {\r\n    var θ = Math.abs(θ = y * (y < 0 ? .5179951515653813 : .5686373742600607)) > 1 - ε ? θ > 0 ? halfπ : -halfπ : asin(θ);\r\n    return [ 1.1764705882352942 * x / Math.cos(θ), Math.abs(θ = ((θ += θ) + Math.sin(θ)) * (y < 0 ? .4102345310814193 : .3736990601468637)) > 1 - ε ? θ > 0 ? halfπ : -halfπ : asin(θ) ];\r\n  };\r\n  (d3.geo.hatano = function() {\r\n    return projection(hatano);\r\n  }).raw = hatano;\r\n  var healpixParallel = 41 + 48 / 36 + 37 / 3600;\r\n  function healpix(h) {\r\n    var lambert = d3.geo.cylindricalEqualArea.raw(0), φ0 = healpixParallel * π / 180, dx0 = 2 * π, dx1 = d3.geo.collignon.raw(π, φ0)[0] - d3.geo.collignon.raw(-π, φ0)[0], y0 = lambert(0, φ0)[1], y1 = d3.geo.collignon.raw(0, φ0)[1], dy1 = d3.geo.collignon.raw(0, halfπ)[1] - y1, k = 2 * π / h;\r\n    function forward(λ, φ) {\r\n      var point, φ2 = Math.abs(φ);\r\n      if (φ2 > φ0) {\r\n        var i = Math.min(h - 1, Math.max(0, Math.floor((λ + π) / k)));\r\n        λ += π * (h - 1) / h - i * k;\r\n        point = d3.geo.collignon.raw(λ, φ2);\r\n        point[0] = point[0] * dx0 / dx1 - dx0 * (h - 1) / (2 * h) + i * dx0 / h;\r\n        point[1] = y0 + (point[1] - y1) * 4 * dy1 / dx0;\r\n        if (φ < 0) point[1] = -point[1];\r\n      } else {\r\n        point = lambert(λ, φ);\r\n      }\r\n      point[0] /= 2;\r\n      return point;\r\n    }\r\n    forward.invert = function(x, y) {\r\n      x *= 2;\r\n      var y2 = Math.abs(y);\r\n      if (y2 > y0) {\r\n        var i = Math.min(h - 1, Math.max(0, Math.floor((x + π) / k)));\r\n        x = (x + π * (h - 1) / h - i * k) * dx1 / dx0;\r\n        var point = d3.geo.collignon.raw.invert(x, .25 * (y2 - y0) * dx0 / dy1 + y1);\r\n        point[0] -= π * (h - 1) / h - i * k;\r\n        if (y < 0) point[1] = -point[1];\r\n        return point;\r\n      }\r\n      return lambert.invert(x, y);\r\n    };\r\n    return forward;\r\n  }\r\n  function healpixProjection() {\r\n    var n = 2, m = projectionMutator(healpix), p = m(n), stream_ = p.stream;\r\n    p.lobes = function(_) {\r\n      if (!arguments.length) return n;\r\n      return m(n = +_);\r\n    };\r\n    p.stream = function(stream) {\r\n      var rotate = p.rotate(), rotateStream = stream_(stream), sphereStream = (p.rotate([ 0, 0 ]), \r\n      stream_(stream));\r\n      p.rotate(rotate);\r\n      rotateStream.sphere = function() {\r\n        d3.geo.stream(sphere(), sphereStream);\r\n      };\r\n      return rotateStream;\r\n    };\r\n    function sphere() {\r\n      var step = 180 / n;\r\n      return {\r\n        type: \"Polygon\",\r\n        coordinates: [ d3.range(-180, 180 + step / 2, step).map(function(x, i) {\r\n          return [ x, i & 1 ? 90 - 1e-6 : healpixParallel ];\r\n        }).concat(d3.range(180, -180 - step / 2, -step).map(function(x, i) {\r\n          return [ x, i & 1 ? -90 + 1e-6 : -healpixParallel ];\r\n        })) ]\r\n      };\r\n    }\r\n    return p;\r\n  }\r\n  (d3.geo.healpix = healpixProjection).raw = healpix;\r\n  function hill(K) {\r\n    var L = 1 + K, sinβ = Math.sin(1 / L), β = asin(sinβ), A = 2 * Math.sqrt(π / (B = π + 4 * β * L)), B, ρ0 = .5 * A * (L + Math.sqrt(K * (2 + K))), K2 = K * K, L2 = L * L;\r\n    function forward(λ, φ) {\r\n      var t = 1 - Math.sin(φ), ρ, ω;\r\n      if (t && t < 2) {\r\n        var θ = halfπ - φ, i = 25, δ;\r\n        do {\r\n          var sinθ = Math.sin(θ), cosθ = Math.cos(θ), β_β1 = β + Math.atan2(sinθ, L - cosθ), C = 1 + L2 - 2 * L * cosθ;\r\n          θ -= δ = (θ - K2 * β - L * sinθ + C * β_β1 - .5 * t * B) / (2 * L * sinθ * β_β1);\r\n        } while (Math.abs(δ) > ε2 && --i > 0);\r\n        ρ = A * Math.sqrt(C);\r\n        ω = λ * β_β1 / π;\r\n      } else {\r\n        ρ = A * (K + t);\r\n        ω = λ * β / π;\r\n      }\r\n      return [ ρ * Math.sin(ω), ρ0 - ρ * Math.cos(ω) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var ρ2 = x * x + (y -= ρ0) * y, cosθ = (1 + L2 - ρ2 / (A * A)) / (2 * L), θ = acos(cosθ), sinθ = Math.sin(θ), β_β1 = β + Math.atan2(sinθ, L - cosθ);\r\n      return [ asin(x / Math.sqrt(ρ2)) * π / β_β1, asin(1 - 2 * (θ - K2 * β - L * sinθ + (1 + L2 - 2 * L * cosθ) * β_β1) / B) ];\r\n    };\r\n    return forward;\r\n  }\r\n  function hillProjection() {\r\n    var K = 1, m = projectionMutator(hill), p = m(K);\r\n    p.ratio = function(_) {\r\n      if (!arguments.length) return K;\r\n      return m(K = +_);\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.hill = hillProjection).raw = hill;\r\n  var sinuMollweideφ = .7109889596207567, sinuMollweideY = .0528035274542;\r\n  function sinuMollweide(λ, φ) {\r\n    return φ > -sinuMollweideφ ? (λ = mollweide(λ, φ), λ[1] += sinuMollweideY, λ) : sinusoidal(λ, φ);\r\n  }\r\n  sinuMollweide.invert = function(x, y) {\r\n    return y > -sinuMollweideφ ? mollweide.invert(x, y - sinuMollweideY) : sinusoidal.invert(x, y);\r\n  };\r\n  (d3.geo.sinuMollweide = function() {\r\n    return projection(sinuMollweide).rotate([ -20, -55 ]);\r\n  }).raw = sinuMollweide;\r\n  function homolosine(λ, φ) {\r\n    return Math.abs(φ) > sinuMollweideφ ? (λ = mollweide(λ, φ), λ[1] -= φ > 0 ? sinuMollweideY : -sinuMollweideY, \r\n    λ) : sinusoidal(λ, φ);\r\n  }\r\n  homolosine.invert = function(x, y) {\r\n    return Math.abs(y) > sinuMollweideφ ? mollweide.invert(x, y + (y > 0 ? sinuMollweideY : -sinuMollweideY)) : sinusoidal.invert(x, y);\r\n  };\r\n  (d3.geo.homolosine = function() {\r\n    return projection(homolosine);\r\n  }).raw = homolosine;\r\n  function kavrayskiy7(λ, φ) {\r\n    return [ 3 * λ / (2 * π) * Math.sqrt(π * π / 3 - φ * φ), φ ];\r\n  }\r\n  kavrayskiy7.invert = function(x, y) {\r\n    return [ 2 / 3 * π * x / Math.sqrt(π * π / 3 - y * y), y ];\r\n  };\r\n  (d3.geo.kavrayskiy7 = function() {\r\n    return projection(kavrayskiy7);\r\n  }).raw = kavrayskiy7;\r\n  function lagrange(n) {\r\n    function forward(λ, φ) {\r\n      if (Math.abs(Math.abs(φ) - halfπ) < ε) return [ 0, φ < 0 ? -2 : 2 ];\r\n      var sinφ = Math.sin(φ), v = Math.pow((1 + sinφ) / (1 - sinφ), n / 2), c = .5 * (v + 1 / v) + Math.cos(λ *= n);\r\n      return [ 2 * Math.sin(λ) / c, (v - 1 / v) / c ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var y0 = Math.abs(y);\r\n      if (Math.abs(y0 - 2) < ε) return x ? null : [ 0, sgn(y) * halfπ ];\r\n      if (y0 > 2) return null;\r\n      x /= 2, y /= 2;\r\n      var x2 = x * x, y2 = y * y, t = 2 * y / (1 + x2 + y2);\r\n      t = Math.pow((1 + t) / (1 - t), 1 / n);\r\n      return [ Math.atan2(2 * x, 1 - x2 - y2) / n, asin((t - 1) / (t + 1)) ];\r\n    };\r\n    return forward;\r\n  }\r\n  function lagrangeProjection() {\r\n    var n = .5, m = projectionMutator(lagrange), p = m(n);\r\n    p.spacing = function(_) {\r\n      if (!arguments.length) return n;\r\n      return m(n = +_);\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.lagrange = lagrangeProjection).raw = lagrange;\r\n  function larrivee(λ, φ) {\r\n    return [ λ * (1 + Math.sqrt(Math.cos(φ))) / 2, φ / (Math.cos(φ / 2) * Math.cos(λ / 6)) ];\r\n  }\r\n  larrivee.invert = function(x, y) {\r\n    var x0 = Math.abs(x), y0 = Math.abs(y), π_sqrt2 = π / Math.SQRT2, λ = ε, φ = halfπ;\r\n    if (y0 < π_sqrt2) φ *= y0 / π_sqrt2; else λ += 6 * acos(π_sqrt2 / y0);\r\n    for (var i = 0; i < 25; i++) {\r\n      var sinφ = Math.sin(φ), sqrtcosφ = asqrt(Math.cos(φ)), sinφ_2 = Math.sin(φ / 2), cosφ_2 = Math.cos(φ / 2), sinλ_6 = Math.sin(λ / 6), cosλ_6 = Math.cos(λ / 6), f0 = .5 * λ * (1 + sqrtcosφ) - x0, f1 = φ / (cosφ_2 * cosλ_6) - y0, df0dφ = sqrtcosφ ? -.25 * λ * sinφ / sqrtcosφ : 0, df0dλ = .5 * (1 + sqrtcosφ), df1dφ = (1 + .5 * φ * sinφ_2 / cosφ_2) / (cosφ_2 * cosλ_6), df1dλ = φ / cosφ_2 * (sinλ_6 / 6) / (cosλ_6 * cosλ_6), denom = df0dφ * df1dλ - df1dφ * df0dλ, dφ = (f0 * df1dλ - f1 * df0dλ) / denom, dλ = (f1 * df0dφ - f0 * df1dφ) / denom;\r\n      φ -= dφ;\r\n      λ -= dλ;\r\n      if (Math.abs(dφ) < ε && Math.abs(dλ) < ε) break;\r\n    }\r\n    return [ x < 0 ? -λ : λ, y < 0 ? -φ : φ ];\r\n  };\r\n  (d3.geo.larrivee = function() {\r\n    return projection(larrivee);\r\n  }).raw = larrivee;\r\n  function laskowski(λ, φ) {\r\n    var λ2 = λ * λ, φ2 = φ * φ;\r\n    return [ λ * (.975534 + φ2 * (-.119161 + λ2 * -.0143059 + φ2 * -.0547009)), φ * (1.00384 + λ2 * (.0802894 + φ2 * -.02855 + λ2 * 199025e-9) + φ2 * (.0998909 + φ2 * -.0491032)) ];\r\n  }\r\n  laskowski.invert = function(x, y) {\r\n    var λ = sgn(x) * π, φ = y / 2, i = 50;\r\n    do {\r\n      var λ2 = λ * λ, φ2 = φ * φ, λφ = λ * φ, fx = λ * (.975534 + φ2 * (-.119161 + λ2 * -.0143059 + φ2 * -.0547009)) - x, fy = φ * (1.00384 + λ2 * (.0802894 + φ2 * -.02855 + λ2 * 199025e-9) + φ2 * (.0998909 + φ2 * -.0491032)) - y, δxδλ = .975534 - φ2 * (.119161 + 3 * λ2 * .0143059 + φ2 * .0547009), δxδφ = -λφ * (2 * .119161 + 4 * .0547009 * φ2 + 2 * .0143059 * λ2), δyδλ = λφ * (2 * .0802894 + 4 * 199025e-9 * λ2 + 2 * -.02855 * φ2), δyδφ = 1.00384 + λ2 * (.0802894 + 199025e-9 * λ2) + φ2 * (3 * (.0998909 - .02855 * λ2) - 5 * .0491032 * φ2), denominator = δxδφ * δyδλ - δyδφ * δxδλ, δλ = (fy * δxδφ - fx * δyδφ) / denominator, δφ = (fx * δyδλ - fy * δxδλ) / denominator;\r\n      λ -= δλ, φ -= δφ;\r\n    } while ((Math.abs(δλ) > ε || Math.abs(δφ) > ε) && --i > 0);\r\n    return i && [ λ, φ ];\r\n  };\r\n  (d3.geo.laskowski = function() {\r\n    return projection(laskowski);\r\n  }).raw = laskowski;\r\n  function littrow(λ, φ) {\r\n    return [ Math.sin(λ) / Math.cos(φ), Math.tan(φ) * Math.cos(λ) ];\r\n  }\r\n  littrow.invert = function(x, y) {\r\n    var x2 = x * x, y2 = y * y, y2_1 = y2 + 1, cosφ = x ? Math.SQRT1_2 * Math.sqrt((y2_1 - Math.sqrt(x2 * x2 + 2 * x2 * (y2 - 1) + y2_1 * y2_1)) / x2 + 1) : 1 / Math.sqrt(y2_1);\r\n    return [ asin(x * cosφ), sgn(y) * acos(cosφ) ];\r\n  };\r\n  (d3.geo.littrow = function() {\r\n    return projection(littrow);\r\n  }).raw = littrow;\r\n  function loximuthal(φ0) {\r\n    var cosφ0 = Math.cos(φ0), tanφ0 = Math.tan(π / 4 + φ0 / 2);\r\n    function forward(λ, φ) {\r\n      var y = φ - φ0, x = Math.abs(y) < ε ? λ * cosφ0 : Math.abs(x = π / 4 + φ / 2) < ε || Math.abs(Math.abs(x) - halfπ) < ε ? 0 : λ * y / Math.log(Math.tan(x) / tanφ0);\r\n      return [ x, y ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var λ, φ = y + φ0;\r\n      return [ Math.abs(y) < ε ? x / cosφ0 : Math.abs(λ = π / 4 + φ / 2) < ε || Math.abs(Math.abs(λ) - halfπ) < ε ? 0 : x * Math.log(Math.tan(λ) / tanφ0) / y, φ ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.loximuthal = function() {\r\n    return parallel1Projection(loximuthal).parallel(40);\r\n  }).raw = loximuthal;\r\n  function miller(λ, φ) {\r\n    return [ λ, 1.25 * Math.log(Math.tan(π / 4 + .4 * φ)) ];\r\n  }\r\n  miller.invert = function(x, y) {\r\n    return [ x, 2.5 * Math.atan(Math.exp(.8 * y)) - .625 * π ];\r\n  };\r\n  (d3.geo.miller = function() {\r\n    return projection(miller);\r\n  }).raw = miller;\r\n  function modifiedStereographic(C) {\r\n    var m = C.length - 1;\r\n    function forward(λ, φ) {\r\n      var cosφ = Math.cos(φ), k = 2 / (1 + cosφ * Math.cos(λ)), zr = k * cosφ * Math.sin(λ), zi = k * Math.sin(φ), i = m, w = C[i], ar = w[0], ai = w[1], t;\r\n      while (--i >= 0) {\r\n        w = C[i];\r\n        ar = w[0] + zr * (t = ar) - zi * ai;\r\n        ai = w[1] + zr * ai + zi * t;\r\n      }\r\n      ar = zr * (t = ar) - zi * ai;\r\n      ai = zr * ai + zi * t;\r\n      return [ ar, ai ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var i = 20, zr = x, zi = y;\r\n      do {\r\n        var j = m, w = C[j], ar = w[0], ai = w[1], br = 0, bi = 0, t;\r\n        while (--j >= 0) {\r\n          w = C[j];\r\n          br = ar + zr * (t = br) - zi * bi;\r\n          bi = ai + zr * bi + zi * t;\r\n          ar = w[0] + zr * (t = ar) - zi * ai;\r\n          ai = w[1] + zr * ai + zi * t;\r\n        }\r\n        br = ar + zr * (t = br) - zi * bi;\r\n        bi = ai + zr * bi + zi * t;\r\n        ar = zr * (t = ar) - zi * ai - x;\r\n        ai = zr * ai + zi * t - y;\r\n        var denominator = br * br + bi * bi, δr, δi;\r\n        zr -= δr = (ar * br + ai * bi) / denominator;\r\n        zi -= δi = (ai * br - ar * bi) / denominator;\r\n      } while (Math.abs(δr) + Math.abs(δi) > ε * ε && --i > 0);\r\n      if (i) {\r\n        var ρ = Math.sqrt(zr * zr + zi * zi), c = 2 * Math.atan(ρ * .5), sinc = Math.sin(c);\r\n        return [ Math.atan2(zr * sinc, ρ * Math.cos(c)), ρ ? asin(zi * sinc / ρ) : 0 ];\r\n      }\r\n    };\r\n    return forward;\r\n  }\r\n  var modifiedStereographicCoefficients = {\r\n    alaska: [ [ .9972523, 0 ], [ .0052513, -.0041175 ], [ .0074606, .0048125 ], [ -.0153783, -.1968253 ], [ .0636871, -.1408027 ], [ .3660976, -.2937382 ] ],\r\n    gs48: [ [ .98879, 0 ], [ 0, 0 ], [ -.050909, 0 ], [ 0, 0 ], [ .075528, 0 ] ],\r\n    gs50: [ [ .984299, 0 ], [ .0211642, .0037608 ], [ -.1036018, -.0575102 ], [ -.0329095, -.0320119 ], [ .0499471, .1223335 ], [ .026046, .0899805 ], [ 7388e-7, -.1435792 ], [ .0075848, -.1334108 ], [ -.0216473, .0776645 ], [ -.0225161, .0853673 ] ],\r\n    miller: [ [ .9245, 0 ], [ 0, 0 ], [ .01943, 0 ] ],\r\n    lee: [ [ .721316, 0 ], [ 0, 0 ], [ -.00881625, -.00617325 ] ]\r\n  };\r\n  function modifiedStereographicProjection() {\r\n    var coefficients = modifiedStereographicCoefficients.miller, m = projectionMutator(modifiedStereographic), p = m(coefficients);\r\n    p.coefficients = function(_) {\r\n      if (!arguments.length) return coefficients;\r\n      return m(coefficients = typeof _ === \"string\" ? modifiedStereographicCoefficients[_] : _);\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.modifiedStereographic = modifiedStereographicProjection).raw = modifiedStereographic;\r\n  function mtFlatPolarParabolic(λ, φ) {\r\n    var sqrt6 = Math.sqrt(6), sqrt7 = Math.sqrt(7), θ = Math.asin(7 * Math.sin(φ) / (3 * sqrt6));\r\n    return [ sqrt6 * λ * (2 * Math.cos(2 * θ / 3) - 1) / sqrt7, 9 * Math.sin(θ / 3) / sqrt7 ];\r\n  }\r\n  mtFlatPolarParabolic.invert = function(x, y) {\r\n    var sqrt6 = Math.sqrt(6), sqrt7 = Math.sqrt(7), θ = 3 * asin(y * sqrt7 / 9);\r\n    return [ x * sqrt7 / (sqrt6 * (2 * Math.cos(2 * θ / 3) - 1)), asin(Math.sin(θ) * 3 * sqrt6 / 7) ];\r\n  };\r\n  (d3.geo.mtFlatPolarParabolic = function() {\r\n    return projection(mtFlatPolarParabolic);\r\n  }).raw = mtFlatPolarParabolic;\r\n  function mtFlatPolarQuartic(λ, φ) {\r\n    var k = (1 + Math.SQRT1_2) * Math.sin(φ), θ = φ;\r\n    for (var i = 0, δ; i < 25; i++) {\r\n      θ -= δ = (Math.sin(θ / 2) + Math.sin(θ) - k) / (.5 * Math.cos(θ / 2) + Math.cos(θ));\r\n      if (Math.abs(δ) < ε) break;\r\n    }\r\n    return [ λ * (1 + 2 * Math.cos(θ) / Math.cos(θ / 2)) / (3 * Math.SQRT2), 2 * Math.sqrt(3) * Math.sin(θ / 2) / Math.sqrt(2 + Math.SQRT2) ];\r\n  }\r\n  mtFlatPolarQuartic.invert = function(x, y) {\r\n    var sinθ_2 = y * Math.sqrt(2 + Math.SQRT2) / (2 * Math.sqrt(3)), θ = 2 * asin(sinθ_2);\r\n    return [ 3 * Math.SQRT2 * x / (1 + 2 * Math.cos(θ) / Math.cos(θ / 2)), asin((sinθ_2 + Math.sin(θ)) / (1 + Math.SQRT1_2)) ];\r\n  };\r\n  (d3.geo.mtFlatPolarQuartic = function() {\r\n    return projection(mtFlatPolarQuartic);\r\n  }).raw = mtFlatPolarQuartic;\r\n  function mtFlatPolarSinusoidal(λ, φ) {\r\n    var A = Math.sqrt(6 / (4 + π)), k = (1 + π / 4) * Math.sin(φ), θ = φ / 2;\r\n    for (var i = 0, δ; i < 25; i++) {\r\n      θ -= δ = (θ / 2 + Math.sin(θ) - k) / (.5 + Math.cos(θ));\r\n      if (Math.abs(δ) < ε) break;\r\n    }\r\n    return [ A * (.5 + Math.cos(θ)) * λ / 1.5, A * θ ];\r\n  }\r\n  mtFlatPolarSinusoidal.invert = function(x, y) {\r\n    var A = Math.sqrt(6 / (4 + π)), θ = y / A;\r\n    if (Math.abs(Math.abs(θ) - halfπ) < ε) θ = θ < 0 ? -halfπ : halfπ;\r\n    return [ 1.5 * x / (A * (.5 + Math.cos(θ))), asin((θ / 2 + Math.sin(θ)) / (1 + π / 4)) ];\r\n  };\r\n  (d3.geo.mtFlatPolarSinusoidal = function() {\r\n    return projection(mtFlatPolarSinusoidal);\r\n  }).raw = mtFlatPolarSinusoidal;\r\n  function naturalEarth(λ, φ) {\r\n    var φ2 = φ * φ, φ4 = φ2 * φ2;\r\n    return [ λ * (.8707 - .131979 * φ2 + φ4 * (-.013791 + φ4 * (.003971 * φ2 - .001529 * φ4))), φ * (1.007226 + φ2 * (.015085 + φ4 * (-.044475 + .028874 * φ2 - .005916 * φ4))) ];\r\n  }\r\n  naturalEarth.invert = function(x, y) {\r\n    var φ = y, i = 25, δ;\r\n    do {\r\n      var φ2 = φ * φ, φ4 = φ2 * φ2;\r\n      φ -= δ = (φ * (1.007226 + φ2 * (.015085 + φ4 * (-.044475 + .028874 * φ2 - .005916 * φ4))) - y) / (1.007226 + φ2 * (.015085 * 3 + φ4 * (-.044475 * 7 + .028874 * 9 * φ2 - .005916 * 11 * φ4)));\r\n    } while (Math.abs(δ) > ε && --i > 0);\r\n    return [ x / (.8707 + (φ2 = φ * φ) * (-.131979 + φ2 * (-.013791 + φ2 * φ2 * φ2 * (.003971 - .001529 * φ2)))), φ ];\r\n  };\r\n  (d3.geo.naturalEarth = function() {\r\n    return projection(naturalEarth);\r\n  }).raw = naturalEarth;\r\n  function nellHammer(λ, φ) {\r\n    return [ λ * (1 + Math.cos(φ)) / 2, 2 * (φ - Math.tan(φ / 2)) ];\r\n  }\r\n  nellHammer.invert = function(x, y) {\r\n    var p = y / 2;\r\n    for (var i = 0, δ = Infinity; i < 10 && Math.abs(δ) > ε; i++) {\r\n      var c = Math.cos(y / 2);\r\n      y -= δ = (y - Math.tan(y / 2) - p) / (1 - .5 / (c * c));\r\n    }\r\n    return [ 2 * x / (1 + Math.cos(y)), y ];\r\n  };\r\n  (d3.geo.nellHammer = function() {\r\n    return projection(nellHammer);\r\n  }).raw = nellHammer;\r\n  var pattersonK1 = 1.0148, pattersonK2 = .23185, pattersonK3 = -.14499, pattersonK4 = .02406, pattersonC1 = pattersonK1, pattersonC2 = 5 * pattersonK2, pattersonC3 = 7 * pattersonK3, pattersonC4 = 9 * pattersonK4, pattersonYmax = 1.790857183;\r\n  function patterson(λ, φ) {\r\n    var φ2 = φ * φ;\r\n    return [ λ, φ * (pattersonK1 + φ2 * φ2 * (pattersonK2 + φ2 * (pattersonK3 + pattersonK4 * φ2))) ];\r\n  }\r\n  patterson.invert = function(x, y) {\r\n    if (y > pattersonYmax) y = pattersonYmax; else if (y < -pattersonYmax) y = -pattersonYmax;\r\n    var yc = y, δ;\r\n    do {\r\n      var y2 = yc * yc;\r\n      yc -= δ = (yc * (pattersonK1 + y2 * y2 * (pattersonK2 + y2 * (pattersonK3 + pattersonK4 * y2))) - y) / (pattersonC1 + y2 * y2 * (pattersonC2 + y2 * (pattersonC3 + pattersonC4 * y2)));\r\n    } while (Math.abs(δ) > ε);\r\n    return [ x, yc ];\r\n  };\r\n  (d3.geo.patterson = function() {\r\n    return projection(patterson);\r\n  }).raw = patterson;\r\n  var peirceQuincuncialProjection = quincuncialProjection(guyou);\r\n  (d3.geo.peirceQuincuncial = function() {\r\n    return peirceQuincuncialProjection().quincuncial(true).rotate([ -90, -90, 45 ]).clipAngle(180 - 1e-6);\r\n  }).raw = peirceQuincuncialProjection.raw;\r\n  function polyconic(λ, φ) {\r\n    if (Math.abs(φ) < ε) return [ λ, 0 ];\r\n    var tanφ = Math.tan(φ), k = λ * Math.sin(φ);\r\n    return [ Math.sin(k) / tanφ, φ + (1 - Math.cos(k)) / tanφ ];\r\n  }\r\n  polyconic.invert = function(x, y) {\r\n    if (Math.abs(y) < ε) return [ x, 0 ];\r\n    var k = x * x + y * y, φ = y * .5, i = 10, δ;\r\n    do {\r\n      var tanφ = Math.tan(φ), secφ = 1 / Math.cos(φ), j = k - 2 * y * φ + φ * φ;\r\n      φ -= δ = (tanφ * j + 2 * (φ - y)) / (2 + j * secφ * secφ + 2 * (φ - y) * tanφ);\r\n    } while (Math.abs(δ) > ε && --i > 0);\r\n    tanφ = Math.tan(φ);\r\n    return [ (Math.abs(y) < Math.abs(φ + 1 / tanφ) ? asin(x * tanφ) : sgn(x) * (acos(Math.abs(x * tanφ)) + halfπ)) / Math.sin(φ), φ ];\r\n  };\r\n  (d3.geo.polyconic = function() {\r\n    return projection(polyconic);\r\n  }).raw = polyconic;\r\n  function rectangularPolyconic(φ0) {\r\n    var sinφ0 = Math.sin(φ0);\r\n    function forward(λ, φ) {\r\n      var A = sinφ0 ? Math.tan(λ * sinφ0 / 2) / sinφ0 : λ / 2;\r\n      if (!φ) return [ 2 * A, -φ0 ];\r\n      var E = 2 * Math.atan(A * Math.sin(φ)), cotφ = 1 / Math.tan(φ);\r\n      return [ Math.sin(E) * cotφ, φ + (1 - Math.cos(E)) * cotφ - φ0 ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      if (Math.abs(y += φ0) < ε) return [ sinφ0 ? 2 * Math.atan(sinφ0 * x / 2) / sinφ0 : x, 0 ];\r\n      var k = x * x + y * y, φ = 0, i = 10, δ;\r\n      do {\r\n        var tanφ = Math.tan(φ), secφ = 1 / Math.cos(φ), j = k - 2 * y * φ + φ * φ;\r\n        φ -= δ = (tanφ * j + 2 * (φ - y)) / (2 + j * secφ * secφ + 2 * (φ - y) * tanφ);\r\n      } while (Math.abs(δ) > ε && --i > 0);\r\n      var E = x * (tanφ = Math.tan(φ)), A = Math.tan(Math.abs(y) < Math.abs(φ + 1 / tanφ) ? asin(E) * .5 : acos(E) * .5 + π / 4) / Math.sin(φ);\r\n      return [ sinφ0 ? 2 * Math.atan(sinφ0 * A) / sinφ0 : 2 * A, φ ];\r\n    };\r\n    return forward;\r\n  }\r\n  (d3.geo.rectangularPolyconic = function() {\r\n    return parallel1Projection(rectangularPolyconic);\r\n  }).raw = rectangularPolyconic;\r\n  var robinsonConstants = [ [ .9986, -.062 ], [ 1, 0 ], [ .9986, .062 ], [ .9954, .124 ], [ .99, .186 ], [ .9822, .248 ], [ .973, .31 ], [ .96, .372 ], [ .9427, .434 ], [ .9216, .4958 ], [ .8962, .5571 ], [ .8679, .6176 ], [ .835, .6769 ], [ .7986, .7346 ], [ .7597, .7903 ], [ .7186, .8435 ], [ .6732, .8936 ], [ .6213, .9394 ], [ .5722, .9761 ], [ .5322, 1 ] ];\r\n  robinsonConstants.forEach(function(d) {\r\n    d[1] *= 1.0144;\r\n  });\r\n  function robinson(λ, φ) {\r\n    var i = Math.min(18, Math.abs(φ) * 36 / π), i0 = Math.floor(i), di = i - i0, ax = (k = robinsonConstants[i0])[0], ay = k[1], bx = (k = robinsonConstants[++i0])[0], by = k[1], cx = (k = robinsonConstants[Math.min(19, ++i0)])[0], cy = k[1], k;\r\n    return [ λ * (bx + di * (cx - ax) / 2 + di * di * (cx - 2 * bx + ax) / 2), (φ > 0 ? halfπ : -halfπ) * (by + di * (cy - ay) / 2 + di * di * (cy - 2 * by + ay) / 2) ];\r\n  }\r\n  robinson.invert = function(x, y) {\r\n    var yy = y / halfπ, φ = yy * 90, i = Math.min(18, Math.abs(φ / 5)), i0 = Math.max(0, Math.floor(i));\r\n    do {\r\n      var ay = robinsonConstants[i0][1], by = robinsonConstants[i0 + 1][1], cy = robinsonConstants[Math.min(19, i0 + 2)][1], u = cy - ay, v = cy - 2 * by + ay, t = 2 * (Math.abs(yy) - by) / u, c = v / u, di = t * (1 - c * t * (1 - 2 * c * t));\r\n      if (di >= 0 || i0 === 1) {\r\n        φ = (y >= 0 ? 5 : -5) * (di + i);\r\n        var j = 50, δ;\r\n        do {\r\n          i = Math.min(18, Math.abs(φ) / 5);\r\n          i0 = Math.floor(i);\r\n          di = i - i0;\r\n          ay = robinsonConstants[i0][1];\r\n          by = robinsonConstants[i0 + 1][1];\r\n          cy = robinsonConstants[Math.min(19, i0 + 2)][1];\r\n          φ -= (δ = (y >= 0 ? halfπ : -halfπ) * (by + di * (cy - ay) / 2 + di * di * (cy - 2 * by + ay) / 2) - y) * degrees;\r\n        } while (Math.abs(δ) > ε2 && --j > 0);\r\n        break;\r\n      }\r\n    } while (--i0 >= 0);\r\n    var ax = robinsonConstants[i0][0], bx = robinsonConstants[i0 + 1][0], cx = robinsonConstants[Math.min(19, i0 + 2)][0];\r\n    return [ x / (bx + di * (cx - ax) / 2 + di * di * (cx - 2 * bx + ax) / 2), φ * radians ];\r\n  };\r\n  (d3.geo.robinson = function() {\r\n    return projection(robinson);\r\n  }).raw = robinson;\r\n  function satelliteVertical(P) {\r\n    function forward(λ, φ) {\r\n      var cosφ = Math.cos(φ), k = (P - 1) / (P - cosφ * Math.cos(λ));\r\n      return [ k * cosφ * Math.sin(λ), k * Math.sin(φ) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var ρ2 = x * x + y * y, ρ = Math.sqrt(ρ2), sinc = (P - Math.sqrt(1 - ρ2 * (P + 1) / (P - 1))) / ((P - 1) / ρ + ρ / (P - 1));\r\n      return [ Math.atan2(x * sinc, ρ * Math.sqrt(1 - sinc * sinc)), ρ ? asin(y * sinc / ρ) : 0 ];\r\n    };\r\n    return forward;\r\n  }\r\n  function satellite(P, ω) {\r\n    var vertical = satelliteVertical(P);\r\n    if (!ω) return vertical;\r\n    var cosω = Math.cos(ω), sinω = Math.sin(ω);\r\n    function forward(λ, φ) {\r\n      var coordinates = vertical(λ, φ), y = coordinates[1], A = y * sinω / (P - 1) + cosω;\r\n      return [ coordinates[0] * cosω / A, y / A ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var k = (P - 1) / (P - 1 - y * sinω);\r\n      return vertical.invert(k * x, k * y * cosω);\r\n    };\r\n    return forward;\r\n  }\r\n  function satelliteProjection() {\r\n    var P = 1.4, ω = 0, m = projectionMutator(satellite), p = m(P, ω);\r\n    p.distance = function(_) {\r\n      if (!arguments.length) return P;\r\n      return m(P = +_, ω);\r\n    };\r\n    p.tilt = function(_) {\r\n      if (!arguments.length) return ω * 180 / π;\r\n      return m(P, ω = _ * π / 180);\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.satellite = satelliteProjection).raw = satellite;\r\n  function times(λ, φ) {\r\n    var t = Math.tan(φ / 2), s = Math.sin(π / 4 * t);\r\n    return [ λ * (.74482 - .34588 * s * s), 1.70711 * t ];\r\n  }\r\n  times.invert = function(x, y) {\r\n    var t = y / 1.70711, s = Math.sin(π / 4 * t);\r\n    return [ x / (.74482 - .34588 * s * s), 2 * Math.atan(t) ];\r\n  };\r\n  (d3.geo.times = function() {\r\n    return projection(times);\r\n  }).raw = times;\r\n  function twoPointEquidistant(z0) {\r\n    if (!z0) return d3.geo.azimuthalEquidistant.raw;\r\n    var λa = -z0 / 2, λb = -λa, z02 = z0 * z0, tanλ0 = Math.tan(λb), S = .5 / Math.sin(λb);\r\n    function forward(λ, φ) {\r\n      var za = acos(Math.cos(φ) * Math.cos(λ - λa)), zb = acos(Math.cos(φ) * Math.cos(λ - λb)), ys = φ < 0 ? -1 : 1;\r\n      za *= za, zb *= zb;\r\n      return [ (za - zb) / (2 * z0), ys * asqrt(4 * z02 * zb - (z02 - za + zb) * (z02 - za + zb)) / (2 * z0) ];\r\n    }\r\n    forward.invert = function(x, y) {\r\n      var y2 = y * y, cosza = Math.cos(Math.sqrt(y2 + (t = x + λa) * t)), coszb = Math.cos(Math.sqrt(y2 + (t = x + λb) * t)), t, d;\r\n      return [ Math.atan2(d = cosza - coszb, t = (cosza + coszb) * tanλ0), (y < 0 ? -1 : 1) * acos(Math.sqrt(t * t + d * d) * S) ];\r\n    };\r\n    return forward;\r\n  }\r\n  function twoPointEquidistantProjection() {\r\n    var points = [ [ 0, 0 ], [ 0, 0 ] ], m = projectionMutator(twoPointEquidistant), p = m(0), rotate = p.rotate;\r\n    delete p.rotate;\r\n    p.points = function(_) {\r\n      if (!arguments.length) return points;\r\n      points = _;\r\n      var interpolate = d3.geo.interpolate(_[0], _[1]), origin = interpolate(.5), p = d3.geo.rotation([ -origin[0], -origin[1] ])(_[0]), b = interpolate.distance * .5, γ = -asin(Math.sin(p[1] * radians) / Math.sin(b));\r\n      if (p[0] > 0) γ = π - γ;\r\n      rotate.call(p, [ -origin[0], -origin[1], -γ * degrees ]);\r\n      return m(b * 2);\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.twoPointEquidistant = twoPointEquidistantProjection).raw = twoPointEquidistant;\r\n  function twoPointAzimuthal(d) {\r\n    var cosd = Math.cos(d);\r\n    function forward(λ, φ) {\r\n      var coordinates = d3.geo.gnomonic.raw(λ, φ);\r\n      coordinates[0] *= cosd;\r\n      return coordinates;\r\n    }\r\n    forward.invert = function(x, y) {\r\n      return d3.geo.gnomonic.raw.invert(x / cosd, y);\r\n    };\r\n    return forward;\r\n  }\r\n  function twoPointAzimuthalProjection() {\r\n    var points = [ [ 0, 0 ], [ 0, 0 ] ], m = projectionMutator(twoPointAzimuthal), p = m(0), rotate = p.rotate;\r\n    delete p.rotate;\r\n    p.points = function(_) {\r\n      if (!arguments.length) return points;\r\n      points = _;\r\n      var interpolate = d3.geo.interpolate(_[0], _[1]), origin = interpolate(.5), p = d3.geo.rotation([ -origin[0], -origin[1] ])(_[0]), b = interpolate.distance * .5, γ = -asin(Math.sin(p[1] * radians) / Math.sin(b));\r\n      if (p[0] > 0) γ = π - γ;\r\n      rotate.call(p, [ -origin[0], -origin[1], -γ * degrees ]);\r\n      return m(b);\r\n    };\r\n    return p;\r\n  }\r\n  (d3.geo.twoPointAzimuthal = twoPointAzimuthalProjection).raw = twoPointAzimuthal;\r\n  function vanDerGrinten(λ, φ) {\r\n    if (Math.abs(φ) < ε) return [ λ, 0 ];\r\n    var sinθ = Math.abs(φ / halfπ), θ = asin(sinθ);\r\n    if (Math.abs(λ) < ε || Math.abs(Math.abs(φ) - halfπ) < ε) return [ 0, sgn(φ) * π * Math.tan(θ / 2) ];\r\n    var cosθ = Math.cos(θ), A = Math.abs(π / λ - λ / π) / 2, A2 = A * A, G = cosθ / (sinθ + cosθ - 1), P = G * (2 / sinθ - 1), P2 = P * P, P2_A2 = P2 + A2, G_P2 = G - P2, Q = A2 + G;\r\n    return [ sgn(λ) * π * (A * G_P2 + Math.sqrt(A2 * G_P2 * G_P2 - P2_A2 * (G * G - P2))) / P2_A2, sgn(φ) * π * (P * Q - A * Math.sqrt((A2 + 1) * P2_A2 - Q * Q)) / P2_A2 ];\r\n  }\r\n  vanDerGrinten.invert = function(x, y) {\r\n    if (Math.abs(y) < ε) return [ x, 0 ];\r\n    if (Math.abs(x) < ε) return [ 0, halfπ * Math.sin(2 * Math.atan(y / π)) ];\r\n    var x2 = (x /= π) * x, y2 = (y /= π) * y, x2_y2 = x2 + y2, z = x2_y2 * x2_y2, c1 = -Math.abs(y) * (1 + x2_y2), c2 = c1 - 2 * y2 + x2, c3 = -2 * c1 + 1 + 2 * y2 + z, d = y2 / c3 + (2 * c2 * c2 * c2 / (c3 * c3 * c3) - 9 * c1 * c2 / (c3 * c3)) / 27, a1 = (c1 - c2 * c2 / (3 * c3)) / c3, m1 = 2 * Math.sqrt(-a1 / 3), θ1 = acos(3 * d / (a1 * m1)) / 3;\r\n    return [ π * (x2_y2 - 1 + Math.sqrt(1 + 2 * (x2 - y2) + z)) / (2 * x), sgn(y) * π * (-m1 * Math.cos(θ1 + π / 3) - c2 / (3 * c3)) ];\r\n  };\r\n  (d3.geo.vanDerGrinten = function() {\r\n    return projection(vanDerGrinten);\r\n  }).raw = vanDerGrinten;\r\n  function vanDerGrinten2(λ, φ) {\r\n    if (Math.abs(φ) < ε) return [ λ, 0 ];\r\n    var sinθ = Math.abs(φ / halfπ), θ = asin(sinθ);\r\n    if (Math.abs(λ) < ε || Math.abs(Math.abs(φ) - halfπ) < ε) return [ 0, sgn(φ) * π * Math.tan(θ / 2) ];\r\n    var cosθ = Math.cos(θ), A = Math.abs(π / λ - λ / π) / 2, A2 = A * A, x1 = cosθ * (Math.sqrt(1 + A2) - A * cosθ) / (1 + A2 * sinθ * sinθ);\r\n    return [ sgn(λ) * π * x1, sgn(φ) * π * asqrt(1 - x1 * (2 * A + x1)) ];\r\n  }\r\n  vanDerGrinten2.invert = function(x, y) {\r\n    if (!x) return [ 0, halfπ * Math.sin(2 * Math.atan(y / π)) ];\r\n    var x1 = Math.abs(x / π), A = (1 - x1 * x1 - (y /= π) * y) / (2 * x1), A2 = A * A, B = Math.sqrt(A2 + 1);\r\n    return [ sgn(x) * π * (B - A), sgn(y) * halfπ * Math.sin(2 * Math.atan2(Math.sqrt((1 - 2 * A * x1) * (A + B) - x1), Math.sqrt(B + A + x1))) ];\r\n  };\r\n  (d3.geo.vanDerGrinten2 = function() {\r\n    return projection(vanDerGrinten2);\r\n  }).raw = vanDerGrinten2;\r\n  function vanDerGrinten3(λ, φ) {\r\n    if (Math.abs(φ) < ε) return [ λ, 0 ];\r\n    var sinθ = φ / halfπ, θ = asin(sinθ);\r\n    if (Math.abs(λ) < ε || Math.abs(Math.abs(φ) - halfπ) < ε) return [ 0, π * Math.tan(θ / 2) ];\r\n    var A = (π / λ - λ / π) / 2, y1 = sinθ / (1 + Math.cos(θ));\r\n    return [ π * (sgn(λ) * asqrt(A * A + 1 - y1 * y1) - A), π * y1 ];\r\n  }\r\n  vanDerGrinten3.invert = function(x, y) {\r\n    if (!y) return [ x, 0 ];\r\n    var y1 = y / π, A = (π * π * (1 - y1 * y1) - x * x) / (2 * π * x);\r\n    return [ x ? π * (sgn(x) * Math.sqrt(A * A + 1) - A) : 0, halfπ * Math.sin(2 * Math.atan(y1)) ];\r\n  };\r\n  (d3.geo.vanDerGrinten3 = function() {\r\n    return projection(vanDerGrinten3);\r\n  }).raw = vanDerGrinten3;\r\n  function vanDerGrinten4(λ, φ) {\r\n    if (!φ) return [ λ, 0 ];\r\n    var φ0 = Math.abs(φ);\r\n    if (!λ || φ0 === halfπ) return [ 0, φ ];\r\n    var B = φ0 / halfπ, B2 = B * B, C = (8 * B - B2 * (B2 + 2) - 5) / (2 * B2 * (B - 1)), C2 = C * C, BC = B * C, B_C2 = B2 + C2 + 2 * BC, B_3C = B + 3 * C, λ0 = λ / halfπ, λ1 = λ0 + 1 / λ0, D = sgn(Math.abs(λ) - halfπ) * Math.sqrt(λ1 * λ1 - 4), D2 = D * D, F = B_C2 * (B2 + C2 * D2 - 1) + (1 - B2) * (B2 * (B_3C * B_3C + 4 * C2) + 12 * BC * C2 + 4 * C2 * C2), x1 = (D * (B_C2 + C2 - 1) + 2 * asqrt(F)) / (4 * B_C2 + D2);\r\n    return [ sgn(λ) * halfπ * x1, sgn(φ) * halfπ * asqrt(1 + D * Math.abs(x1) - x1 * x1) ];\r\n  }\r\n  vanDerGrinten4.invert = function(x, y) {\r\n    if (!x || !y) return [ x, y ];\r\n    y /= π;\r\n    var x1 = sgn(x) * x / halfπ, D = (x1 * x1 - 1 + 4 * y * y) / Math.abs(x1), D2 = D * D, B = 2 * y, i = 50;\r\n    do {\r\n      var B2 = B * B, C = (8 * B - B2 * (B2 + 2) - 5) / (2 * B2 * (B - 1)), C_ = (3 * B - B2 * B - 10) / (2 * B2 * B), C2 = C * C, BC = B * C, B_C = B + C, B_C2 = B_C * B_C, B_3C = B + 3 * C, F = B_C2 * (B2 + C2 * D2 - 1) + (1 - B2) * (B2 * (B_3C * B_3C + 4 * C2) + C2 * (12 * BC + 4 * C2)), F_ = -2 * B_C * (4 * BC * C2 + (1 - 4 * B2 + 3 * B2 * B2) * (1 + C_) + C2 * (-6 + 14 * B2 - D2 + (-8 + 8 * B2 - 2 * D2) * C_) + BC * (-8 + 12 * B2 + (-10 + 10 * B2 - D2) * C_)), sqrtF = Math.sqrt(F), f = D * (B_C2 + C2 - 1) + 2 * sqrtF - x1 * (4 * B_C2 + D2), f_ = D * (2 * C * C_ + 2 * B_C * (1 + C_)) + F_ / sqrtF - 8 * B_C * (D * (-1 + C2 + B_C2) + 2 * sqrtF) * (1 + C_) / (D2 + 4 * B_C2);\r\n      B -= δ = f / f_;\r\n    } while (δ > ε && --i > 0);\r\n    return [ sgn(x) * (Math.sqrt(D * D + 4) + D) * π / 4, halfπ * B ];\r\n  };\r\n  (d3.geo.vanDerGrinten4 = function() {\r\n    return projection(vanDerGrinten4);\r\n  }).raw = vanDerGrinten4;\r\n  var wagner4 = function() {\r\n    var A = 4 * π + 3 * Math.sqrt(3), B = 2 * Math.sqrt(2 * π * Math.sqrt(3) / A);\r\n    return mollweideBromley(B * Math.sqrt(3) / π, B, A / 6);\r\n  }();\r\n  (d3.geo.wagner4 = function() {\r\n    return projection(wagner4);\r\n  }).raw = wagner4;\r\n  function wagner6(λ, φ) {\r\n    return [ λ * Math.sqrt(1 - 3 * φ * φ / (π * π)), φ ];\r\n  }\r\n  wagner6.invert = function(x, y) {\r\n    return [ x / Math.sqrt(1 - 3 * y * y / (π * π)), y ];\r\n  };\r\n  (d3.geo.wagner6 = function() {\r\n    return projection(wagner6);\r\n  }).raw = wagner6;\r\n  function wagner7(λ, φ) {\r\n    var s = .90631 * Math.sin(φ), c0 = Math.sqrt(1 - s * s), c1 = Math.sqrt(2 / (1 + c0 * Math.cos(λ /= 3)));\r\n    return [ 2.66723 * c0 * c1 * Math.sin(λ), 1.24104 * s * c1 ];\r\n  }\r\n  wagner7.invert = function(x, y) {\r\n    var t1 = x / 2.66723, t2 = y / 1.24104, p = Math.sqrt(t1 * t1 + t2 * t2), c = 2 * asin(p / 2);\r\n    return [ 3 * Math.atan2(x * Math.tan(c), 2.66723 * p), p && asin(y * Math.sin(c) / (1.24104 * .90631 * p)) ];\r\n  };\r\n  (d3.geo.wagner7 = function() {\r\n    return projection(wagner7);\r\n  }).raw = wagner7;\r\n  function wiechel(λ, φ) {\r\n    var cosφ = Math.cos(φ), sinφ = Math.cos(λ) * cosφ, sin1_φ = 1 - sinφ, cosλ = Math.cos(λ = Math.atan2(Math.sin(λ) * cosφ, -Math.sin(φ))), sinλ = Math.sin(λ);\r\n    cosφ = asqrt(1 - sinφ * sinφ);\r\n    return [ sinλ * cosφ - cosλ * sin1_φ, -cosλ * cosφ - sinλ * sin1_φ ];\r\n  }\r\n  wiechel.invert = function(x, y) {\r\n    var w = -.5 * (x * x + y * y), k = Math.sqrt(-w * (2 + w)), b = y * w + x * k, a = x * w - y * k, D = Math.sqrt(a * a + b * b);\r\n    return [ Math.atan2(k * b, D * (1 + w)), D ? -asin(k * a / D) : 0 ];\r\n  };\r\n  (d3.geo.wiechel = function() {\r\n    return projection(wiechel);\r\n  }).raw = wiechel;\r\n  function winkel3(λ, φ) {\r\n    var coordinates = aitoff(λ, φ);\r\n    return [ (coordinates[0] + λ / halfπ) / 2, (coordinates[1] + φ) / 2 ];\r\n  }\r\n  winkel3.invert = function(x, y) {\r\n    var λ = x, φ = y, i = 25;\r\n    do {\r\n      var cosφ = Math.cos(φ), sinφ = Math.sin(φ), sin_2φ = Math.sin(2 * φ), sin2φ = sinφ * sinφ, cos2φ = cosφ * cosφ, sinλ = Math.sin(λ), cosλ_2 = Math.cos(λ / 2), sinλ_2 = Math.sin(λ / 2), sin2λ_2 = sinλ_2 * sinλ_2, C = 1 - cos2φ * cosλ_2 * cosλ_2, E = C ? acos(cosφ * cosλ_2) * Math.sqrt(F = 1 / C) : F = 0, F, fx = .5 * (2 * E * cosφ * sinλ_2 + λ / halfπ) - x, fy = .5 * (E * sinφ + φ) - y, δxδλ = .5 * F * (cos2φ * sin2λ_2 + E * cosφ * cosλ_2 * sin2φ) + .5 / halfπ, δxδφ = F * (sinλ * sin_2φ / 4 - E * sinφ * sinλ_2), δyδλ = .125 * F * (sin_2φ * sinλ_2 - E * sinφ * cos2φ * sinλ), δyδφ = .5 * F * (sin2φ * cosλ_2 + E * sin2λ_2 * cosφ) + .5, denominator = δxδφ * δyδλ - δyδφ * δxδλ, δλ = (fy * δxδφ - fx * δyδφ) / denominator, δφ = (fx * δyδλ - fy * δxδλ) / denominator;\r\n      λ -= δλ, φ -= δφ;\r\n    } while ((Math.abs(δλ) > ε || Math.abs(δφ) > ε) && --i > 0);\r\n    return [ λ, φ ];\r\n  };\r\n  (d3.geo.winkel3 = function() {\r\n    return projection(winkel3);\r\n  }).raw = winkel3;\r\n  function cassini(λ, φ) {\r\n    var cosφ = Math.cos(φ), tanφ = Math.tan(φ), cosλ = Math.cos(λ), sinλ = Math.sin(λ);\r\n    return [ Math.asin(cosφ * sinλ), Math.atan2(tanφ, cosλ) ];\r\n  }\r\n  cassini.invert = function(x, y) {\r\n    return [ Math.asin(Math.cos(x) * Math.sin(y)), Math.atan2(Math.tan(x), Math.cos(y)) ];\r\n  };\r\n  (d3.geo.cassini = function() {\r\n    return projection(cassini);\r\n  }).raw = cassini;  \r\n})();\n;","inputSourceMap":null}